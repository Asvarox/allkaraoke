import{c as w,g as m,s as c,S as f}from"./index-DEM6R1xy.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="387fc6b3-7b06-4a2c-8370-39cfb39bc19d",e._sentryDebugIdIdentifier="sentry-dbid-387fc6b3-7b06-4a2c-8370-39cfb39bc19d")}catch{}})();{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};r._sentryModuleMetadata=r._sentryModuleMetadata||{},r._sentryModuleMetadata[new r.Error().stack]=Object.assign({},r._sentryModuleMetadata[new r.Error().stack],{"_sentryBundlerPluginAppKey:allkaraoke-party-sentry-key":!0})}const S="https://eu.posthog.com",I="281",b=new Date(Date.now()-1e3*3600*24*28).toISOString(),v=["(tv)","(album version)","(movie version)","[duet]"],D=e=>(v.forEach(t=>{e.title.toLowerCase().endsWith(t)&&(e.title=e.title.slice(0,-t.length))}),e.title=e.title.trim(),e.language=e.language.map(t=>t.toLowerCase().startsWith("espa")?"Spanish":t.toLowerCase().endsWith("(romanized)")?t.slice(0,-11).trim():t.toLowerCase().endsWith("(brazil)")?"Portuguese":t),e.lastUpdate=new Date().toISOString(),e.id=void 0,e.id=m(e),e),k=async(e,t,s,u,n,a)=>{var y,h;const i=await e(`${S}/api/projects/${I}/query`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:{kind:"HogQLQuery",query:`
            select events.properties.song, events.properties.songId, events.created_at
            from events
            where events.created_at > toDateTime('${a??b}')
              and event IN ('share-song', 'unshare-song') and events.properties.$user_id !='3ab0feed-e1d2-4ff0-8780-5db00698eb60'
            ORDER BY events.created_at ASC
            LIMIT 300
        `}})}),p=[];for(const[l,d]of i.results)try{!l&&d&&p.includes(d)&&(await n(d),console.log(`Deleting song ${d}`));const o=w(l.replaceAll("\\n",`
`).replaceAll('\\"','"'));if(!o.id){console.log("Song has no ID",o);return}D(o),s.includes(o.id)?console.log(`Song ${o.id} already fetched`):(((y=o.tracks[0])==null?void 0:y.sections.length)??0)<5?console.log(`Song ${o.id} seems to be broken, ${(h=o.tracks[0])==null?void 0:h.sections.length} sections found`):t.find(g=>g.id===o.id)?console.log(`Song ${o.id} already exists (by song id)`):t.find(g=>g.video===o.video)?console.log(`Song ${o.id} already exists (by video id)`):(o.lastUpdate=new Date().toISOString(),p.push(o.id),await u(o),console.log(`Added song ${o.id}`))}catch{console.warn(`Couldn't convert song ${l}`)}},$=async()=>{const e=c.session.getItem("posthog_key")||prompt("Enter PostHog PAT");if(!e)return;c.session.setItem("posthog_key",e);const t=new Date;t.setDate(t.getDate()-10);let s=prompt("Enter from",c.local.getItem("posthog_from")||t.toISOString());if(s===null)return;s=new Date(s).toISOString(),c.local.setItem("posthog_from",new Date().toISOString()),await k(async(n,a)=>{const i=await fetch(n,{...a,headers:{...a.headers,Authorization:`Bearer ${e}`}});if(!i.ok)throw new Error(`Request failed with status ${i.status}`);return i.json()},await f.getIndex(!0),[],async n=>f.store(n),async n=>f.deleteSong(n),s)};export{$ as default};
//# sourceMappingURL=importSongsFromPostHog-q212EWwE.js.map
