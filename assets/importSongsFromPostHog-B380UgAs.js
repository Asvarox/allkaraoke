import{c as m,g as u,S as g}from"./index-C6Gg2PS2.js";const p="https://eu.posthog.com",S="281",f=new Date(Date.now()-1e3*3600*24*28).toISOString(),h=["(tv)","(album version)","(movie version)","[duet]"],w=e=>(h.forEach(t=>{e.title.toLowerCase().endsWith(t)&&(e.title=e.title.slice(0,-t.length))}),e.title=e.title.trim(),e.language=e.language.map(t=>t.toLowerCase().startsWith("espa")?"Spanish":t.toLowerCase().endsWith("(romanized)")?t.slice(0,-11).trim():t.toLowerCase().endsWith("(brazil)")?"Portuguese":t),e.lastUpdate=new Date().toISOString(),e.id=void 0,e.id=u(e),e),I=async(e,t,s,a,r)=>{const n=await e(`${p}/api/projects/${S}/events?event=share-song&after=${r??f}&limit=200`);await Promise.all(n.results.map(async i=>{var l,c;try{let o=m(i.properties.song);if(!o.id){console.log("Song has no ID",o);return}w(o),s.includes(o.id)?console.log(`Song ${o.id} already fetched`):(((l=o.tracks[0])==null?void 0:l.sections.length)??0)<5?console.log(`Song ${o.id} seems to be broken, ${(c=o.tracks[0])==null?void 0:c.sections.length} sections found`):t.find(d=>d.id===o.id)?console.log(`Song ${o.id} already exists`):(o.lastUpdate=new Date().toISOString(),await a(o),console.log(`Added song ${o.id}`))}catch{console.warn(`Couldn't convert song ${i.properties.song}`)}}))},y=async()=>{const e=sessionStorage.getItem("posthog_key")||prompt("Enter PostHog PAT");if(!e)return;sessionStorage.setItem("posthog_key",e);const t=new Date;t.setDate(t.getDate()-10);let s=prompt("Enter from",localStorage.getItem("posthog_from")||t.toISOString());if(s===null)return;s=new Date(s).toISOString(),localStorage.setItem("posthog_from",new Date().toISOString()),await I(async r=>{const n=await fetch(r,{headers:{Authorization:`Bearer ${e}`}});if(!n.ok)throw new Error(`Request failed with status ${n.status}`);return n.json()},await g.getIndex(!0),[],async r=>g.store(r),s)};export{y as default};
//# sourceMappingURL=importSongsFromPostHog-B380UgAs.js.map
