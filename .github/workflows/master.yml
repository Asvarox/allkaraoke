name: Cypress Tests

on: [push]

jobs:
    cypress-run:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v2
            - name: Install
              uses: actions/setup-node@v2
              with:
                  node-version: '16'
                  cache: 'yarn'
            - run: yarn install
            - run: yarn test
            - name: Cypress run
              uses: cypress-io/github-action@v2
              with:
                  build: yarn run build
                  start: yarn start:production
              env:
                  DISABLE_ESLINT_PLUGIN: true
            - uses: actions/upload-artifact@v3
              if: failure()
              with:
                  name: cypress-test-results
                  path: |
                      src/**/__diff_output__/*
                      cypress/screenshots
                      cypress/videos
                      cypress/integration/__image_snapshots__
            - name: Deploy ðŸš€
              uses: JamesIves/github-pages-deploy-action@v4.3.0
              with:
                  branch: gh-pages # The branch the action should deploy to.
                  folder: build # The folder the action should deploy.
