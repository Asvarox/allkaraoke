import{a7 as ve,c0 as Ht,c1 as be,c2 as ye,c as xe,j as h,r as m,c3 as Dt,c4 as zt,c5 as Se,aq as Me,c6 as q,c7 as Pe,c8 as we,c9 as ft,a9 as H,ay as st,bg as v,ai as mt,ak as pt,a4 as S,as as vt,aj as qt,R as ke,ca as Te,br as je,aY as Ce,b8 as Wt,b5 as Re,au as C,Q as Yt,S as Xt,aT as Gt,cb as Ie,aQ as Ee,b7 as N,cc as tt,aH as Ne,ae as W,aC as Pt,aP as et,cd as J,aa as V,ce as wt,cf as ot,cg as Ae,a_ as F,aG as Fe,aZ as Oe,ch as $e}from"./index-eef155d3.js";function _e(t,e,n){var r=t.length;return n=n===void 0?r:n,!e&&n>=r?t:ve(t,e,n)}var Le="\\ud800-\\udfff",Be="\\u0300-\\u036f",Ve="\\ufe20-\\ufe2f",He="\\u20d0-\\u20ff",De=Be+Ve+He,ze="\\ufe0e\\ufe0f",qe="\\u200d",We=RegExp("["+qe+Le+De+ze+"]");function Ut(t){return We.test(t)}function Ye(t){return t.split("")}var Kt="\\ud800-\\udfff",Xe="\\u0300-\\u036f",Ge="\\ufe20-\\ufe2f",Ue="\\u20d0-\\u20ff",Ke=Xe+Ge+Ue,Je="\\ufe0e\\ufe0f",Qe="["+Kt+"]",ut="["+Ke+"]",dt="\\ud83c[\\udffb-\\udfff]",Ze="(?:"+ut+"|"+dt+")",Jt="[^"+Kt+"]",Qt="(?:\\ud83c[\\udde6-\\uddff]){2}",Zt="[\\ud800-\\udbff][\\udc00-\\udfff]",ts="\\u200d",te=Ze+"?",ee="["+Je+"]?",es="(?:"+ts+"(?:"+[Jt,Qt,Zt].join("|")+")"+ee+te+")*",ss=ee+te+es,ns="(?:"+[Jt+ut+"?",ut,Qt,Zt,Qe].join("|")+")",rs=RegExp(dt+"(?="+dt+")|"+ns+ss,"g");function is(t){return t.match(rs)||[]}function as(t){return Ut(t)?is(t):Ye(t)}function os(t){return function(e){e=Ht(e);var n=Ut(e)?as(e):void 0,r=n?n[0]:e.charAt(0),s=n?_e(n,1).join(""):e.slice(1);return r[t]()+s}}var cs=os("toUpperCase");const ls=cs;function hs(t){return ls(Ht(t).toLowerCase())}var us=1,ds=4;function sr(t){return be(t,us|ds)}function kt(t){return t&&t.length?ye(t):[]}const gs=xe(h.jsx("path",{d:"M2 20h2c.55 0 1-.45 1-1v-9c0-.55-.45-1-1-1H2v11zm19.83-7.12c.11-.25.17-.52.17-.8V11c0-1.1-.9-2-2-2h-5.5l.92-4.65c.05-.22.02-.46-.08-.66-.23-.45-.52-.86-.88-1.22L14 2 7.59 8.41C7.21 8.79 7 9.3 7 9.83v7.84C7 18.95 8.05 20 9.34 20h8.11c.7 0 1.36-.37 1.72-.97l2.66-6.15z"}),"ThumbUpAlt");var fs=function(t,e){var n=m.useRef(function(){});m.useEffect(function(){n.current=t}),m.useEffect(function(){if(e!==null){var r=setInterval(function(){return n.current()},e||0);return function(){return clearInterval(r)}}},[e])};const ms=fs;function ps(t){const e=m.useRef(t);return m.useEffect(()=>{e.current=t},[t]),e.current}function vs({onClose:t,closeButtonText:e}){return h.jsx(Dt,{onClose:t,children:h.jsx(zt,{children:h.jsx(Se,{smooth:!1,onBack:t,onFinish:t,closeButtonText:e,skipText:"Back"})})})}function bs({onResume:t,onExit:e,onRestart:n}){const r=m.useRef(null),s=m.useRef(null);m.useEffect(()=>{var a;(a=r.current)==null||a.focus()},[r]);const[i,c]=m.useState(!1),{register:o}=Me({enabled:!i});return h.jsxs(Dt,{onClose:t,children:[h.jsxs(zt,{children:[h.jsx(q,{...o("button-resume-song",t),ref:r,children:"Resume song"}),h.jsx(q,{...o("button-restart-song",n),children:"Restart song"}),h.jsx(q,{...o("button-exit-song",e),children:"Exit song"}),h.jsx(q,{...o("input-settings",()=>c(!0)),children:"Microphones settings"}),h.jsx("hr",{}),h.jsx(Pe,{ref:s,...o("input-lag",()=>{var a;return(a=s.current)==null?void 0:a.focus()})})]}),i&&h.jsx(vs,{onClose:()=>c(!1),closeButtonText:"Back to Pause Menu"})]})}const se=we()?1e3:8e3;function ys(t){return Math.floor((ft(t)-se)/1e3)}const xs=2e4;function Ss(t){return ft(t)-(t.videoGap??0)*1e3>xs}function Ms({playerRef:t,isEnabled:e}){const[n]=H(st),r=v.getSong(),s=m.useMemo(()=>Ss(r),[r]),i=m.useMemo(()=>ft(r),[r]),c=v.getCurrentTime(!1)<i-se*1.2,o=e&&c&&s;mt({accept:()=>{t==null||t.seekTo(ys(r));const{artist:d,title:u}=v.getSong();qt.capture("introSkipped",{name:`${d} - ${u}`,artist:d,title:u})}},o);const l=m.useMemo(()=>({accept:"Skip Intro",back:"Pause Menu"}),[]);return pt(l,o),!n&&o?h.jsxs(Ps,{visible:o,"data-test":"skip-intro-info",children:["Press ",h.jsx(ws,{children:"Enter"})," to skip the intro"]}):null}const Ps=S("div",{target:"e3375ar1"})(vt,";pointer-events:none;position:fixed;bottom:29rem;transform:scale(",t=>t.visible?1:0,");opacity:",t=>t.visible?1:0,";text-align:center;font-size:5rem;text-shadow:0 0 3.5rem black;width:100%;z-index:4;padding:0.5rem;transition:ease 500ms;"),ws=S("kbd",{target:"e3375ar0"})("margin:0.2rem;padding:0.2rem 2rem;border-radius:1.3rem;border:0.5rem solid rgb(204, 204, 204);border-bottom-color:rgb(150, 150, 150);border-right-color:rgb(150, 150, 150);line-height:1.4;display:inline-block;background-color:rgb(247, 247, 247);text-shadow:0 1rem 0 #fff;opacity:",t=>t.disabled?.25:1,";"),ks=15e3;function Ts({onSongEnd:t,isEnabled:e}){const[n]=H(st),r=v.getDuration(),s=m.useMemo(()=>Math.max(...v.getPlayers().map(p=>Te(p.getLastNotesSection()))),[]),i=m.useMemo(()=>{const p=je(s,v.getSong());return e&&r*1e3>p+ks},[r,s,e]),[c,o]=m.useState(0),[a,l]=m.useState(!1);ms(()=>o(v.getCurrentBeat()),1e3);const d=Ce(i&&c>s,5e3)&&!a;mt({accept:()=>{l(!0),setTimeout(t,700);const{artist:p,title:y}=v.getSong();qt.capture("outroSkipped",{name:`${p} - ${y}`,artist:p,title:y})}},d);const g=m.useMemo(()=>({accept:"Skip Outro",back:"Pause Menu"}),[]);return pt(g,d),!n&&i?h.jsxs(js,{visible:d,children:["Press ",h.jsx(Cs,{children:"Enter"})," to skip the outro"]}):null}const js=S("div",{target:"ehmmgcc1"})(vt,";pointer-events:none;position:fixed;bottom:29rem;transform:scale(",t=>t.visible?1:0,");opacity:",t=>t.visible?1:0,";text-align:center;font-size:5rem;text-shadow:0 0 3.5rem black;width:100%;z-index:4;padding:0.5rem;transition:ease 500ms;"),Cs=S("kbd",{target:"ehmmgcc0"})("margin:0.2rem;padding:0.2rem 2rem;border-radius:1.3rem;border:0.5rem solid rgb(204, 204, 204);border-bottom-color:rgb(150, 150, 150);border-right-color:rgb(150, 150, 150);line-height:1.4;display:inline-block;background-color:rgb(247, 247, 247);text-shadow:0 1rem 0 #fff;opacity:",t=>t.disabled?.25:1,";"),Rs=ke.memo(Ts);function Is({players:t}){const e=v.getCurrentTime(!1),n=v.getSongBeatLength(),r=v.getDuration(),s=v.getSong(),i=m.useMemo(()=>kt(s.tracks.filter((a,l)=>t.find(d=>d.track===l)).map(({sections:a})=>Wt(a)*n+s.gap)),[s,n,t]),c=m.useMemo(()=>kt(s.tracks.filter((a,l)=>t.find(d=>d.track===l)).map(({sections:a})=>Re(a)*n+s.gap)),[s,n,t]),o=r*1e3;return!e||!r?null:h.jsxs(bt,{children:[i.map(a=>h.jsx(Tt,{position:a/o},a)),c.map(a=>h.jsx(Tt,{position:a/o},a)),h.jsx(As,{fill:e/o})]})}const bt=S("div",{target:"e19spujm2"})({name:"1q7pdku",styles:"position:absolute;height:0.6rem;width:100%;background:rgba(0, 0, 0, 0.5);left:0;top:calc(50% - 0.3rem)"}),Es=S(bt,{target:"e19spujm1"})("top:0;margin-left:-0.25rem;width:0.5rem;background:",C.colors.text.active,";opacity:75%;"),Tt=t=>h.jsx(Es,{style:{left:`${Math.min(t.position*100,100)}%`}}),Ns=S(bt,{target:"e19spujm0"})({name:"1ssqmyb",styles:"top:0;background:white;opacity:50%"}),As=t=>h.jsx(Ns,{style:{width:`${Math.round(t.fill*1e4)/100}%`}});var yt={},Fs=Xt;Object.defineProperty(yt,"__esModule",{value:!0});var ne=yt.default=void 0,Os=Fs(Yt()),$s=h,_s=(0,Os.default)((0,$s.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}),"Error");ne=yt.default=_s;var xt={},Ls=Xt;Object.defineProperty(xt,"__esModule",{value:!0});var re=xt.default=void 0,Bs=Ls(Yt()),Vs=h,Hs=(0,Bs.default)((0,Vs.jsx)("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}),"Warning");re=xt.default=Hs;function Ds({status:t,tooltipPosition:e="end",...n}){return h.jsxs(zs,{...n,children:[t==="ok"?h.jsx(gs,{"data-test":"status-ok"}):t==="unavailable"?h.jsx(qs,{"data-test":"status-unavailable"}):h.jsx(Ws,{"data-test":"status-unstable"}),t==="unavailable"?h.jsx(jt,{position:e,children:h.jsxs("span",{children:["The device is ",h.jsx("strong",{children:"disconnected"}),". Reconnect it, please."]})}):t==="unstable"?h.jsx(jt,{position:e,children:h.jsxs("span",{children:["The connection seems ",h.jsx("strong",{children:"unstable"}),". Connect to the same Wifi."]})}):null]})}const zs=S("span",{target:"e1yb3fjk4"})({name:"186aqlb",styles:"position:absolute;right:0.5rem;top:0.5rem;font-size:3rem;z-index:10;svg{width:3rem;height:3rem;text-shadow:black;}"}),qs=S(ne,{target:"e1yb3fjk2"})({name:"f0g68e",styles:"fill:#ff0000"}),Ws=S(re,{target:"e1yb3fjk1"})({name:"w492oh",styles:"fill:#f89400;stroke:black"}),jt=S("div",{target:"e1yb3fjk0"})(vt,";position:absolute;",t=>t.position==="end"?"left: 100%":"right: 150%",";top:-0.5rem;font-size:1.5rem;height:100%;display:flex;align-items:center;width:25rem;background:rgba(0, 0, 0, 0.75);padding:0.5rem;margin-left:2rem;"),Ys=(t,e=333,n)=>{const[r,s]=m.useState("ok");return m.useEffect(()=>{const i=setInterval(()=>{s(Gt.getInputStatus(t))},e);return()=>{clearInterval(i)}},[t,e,n]),r};function Xs({player:t,bottom:e=!1}){const n=Gt.getPlayerVolume(t.number),r=Ys(t.number);return h.jsxs(Gs,{children:[r!=="unavailable"&&h.jsx(Ie,{playerNumber:t.number,volume:n}),h.jsx(Us,{status:r,tooltipPosition:"start"}),h.jsx(Ks,{playerNumber:t.number})]})}const Gs=S("div",{target:"e11j9crn2"})({name:"qoosmx",styles:"position:absolute;width:20rem;right:0;top:0;height:100%"}),Us=S(Ds,{target:"e11j9crn1"})({name:"1jv40im",styles:"top:auto;right:1rem;bottom:1rem"}),Ks=S(Ee,{target:"e11j9crn0"})({name:"165qyih",styles:"z-index:2;font-size:2rem;margin-right:1rem;-webkit-text-stroke:0.1rem black;bottom:1.5rem"});function Ct({player:t,playerChanges:e,bottom:n=!1,effectsEnabled:r}){const s=v.getPlayer(t.number),[i]=H(st),c=C.colors.players[t.number].text,o=e[s.getTrackIndex()]??[],a=s.getCurrentSection(),l=s.getNextSection(),d=s.getNextSection(2),u=v.getCurrentBeat(),g=v.getSongBeatLength(),p=Math.max(0,...o.filter(P=>P<=(a==null?void 0:a.start))),y=o.find(P=>P>(a==null?void 0:a.start))??1/0,f=(y-u)*g,M=(y-u)/(y-p),R=f<2500,k=N(a),A=k?Wt([a])-a.start:0;return h.jsxs(tn,{shouldBlink:R,bottom:n,children:[!i&&r&&h.jsx(Xs,{player:t}),f<1/0&&h.jsx(on,{color:c,progress:M<=1?M*100:0}),k?h.jsx(h.Fragment,{children:h.jsxs(Y,{"data-test":`lyrics-current-player-${t.number}`,effectsEnabled:r,children:[h.jsx(Js,{children:h.jsx(Zs,{color:c,percent:Math.min(2,(u-a.start)/A)})}),a==null?void 0:a.notes.map(P=>{const w=r?Math.max(0,Math.min(2,(u-P.start)/P.length)):u>=P.start?1:0;return h.jsxs(en,{type:P.type,children:[h.jsxs(sn,{children:[h.jsx(rn,{fill:w,color:c,children:P.lyrics.trim()}),P.lyrics.endsWith(" ")&&" "]}),P.lyrics]},P.start)}),(l==null?void 0:l.start)===y&&h.jsx(Rt,{shouldShake:!0})]})}):h.jsx(Y,{effectsEnabled:r,children:" "}),N(l)?h.jsxs(Y,{nextLine:!0,"data-test":`lyrics-next-player-${t.number}`,effectsEnabled:r,children:[l.notes.map(P=>h.jsx(m.Fragment,{children:P.lyrics},P.start)),(d==null?void 0:d.start)===y&&h.jsx(Rt,{})]}):h.jsx(Y,{effectsEnabled:r,nextLine:!0,children:" "})]})}const Js=S("span",{target:"e1agvfe38"})({name:"1sngsgs",styles:"position:relative;height:0"}),Qs=S("span",{target:"e1agvfe37"})({name:"7drlms",styles:"position:absolute;width:15rem;height:3.1rem;margin:0.7rem 0;right:10rem"}),Zs=({percent:t,color:e})=>{const n=m.useMemo(()=>{const r=tt(e).toRgb();return`${r.r}, ${r.g}, ${r.b}`},[e]);return h.jsx(Qs,{style:{transformOrigin:"right",transform:`scaleX(${Math.min(1,2-t)})`,right:`${Math.max(0,1-t)*15}rem`,background:`linear-gradient(270deg, ${n}, 1) 0%, rgba(${e}, 0.5) 25%, rgba(${n}, 0) 100%)`}})},tn=S("div",{target:"e1agvfe36"})("@keyframes blink{100%{background-color:rgba(0, 0, 0, ",t=>t.bottom?"0.85":"0.5",");}30%{background-color:rgba(0, 0, 0, ",t=>t.bottom?"0.85":"0.5",");}50%{background-color:rgba(200, 200, 200, ",t=>t.bottom?"0.85":"0.5",");}30%{background-color:rgba(0, 0, 0, ",t=>t.bottom?"0.85":"0.5",");}0%{background-color:rgba(0, 0, 0, ",t=>t.bottom?"0.85":"0.5",");}}box-sizing:border-box;padding:1rem;background:rgba(0, 0, 0, ",t=>t.bottom?"0.9":"0.5",");width:100%;text-align:center;line-height:1;margin:2rem 0;position:relative;",t=>t.shouldBlink?"animation: blink 350ms ease-in-out infinite both;":"",";"),en=S("span",{target:"e1agvfe35"})("font-style:",t=>t.type==="freestyle"?"italic":"normal",";"),sn=S("span",{target:"e1agvfe34"})({name:"nffb2y",styles:"position:absolute;z-index:1"}),nn=S("span",{target:"e1agvfe33"})(""),rn=({fill:t,color:e,children:n})=>h.jsx(nn,{style:{clipPath:`inset(0 ${(1-(t===0?0:t+.05))*100}% -5rem 0)`,color:`${e}`},children:n}),an=S("div",{target:"e1agvfe32"})("position:absolute;height:1rem;background:",t=>t.color,";width:100%;"),on=t=>h.jsx(an,{style:{transformOrigin:"left",transform:`scaleX(${t.progress/100})`},color:t.color}),Rt=S(Ne,{shouldForwardProp:t=>t!=="shouldShake",target:"e1agvfe31"})("@keyframes shake{10%,90%{transform:translate3d(-0.1rem, 0, 0);}20%,80%{transform:translate3d(0.2rem, 0, 0);}30%,50%,70%{transform:translate3d(-0.4rem, 0, 0);}40%,60%{transform:translate3d(0.4rem, 0, 0);}}",t=>t.shouldShake&&"animation: shake 0.92s cubic-bezier(0.36, 0.07, 0.19, 0.97) both infinite;"," margin-left:2rem;",t=>t.shouldShake?`fill: ${C.colors.text.active};`:""," font-size:",t=>t.shouldShake?4:3,"rem;"),Y=S("div",{target:"e1agvfe30"})("font-size:",({nextLine:t,effectsEnabled:e})=>e?3.5+(t?0:1):2,"rem;height:",({effectsEnabled:t})=>t?4.5:2,"rem;",({effectsEnabled:t})=>t?"":"-webkit-text-stroke-width: 2px",";color:",({nextLine:t})=>t?C.colors.text.inactive:C.colors.text.default,";font-family:'Comic Sans MS','Comic Sans','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;z-index:10;"),cn=new Intl.NumberFormat(void 0,{maximumFractionDigits:0});function It({score:t}){return h.jsx(h.Fragment,{children:cn.format(t)})}function ie(t,e,n,r,s){return s&&n?C.colors.players[e].starPerfect:s?C.colors.players[e].perfect:n&&r?C.colors.players[e].star:r?C.colors.players[e].hit:C.colors.players[e].miss}function ln(t,e,n,r){return ie(t,e,r.note.type==="star",n,r.isPerfect)}const ct={},hn=t=>{if(!ct[t]){const e=tt(t);ct[t]=[[e.setAlpha(.8).toRgbString(),e.setAlpha(.9).toRgbString(),e.setAlpha(1).toRgbString()],[e.setAlpha(0).toRgbString()],[e.setAlpha(.1).toRgbString(),e.setAlpha(.3).toRgbString(),e.setAlpha(.2).toRgbString()]]}return ct[t]};function gt(t,e,n,r,s,i,c,o=1){if(s<=0)return;e.globalAlpha=1;const a=e.createRadialGradient(n,r,0,n,r,s/2),[l,d,u]=hn(c);a.addColorStop(0,l[W(0,l.length-1)]),a.addColorStop(.05,l[W(0,l.length-1)]),a.addColorStop(.15,u[W(0,u.length-1)]),a.addColorStop(1,d[W(0,d.length-1)]),e.beginPath(),e.arc(n,r,s/2,0,2*Math.PI),e.closePath(),e.fillStyle=a,e.fill(),e.fillStyle=c,e.globalAlpha=1}function ae(t,e,n,r,s,i,c,o,a=1){s>0&&gt(t,e,n,r,s,i,o,a)}const Q=(t,e)=>t-e+Math.random()*e*2,Et=(t=0)=>Math.sign(t+Math.random()-.5),un=300,dn=50,X=1.3;class gn{constructor(e,n,r){this.x=e,this.y=n,this.color=r,this.finished=!1,this.tick=(s,i,c)=>{const o=1-this.ttl/this.startingTtl,a=this.ttl,l=this.width*o,d=this.width*this.heightModifier*o,u=this.x-l/2+a*this.velocityX,g=this.y+d/2+a*this.velocityY;ae(i,s,u,g,l,d,this.initialAngle+a,this.color,.7*o),this.ttl=this.ttl-c,this.finished=this.ttl<=0},this.startingTtl=this.ttl=Q(un,dn),this.velocityX=X*Math.random()-X/2,this.velocityY=X*Math.random()-X/2,this.width=25,this.initialAngle=180-Math.random()*360,this.heightModifier=.5+Math.random()/2}}const fn=`
precision mediump float;
`,nt=fn.replace(/\n/g,""),mn=`
attribute vec3 aVertexPosition;
attribute vec2 aTextureCoord;
`,oe=mn.replace(/\n/g,""),pn=`
varying vec3 vVertexPosition;
varying vec2 vTextureCoord;
`,rt=pn.replace(/\n/g,""),vn=nt+oe+rt+`
uniform mat4 uMVMatrix;
uniform mat4 uPMatrix;

void main() {
    vTextureCoord = aTextureCoord;
    vVertexPosition = aVertexPosition;
    
    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
}
`;vn.replace(/\n/g,"");const bn=nt+rt+`
void main() {
    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
}
`;bn.replace(/\n/g,"");const yn=nt+oe+rt+`
void main() {
    vTextureCoord = aTextureCoord;
    vVertexPosition = aVertexPosition;
    
    gl_Position = vec4(aVertexPosition, 1.0);
}
`;yn.replace(/\n/g,"");const xn=nt+rt+`
uniform sampler2D uRenderTexture;

void main() {
    gl_FragColor = texture2D(uRenderTexture, vTextureCoord);
}
`;xn.replace(/\n/g,"");const ce=6,T=30,b=T+6,Sn=t=>{const e=t.canvas.width,n=t.canvas.height,r=Math.max(0,(e-n*(16/9))/2),s=10+(e-2*r)*.15+r,i=n-t.paddingVertical*2;return{width:e-s*2,height:i/t.playerCount,baseX:s,baseY:t.paddingVertical+t.playerIndex*i/t.playerCount}};function Nt({canvas:t,currentSectionIndex:e,song:n,songBeatLength:r,minPitch:s,maxPitch:i,track:c,playerIndex:o,playerCount:a,paddingVertical:l}){var A;const d=n.tracks[c].sections,u=d[e],g=d[e+1],p=Sn({canvas:t,playerCount:a,playerIndex:o,paddingVertical:l}),y=N(u)?(A=u==null?void 0:u.notes)==null?void 0:A.at(-1):void 0,f=N(u)?(g==null?void 0:g.start)??y.start+y.length:u.end,M=u.start*r,R=(f-u.start)*r,k=(p.height-20-T)/(i-s+ce*2);return{playerCanvas:p,currentSection:u,sectionEndBeat:f,timeSectionGap:M,maxTime:R,pitchStepHeight:k}}function At(t,e,n,r,s,i,c,o){const a=Math.max(r,s/2),l=Math.min(a/2,s/2,i);t.beginPath(),t.moveTo(e+l,n),t.lineTo(e+a-l,n),t.quadraticCurveTo(e+a,n,e+a,n+l),t.lineTo(e+a,n+s-l),t.quadraticCurveTo(e+a,n+s,e+a-l,n+s),t.lineTo(e+l,n+s),t.quadraticCurveTo(e,n+s,e,n+s-l),t.lineTo(e,n+l),t.quadraticCurveTo(e,n,e+l,n),t.closePath(),c&&t.fill(),o&&t.stroke()}function St(t,e,n,r,s,i,c,o,a=.1){At(t,e,n,r,s,i,c,o),c&&a>0&&(t.save(),At(t,e,n,r,s,i,!1,!1),t.clip(),t.fillStyle=`rgba(255,255,255,${a})`,t.fillRect(e,n,r,s/2.2),t.restore())}function Z(t,e){t.fillStyle=e.fill,t.strokeStyle=e.stroke,t.lineWidth=e.lineWidth}function G(t,e,n,r,s,i){i==="star"?Z(t,C.colors.lines.star):i==="freestyle"||i==="rap"?Z(t,C.colors.lines.freestyle):Z(t,C.colors.lines.normal),t.shadowBlur=10,t.shadowColor="rgb(31,31,31)",t.shadowOffsetX=0,t.shadowOffsetY=0,St(t,e,n,r,s,100,!0,!0,.075),t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}function I(t,e,n,r,s,i,c,o,a){Z(t,ie(t,i,a,c,o)),t.shadowBlur=5,t.shadowColor="rgba(31,31,31, .7)",t.shadowOffsetX=1,t.shadowOffsetY=1,St(t,e,n,r,s,100,!0,!0,c?.15:0),t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}const x=10,U={start:{x:0,y:0,w:T/2+x,h:T+x*2},middle:{x:T/2+x,y:0,w:1,h:T+x*2},end:{x:T/2+1+x,y:0,w:T/2+x,h:T+x*2}},E={start:{x:0,y:0,w:b/2+x,h:b+x*2},middle:{x:b/2+x,y:0,w:1,h:b+x*2},end:{x:b/2+1+x,y:0,w:b/2+x,h:b+x*2}},O={blueMiss:{draw:(t,e,n,r,s)=>I(t,e,n,r,s,0,!1,!1,!1),width:T+1,height:T,padding:x,fragments:U},blueHit:{draw:(t,e,n,r,s)=>I(t,e,n,r,s,0,!0,!1,!1),width:b+1,height:b,padding:x,fragments:E},bluePerfect:{draw:(t,e,n,r,s)=>I(t,e,n,r,s,0,!0,!0,!1),width:b+1,height:b,padding:x,fragments:E},blueStarMiss:{draw:(t,e,n,r,s)=>I(t,e,n,r,s,0,!1,!1,!0),width:T+1,height:T,padding:x,fragments:U},blueStarHit:{draw:(t,e,n,r,s)=>I(t,e,n,r,s,0,!0,!1,!0),width:b+1,height:b,padding:x,fragments:E},blueStarPerfect:{draw:(t,e,n,r,s)=>I(t,e,n,r,s,0,!0,!0,!0),width:b+1,height:b,padding:x,fragments:E},redMiss:{draw:(t,e,n,r,s)=>I(t,e,n,r,s,1,!1,!1,!1),width:T+1,height:T,padding:x,fragments:U},redHit:{draw:(t,e,n,r,s)=>I(t,e,n,r,s,1,!0,!1,!1),width:b+1,height:b,padding:x,fragments:E},redPerfect:{draw:(t,e,n,r,s)=>I(t,e,n,r,s,1,!0,!0,!1),width:b+1,height:b,padding:x,fragments:E},redStarMiss:{draw:(t,e,n,r,s)=>I(t,e,n,r,s,1,!1,!1,!0),width:T+1,height:T,padding:x,fragments:U},redStarHit:{draw:(t,e,n,r,s)=>I(t,e,n,r,s,1,!0,!1,!0),width:b+1,height:b,padding:x,fragments:E},redStarPerfect:{draw:(t,e,n,r,s)=>I(t,e,n,r,s,1,!0,!0,!0),width:b+1,height:b,padding:x,fragments:E},noteNormal:{draw:(t,e,n,r,s)=>G(t,e,n,r,s,"normal"),width:b+1,height:b,padding:x,fragments:E},noteStar:{draw:(t,e,n,r,s)=>G(t,e,n,r,s,"star"),width:b+1,height:b,padding:x,fragments:E},noteFreestyle:{draw:(t,e,n,r,s)=>G(t,e,n,r,s,"freestyle"),width:b+1,height:b,padding:x,fragments:E},noteRap:{draw:(t,e,n,r,s)=>G(t,e,n,r,s,"rap"),width:b+1,height:b,padding:x,fragments:E}};function Mn(t,e){const n=document.createElement("canvas");return n.width=t,n.height=e,n}const Pn=Math.max(...Object.values(O).map(t=>t.padding*2+t.width)),wn=Object.values(O).map(t=>t.padding*2+t.height).reduce((t,e)=>t+e,0),le=Mn(Pn,wn),he=le.getContext("2d");let _=0;const Ft=Object.entries(O).map(([t,e])=>{const n=e.padding*2,r={name:t,x:0,y:_,w:e.width+n,h:e.height+n};return _=_+e.height+n,r}).reduce((t,e)=>({...t,[e.name]:e}),{});_=0;Object.entries(O).forEach(([t,e])=>{e.draw(he,e.padding,_+e.padding,e.width,e.height),_=_+e.padding*2+e.height});const ue=(t,e)=>({canvas:le,ctx:he,x:Ft[t].x+O[t].fragments[e].x,y:Ft[t].y+O[t].fragments[e].y,w:O[t].fragments[e].w,h:O[t].fragments[e].h,padding:O[t].padding}),lt=(t,e,n,r,s,i,c,o=1,a=1)=>{const l=ue(e,n),{canvas:d,w:u,h:g,y:p,x:y,padding:f}=l,M=f*o,R=f*a;return t.imageSmoothingEnabled=!1,t.drawImage(d,y,p,u,g,r-M,s-R,i??u,c??g),t.imageSmoothingEnabled=!0,l};function de(t,e,n,r,s){const i=ue(e,"start"),c=Math.max(s,(i.h-i.padding*2)/2),o=Math.min(1,c/2/(i.w-i.padding)),a=o*i.w,l=a-i.padding*o,d=c-2*l;lt(t,e,"start",n,r,a,void 0,o),d>0&&lt(t,e,"middle",n+a,r,d,void 0,o),lt(t,e,"end",n+d+a,r,a,void 0,o)}const kn=t=>`note${hs(t)}`;function ge(t,e,n,r,s){const i=kn(s.type);de(t,i,e,n,r)}function Tn(t,e,n,r,s,i){t.save(),St(t,e,n,r,s,100,!1,!1),t.clip(),t.beginPath(),t.strokeStyle="rgba(255,255,255, .35)",t.lineWidth=3,t.lineJoin="round",t.moveTo(e,n+s/2-i.frequencyRecords[0].preciseDistance*s/3);for(let c=1;c<i.frequencyRecords.length;c++)t.lineTo(e+c*(r/(i.frequencyRecords.length-1)),n+s/2-i.frequencyRecords[c].preciseDistance*s/3);t.stroke(),t.closePath(),t.restore(),t.lineJoin="miter"}const jn=(t,e,n,r)=>{let s=t===0?"blue":"red";return n&&r?s=`${s}StarPerfect`:n?s=`${s}Perfect`:r&&e?s=`${s}StarHit`:e?s=`${s}Hit`:r&&!e?s=`${s}StarMiss`:s=`${s}Miss`,s};function Cn(t,e,n,r,s,i,c){const o=jn(s,i,c.isPerfect,c.note.type==="star");de(t,o,e,n,r)}class Rn{constructor(){this.particles=[],this.lastTick=Date.now(),this.getTimeDelta=e=>{const n=Date.now()-e,r=n-this.lastTick;return this.lastTick=n,r},this.tick=(e,n,r=0)=>{const s=this.getTimeDelta(r);this.particles.forEach(i=>i.tick(e,n,s)),this.particles=this.particles.filter(i=>!i.finished)},this.add=e=>this.particles.push(e)}}const $=new Rn,In=50/60*1e3,En=25/60*1e3,Nn=60,Ot=.3;class An{constructor(e,n,r,s){this.x=e,this.y=n,this.color=r,this.delay=s,this.finished=!1,this.tick=(i,c,o)=>{if(this.delay-- >0)return;const a=this.ttl/this.startingTtl,l=this.startingTtl-this.ttl,d=this.width*a,u=this.width*this.heightModifier*a,g=this.x-d/2+l*this.velocityX,p=this.y-u/2+l*this.velocityY;ae(c,i,g,p,d,u,this.initialAngle+l,this.color,.8*a),this.velocityX=this.velocityX-.009,this.velocityY=this.velocityY*1.0075,this.ttl=this.ttl-o,this.finished=this.ttl<=0},this.startingTtl=this.ttl=Q(In,En),this.velocityX=Q(.5,Ot)*Et(.2),this.velocityY=Q(.4,Ot)*Et(),this.width=Nn,this.initialAngle=180-Math.random()*360,this.heightModifier=.5+Math.random()/2}}class Fn{constructor(e,n,r,s,i,c){this.finished=!0,this.tick=(u,g)=>{};const o=i.type==="star"?C.colors.players[s].star.fill:C.colors.players[s].perfect.fill,a=tt(o).lighten(15).toRgbString(),l=tt(o).darken(15).toRgbString(),d=r/8;for(let u=0;u<d;u++){const g=Math.random();let p=o;g>.66?p=a:g>.33&&(p=l);const y=n+20*(Math.random()-.5);c.add(new An(e+u*5,y,p,(d-u)/10))}}}const $t=200;class On{constructor(e,n,r,s){this.x=e,this.y=n,this.width=r,this.note=s,this.finished=!1,this.ttl=$t,this.tick=(i,c,o)=>{const a=this.ttl/$t;i.save(),i.globalAlpha=a,i.translate(0,b*(1-a)),ge(i,this.x,this.y,this.width,this.note),i.globalAlpha=1,i.restore(),this.ttl=this.ttl-o,this.finished=this.ttl<=0}}}const ht=50/60*1e3,K=.05,$n=200,_t=4,_n=Math.pow;function Lt(t){return 1-_n(1-t,2)}class Ln{constructor(e,n,r,s){this.x=e,this.y=n,this.finished=!1,this.tick=(i,c,o)=>{const a=this.ttl/ht;let l=Lt(1-Math.min(1,(1-a)*6));const d=this.maxWidth*l*3/4,u=this.maxWidth*l;gt(c,i,this.x,this.y,d,u,"white",l*.35),l=Lt(a);const g=l*this.maxWidth/4,p=l*this.maxWidth/4,y=this.x,f=this.y,M=ht-this.ttl;i.globalAlpha=l*.2,gt(c,i,y+M*this.velocityX,f+M*this.velocityY,g,p,"white",l*.2),this.ttl=this.ttl-o,this.finished=this.ttl<=0},this.ttl=ht,this.velocityX=K*Math.random()-K/2,this.velocityY=K*Math.random()-K/2,this.maxWidth=Math.min(.1+s,1)*(Math.sin(r/70)*_t+($n-_t))}}const Bt=20;class Bn{constructor(e,n,r,s,i){this.x=e,this.y=n,this.w=r,this.h=s,this.seed=i,this.finished=!1,this.ttl=2/60*1e3,this.tick=(c,o,a)=>{c.strokeStyle="rgba(255,255,255,.25)",c.lineWidth=2,c.beginPath();for(let l=0;l<this.w;l++){const d=this.x+this.w-l,u=(this.h/2+2)*Math.sin(d/Bt+this.seed/250);c.lineTo(d,this.y+this.h/2+u)}c.stroke(),c.beginPath();for(let l=0;l<this.w;l++){const d=this.x+this.w-l,u=-1*(this.h/2+2)*Math.sin(d/Bt+this.seed/250);c.lineTo(d,this.y+this.h/2+u)}c.stroke(),this.ttl=this.ttl-a,this.finished=this.ttl<=0}}}const Vt=20;function Vn(t,e){return t.find(n=>n.start<=e&&n.start+n.length>=e)}class Hn{constructor(e,n=0,r=1){this.canvas=e,this.verticalMargin=n,this.scaleFactor=r,this.loop=!1,this.pauseTime=0,this.pausedOn=0,this.shaders=null,this.start=()=>{Pt.sectionChange.subscribe(this.onSectionEnd),this.loop=!0,this.drawFrame()},this.pause=()=>{this.end(),this.pausedOn=Date.now()},this.resume=()=>{this.pauseTime+=Date.now()-this.pausedOn,this.start()},this.end=()=>{var s;this.loop=!1,(s=this.shaders)==null||s.cleanup(),Pt.sectionChange.unsubscribe(this.onSectionEnd)},this.isPlaying=()=>this.loop,this.drawFrame=()=>{const s=Date.now(),i=this.canvas.getContext("2d");if(i){if(v.isPlaying()&&(i.clearRect(0,0,this.canvas.width,this.canvas.height),et.getPlayers().forEach((o,a)=>{this.drawPlayer(o.number,i)}),$.tick(i,this.canvas,this.pauseTime)),J.get()===30){const c=Date.now(),o=1e3/30,a=c-s>o?o:o-(c-s);this.loop&&setTimeout(this.drawFrame,a,J.get())}J.get()!==30&&this.loop&&window.requestAnimationFrame(this.drawFrame)}},this.drawPlayer=(s,i)=>{const c=this.getDrawingData(s),{currentSection:o}=Nt(c);if(V.get()==="high"&&this.setDistortionForce(c),!N(o))return;const a=this.calculateDisplacements(o,c);this.drawNotesToSing(i,c,a),this.drawSungNotes(i,c,a),V.get()==="high"&&this.drawFlare(i,c,a)},this.setDistortionForce=s=>{var c,o,a;const i=s.currentSection;if(!N(i))(o=this.shaders)==null||o.updatePlayerForce(s.playerNumber,(((c=this.shaders)==null?void 0:c.getPlayerForce(s.playerNumber))??0)*.99);else{const l=Math.max(0,s.currentBeat-Vt),d=s.currentPlayerNotes.filter(f=>f.note.start+f.note.length>=l).filter(f=>wt(f)===0).reduce((f,M)=>f+M.length-Math.max(0,l-M.start),0),u=s.currentPlayerNotes.at(-1),g=((u==null?void 0:u.start)??0)+((u==null?void 0:u.length)??0),p=s.currentBeat-g,y=Math.max(Math.min(Math.pow((d-p/1.5)/Vt,3),.98),0);(a=this.shaders)==null||a.updatePlayerForce(s.playerNumber,y)}},this.drawNotesToSing=(s,i,c)=>{N(i.currentSection)&&i.currentSection.notes.forEach(o=>{const{x:a,y:l,w:d,h:u}=this.getNoteCoords(i,o,o.pitch,!0,c[o.start]);ge(s,a,l,d,o)})},this.drawSungNotes=(s,i,c)=>{N(i.currentSection)&&i.currentPlayerNotes.forEach(o=>{const a=wt(o),{x:l,y:d,w:u,h:g}=this.getNoteCoords(i,o,o.note.pitch+a,a===0,c[o.note.start]);(a>0||u>g/2.5)&&(Cn(s,l,d,u,i.playerNumber,a===0,o),o.vibrato&&$.add(new Bn(l,d,u,g,i.currentTime)),a===0&&o.frequencyRecords.length>3&&!ot.includes(o.note.type)&&Tn(s,l,d,u,g,o))})},this.drawFlare=(s,i,c)=>{var a;if(!N(i.currentSection))return;const o=Vn(i.currentPlayerNotes,i.currentBeat-185/i.songBeatLength);if(o&&o.distance===0){const l=c[o.note.start]||[0,0],{x:d,y:u,w:g,h:p}=this.getNoteCoords(i,o,o.note.pitch,!0,l),y=ot.includes(o.note.type)?0:o.frequencyRecords.at(-1).preciseDistance,f=d+g,M=this.getPreciseY(u,p,y);$.add(new Ln(f,M,i.currentTime,1)),$.add(new gn(Ae(Math.max(d,f-50),f),M,ln(s,i.playerNumber,!0,o).fill)),(a=this.shaders)==null||a.updatePlayerCenter(i.playerNumber,f,M)}},this.onSectionEnd=s=>{if(v.isPlaying()){const i=this.getDrawingData(s,-1);if(!N(i.currentSection))return;this.fadeoutNotes(i.currentSection,i),this.explodeNotes(i.currentSection,i)}},this.fadeoutNotes=(s,i)=>{V.get()==="high"&&s.notes.forEach(c=>{const{x:o,y:a,w:l,h:d}=this.getNoteCoords(i,c,c.pitch,!0);$.add(new On(o,a,l,c))})},this.explodeNotes=(s,i)=>{V.get()==="high"&&i.playerNotes.filter(o=>(o.distance===0||ot.includes(o.note.type))&&s.notes.includes(o.note)).forEach(o=>{const{x:a,y:l,w:d,h:u}=this.getNoteCoords(i,o,o.note.pitch,!0);$.add(new Fn(a,l+u/2,d,i.playerNumber,o.note,$))})},this.calculateDisplacements=(s,i)=>{const c={};return V.get()==="high"?s.notes.forEach(o=>{const a=i.playerNotes.filter(g=>g.note.start===o.start).filter(g=>g.note.start+g.note.length+30>=i.currentBeat&&g.distance===0).map(g=>g.start+30<i.currentBeat?g.length-(i.currentBeat-30-g.start):g.length).reduce((g,p)=>Math.min(g+p,30),0),l=Math.max(0,(a-5)/(o.type==="star"?3:5)),d=(Math.random()-.5)*l,u=(Math.random()-.5)*l;c[o.start]=[d,u]}):s.notes.forEach(o=>{c[o.start]=[0,0]}),c},this.getDrawingData=(s,i=0)=>{const c=et.getPlayers(),o=c.findIndex(f=>f.number===s),a=c.length,l=v.getPlayer(s),d=l.getCurrentSectionIndex()+i,u=v.getSong(),g=l.getTrackIndex(),p=u.tracks[g].sections[d],y=l.getPlayerNotes();return{playerNumber:s,playerIndex:o,playerCount:a,song:u,songBeatLength:v.getSongBeatLength(),minPitch:l.getMinPitch(),maxPitch:l.getMaxPitch(),canvas:this.canvas,currentTime:v.getCurrentTime(),frequencies:l.getPlayerFrequencies(),playerNotes:y,currentPlayerNotes:y.filter(f=>f.note.start>=((p==null?void 0:p.start)??1/0)),track:l.getTrackIndex(),currentBeat:v.getCurrentBeat(),currentSectionIndex:d,currentSection:p,paddingVertical:this.verticalMargin}},this.getNoteCoords=(s,{start:i,length:c},o,a,l=[0,0])=>{const{sectionEndBeat:d,currentSection:u,playerCanvas:g,pitchStepHeight:p}=Nt(s),y=N(u)?u.notes[0].start:1,f=g.width/(d-y),[M,R]=a?l:[0,0],k=p*(s.maxPitch-o+ce);return{x:Math.floor(g.baseX+f*(i-y)+M),y:Math.floor(g.baseY+10+k+R-(a?3:0)),w:Math.floor(f*c),h:a?b:T}},this.getPreciseY=(s,i,c)=>s+i/2-c*i/3}}const Dn=`precision mediump float;

const float MAX_FORCE = 300.0;
const int SAMPLE_COUNT = 8; // 2^x
const float INTENSITY = 0.051;
// get our varyings
varying vec3 vVertexPosition;
varying vec2 vTextureCoord;
// the uniform we declared inside our javascript
uniform float uTime;
uniform sampler2D planeTexture;
uniform vec2 uResolution;

uniform vec2 uP0center;
uniform float uP0force;

uniform vec2 uP1center;
uniform float uP1force;

float rnd(float n) {
    return fract(sin(n) * 43758.5453);
}
float random (vec2 st) {
    return rnd(dot(st.xy, vec2(12.9898, 78.233)));
}

vec4 directionalBlur(in vec2 uv, in vec2 direction, in float intensity)
{
    vec4 color = vec4(0.0);

    for (int i=1; i<=SAMPLE_COUNT; i++)
    {
        color += texture2D(planeTexture,uv+float(i)*intensity/float(SAMPLE_COUNT)*direction);
    }

    return color/float(SAMPLE_COUNT);
}

float distort(vec2 center, float force, float comparedIntensity) {
    float actualForce = force * MAX_FORCE;
    vec2 centerAbs = center * uResolution;

    vec2 direction = gl_FragCoord.xy - centerAbs.xy;
    float dist = length(direction) / length(uResolution);


    float intensity = max(0.0, 0.50 - dist) * INTENSITY * pow(force, 1.5);
    if (intensity > comparedIntensity) {
        vec4 newColor = directionalBlur(gl_FragCoord.xy / uResolution, normalize(direction), intensity);
        gl_FragColor = newColor;
    }
    return intensity;
}

void main() {
    gl_FragColor = texture2D(planeTexture, vTextureCoord);
    float p1intensity = distort(uP0center, uP0force, 0.0);
    float p2intensity = distort(uP1center, uP1force, p1intensity);
}`,zn=`
precision mediump float;

// default mandatory variables
attribute vec3 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat4 uMVMatrix;
uniform mat4 uPMatrix;

uniform mat4 planeTextureMatrix;

// custom varyings
varying vec3 vVertexPosition;
varying vec2 vTextureCoord;

void main() {
    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);

    // varyings
    vVertexPosition = aVertexPosition;
    vTextureCoord = (planeTextureMatrix * vec4(aTextureCoord, 0.0, 1.0)).xy;
}`,qn=1920;function Wn({currentStatus:t,width:e,height:n,playerSetups:r,onSongEnd:s,playerChanges:i,effectsEnabled:c,videoPlayerRef:o,isPauseMenuVisible:a}){var A,P;const[l]=H(V),[d]=H(st),u=m.useRef(null),g=m.useRef(null),p=m.useRef(null);m.useEffect(()=>(v.startInputMonitoring(),()=>{v.stopInputMonitoring()}),[]);const y=qn,f=y*(n/e),M=f/n;m.useEffect(()=>{if(!(!u.current||!p.current))return g.current=new Hn(u.current,p.current.offsetHeight*M),g.current.start(),()=>{var w;(w=g.current)==null||w.end()}},[u.current,(A=p.current)==null?void 0:A.offsetHeight,M]),m.useEffect(()=>{var w,L,D,z;a&&((w=g.current)!=null&&w.isPlaying())?(L=g.current)==null||L.pause():!a&&!((D=g.current)!=null&&D.isPlaying())&&((z=g.current)==null||z.resume())},[a]),m.useEffect(()=>{t===F.ENDED&&s&&s()},[t,s]);const R=et.getPlayers(),k=!d&&R.length===2;return h.jsxs(Yn,{children:[l==="high"&&h.jsxs(h.Fragment,{children:[h.jsx("script",{type:"x-shader/x-fragment",id:"plane-fs",children:Dn}),h.jsx("script",{id:"plane-vs",type:"x-shader/x-vertex",children:zn}),h.jsx(Gn,{id:"canvas",style:{zIndex:1e4}})]}),h.jsx(Xn,{id:"plane",children:h.jsx("canvas",{ref:u,width:y,height:f,"data-sampler":"planeTexture"})}),c&&h.jsxs(h.Fragment,{children:[h.jsx(Ms,{playerRef:o,isEnabled:!a}),h.jsx(Rs,{onSongEnd:s,isEnabled:!a})]}),h.jsx(Is,{players:r}),k&&h.jsx(Ct,{player:R[0],playerChanges:i,effectsEnabled:c}),h.jsx(Un,{children:c&&h.jsx(h.Fragment,{children:((P=v.getSingSetup())==null?void 0:P.mode)===Fe.CO_OP?h.jsx("span",{"data-test":"players-score","data-score":v.getPlayerScore(0),children:h.jsx(It,{score:v.getPlayerScore(0)})}):et.getPlayers().map(w=>h.jsx("span",{"data-test":`player-${w.number}-score`,"data-score":v.getPlayerScore(w.number),children:h.jsx(It,{score:v.getPlayerScore(w.number)})},w.number))})}),h.jsx("div",{ref:p,children:h.jsx(Ct,{player:R[k?1:0],playerChanges:i,bottom:!0,effectsEnabled:c})})]})}const Yn=S("div",{target:"eq90wxp3"})({name:"y3i90j",styles:"height:100%;color:white;-webkit-text-stroke:0.2rem black;font-weight:bold;position:relative;display:flex;flex-direction:column"}),Xn=S("div",{target:"eq90wxp2"})({name:"1x1omeb",styles:"position:absolute;top:0;left:0;width:100%;height:100%;canvas{width:100%;height:100%;}"}),Gn=S("div",{target:"eq90wxp1"})({name:"1b4920d",styles:"position:absolute;top:0;left:0;width:100%;height:100%"}),Un=S("div",{target:"eq90wxp0"})({name:"1kstjp",styles:"flex:1;height:100%;box-sizing:border-box;font-size:5.5rem;display:flex;justify-content:center;gap:4rem;padding-right:4rem;flex-direction:column;text-align:right;z-index:1"});function Kn(t,e){const[n,r]=m.useState(0);return m.useEffect(()=>{t.current&&e===F.PLAYING&&n===0&&t.current.getDuration().then(s=>{r(s),v.setDuration(s)})},[n,t,e]),n}function Jn({song:t,width:e,height:n,autoplay:r=!0,showControls:s=!1,onCurrentTimeUpdate:i,onSongEnd:c,onStatusChange:o,players:a,playerChanges:l=[[],[]],effectsEnabled:d=!0,singSetup:u,restartSong:g,...p},y){const f=m.useRef(null),[M,R]=m.useState(0),[k,A]=m.useState(F.UNSTARTED),[P]=H($e),[w,L]=m.useState(!1);m.useEffect(()=>(v.setSong(t),v.setSingSetup(u),()=>{v.resetSingSetup()}),[t,u]),m.useEffect(()=>{if(f.current&&k===F.PLAYING){const j=setInterval(async()=>{if(!f.current)return;const B=Math.max(0,await f.current.getCurrentTime()*1e3-P);R(B),i==null||i(B),v.setCurrentTime(B),v.update()},1e3/J.get());return()=>clearInterval(j)}},[f,i,k,P]);const D=Kn(f,k);m.useImperativeHandle(y,()=>({seekTo:j=>f.current.seekTo(j),setPlaybackSpeed:j=>f.current.setPlaybackSpeed(j),play:()=>f.current.playVideo(),pause:()=>f.current.pauseVideo()}));const z=m.useCallback(j=>{A(j),o==null||o(j)},[A,o]),it=d&&c!==void 0,fe=()=>{var j;L(!0),(j=f.current)==null||j.pauseVideo()},Mt=()=>{var j;L(!1),(j=f.current)==null||j.playVideo()},me=()=>{w?Mt():fe()},at=ps(k);m.useEffect(()=>{var B;if(!it)return;const j=at!==F.PAUSED&&at!==F.BUFFERING&&k===F.PAUSED;k===F.PLAYING&&w?(B=f.current)==null||B.pauseVideo():j&&!w&&L(!0)},[w,k,at,it]),mt({back:me},it,[w]);const pe=m.useMemo(()=>({back:"Pause Menu"}),[]);return pt(pe,d),h.jsxs(Qn,{...p,children:[w&&h.jsx(bs,{onExit:c,onResume:Mt,onRestart:g}),k!==F.UNSTARTED&&h.jsx(Zn,{style:{width:`${e}px`,height:`${n}px`},children:h.jsx(Wn,{isPauseMenuVisible:w,effectsEnabled:d,playerChanges:l,duration:D,currentStatus:k,song:t,width:e,height:n,onSongEnd:c,playerSetups:a,videoPlayerRef:f.current})}),h.jsx(tr,{children:h.jsx(Oe,{ref:f,video:t.video,width:e,height:n,controls:s,autoplay:r,disablekb:!0,volume:t.volume,startAt:t.videoGap??0,onStateChange:z})})]})}const Qn=S("div",{target:"e39m8x62"})({name:"bjn8wh",styles:"position:relative"}),Zn=S("div",{target:"e39m8x61"})({name:"qkt6ng",styles:"position:absolute;z-index:1;background-color:rgba(0, 0, 0, 0.2);pointer-events:none;width:100%;height:100%;top:0;left:0"}),tr=S("div",{target:"e39m8x60"})({name:"j387f9",styles:"overflow:hidden;height:100%"}),nr=m.forwardRef(Jn);export{Ds as P,vs as S,ps as a,Ys as b,sr as c,It as d,nr as e,cn as f,kt as u};
//# sourceMappingURL=Player-9ba3d470.js.map
