import{r as u,o as q,n as Y,s as E,b as j,h as G,a as O,j as t,i as z,k as W,F as Se,aj as Me,B as ke,ak as Ee,p as M,ai as F,a3 as Le,a7 as Ue,al as we,am as Be,c as $e,an as Q,ao as Ie,ap as Ne,aa as ue,aq as Ae,v as K,q as ze,e as Fe,D as Ve,ar as Ge,as as ie,at as Oe,au as We,av as De,aw as _e,ax as qe,ay as he,az as Ye,aA as He,aB as Ke,aC as Qe,a8 as Xe,aD as Ze,a9 as Je,ab as et,S as re,g as tt,aE as at,ah as rt,ac as nt}from"./index-CwYW931T.js";import{B as L,q as $,k as T,N as xe,L as le,T as A,O as ot,E as me,J as I,z as ne,i as st,I as it,w as lt,o as fe,j as ct,Q as dt,R as ut,p as pt,U as H,V as ht,S as ge,e as xt,h as mt,W as ft,A as gt,r as vt}from"./ShareSongsModal-DMjofMrh.js";function bt(e){return u.Children.toArray(e).filter(a=>u.isValidElement(a))}const yt=u.createContext({}),Z=yt,jt=u.createContext({}),ae=jt;function Ct(e){return q("MuiStep",e)}Y("MuiStep",["root","horizontal","vertical","alternativeLabel","completed"]);const St=["active","children","className","component","completed","disabled","expanded","index","last"],kt=e=>{const{classes:a,orientation:r,alternativeLabel:n,completed:o}=e;return W({root:["root",r,n&&"alternativeLabel",o&&"completed"]},Ct,a)},Lt=E("div",{name:"MuiStep",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:r}=e;return[a.root,a[r.orientation],r.alternativeLabel&&a.alternativeLabel,r.completed&&a.completed]}})(({ownerState:e})=>j({},e.orientation==="horizontal"&&{paddingLeft:8,paddingRight:8},e.alternativeLabel&&{flex:1,position:"relative"})),wt=u.forwardRef(function(a,r){const n=G({props:a,name:"MuiStep"}),{active:o,children:i,className:l,component:c="div",completed:d,disabled:p,expanded:m=!1,index:s,last:f}=n,S=O(n,St),{activeStep:C,connector:k,alternativeLabel:g,orientation:w,nonLinear:B}=u.useContext(Z);let[h=!1,x=!1,y=!1]=[o,d,p];C===s?h=o!==void 0?o:!0:!B&&C>s?x=d!==void 0?d:!0:!B&&C<s&&(y=p!==void 0?p:!0);const v=u.useMemo(()=>({index:s,last:f,expanded:m,icon:s+1,active:h,completed:x,disabled:y}),[s,f,m,h,x,y]),b=j({},n,{active:h,orientation:w,alternativeLabel:g,completed:x,disabled:y,expanded:m,component:c}),R=kt(b),U=t.jsxs(Lt,j({as:c,className:z(R.root,l),ref:r,ownerState:b},S,{children:[k&&g&&s!==0?k:null,i]}));return t.jsx(ae.Provider,{value:v,children:k&&!g&&s!==0?t.jsxs(u.Fragment,{children:[k,U]}):U})}),J=wt,Bt=Se(t.jsx("path",{d:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24zm-2 17l-5-5 1.4-1.4 3.6 3.6 7.6-7.6L19 8l-9 9z"}),"CheckCircle"),$t=Se(t.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}),"Warning");function It(e){return q("MuiStepIcon",e)}const Tt=Y("MuiStepIcon",["root","active","completed","error","text"]),oe=Tt;var ve;const Rt=["active","className","completed","error","icon"],Pt=e=>{const{classes:a,active:r,completed:n,error:o}=e;return W({root:["root",r&&"active",n&&"completed",o&&"error"],text:["text"]},It,a)},se=E(Me,{name:"MuiStepIcon",slot:"Root",overridesResolver:(e,a)=>a.root})(({theme:e})=>({display:"block",transition:e.transitions.create("color",{duration:e.transitions.duration.shortest}),color:(e.vars||e).palette.text.disabled,[`&.${oe.completed}`]:{color:(e.vars||e).palette.primary.main},[`&.${oe.active}`]:{color:(e.vars||e).palette.primary.main},[`&.${oe.error}`]:{color:(e.vars||e).palette.error.main}})),Mt=E("text",{name:"MuiStepIcon",slot:"Text",overridesResolver:(e,a)=>a.text})(({theme:e})=>({fill:(e.vars||e).palette.primary.contrastText,fontSize:e.typography.caption.fontSize,fontFamily:e.typography.fontFamily})),Et=u.forwardRef(function(a,r){const n=G({props:a,name:"MuiStepIcon"}),{active:o=!1,className:i,completed:l=!1,error:c=!1,icon:d}=n,p=O(n,Rt),m=j({},n,{active:o,completed:l,error:c}),s=Pt(m);if(typeof d=="number"||typeof d=="string"){const f=z(i,s.root);return c?t.jsx(se,j({as:$t,className:f,ref:r,ownerState:m},p)):l?t.jsx(se,j({as:Bt,className:f,ref:r,ownerState:m},p)):t.jsxs(se,j({className:f,ref:r,ownerState:m},p,{children:[ve||(ve=t.jsx("circle",{cx:"12",cy:"12",r:"12"})),t.jsx(Mt,{className:s.text,x:"12",y:"12",textAnchor:"middle",dominantBaseline:"central",ownerState:m,children:d})]}))}return d}),Ut=Et;function Nt(e){return q("MuiStepLabel",e)}const At=Y("MuiStepLabel",["root","horizontal","vertical","label","active","completed","error","disabled","iconContainer","alternativeLabel","labelContainer"]),D=At,zt=["children","className","componentsProps","error","icon","optional","slotProps","StepIconComponent","StepIconProps"],Ft=e=>{const{classes:a,orientation:r,active:n,completed:o,error:i,disabled:l,alternativeLabel:c}=e;return W({root:["root",r,i&&"error",l&&"disabled",c&&"alternativeLabel"],label:["label",n&&"active",o&&"completed",i&&"error",l&&"disabled",c&&"alternativeLabel"],iconContainer:["iconContainer",n&&"active",o&&"completed",i&&"error",l&&"disabled",c&&"alternativeLabel"],labelContainer:["labelContainer",c&&"alternativeLabel"]},Nt,a)},Vt=E("span",{name:"MuiStepLabel",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:r}=e;return[a.root,a[r.orientation]]}})(({ownerState:e})=>j({display:"flex",alignItems:"center",[`&.${D.alternativeLabel}`]:{flexDirection:"column"},[`&.${D.disabled}`]:{cursor:"default"}},e.orientation==="vertical"&&{textAlign:"left",padding:"8px 0"})),Gt=E("span",{name:"MuiStepLabel",slot:"Label",overridesResolver:(e,a)=>a.label})(({theme:e})=>j({},e.typography.body2,{display:"block",transition:e.transitions.create("color",{duration:e.transitions.duration.shortest}),[`&.${D.active}`]:{color:(e.vars||e).palette.text.primary,fontWeight:500},[`&.${D.completed}`]:{color:(e.vars||e).palette.text.primary,fontWeight:500},[`&.${D.alternativeLabel}`]:{marginTop:16},[`&.${D.error}`]:{color:(e.vars||e).palette.error.main}})),Ot=E("span",{name:"MuiStepLabel",slot:"IconContainer",overridesResolver:(e,a)=>a.iconContainer})(()=>({flexShrink:0,display:"flex",paddingRight:8,[`&.${D.alternativeLabel}`]:{paddingRight:0}})),Wt=E("span",{name:"MuiStepLabel",slot:"LabelContainer",overridesResolver:(e,a)=>a.labelContainer})(({theme:e})=>({width:"100%",color:(e.vars||e).palette.text.secondary,[`&.${D.alternativeLabel}`]:{textAlign:"center"}})),Te=u.forwardRef(function(a,r){var n;const o=G({props:a,name:"MuiStepLabel"}),{children:i,className:l,componentsProps:c={},error:d=!1,icon:p,optional:m,slotProps:s={},StepIconComponent:f,StepIconProps:S}=o,C=O(o,zt),{alternativeLabel:k,orientation:g}=u.useContext(Z),{active:w,disabled:B,completed:h,icon:x}=u.useContext(ae),y=p||x;let v=f;y&&!v&&(v=Ut);const b=j({},o,{active:w,alternativeLabel:k,completed:h,disabled:B,error:d,orientation:g}),R=Ft(b),U=(n=s.label)!=null?n:c.label;return t.jsxs(Vt,j({className:z(R.root,l),ref:r,ownerState:b},C,{children:[y||v?t.jsx(Ot,{className:R.iconContainer,ownerState:b,children:t.jsx(v,j({completed:h,active:w,error:d,icon:y},S))}):null,t.jsxs(Wt,{className:R.labelContainer,ownerState:b,children:[i?t.jsx(Gt,j({ownerState:b},U,{className:z(R.label,U==null?void 0:U.className),children:i})):null,m]})]}))});Te.muiName="StepLabel";const Dt=Te;function _t(e){return q("MuiStepButton",e)}const qt=Y("MuiStepButton",["root","horizontal","vertical","touchRipple"]),be=qt,Yt=["children","className","icon","optional"],Ht=e=>{const{classes:a,orientation:r}=e;return W({root:["root",r],touchRipple:["touchRipple"]},_t,a)},Kt=E(ke,{name:"MuiStepButton",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:r}=e;return[{[`& .${be.touchRipple}`]:a.touchRipple},a.root,a[r.orientation]]}})(({ownerState:e})=>j({width:"100%",padding:"24px 16px",margin:"-24px -16px",boxSizing:"content-box"},e.orientation==="vertical"&&{justifyContent:"flex-start",padding:"8px",margin:"-8px"},{[`& .${be.touchRipple}`]:{color:"rgba(0, 0, 0, 0.3)"}})),Qt=u.forwardRef(function(a,r){const n=G({props:a,name:"MuiStepButton"}),{children:o,className:i,icon:l,optional:c}=n,d=O(n,Yt),{disabled:p,active:m}=u.useContext(ae),{orientation:s}=u.useContext(Z),f=j({},n,{orientation:s}),S=Ht(f),C={icon:l,optional:c},k=Ee(o,["StepLabel"])?u.cloneElement(o,C):t.jsx(Dt,j({},C,{children:o}));return t.jsx(Kt,j({focusRipple:!0,disabled:p,TouchRippleProps:{className:S.touchRipple},className:z(S.root,i),ref:r,ownerState:f,"aria-current":m?"step":void 0},d,{children:k}))}),ee=Qt;function Xt(e){return q("MuiStepper",e)}Y("MuiStepper",["root","horizontal","vertical","alternativeLabel"]);function Zt(e){return q("MuiStepConnector",e)}Y("MuiStepConnector",["root","horizontal","vertical","alternativeLabel","active","completed","disabled","line","lineHorizontal","lineVertical"]);const Jt=["className"],ea=e=>{const{classes:a,orientation:r,alternativeLabel:n,active:o,completed:i,disabled:l}=e,c={root:["root",r,n&&"alternativeLabel",o&&"active",i&&"completed",l&&"disabled"],line:["line",`line${M(r)}`]};return W(c,Zt,a)},ta=E("div",{name:"MuiStepConnector",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:r}=e;return[a.root,a[r.orientation],r.alternativeLabel&&a.alternativeLabel,r.completed&&a.completed]}})(({ownerState:e})=>j({flex:"1 1 auto"},e.orientation==="vertical"&&{marginLeft:12},e.alternativeLabel&&{position:"absolute",top:12,left:"calc(-50% + 20px)",right:"calc(50% + 20px)"})),aa=E("span",{name:"MuiStepConnector",slot:"Line",overridesResolver:(e,a)=>{const{ownerState:r}=e;return[a.line,a[`line${M(r.orientation)}`]]}})(({ownerState:e,theme:a})=>{const r=a.palette.mode==="light"?a.palette.grey[400]:a.palette.grey[600];return j({display:"block",borderColor:a.vars?a.vars.palette.StepConnector.border:r},e.orientation==="horizontal"&&{borderTopStyle:"solid",borderTopWidth:1},e.orientation==="vertical"&&{borderLeftStyle:"solid",borderLeftWidth:1,minHeight:24})}),ra=u.forwardRef(function(a,r){const n=G({props:a,name:"MuiStepConnector"}),{className:o}=n,i=O(n,Jt),{alternativeLabel:l,orientation:c="horizontal"}=u.useContext(Z),{active:d,disabled:p,completed:m}=u.useContext(ae),s=j({},n,{alternativeLabel:l,orientation:c,active:d,completed:m,disabled:p}),f=ea(s);return t.jsx(ta,j({className:z(f.root,o),ref:r,ownerState:s},i,{children:t.jsx(aa,{className:f.line,ownerState:s})}))}),na=ra,oa=["activeStep","alternativeLabel","children","className","component","connector","nonLinear","orientation"],sa=e=>{const{orientation:a,alternativeLabel:r,classes:n}=e;return W({root:["root",a,r&&"alternativeLabel"]},Xt,n)},ia=E("div",{name:"MuiStepper",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:r}=e;return[a.root,a[r.orientation],r.alternativeLabel&&a.alternativeLabel]}})(({ownerState:e})=>j({display:"flex"},e.orientation==="horizontal"&&{flexDirection:"row",alignItems:"center"},e.orientation==="vertical"&&{flexDirection:"column"},e.alternativeLabel&&{alignItems:"flex-start"})),la=t.jsx(na,{}),ca=u.forwardRef(function(a,r){const n=G({props:a,name:"MuiStepper"}),{activeStep:o=0,alternativeLabel:i=!1,children:l,className:c,component:d="div",connector:p=la,nonLinear:m=!1,orientation:s="horizontal"}=n,f=O(n,oa),S=j({},n,{alternativeLabel:i,orientation:s,component:d}),C=sa(S),k=u.Children.toArray(l).filter(Boolean),g=k.map((B,h)=>u.cloneElement(B,j({index:h,last:h+1===k.length},B.props))),w=u.useMemo(()=>({activeStep:o,alternativeLabel:i,connector:p,nonLinear:m,orientation:s}),[o,i,p,m,s]);return t.jsx(Z.Provider,{value:w,children:t.jsx(ia,j({as:d,ownerState:S,className:z(C.root,c),ref:r},f,{children:g}))})}),da=ca,te=F("span",{target:"e1juu05a0"})({name:"1n7r223",styles:"font-family:monospace"}),ce=(e,a,r="Lookup")=>({InputProps:{endAdornment:t.jsx(Le,{title:a?"Open search results for the song":"Artist or title of the song is unknown",children:t.jsx("span",{children:t.jsx(L,{sx:{mr:-1},endIcon:t.jsx(Ue,{}),color:"secondary",variant:"text",onClick:e,disabled:!a,children:r})})})}});function ua(e){const a=()=>{window.open(`https://www.youtube.com/results?search_query=${encodeURIComponent((e==null?void 0:e.songArtist)+" "+(e==null?void 0:e.songTitle))}`,"_blank")},r=!!e.songTitle&&!!e.songArtist,n=we(e.data.video);return t.jsxs($,{sx:{display:"flex",flexWrap:"wrap"},"data-test":"author-and-vid",children:[t.jsx(T,{"data-test":"author-name",sx:{mt:2},value:e.data.author,onChange:o=>e.onChange({...e.data,author:o.target.value}),label:"Author name (optional)",fullWidth:!0,size:"small",helperText:"Nickname of the person that created the .txt file."}),t.jsx(T,{"data-test":"author-url",sx:{mt:2},value:e.data.authorUrl,onChange:o=>e.onChange({...e.data,authorUrl:o.target.value}),label:"Author URL (optional)",helperText:"Link to authors page/profile.",fullWidth:!0,size:"small"}),t.jsx($,{sx:{display:"flex",flexDirection:"row",mt:2,alignItems:"center",width:"100%"},children:t.jsx(T,{"data-test":"video-url",required:!0,value:e.data.video,onChange:o=>e.onChange({...e.data,video:o.target.value}),label:"YouTube Video URL",placeholder:"https://www.youtube.com/watch?v=",fullWidth:!0,size:"small",helperText:"Link to YouTube video, eg https://www.youtube.com/watch?v=xxxxxxxxx. Click the 'Lookup' button to look for it on YouTube",name:"videoUrl",...ce(a,r)})}),n&&t.jsx($,{children:t.jsx(Be,{videoId:n})})]})}const pa={polish:{Ãˆ:"Ã©",Ã­:"'","Â¥":"'","Â¯":"Å»","Â¹":"Ä…",Ï€:"Ä…",Ãª:"Ä™",Ã:"Ä™",Å’:"Åš",Ã¥:"Åš",Å“:"Å›",Ãº:"Å›",Ã¦:"Ä‡",ÃŠ:"Ä‡","Â¿":"Å¼",Ã¸:"Å¼",Ã˜:"Å»",Ã±:"Å„",Ã’:"Å„","Â³":"Å‚","â‰¥":"Å‚","Â£":"Å",Ã›:"Ã³",Ã¼:"Åº",Å¸:"Åº"},spanish:{Ã¸:"Â¿",Ãˆ:"Ã©",ÃŒ:"Ã­",Ã’:"Ã±",Å„:"Ã±","Â·":"Ã¡",Ã›:"Ã³","Â°":"!","Ë™":"Ãº",Å›:"Ãº"}};function ha(e,a){const r=pa[a];if(r===void 0)return e;let n=e;for(const[o,i]of Object.entries(r))n=n.replaceAll(o,i);return n}function xa(e){const a=e.split(`
`),r=["#TITLE","#ARTIST","#BPM"];for(const n of r)if(!a.some(o=>o.startsWith(n)))return!1;if(!a.some(n=>n.startsWith(":")))return!1;try{$e(e)}catch(n){return console.log(n),!1}return!0}async function ma(e){try{const a=new URL(e);if(a.host==="usdb.animux.de")return ga(e,a);if(a.host==="ultrastar-es.org")return fa(e)}catch(a){console.warn(a)}}async function fa(e){var d,p,m,s;const r=await(await fetch(`https://backend.allkaraoke.party/proxy?url=${encodeURIComponent(e)}`)).text(),n=new DOMParser().parseFromString(r,"text/html"),i=`https://ultrastar-es.org/pl/canciones/descargar/txt/${(d=n.querySelector("ul[data-id]"))==null?void 0:d.getAttribute("data-id")}`;window.location.href=i;const l=(p=n.querySelector("#listado > ul > li > dl > dd:nth-child(6) > a"))==null?void 0:p.getAttribute("href"),c=(m=n.querySelector("#listado > ul > li"))==null?void 0:m.getAttribute("data-id");return{authorUrl:l?"https://ultrastar-es.org"+l:"",author:((s=n.querySelector("#listado > ul > li > dl > dd:nth-child(6)"))==null?void 0:s.textContent)??"",video:c?"https://www.youtube.com/watch?v="+c:""}}async function ga(e,a){var p,m,s,f,S;const n=await(await fetch(`https://backend.allkaraoke.party/proxy?url=${encodeURIComponent(e)}`)).text(),o=new DOMParser().parseFromString(n,"text/html"),i=(p=o.querySelector('a[href^="?link=profil&id="]'))==null?void 0:p.textContent,l=(s=(m=o.querySelector('a[href^="?link=profil&id="]'))==null?void 0:m.getAttribute)==null?void 0:s.call(m,"href"),c=(f=o.querySelector("#tablebg > tbody > tr:nth-child(3) > td > table:nth-child(2) > tbody > tr.list_head > td:nth-child(1)"))==null?void 0:f.textContent,d=(S=o.querySelector("#tablebg > tbody > tr:nth-child(3) > td > table:nth-child(2) > tbody > tr.list_head > td:nth-child(2)"))==null?void 0:S.textContent;return window.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(c+" "+d)}`,"_blank"),window.open(`http://usdb.animux.de/index.php?link=gettxt&id=${a.searchParams.get("id")}`,"_blank"),{authorUrl:l?"http://usdb.animux.de/index.php"+l:"",author:i??"",video:""}}function va(e){var i,l;const a=async c=>{if(e.onChange({...e.data,sourceUrl:c.target.value}),e.shouldAutoImport){const d=await ma(c.target.value);d&&e.onAutoImport(d)}},r=c=>{e.onChange({...e.data,txtInput:ha(e.data.txtInput,c)})},o=!u.useMemo(()=>xa(e.data.txtInput),[e.data.txtInput])&&e.data.txtInput.length>0;return t.jsxs($,{sx:{display:"flex",flexWrap:"wrap"},"data-test":"basic-data",children:[e.isTxtRequired&&t.jsxs("div",{children:[t.jsx("h4",{children:"Where to find songs?"}),t.jsxs("p",{children:["Any UltraStar compatible .txt file will do. You can find many already made songs on"," ",t.jsx("a",{href:"https://usdb.animux.de/",target:"_blank",rel:"noreferrer",children:"usdb.animux.de"})," or ",t.jsx("a",{href:"https://ultrastar-es.org/en",target:"_blank",rel:"noreferrer",children:"ultrastar-es.org"}),".",t.jsx("br",{}),t.jsx("br",{})]}),t.jsx("p",{children:"You don't need audio/video files, you'll be able to search for appropriate YouTube video and synchronise the lyrics to it in subsequent steps."})]}),t.jsx(T,{sx:{mt:2},value:e.data.sourceUrl,onChange:a,label:"Source URL (optional)",fullWidth:!0,size:"small","data-test":"source-url",helperText:"The link to the page from which the .TXT file was downloaded."}),e.isTxtRequired?t.jsxs(t.Fragment,{children:[t.jsx(T,{error:o,helperText:o?"This doesn't look like a valid UltraStar .TXT format":"",required:!0,sx:{mt:2},fullWidth:!0,size:"small",multiline:!0,label:"Song's UltraStar .TXT file contents",onChange:c=>e.onChange({...e.data,txtInput:c.target.value}),value:e.data.txtInput,maxRows:15,minRows:15,InputProps:{inputProps:{"data-test":"input-txt",sx:{fontFamily:"monospace"}}}}),t.jsxs($,{sx:{display:"flex",gap:1,mt:1},children:[t.jsx(L,{onClick:()=>r("polish"),children:"Fix ðŸ‡µðŸ‡± Polish accents"}),t.jsx(L,{onClick:()=>r("spanish"),children:"Fix ðŸ‡ªðŸ‡¸ Spanish accents"})]})]}):t.jsx($,{sx:{display:"flex",width:"100%",height:500,overflow:"auto"},children:(l=(i=e.finalSong)==null?void 0:i.tracks)==null?void 0:l.map((c,d)=>t.jsxs($,{sx:{flex:1},children:[t.jsx("h4",{children:c.name??`Track #${d+1}`}),c.sections.filter(Q).map(p=>t.jsx("p",{children:p.notes.map(m=>m.lyrics).join("")},p.start))]},d))})]})}const ba=["children","className","disableTypography","inset","primary","primaryTypographyProps","secondary","secondaryTypographyProps"],ya=e=>{const{classes:a,inset:r,primary:n,secondary:o,dense:i}=e;return W({root:["root",r&&"inset",i&&"dense",n&&o&&"multiline"],primary:["primary"],secondary:["secondary"]},ot,a)},ja=E("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:r}=e;return[{[`& .${xe.primary}`]:a.primary},{[`& .${xe.secondary}`]:a.secondary},a.root,r.inset&&a.inset,r.primary&&r.secondary&&a.multiline,r.dense&&a.dense]}})(({ownerState:e})=>j({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4},e.primary&&e.secondary&&{marginTop:6,marginBottom:6},e.inset&&{paddingLeft:56})),Ca=u.forwardRef(function(a,r){const n=G({props:a,name:"MuiListItemText"}),{children:o,className:i,disableTypography:l=!1,inset:c=!1,primary:d,primaryTypographyProps:p,secondary:m,secondaryTypographyProps:s}=n,f=O(n,ba),{dense:S}=u.useContext(le);let C=d??o,k=m;const g=j({},n,{disableTypography:l,inset:c,primary:!!C,secondary:!!k,dense:S}),w=ya(g);return C!=null&&C.type!==A&&!l&&(C=t.jsx(A,j({variant:S?"body2":"body1",className:w.primary,component:p!=null&&p.variant?void 0:"span",display:"block"},p,{children:C}))),k!=null&&k.type!==A&&!l&&(k=t.jsx(A,j({variant:"body2",className:w.secondary,color:"text.secondary",display:"block"},s,{children:k}))),t.jsxs(ja,j({className:z(w.root,i),ownerState:g,ref:r},f,{children:[C,k]}))}),Sa=Ca,Re=e=>{const a=Math.floor(e/1e3/60),r=Math.floor(e/1e3)-a*60,n=Math.floor(e%1e3);return t.jsxs(te,{children:[String(a).padStart(2,"0"),":",String(r).padStart(2,"0"),".",String(n).padStart(3,"0")]})},ka=e=>"playVideo"in e?{play:()=>e.playVideo(),pause:()=>e.pauseVideo(),seekTo:a=>e.seekTo(a,!0),setPlaybackSpeed:a=>e.setPlaybackRate(a)}:e,X=(e,a)=>t.jsx(Le,{title:"Click to play the moment just before this time",placement:"top",arrow:!0,children:t.jsx(L,{sx:{py:.15,mb:.5},variant:"contained",size:"small",disabled:!a,onClick:a?()=>{Ie.resetPlayerNotes(),ka(a).seekTo((e??0)/1e3-.7)}:void 0,children:Re(e??0)})}),La=Re,ye=10;function wa({data:e,onChange:a,videoId:r,videoGap:n=0}){var B;const o=u.useRef(null),i=u.useRef(null),[l,c]=u.useState(!1);u.useEffect(()=>{(async()=>{var h,x,y,v;e.volume===0?(a({...e,volume:.5}),await((x=(h=o.current)==null?void 0:h.getInternalPlayer())==null?void 0:x.setVolume(50))):await((v=(y=o.current)==null?void 0:y.getInternalPlayer())==null?void 0:v.setVolume(e.volume*100)),c(!0)})()},[]),u.useEffect(()=>{if(!l)return;const h=setInterval(async()=>{var y,v;const x=await((v=(y=o.current)==null?void 0:y.getInternalPlayer())==null?void 0:v.getVolume());x!==void 0&&x!==e.volume*100&&a({...e,volume:x/100})},500);return()=>{clearInterval(h)}},[l,e,a]);const[d,p]=u.useState(!1),[m,s]=u.useState(!1),f=async(h,x)=>{var y,v;await((v=(y=o.current)==null?void 0:y.getInternalPlayer())==null?void 0:v.setVolume(+x*100)),a({...e,volume:+x})},S=e.previewStart??n+60,C=e.previewEnd??S+30,[k,g]=u.useState(null);u.useEffect(()=>{var h,x;i.current&&(i.current.currentTime=35),(x=(h=o.current)==null?void 0:h.getInternalPlayer())==null||x.getDuration().then(g)},[]);const w=(B=o.current)==null?void 0:B.getInternalPlayer();return t.jsxs($,{sx:{display:"flex",flexDirection:"column",width:"100%"},children:[t.jsxs("h3",{children:["Set song preview (start: ",X(S*1e3,w),", end:"," ",X(C*1e3,w),")"]}),t.jsx($,{sx:{display:"flex",gap:5},children:t.jsx(me,{"data-test":"song-preview",disabled:k===null,step:1,value:[S,C],max:(k??500)-ye,onChange:(h,x)=>{const[y,v]=x;v-y>ye&&a({...e,previewStart:y,previewEnd:v})}})}),t.jsx("h3",{children:"Adjust volume"}),t.jsxs($,{sx:{display:"flex",gap:5},children:[t.jsxs($,{children:[t.jsx("h4",{children:"Song"}),t.jsx(Be,{videoId:r,ref:o,onPlay:()=>{var h;p(!0),m&&((h=i.current)==null||h.pause(),setTimeout(()=>s(!0),200))},onPause:()=>{s(!1)}})]}),t.jsxs($,{children:[t.jsx("h4",{children:"Reference sound"}),t.jsx("p",{children:"Use the slider below to make the video volume roughly the same as this music."}),t.jsx("br",{}),t.jsx("audio",{ref:i,controls:!0,src:Ne,loop:!0,onLoad:h=>h.currentTarget.currentTime=35,onPlay:h=>{var x,y;h.currentTarget.volume=.5,s(!0),d&&((y=(x=o.current)==null?void 0:x.getInternalPlayer())==null||y.pauseVideo(),setTimeout(()=>p(!0),200))},onPause:()=>{var h,x;s(!1),d&&((x=(h=o.current)==null?void 0:h.getInternalPlayer())==null||x.playVideo())}})]})]}),t.jsxs("h4",{children:["Final Song Volume (",e.volume*100,")"]}),t.jsx($,{children:t.jsx(me,{"data-test":"volume",min:.1,max:1,step:.01,"aria-label":"Volume",value:e.volume,onChange:f})})]})}function Ba(){const r=new Intl.DisplayNames(["en"],{type:"region"}),n={};for(let i=65;i<=90;++i)for(let l=65;l<=90;++l){let c=String.fromCharCode(i)+String.fromCharCode(l),d=r.of(c);d&&c!==d&&(n[d]=c)}return{...n,...{}}}const $a=Ba(),Ia=e=>{const a=ue(!0);return u.useMemo(()=>{var n,o;const r=a.data.filter(i=>i.artist===e).map(i=>i.artistOrigin).filter(Boolean).reduce((i,l)=>(i[l]?i[l]++:i[l]=1,i),{});return(o=(n=Object.entries(r).sort((i,l)=>l[1]-i[1]))==null?void 0:n[0])==null?void 0:o[0]},[e,a.data])};function Ta(e){var m;const a=ue(!0),r=Ia(e.songArtist??"");u.useEffect(()=>{e.data.artistOrigin===void 0&&e.onChange({...e.data,artistOrigin:r})},[r,e.data]);const n=u.useMemo(()=>[...new Set(a.data.map(({language:s})=>Array.isArray(s)?s:[s]).flat().filter(Boolean))],[a.data]),o=$a,i=u.useMemo(()=>[...new Set(a.data.map(s=>s.genre).filter(Boolean).map(s=>s.toLowerCase().replace(/\b\w/g,f=>f.toUpperCase().trim())))],[a.data]),l=u.useMemo(()=>[...new Set(a.data.map(s=>s.edition).filter(Boolean).map(s=>s.toLowerCase().replace(/\b\w/g,f=>f.toUpperCase().trim())))].sort(),[a.data]),c=s=>{window.open(`https://www.google.com/search?q=${encodeURIComponent(`${e.songArtist} ${e.songTitle} ${s}`)}`,"_blank")},d=!!e.songTitle&&!!e.songArtist,p=+(((m=e.data)==null?void 0:m.realBpm)??0)>200;return t.jsxs(I,{container:!0,spacing:2,"data-test":"song-metadata",sx:{mt:6},children:[t.jsx(I,{item:!0,xs:6,children:t.jsx(T,{value:e.data.artist,onChange:s=>e.onChange({...e.data,artist:s.target.value}),label:"Song artist",size:"small","data-test":"song-artist",required:!0,fullWidth:!0})}),t.jsx(I,{item:!0,xs:6,children:t.jsx(T,{value:e.data.title,onChange:s=>e.onChange({...e.data,title:s.target.value}),label:"Song title",fullWidth:!0,size:"small",required:!0,"data-test":"song-title"})}),t.jsx(I,{item:!0,xs:3,children:t.jsx(ne,{onKeyDown:s=>{s.key==="Enter"&&s.preventDefault()},freeSolo:!0,disableClearable:!0,options:i,value:e.data.genre??"",onChange:(s,f)=>e.onChange({...e.data,genre:f}),renderInput:s=>t.jsx(T,{...s,onBlur:f=>e.onChange({...e.data,genre:f.target.value}),label:"Song genre (optional)",size:"small","data-test":"song-genre",fullWidth:!0})})}),t.jsx(I,{item:!0,xs:3,children:t.jsx(ne,{onKeyDown:s=>{s.key==="Enter"&&s.preventDefault()},freeSolo:!0,disableClearable:!0,options:l,value:e.data.edition??"",onChange:(s,f)=>e.onChange({...e.data,edition:f}),renderInput:s=>t.jsx(T,{...s,onBlur:f=>e.onChange({...e.data,edition:f.target.value}),label:"Song edition (optional)",size:"small","data-test":"song-edition",helperText:"Songs with the same theme, e.g. 'Christmas'",fullWidth:!0})})}),t.jsx(I,{item:!0,xs:3,children:t.jsx(ne,{onKeyDown:s=>{s.key==="Enter"&&s.preventDefault()},multiple:!0,freeSolo:!0,disableClearable:!0,options:n,value:typeof e.data.language=="string"?[e.data.language]:e.data.language,onChange:(s,f)=>{e.onChange({...e.data,language:f?f.filter(Boolean):e.data.language})},renderInput:s=>{var f;return t.jsx(T,{...s,label:"Song language",fullWidth:!0,size:"small",required:!((f=e.data.language)!=null&&f.length),"data-test":"song-language"})}})}),t.jsx(I,{item:!0,xs:3,children:t.jsxs(st,{fullWidth:!0,children:[t.jsx(it,{id:"song-origin-select-label",size:"small",children:"Song/artist origin (optional)"}),t.jsxs(lt,{"data-test":"artist-origin",size:"small",labelId:"song-origin-select-label",id:"song-origin-select",value:e.data.artistOrigin??"",label:"Song/artist origin (optional)",onChange:s=>e.onChange({...e.data,artistOrigin:s.target.value}),children:[t.jsx(fe,{value:"",children:"None"},"none"),Object.entries(o).map(([s,f])=>t.jsxs(fe,{value:f,children:[t.jsx(Ra,{isocode:f})," ",s]},f))]}),t.jsx(ct,{children:"Used to show the flag on the list"})]})}),t.jsx(I,{item:!0,xs:6,children:t.jsx(T,{"data-test":"release-year",value:e.data.year,onChange:s=>e.onChange({...e.data,year:s.target.value}),label:"Release year",helperText:"The year the song was released. Click the 'Lookup' button to look for it on Google",fullWidth:!0,size:"small",required:!0,...ce(()=>c("release year"),d)})}),t.jsx(I,{item:!0,xs:6,children:t.jsx(T,{"data-test":"song-bpm",value:e.data.realBpm,onChange:s=>e.onChange({...e.data,realBpm:s.target.value}),label:"Song (real) BPM",focused:p?!0:void 0,helperText:p?t.jsxs(t.Fragment,{children:["Usually songs don't have higher BPM than ",t.jsx("b",{children:"200"}),". Make sure the value is correct"]}):"The actual tempo of the song. Click the 'Lookup' button to look for it on Google",color:p?"warning":void 0,fullWidth:!0,type:"number",size:"small",required:!0,...ce(()=>c("tempo"),d)})}),t.jsx(I,{item:!0,xs:12}),t.jsx(I,{item:!0,xs:12,children:t.jsx(wa,{...e})})]})}const Ra=F(Ae,{target:"e14qbofj0"})({name:"1jigaf4",styles:"width:1em;margin-right:0.5em"});function Pa(e){return q("MuiButtonGroup",e)}const P=Y("MuiButtonGroup",["root","contained","outlined","text","disableElevation","disabled","firstButton","fullWidth","vertical","grouped","groupedHorizontal","groupedVertical","groupedText","groupedTextHorizontal","groupedTextVertical","groupedTextPrimary","groupedTextSecondary","groupedOutlined","groupedOutlinedHorizontal","groupedOutlinedVertical","groupedOutlinedPrimary","groupedOutlinedSecondary","groupedContained","groupedContainedHorizontal","groupedContainedVertical","groupedContainedPrimary","groupedContainedSecondary","lastButton","middleButton"]),Ma=["children","className","color","component","disabled","disableElevation","disableFocusRipple","disableRipple","fullWidth","orientation","size","variant"],Ea=(e,a)=>{const{ownerState:r}=e;return[{[`& .${P.grouped}`]:a.grouped},{[`& .${P.grouped}`]:a[`grouped${M(r.orientation)}`]},{[`& .${P.grouped}`]:a[`grouped${M(r.variant)}`]},{[`& .${P.grouped}`]:a[`grouped${M(r.variant)}${M(r.orientation)}`]},{[`& .${P.grouped}`]:a[`grouped${M(r.variant)}${M(r.color)}`]},{[`& .${P.firstButton}`]:a.firstButton},{[`& .${P.lastButton}`]:a.lastButton},{[`& .${P.middleButton}`]:a.middleButton},a.root,a[r.variant],r.disableElevation===!0&&a.disableElevation,r.fullWidth&&a.fullWidth,r.orientation==="vertical"&&a.vertical]},Ua=e=>{const{classes:a,color:r,disabled:n,disableElevation:o,fullWidth:i,orientation:l,variant:c}=e,d={root:["root",c,l==="vertical"&&"vertical",i&&"fullWidth",o&&"disableElevation"],grouped:["grouped",`grouped${M(l)}`,`grouped${M(c)}`,`grouped${M(c)}${M(l)}`,`grouped${M(c)}${M(r)}`,n&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return W(d,Pa,a)},Na=E("div",{name:"MuiButtonGroup",slot:"Root",overridesResolver:Ea})(({theme:e,ownerState:a})=>j({display:"inline-flex",borderRadius:(e.vars||e).shape.borderRadius},a.variant==="contained"&&{boxShadow:(e.vars||e).shadows[2]},a.disableElevation&&{boxShadow:"none"},a.fullWidth&&{width:"100%"},a.orientation==="vertical"&&{flexDirection:"column"},{[`& .${P.grouped}`]:j({minWidth:40,"&:hover":j({},a.variant==="contained"&&{boxShadow:"none"})},a.variant==="contained"&&{boxShadow:"none"}),[`& .${P.firstButton},& .${P.middleButton}`]:j({},a.orientation==="horizontal"&&{borderTopRightRadius:0,borderBottomRightRadius:0},a.orientation==="vertical"&&{borderBottomRightRadius:0,borderBottomLeftRadius:0},a.variant==="text"&&a.orientation==="horizontal"&&{borderRight:e.vars?`1px solid rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${e.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${P.disabled}`]:{borderRight:`1px solid ${(e.vars||e).palette.action.disabled}`}},a.variant==="text"&&a.orientation==="vertical"&&{borderBottom:e.vars?`1px solid rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${e.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${P.disabled}`]:{borderBottom:`1px solid ${(e.vars||e).palette.action.disabled}`}},a.variant==="text"&&a.color!=="inherit"&&{borderColor:e.vars?`rgba(${e.vars.palette[a.color].mainChannel} / 0.5)`:K(e.palette[a.color].main,.5)},a.variant==="outlined"&&a.orientation==="horizontal"&&{borderRightColor:"transparent"},a.variant==="outlined"&&a.orientation==="vertical"&&{borderBottomColor:"transparent"},a.variant==="contained"&&a.orientation==="horizontal"&&{borderRight:`1px solid ${(e.vars||e).palette.grey[400]}`,[`&.${P.disabled}`]:{borderRight:`1px solid ${(e.vars||e).palette.action.disabled}`}},a.variant==="contained"&&a.orientation==="vertical"&&{borderBottom:`1px solid ${(e.vars||e).palette.grey[400]}`,[`&.${P.disabled}`]:{borderBottom:`1px solid ${(e.vars||e).palette.action.disabled}`}},a.variant==="contained"&&a.color!=="inherit"&&{borderColor:(e.vars||e).palette[a.color].dark},{"&:hover":j({},a.variant==="outlined"&&a.orientation==="horizontal"&&{borderRightColor:"currentColor"},a.variant==="outlined"&&a.orientation==="vertical"&&{borderBottomColor:"currentColor"})}),[`& .${P.lastButton},& .${P.middleButton}`]:j({},a.orientation==="horizontal"&&{borderTopLeftRadius:0,borderBottomLeftRadius:0},a.orientation==="vertical"&&{borderTopRightRadius:0,borderTopLeftRadius:0},a.variant==="outlined"&&a.orientation==="horizontal"&&{marginLeft:-1},a.variant==="outlined"&&a.orientation==="vertical"&&{marginTop:-1})})),Aa=u.forwardRef(function(a,r){const n=G({props:a,name:"MuiButtonGroup"}),{children:o,className:i,color:l="primary",component:c="div",disabled:d=!1,disableElevation:p=!1,disableFocusRipple:m=!1,disableRipple:s=!1,fullWidth:f=!1,orientation:S="horizontal",size:C="medium",variant:k="outlined"}=n,g=O(n,Ma),w=j({},n,{color:l,component:c,disabled:d,disableElevation:p,disableFocusRipple:m,disableRipple:s,fullWidth:f,orientation:S,size:C,variant:k}),B=Ua(w),h=u.useMemo(()=>({className:B.grouped,color:l,disabled:d,disableElevation:p,disableFocusRipple:m,disableRipple:s,fullWidth:f,size:C,variant:k}),[l,d,p,m,s,f,C,k,B.grouped]),x=bt(o),y=x.length,v=b=>{const R=b===0,U=b===y-1;return R&&U?"":R?B.firstButton:U?B.lastButton:B.middleButton};return t.jsx(Na,j({as:c,role:"group",className:z(B.root,i),ref:r,ownerState:w},g,{children:t.jsx(dt.Provider,{value:h,children:x.map((b,R)=>t.jsx(ut.Provider,{value:v(R),children:b},R))})}))}),_=Aa;function za({player:e,currentTime:a,effectsEnabled:r,onEffectsToggle:n}){const o=c=>e.seekTo((a+c)/1e3),[i,l]=u.useState(1);return t.jsxs(t.Fragment,{children:[t.jsxs($,{sx:{mb:2},children:[t.jsxs(A,{variant:"h6","data-test":"current-time",children:["Current time: ",La(a)," (",t.jsx(te,{children:Math.round(a)})," ms)"]}),t.jsxs($,{sx:{display:"flex",gap:1},children:[t.jsxs(_,{variant:"contained",sx:{display:"flex",mt:1,flex:1},children:[t.jsx(L,{sx:{flex:1,px:1},onClick:()=>o(-1e4),"data-test":"seek-10s",children:"-10"}),t.jsx(L,{sx:{flex:1,px:1},onClick:()=>o(-5e3),"data-test":"seek-5s",children:"-5"}),t.jsx(L,{sx:{flex:1,px:1},onClick:()=>o(-1e3),"data-test":"seek-1s",children:"-1"}),t.jsx(L,{sx:{flex:1,px:1},onClick:()=>o(-500),"data-test":"seek-0.5s",children:"-0.5"})]}),t.jsx(pt,{}),t.jsxs(_,{variant:"contained",sx:{display:"flex",mt:1,flex:1},children:[t.jsx(L,{sx:{flex:1,px:1},onClick:()=>o(500),"data-test":"seek+0.5s",children:"+0.5"}),t.jsx(L,{sx:{flex:1,px:1},onClick:()=>o(1e3),"data-test":"seek+1s",children:"+1"}),t.jsx(L,{sx:{flex:1,px:1},onClick:()=>o(5e3),"data-test":"seek+5s",children:"+5"}),t.jsx(L,{sx:{flex:1,px:1},onClick:()=>o(1e4),"data-test":"seek+10s",children:"+10"})]})]})]}),t.jsxs($,{sx:{mb:2},children:[t.jsxs(A,{variant:"h6",children:["Playback speed: ",t.jsxs(te,{"data-test":"current-speed",children:[i*100,"%"]})]}),t.jsx(_,{variant:"contained",sx:{display:"flex",mt:1},children:[.25,.5,.75,1,1.25,1.5,2].map(c=>t.jsxs(L,{"data-test":`speed-${c}`,sx:{flex:1},onClick:()=>{l(c),e.setPlaybackSpeed(c)},disabled:i===c,children:[c*100,"%"]},c))})]})]})}const Fa=["alignItems","autoFocus","component","children","dense","disableGutters","divider","focusVisibleClassName","selected","className"],Va=(e,a)=>{const{ownerState:r}=e;return[a.root,r.dense&&a.dense,r.alignItems==="flex-start"&&a.alignItemsFlexStart,r.divider&&a.divider,!r.disableGutters&&a.gutters]},Ga=e=>{const{alignItems:a,classes:r,dense:n,disabled:o,disableGutters:i,divider:l,selected:c}=e,p=W({root:["root",n&&"dense",!i&&"gutters",l&&"divider",o&&"disabled",a==="flex-start"&&"alignItemsFlexStart",c&&"selected"]},ht,r);return j({},r,p)},Oa=E(ke,{shouldForwardProp:e=>ze(e)||e==="classes",name:"MuiListItemButton",slot:"Root",overridesResolver:Va})(({theme:e,ownerState:a})=>j({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${H.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:K(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${H.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:K(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}},[`&.${H.selected}:hover`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:K(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:K(e.palette.primary.main,e.palette.action.selectedOpacity)}},[`&.${H.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${H.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity}},a.divider&&{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:"padding-box"},a.alignItems==="flex-start"&&{alignItems:"flex-start"},!a.disableGutters&&{paddingLeft:16,paddingRight:16},a.dense&&{paddingTop:4,paddingBottom:4})),Wa=u.forwardRef(function(a,r){const n=G({props:a,name:"MuiListItemButton"}),{alignItems:o="center",autoFocus:i=!1,component:l="div",children:c,dense:d=!1,disableGutters:p=!1,divider:m=!1,focusVisibleClassName:s,selected:f=!1,className:S}=n,C=O(n,Fa),k=u.useContext(le),g=u.useMemo(()=>({dense:d||k.dense||!1,alignItems:o,disableGutters:p}),[o,k.dense,d,p]),w=u.useRef(null);Fe(()=>{i&&w.current&&w.current.focus()},[i]);const B=j({},n,{alignItems:o,dense:g.dense,disableGutters:p,divider:m,selected:f}),h=Ga(B),x=Ve(w,r);return t.jsx(le.Provider,{value:g,children:t.jsx(Oa,j({ref:x,href:C.href||C.to,component:(C.href||C.to)&&l==="div"?"button":l,focusVisibleClassName:z(h.focusVisible,s),ownerState:B,className:z(h.root,S)},C,{classes:h,children:c}))})}),Da=Wa;function _a(e,a){const r=Math.floor(a);return u.useMemo(()=>e.findIndex((n,o)=>r<0?!0:r<n.start?!1:o===e.length-1||e[o+1].start>r),[r,e])}function qa({song:e,currentTime:a,beatLength:r,player:n,onRecordChange:o,onTrackNameChange:i}){var B;const[l,c]=u.useState(0),[d,p]=u.useState(-1),[m,s]=u.useState([]),f=Ge(a,r,e.gap),S=e.tracks[l].sections.filter(Q),C=_a(S,f),k=h=>{p(h),Ie.resetPlayerNotes(),n.seekTo((S[h].start*r+e.gap)/1e3)},g=()=>{s(h=>[...h,{type:"delete",section:d,track:l}]),d===S.length-1&&p(h=>h-1)},w=h=>{s(x=>{const y=x.at(-1);if(y&&y.type==="shift"&&y.track===l&&y.section===d){const v=[...x];return v.at(-1).shift=h,v}return[...x,{type:"shift",section:d,track:l,shift:h}]})};return u.useEffect(()=>{o(m)},[o,m]),t.jsxs(Ka,{children:[t.jsxs(ge,{direction:"row",children:[t.jsxs(A,{variant:"h6",mb:0,sx:{flex:1},children:["Edit verses",e.tracks.length>1&&t.jsx(_,{variant:"contained",sx:{ml:2},size:"small",children:e.tracks.map((h,x)=>t.jsxs(L,{onClick:()=>c(x),disabled:l===x,"data-test":`track-${x+1}`,children:["Track ",x+1]},x))})]}),t.jsx(T,{placeholder:"Set track name",sx:{flex:1},size:"small",value:((B=e.tracks[l])==null?void 0:B.name)??"",onChange:h=>i(l,h.target.value),"data-test":"track-name"})]}),t.jsxs(ge,{direction:"row",spacing:2,sx:{height:"400px"},children:[t.jsx(xt,{sx:{overflowY:"auto"},children:S.map((h,x)=>t.jsx(mt,{disablePadding:!0,"data-test":`section-${x}`,children:t.jsx(Da,{onClick:()=>k(x),selected:d===x,children:t.jsx(Sa,{primaryTypographyProps:{fontWeight:x===C?"bold":"normal"},primary:Q(h)?h.notes.map(y=>y.lyrics).join(""):"[pause]"})})},h.start))}),t.jsx(Qa,{children:d>-1&&t.jsxs(t.Fragment,{children:[d===0&&t.jsx("h3",{"data-test":"use-gap-info",children:"Use gap shift to change when this section starts"}),d>0&&t.jsx(t.Fragment,{children:t.jsx(T,{"data-test":"change-start-beat",size:"small",type:"number",onChange:h=>w(+h.target.value),value:ie([S[d]]),label:"Change start beat",InputProps:{inputProps:{step:1}},fullWidth:!0,sx:{mb:2},helperText:t.jsxs(t.Fragment,{children:["Timestamp:"," ",X(ie([S[d]])*r+e.gap,n)]})})}),t.jsx(L,{variant:"contained",color:"error",onClick:g,fullWidth:!0,"data-test":"delete-section",children:"Delete section"})]})}),t.jsxs(Ya,{children:[t.jsx($,{sx:{overflowY:"auto",maxHeight:"34rem"},"data-test":"change-list",children:m.map((h,x)=>{let y="",v=je;return h.type==="delete"?(v=je,y="Deleted"):h.type==="shift"&&(v=Ha,y=`Start -> ${h.shift}`),t.jsx(v,{children:t.jsxs("strong",{children:["Track: ",h.track+1,", Section: ",h.section+1,", ",y]})},x)})}),m.length>0&&t.jsx(L,{"data-test":"undo-change",variant:"contained",color:"warning",onClick:()=>s(h=>h.filter((x,y)=>y!==h.length-1)),fullWidth:!0,children:"Undo last change"})]})]})]})}const Ya=F("div",{target:"edf68o88"})({name:"82a6rk",styles:"flex:1"}),Pe=F("div",{target:"edf68o87"})({name:"m1a2da",styles:"padding:0.5rem"}),je=F(Pe,{target:"edf68o86"})({name:"hwfcu5",styles:"color:red"}),Ha=F(Pe,{target:"edf68o85"})({name:"zzs6wi",styles:"color:#0059ff"}),Ka=F("div",{target:"edf68o83"})(""),Qa=F("div",{target:"edf68o82"})({name:"82a6rk",styles:"flex:1"});function Xa({song:e,player:a,beatLength:r}){return t.jsx(t.Fragment,{})}function Za(e,a){var l;const n=(l=a.tracks[0].sections.filter(Q).at(-1))==null?void 0:l.notes.at(-1),o=e-a.gap,i=n.start+n.length;return Number((6e4/(o/i*a.bar)).toFixed(2))}function Ja({current:e,onChange:a,player:r,song:n}){const o=Math.max(...n.tracks.map(d=>Oe(d.sections))),i=We(o,n)+n.gap,[l,c]=u.useState(Math.round(i));return t.jsxs($,{sx:{display:"flex",gap:2,mb:2},children:[t.jsx(T,{"data-test":"desired-end",size:"small",type:"number",value:l,onChange:d=>c(+d.target.value),label:"Desired last note end time (in milliseconds)",sx:{flex:1},helperText:l?t.jsxs(t.Fragment,{children:["Estimated proper Tempo (BPM) of the lyrics:"," ",t.jsx(te,{"data-test":"desired-bpm",children:Za(l,n)})]}):" "}),t.jsx(T,{"data-test":"change-bpm",size:"small",type:"number",value:e,onChange:d=>a(+d.target.value),label:"Tempo (BPM) of the lyrics",sx:{flex:.5},helperText:" ",InputProps:{inputProps:{step:"0.1"}}})]})}function er({current:e,onChange:a,player:r,finalGap:n}){return t.jsxs($,{sx:{flex:1},children:[t.jsxs(A,{variant:"h6",children:["Lyrics Gap shift (final: ",X(n,r),")"]}),t.jsxs($,{sx:{display:"flex",gap:1,mt:1},children:[t.jsxs(_,{sx:{flex:1},children:[t.jsx(L,{sx:{flex:1,px:1},onClick:()=>a(e-1e3),"data-test":"shift-gap-1s",children:"-1000"}),t.jsx(L,{sx:{flex:1,px:1},onClick:()=>a(e-500),"data-test":"shift-gap-0.5s",children:"-500"}),t.jsx(L,{sx:{flex:1,px:1},onClick:()=>a(e-50),"data-test":"shift-gap-0.05s",children:"-50"})]}),t.jsx(T,{sx:{py:0,flex:1},size:"small",type:"text",value:e,onChange:o=>a(+o.target.value),label:"Miliseconds","data-test":"shift-gap"}),t.jsxs(_,{sx:{flex:1},children:[t.jsx(L,{sx:{flex:1,px:1},onClick:()=>a(e+50),"data-test":"shift-gap+0.05s",children:"+50"}),t.jsx(L,{sx:{flex:1,px:1},onClick:()=>a(e+500),"data-test":"shift-gap+0.5s",children:"+500"}),t.jsx(L,{sx:{flex:1,px:1},onClick:()=>a(e+1e3),"data-test":"shift-gap+1s",children:"+1000"})]})]})]})}function tr({current:e,onChange:a,player:r,finalGap:n}){return t.jsxs($,{sx:{flex:1},children:[t.jsxs(A,{variant:"h6",children:["Video Gap shift (final: ",X((n??0)*1e3,r),")"]}),t.jsxs($,{sx:{display:"flex",gap:1,mt:1},children:[t.jsxs(_,{sx:{flex:1},children:[t.jsx(L,{sx:{flex:1,px:1.25},onClick:()=>a(e-10),"data-test":"shift-video-gap-10s",children:"-10"}),t.jsx(L,{sx:{flex:1,px:1.25},onClick:()=>a(e-5),"data-test":"shift-video-gap-5s",children:"-5"}),t.jsx(L,{sx:{flex:1,px:1.25},onClick:()=>a(e-1),"data-test":"shift-video-gap-1s",children:"-1"})]}),t.jsx(T,{"data-test":"shift-video-gap",sx:{py:0,flex:1},size:"small",type:"text",value:e,onChange:o=>a(+o.target.value),label:"Seconds"}),t.jsxs(_,{sx:{flex:1},children:[t.jsx(L,{sx:{flex:1,px:1.25},onClick:()=>a(e+1),"data-test":"shift-video-gap+1s",children:"+1"}),t.jsx(L,{sx:{flex:1,px:1.25},onClick:()=>a(e+5),"data-test":"shift-video-gap+5s",children:"+5"}),t.jsx(L,{sx:{flex:1,px:1.25},onClick:()=>a(e+10),"data-test":"shift-video-gap+10s",children:"+10"})]})]})]})}var ar=1,rr=4;function nr(e){return De(e,ar|rr)}const or=(e,a)=>({...e,gap:e.gap+a}),sr=(e,a)=>({...e,videoGap:(e.videoGap??0)+a}),ir=(e,a)=>({...e,bpm:a}),lr=(e,a)=>({...e,tracks:e.tracks.map((r,n)=>{const o=a.filter(l=>l.track===n);let i=[...r.sections].filter(Q);return o.forEach(l=>{if(l.type==="delete")i=i.filter((c,d)=>d!==l.section);else if(l.type==="shift"){const c=l.shift-ie([i[l.section]]);i=i.map((d,p)=>p<l.section?d:{...d,notes:d.notes.map(m=>({...m,start:m.start+c}))})}}),{...r,sections:i}})}),cr=(e,a)=>({...e,tracks:e.tracks.map((r,n)=>({...r,name:a[n]??r.name}))}),de=800,Ce=de/16*9;function dr({song:e,onUpdate:a,visible:r}){const n=u.useRef(null),[o,i]=u.useState(0),[l,c]=u.useState(0),[d,p]=u.useState(0),[m,s]=u.useState(e.bpm),[f,S]=u.useState(0),[C,k]=u.useState([]),[g,w]=u.useState(!1),[B,h]=u.useState(e.tracks.map(b=>b.name??void 0)),x=u.useMemo(()=>{let b=nr(e);return b=_e(b),b=qe(b),b=he(b),b=or(b,l),b=sr(b,d),b=ir(b,m),b=lr(b,C),b=cr(b,B),b=he(b),b=Ye(b),b},[l,d,e,m,C,B]);u.useEffect(()=>{a==null||a(x)},[a,x]);const y=u.useMemo(()=>({id:"test",mode:He.DUEL,players:[{number:0,track:0},{number:1,track:e.tracks.length-1}],tolerance:6}),[e]);let v;return v=Ke(x),u.useEffect(()=>{var b;r||(b=n.current)==null||b.pause()},[r]),t.jsxs(I,{container:!0,spacing:2,sx:{display:r?void 0:"none"},children:[t.jsx(I,{item:!0,xs:8,"data-test":"player-container",children:t.jsx($,{sx:{width:de,height:Ce},children:t.jsx(Qe,{song:x,showControls:!0,autoplay:!1,width:de,height:Ce,ref:n,onCurrentTimeUpdate:i,players:y.players,effectsEnabled:g,singSetup:y,onSongEnd:()=>{}},f)})}),t.jsxs(I,{item:!0,xs:4,children:[t.jsx(A,{variant:"h5",mb:2,children:"Playback controls"}),n.current&&t.jsx(za,{player:n.current,currentTime:o,effectsEnabled:g,onEffectsToggle:()=>w(b=>!b)}),!n.current&&t.jsx("h2",{children:"Start the song to see the manipulation form"})]}),n.current&&t.jsxs(t.Fragment,{children:[t.jsx(I,{item:!0,xs:8,children:t.jsxs($,{sx:{display:"flex",gap:5,flex:1},children:[t.jsx(tr,{player:n.current,onChange:b=>{const R=b-d;p(b),c(U=>U+R*1e3)},current:d,finalGap:x.videoGap}),t.jsx(er,{player:n.current,onChange:c,current:l,finalGap:x.gap})]})}),t.jsxs(I,{item:!0,xs:4,children:[t.jsxs(V,{children:["Use ",t.jsx("strong",{children:"Video shift gap"})," to crop the beginning of the video if it starts with an intro."]}),t.jsxs(V,{children:["Use ",t.jsx("strong",{children:"Lyrics shift gap"})," to sync the start of the lyrics to the video. You can lower the"," ",t.jsx("strong",{children:"Playback speed"})," above to make sure you got it just right."]})]}),t.jsxs(I,{item:!0,xs:8,children:[t.jsx(A,{variant:"h5",mb:2,children:"Advanced"}),t.jsx(Ja,{player:n.current,onChange:s,current:m,song:x},x.gap),t.jsx(Xa,{player:n.current,song:x,beatLength:v})]}),t.jsxs(I,{item:!0,xs:4,children:[t.jsx(V,{children:"If the lyrics desynchronise over time, probably the tempo (BPM) of the lyrics is wrong."}),t.jsxs(V,{children:["You can either use ",t.jsx("strong",{children:"Last note end time"})," - enter the millisecond when the last note should end (seek through the video for the moment as ",t.jsx("strong",{children:"Current time"})," panel show the exact millisecond) and a suggested BPM value will appear below."]}),t.jsxs(V,{children:[t.jsx("strong",{children:"Tempo (BPM)"})," field allows to fine-tune the tempo."]})]}),t.jsx(I,{item:!0,xs:8,children:t.jsx(qa,{song:x,currentTime:o,beatLength:v,player:n.current,onRecordChange:k,onTrackNameChange:(b,R)=>h(U=>{const pe=[...U];return pe[b]=R===""?void 0:R,pe})})}),t.jsxs(I,{item:!0,xs:4,children:[t.jsxs(V,{children:["If the lyrics there are more lyrics than in the video or there are longer/shorter interludes between verses, you can ",t.jsx("strong",{children:"Edit verses"}),"."]}),t.jsx(V,{children:"Select a verse by clicking on it."}),t.jsxs(V,{children:["You can either ",t.jsx("strong",{children:"Change its start beat"}),' (which will "move in time" the verse and all subsequent ones) or ',t.jsx("strong",{children:"Delete it"})," (it won't affect the timing of other verses)."]}),t.jsxs(V,{children:[t.jsx("strong",{children:"List of changes"})," on the right allows you to see and undo the actions one by one."]})]})]})]})}const V=F("p",{target:"enb6wj40"})({name:"1tcko1c",styles:"font-size:0.85rem;margin-bottom:1rem;line-height:1.25rem;strong{font-weight:bold;}"});function ur(e){var a,r,n;return t.jsx($,{"data-test":"sync-lyrics",children:e.data&&e.data.video.length<15&&!!((n=(r=(a=e.data.tracks)==null?void 0:a[0])==null?void 0:r.sections)!=null&&n.length)&&t.jsx(dr,{song:e.data,onUpdate:e.onChange,visible:e.visible})})}function pr(e){const a=new URL(window.location.href);Object.entries(e).forEach(([r,n])=>{n===null?a.searchParams.delete(r):a.searchParams.set(r,n)}),window.history.replaceState(null,"",a.toString())}function hr(e){return Array.isArray(e)?e.length===0:!e}const N=["basic-data","author-and-video","sync","metadata"];function gr({song:e}){const a=!!e,{data:r}=ue(!0);Xe(!1);const n=Ze();Je(!1);const o=et("step"),[i,l]=u.useState(Math.max(0,N.indexOf(o)));u.useEffect(()=>{N[i]&&pr({step:N[i]})},[i]);const[c,d]=u.useState({sourceUrl:(e==null?void 0:e.sourceUrl)??"",txtInput:""}),[p,m]=u.useState({author:(e==null?void 0:e.author)??"",authorUrl:(e==null?void 0:e.authorUrl)??"",video:e!=null&&e.video?`https://www.youtube.com/watch?v=${e.video}`:""}),[s,f]=u.useState({artist:(e==null?void 0:e.artist)??"",title:(e==null?void 0:e.title)??"",realBpm:e!=null&&e.realBpm?String(e.realBpm):"",year:(e==null?void 0:e.year)??"",language:(e==null?void 0:e.language)??[],volume:(e==null?void 0:e.volume)??0,previewStart:(e==null?void 0:e.previewStart)??void 0,previewEnd:(e==null?void 0:e.previewEnd)??void 0,genre:e==null?void 0:e.genre,edition:e==null?void 0:e.edition,artistOrigin:e==null?void 0:e.artistOrigin}),[S,C]=u.useState(e),k=u.useRef(""),g=u.useMemo(()=>{try{return a?{...e,video:we(p.video)||e.video,author:p.author,authorUrl:p.authorUrl,sourceUrl:c.sourceUrl}:c.txtInput?$e(c.txtInput,p.video,p.author,p.authorUrl,c.sourceUrl):void 0}catch(v){k.current=v.message,console.error(v)}},[c.txtInput,p.video,p.author,p.authorUrl,c.sourceUrl,e,a]),w=u.useMemo(()=>!a&&g&&(r==null?void 0:r.find(v=>re.generateSongFile(v)===re.generateSongFile(g))),[r,g,a]);u.useEffect(()=>{g&&(g.video&&!p.video&&m(v=>({...v,video:`https://www.youtube.com/watch?v=${g.video}`})),g.author&&!p.author&&m(v=>({...v,author:v.author||(g==null?void 0:g.author)||"",authorUrl:v.authorUrl||(g==null?void 0:g.authorUrl)||""})),g.sourceUrl&&!c.sourceUrl&&d(v=>({...v,sourceUrl:g.sourceUrl})),["year","language","realBpm","genre","artist","title","volume","previewStart","previewEnd","artistOrigin"].forEach(v=>{g[v]&&hr(s[v])&&f(b=>({...b,[v]:g[v]}))}))},[g,s.year,s.language,s.realBpm,s.genre,s.artist,s.volume,s.title,s.previewStart,s.previewEnd,c.sourceUrl,p.video]);const B=!!c.txtInput||a,h=!!p.video,x=N[i]==="author-and-video"?h:!0,y={...S,...s,author:p.author,authorUrl:p.authorUrl,realBpm:+s.realBpm,sourceUrl:c.sourceUrl,id:tt(s)};return t.jsxs(at,{injectFirst:!0,children:[t.jsx(rt,{}),t.jsxs(xr,{children:[!a&&t.jsx("div",{style:{marginBottom:"1rem"},children:t.jsx(nt,{to:"menu/",children:t.jsx("a",{children:"Return to the main menu"})})}),t.jsxs(da,{activeStep:i,sx:{mb:2},nonLinear:a,children:[t.jsx(J,{completed:B,children:t.jsx(ee,{color:"inherit",onClick:()=>l(0),children:"Basic Info"})},0),t.jsx(J,{completed:h,children:t.jsx(ee,{color:"inherit",onClick:()=>l(1),children:"Author and video data"})},1),t.jsx(J,{children:t.jsx(ee,{color:"inherit",onClick:()=>l(2),children:"Sync lyrics to video"})},2),t.jsx(J,{children:t.jsx(ee,{color:"inherit",onClick:()=>l(3),children:"Fill song metadata"})},3)]}),t.jsxs("form",{onSubmit:async v=>{v.preventDefault(),i<N.length-1?l(b=>b+1):N.at(i)==="metadata"&&(await re.store(y),ft(y.id),n("edit/list/",{id:y.id,created:a?null:"true",song:null}))},children:[N.at(i)==="basic-data"&&t.jsx(va,{shouldAutoImport:!h,isTxtRequired:!e,onAutoImport:m,onChange:d,data:c,finalSong:y}),N.at(i)==="author-and-video"&&t.jsx(ua,{songArtist:g==null?void 0:g.artist,songTitle:g==null?void 0:g.title,onChange:m,data:p}),g&&t.jsx(ur,{onChange:C,data:g,visible:N.at(i)==="sync"}),N.at(i)==="metadata"&&t.jsx(Ta,{videoGap:S==null?void 0:S.videoGap,onChange:f,data:s,songArtist:g==null?void 0:g.artist,songTitle:g==null?void 0:g.title,videoId:g.video}),w&&t.jsxs(gt,{severity:"warning","data-test":"possible-duplicate",children:[t.jsx(vt,{children:"Possible duplicate"}),"There is already a song with similar artist and/or name:"," ",t.jsxs("b",{children:[w.artist," - ",w.title]})]}),t.jsxs($,{sx:{display:"flex",justifyContent:"flex-end"},children:[t.jsx(L,{"data-test":"previous-button",sx:{mt:2,align:"right"},onClick:()=>l(v=>v-1),disabled:i===0,children:"Previous"}),N.at(i)==="metadata"?t.jsx(L,{"data-test":"save-button",sx:{mt:2,align:"right"},type:"submit",variant:"contained",children:"Save"}):t.jsx(L,{"data-test":"next-button",sx:{mt:2,align:"right"},variant:"contained",type:"submit",disabled:!x||i===N.length-1,children:"Next"})]})]})]})]})}const xr=F("div",{target:"e1qxoxak0"})({name:"1ec6m7r",styles:"background:white;margin:30px auto 0;width:1260px;height:100%"});export{gr as default};
//# sourceMappingURL=ConvertView-DgywnF5y.js.map
