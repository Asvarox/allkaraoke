import{r as p,p as Y,o as H,h as U,b as C,i as G,a as O,j as t,k as F,l as W,G as Le,ak as Ue,B as we,al as Ne,q as E,aj as z,a4 as Be,a8 as ze,am as $e,an as Ie,c as Te,ao as X,ap as Re,aq as Ae,ab as he,ar as Fe,as as Ve,w as Z,t as Ge,e as Oe,E as We,at as De,au as ce,av as _e,aw as qe,ax as Ye,ay as He,az as me,aA as Ke,aB as Xe,aC as Qe,aD as Ze,a9 as Je,aE as et,aa as tt,ac as at,S as se,g as rt,aF as nt,ai as st,ad as ot}from"./index-B6bbN9XC.js";import{B as L,q as I,k as R,N as fe,L as de,T as A,O as it,E as ge,J as T,z as oe,i as lt,I as ct,w as dt,o as ve,j as ut,Q as pt,R as ht,p as xt,U as Q,V as mt,S as be,e as ft,h as gt,W as vt,A as bt,r as yt}from"./ShareSongsModal-BeI1-AQ5.js";function jt(e){return p.Children.toArray(e).filter(a=>p.isValidElement(a))}const Ct=p.createContext({}),ee=Ct,St=p.createContext({}),ne=St;function kt(e){return Y("MuiStep",e)}H("MuiStep",["root","horizontal","vertical","alternativeLabel","completed"]);const Lt=["active","children","className","component","completed","disabled","expanded","index","last"],wt=e=>{const{classes:a,orientation:r,alternativeLabel:n,completed:s}=e;return W({root:["root",r,n&&"alternativeLabel",s&&"completed"]},kt,a)},Bt=U("div",{name:"MuiStep",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:r}=e;return[a.root,a[r.orientation],r.alternativeLabel&&a.alternativeLabel,r.completed&&a.completed]}})(({ownerState:e})=>C({},e.orientation==="horizontal"&&{paddingLeft:8,paddingRight:8},e.alternativeLabel&&{flex:1,position:"relative"})),$t=p.forwardRef(function(a,r){const n=G({props:a,name:"MuiStep"}),{active:s,children:i,className:c,component:l="div",completed:u,disabled:d,expanded:f=!1,index:o,last:m}=n,k=O(n,Lt),{activeStep:j,connector:S,alternativeLabel:g,orientation:w,nonLinear:B}=p.useContext(ee);let[y=!1,x=!1,v=!1]=[s,u,d];j===o?y=s!==void 0?s:!0:!B&&j>o?x=u!==void 0?u:!0:!B&&j<o&&(v=d!==void 0?d:!0);const h=p.useMemo(()=>({index:o,last:m,expanded:f,icon:o+1,active:y,completed:x,disabled:v}),[o,m,f,y,x,v]),$=C({},n,{active:y,orientation:w,alternativeLabel:g,completed:x,disabled:v,expanded:f,component:l}),M=wt($),b=t.jsxs(Bt,C({as:l,className:F(M.root,c),ref:r,ownerState:$},k,{children:[S&&g&&o!==0?S:null,i]}));return t.jsx(ne.Provider,{value:h,children:S&&!g&&o!==0?t.jsxs(p.Fragment,{children:[S,b]}):b})}),te=$t,It=Le(t.jsx("path",{d:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24zm-2 17l-5-5 1.4-1.4 3.6 3.6 7.6-7.6L19 8l-9 9z"}),"CheckCircle"),Tt=Le(t.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}),"Warning");function Rt(e){return Y("MuiStepIcon",e)}const Pt=H("MuiStepIcon",["root","active","completed","error","text"]),ie=Pt;var ye;const Mt=["active","className","completed","error","icon"],Et=e=>{const{classes:a,active:r,completed:n,error:s}=e;return W({root:["root",r&&"active",n&&"completed",s&&"error"],text:["text"]},Rt,a)},le=U(Ue,{name:"MuiStepIcon",slot:"Root",overridesResolver:(e,a)=>a.root})(({theme:e})=>({display:"block",transition:e.transitions.create("color",{duration:e.transitions.duration.shortest}),color:(e.vars||e).palette.text.disabled,[`&.${ie.completed}`]:{color:(e.vars||e).palette.primary.main},[`&.${ie.active}`]:{color:(e.vars||e).palette.primary.main},[`&.${ie.error}`]:{color:(e.vars||e).palette.error.main}})),Ut=U("text",{name:"MuiStepIcon",slot:"Text",overridesResolver:(e,a)=>a.text})(({theme:e})=>({fill:(e.vars||e).palette.primary.contrastText,fontSize:e.typography.caption.fontSize,fontFamily:e.typography.fontFamily})),Nt=p.forwardRef(function(a,r){const n=G({props:a,name:"MuiStepIcon"}),{active:s=!1,className:i,completed:c=!1,error:l=!1,icon:u}=n,d=O(n,Mt),f=C({},n,{active:s,completed:c,error:l}),o=Et(f);if(typeof u=="number"||typeof u=="string"){const m=F(i,o.root);return l?t.jsx(le,C({as:Tt,className:m,ref:r,ownerState:f},d)):c?t.jsx(le,C({as:It,className:m,ref:r,ownerState:f},d)):t.jsxs(le,C({className:m,ref:r,ownerState:f},d,{children:[ye||(ye=t.jsx("circle",{cx:"12",cy:"12",r:"12"})),t.jsx(Ut,{className:o.text,x:"12",y:"12",textAnchor:"middle",dominantBaseline:"central",ownerState:f,children:u})]}))}return u}),zt=Nt;function At(e){return Y("MuiStepLabel",e)}const Ft=H("MuiStepLabel",["root","horizontal","vertical","label","active","completed","error","disabled","iconContainer","alternativeLabel","labelContainer"]),_=Ft,Vt=["children","className","componentsProps","error","icon","optional","slotProps","StepIconComponent","StepIconProps"],Gt=e=>{const{classes:a,orientation:r,active:n,completed:s,error:i,disabled:c,alternativeLabel:l}=e;return W({root:["root",r,i&&"error",c&&"disabled",l&&"alternativeLabel"],label:["label",n&&"active",s&&"completed",i&&"error",c&&"disabled",l&&"alternativeLabel"],iconContainer:["iconContainer",n&&"active",s&&"completed",i&&"error",c&&"disabled",l&&"alternativeLabel"],labelContainer:["labelContainer",l&&"alternativeLabel"]},At,a)},Ot=U("span",{name:"MuiStepLabel",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:r}=e;return[a.root,a[r.orientation]]}})(({ownerState:e})=>C({display:"flex",alignItems:"center",[`&.${_.alternativeLabel}`]:{flexDirection:"column"},[`&.${_.disabled}`]:{cursor:"default"}},e.orientation==="vertical"&&{textAlign:"left",padding:"8px 0"})),Wt=U("span",{name:"MuiStepLabel",slot:"Label",overridesResolver:(e,a)=>a.label})(({theme:e})=>C({},e.typography.body2,{display:"block",transition:e.transitions.create("color",{duration:e.transitions.duration.shortest}),[`&.${_.active}`]:{color:(e.vars||e).palette.text.primary,fontWeight:500},[`&.${_.completed}`]:{color:(e.vars||e).palette.text.primary,fontWeight:500},[`&.${_.alternativeLabel}`]:{marginTop:16},[`&.${_.error}`]:{color:(e.vars||e).palette.error.main}})),Dt=U("span",{name:"MuiStepLabel",slot:"IconContainer",overridesResolver:(e,a)=>a.iconContainer})(()=>({flexShrink:0,display:"flex",paddingRight:8,[`&.${_.alternativeLabel}`]:{paddingRight:0}})),_t=U("span",{name:"MuiStepLabel",slot:"LabelContainer",overridesResolver:(e,a)=>a.labelContainer})(({theme:e})=>({width:"100%",color:(e.vars||e).palette.text.secondary,[`&.${_.alternativeLabel}`]:{textAlign:"center"}})),Pe=p.forwardRef(function(a,r){var n;const s=G({props:a,name:"MuiStepLabel"}),{children:i,className:c,componentsProps:l={},error:u=!1,icon:d,optional:f,slotProps:o={},StepIconComponent:m,StepIconProps:k}=s,j=O(s,Vt),{alternativeLabel:S,orientation:g}=p.useContext(ee),{active:w,disabled:B,completed:y,icon:x}=p.useContext(ne),v=d||x;let h=m;v&&!h&&(h=zt);const $=C({},s,{active:w,alternativeLabel:S,completed:y,disabled:B,error:u,orientation:g}),M=Gt($),b=(n=o.label)!=null?n:l.label;return t.jsxs(Ot,C({className:F(M.root,c),ref:r,ownerState:$},j,{children:[v||h?t.jsx(Dt,{className:M.iconContainer,ownerState:$,children:t.jsx(h,C({completed:y,active:w,error:u,icon:v},k))}):null,t.jsxs(_t,{className:M.labelContainer,ownerState:$,children:[i?t.jsx(Wt,C({ownerState:$},b,{className:F(M.label,b==null?void 0:b.className),children:i})):null,f]})]}))});Pe.muiName="StepLabel";const qt=Pe;function Yt(e){return Y("MuiStepButton",e)}const Ht=H("MuiStepButton",["root","horizontal","vertical","touchRipple"]),je=Ht,Kt=["children","className","icon","optional"],Xt=e=>{const{classes:a,orientation:r}=e;return W({root:["root",r],touchRipple:["touchRipple"]},Yt,a)},Qt=U(we,{name:"MuiStepButton",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:r}=e;return[{[`& .${je.touchRipple}`]:a.touchRipple},a.root,a[r.orientation]]}})(({ownerState:e})=>C({width:"100%",padding:"24px 16px",margin:"-24px -16px",boxSizing:"content-box"},e.orientation==="vertical"&&{justifyContent:"flex-start",padding:"8px",margin:"-8px"},{[`& .${je.touchRipple}`]:{color:"rgba(0, 0, 0, 0.3)"}})),Zt=p.forwardRef(function(a,r){const n=G({props:a,name:"MuiStepButton"}),{children:s,className:i,icon:c,optional:l}=n,u=O(n,Kt),{disabled:d,active:f}=p.useContext(ne),{orientation:o}=p.useContext(ee),m=C({},n,{orientation:o}),k=Xt(m),j={icon:c,optional:l},S=Ne(s,["StepLabel"])?p.cloneElement(s,j):t.jsx(qt,C({},j,{children:s}));return t.jsx(Qt,C({focusRipple:!0,disabled:d,TouchRippleProps:{className:k.touchRipple},className:F(k.root,i),ref:r,ownerState:m,"aria-current":f?"step":void 0},u,{children:S}))}),ae=Zt;function Jt(e){return Y("MuiStepper",e)}H("MuiStepper",["root","horizontal","vertical","alternativeLabel"]);function ea(e){return Y("MuiStepConnector",e)}H("MuiStepConnector",["root","horizontal","vertical","alternativeLabel","active","completed","disabled","line","lineHorizontal","lineVertical"]);const ta=["className"],aa=e=>{const{classes:a,orientation:r,alternativeLabel:n,active:s,completed:i,disabled:c}=e,l={root:["root",r,n&&"alternativeLabel",s&&"active",i&&"completed",c&&"disabled"],line:["line",`line${E(r)}`]};return W(l,ea,a)},ra=U("div",{name:"MuiStepConnector",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:r}=e;return[a.root,a[r.orientation],r.alternativeLabel&&a.alternativeLabel,r.completed&&a.completed]}})(({ownerState:e})=>C({flex:"1 1 auto"},e.orientation==="vertical"&&{marginLeft:12},e.alternativeLabel&&{position:"absolute",top:12,left:"calc(-50% + 20px)",right:"calc(50% + 20px)"})),na=U("span",{name:"MuiStepConnector",slot:"Line",overridesResolver:(e,a)=>{const{ownerState:r}=e;return[a.line,a[`line${E(r.orientation)}`]]}})(({ownerState:e,theme:a})=>{const r=a.palette.mode==="light"?a.palette.grey[400]:a.palette.grey[600];return C({display:"block",borderColor:a.vars?a.vars.palette.StepConnector.border:r},e.orientation==="horizontal"&&{borderTopStyle:"solid",borderTopWidth:1},e.orientation==="vertical"&&{borderLeftStyle:"solid",borderLeftWidth:1,minHeight:24})}),sa=p.forwardRef(function(a,r){const n=G({props:a,name:"MuiStepConnector"}),{className:s}=n,i=O(n,ta),{alternativeLabel:c,orientation:l="horizontal"}=p.useContext(ee),{active:u,disabled:d,completed:f}=p.useContext(ne),o=C({},n,{alternativeLabel:c,orientation:l,active:u,completed:f,disabled:d}),m=aa(o);return t.jsx(ra,C({className:F(m.root,s),ref:r,ownerState:o},i,{children:t.jsx(na,{className:m.line,ownerState:o})}))}),oa=sa,ia=["activeStep","alternativeLabel","children","className","component","connector","nonLinear","orientation"],la=e=>{const{orientation:a,alternativeLabel:r,classes:n}=e;return W({root:["root",a,r&&"alternativeLabel"]},Jt,n)},ca=U("div",{name:"MuiStepper",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:r}=e;return[a.root,a[r.orientation],r.alternativeLabel&&a.alternativeLabel]}})(({ownerState:e})=>C({display:"flex"},e.orientation==="horizontal"&&{flexDirection:"row",alignItems:"center"},e.orientation==="vertical"&&{flexDirection:"column"},e.alternativeLabel&&{alignItems:"flex-start"})),da=t.jsx(oa,{}),ua=p.forwardRef(function(a,r){const n=G({props:a,name:"MuiStepper"}),{activeStep:s=0,alternativeLabel:i=!1,children:c,className:l,component:u="div",connector:d=da,nonLinear:f=!1,orientation:o="horizontal"}=n,m=O(n,ia),k=C({},n,{alternativeLabel:i,orientation:o,component:u}),j=la(k),S=p.Children.toArray(c).filter(Boolean),g=S.map((B,y)=>p.cloneElement(B,C({index:y,last:y+1===S.length},B.props))),w=p.useMemo(()=>({activeStep:s,alternativeLabel:i,connector:d,nonLinear:f,orientation:o}),[s,i,d,f,o]);return t.jsx(ee.Provider,{value:w,children:t.jsx(ca,C({as:u,ownerState:k,className:F(j.root,l),ref:r},m,{children:g}))})}),pa=ua;function ha(e){var r;const a=new URL((r=global.location)==null?void 0:r.href);Object.entries(e).forEach(([n,s])=>{s===null?a.searchParams.delete(n):a.searchParams.set(n,s)}),global.history.replaceState(null,"",a.toString())}const re=z("span",{target:"eu1xhb40"})({name:"1n7r223",styles:"font-family:monospace"}),ue=(e,a,r="Lookup")=>({InputProps:{endAdornment:t.jsx(Be,{title:a?"Open search results for the song":"Artist or title of the song is unknown",children:t.jsx("span",{children:t.jsx(L,{sx:{mr:-1},endIcon:t.jsx(ze,{}),color:"secondary",variant:"text",onClick:e,disabled:!a,children:r})})})}});function xa(e){const a=()=>{global.open(`https://www.youtube.com/results?search_query=${encodeURIComponent((e==null?void 0:e.songArtist)+" "+(e==null?void 0:e.songTitle))}`,"_blank")},r=!!e.songTitle&&!!e.songArtist,n=$e(e.data.video);return t.jsxs(I,{sx:{display:"flex",flexWrap:"wrap"},"data-test":"author-and-vid",children:[t.jsx(R,{"data-test":"author-name",sx:{mt:2},value:e.data.author,onChange:s=>e.onChange({...e.data,author:s.target.value}),label:"Author name (optional)",fullWidth:!0,size:"small",helperText:"Nickname of the person that created the .txt file."}),t.jsx(R,{"data-test":"author-url",sx:{mt:2},value:e.data.authorUrl,onChange:s=>e.onChange({...e.data,authorUrl:s.target.value}),label:"Author URL (optional)",helperText:"Link to authors page/profile.",fullWidth:!0,size:"small"}),t.jsx(I,{sx:{display:"flex",flexDirection:"row",mt:2,alignItems:"center",width:"100%"},children:t.jsx(R,{"data-test":"video-url",required:!0,value:e.data.video,onChange:s=>e.onChange({...e.data,video:s.target.value}),label:"YouTube Video URL",placeholder:"https://www.youtube.com/watch?v=",fullWidth:!0,size:"small",helperText:"Link to YouTube video, eg https://www.youtube.com/watch?v=xxxxxxxxx. Click the 'Lookup' button to look for it on YouTube",name:"videoUrl",...ue(a,r)})}),n&&t.jsx(I,{children:t.jsx(Ie,{videoId:n})})]})}const ma={polish:{Ãˆ:"Ã©",Ã­:"'","Â¥":"'","Â¯":"Å»","Â¹":"Ä…",Ï€:"Ä…",Ãª:"Ä™",Ã:"Ä™",Å’:"Åš",Ã¥:"Åš",Å“:"Å›",Ãº:"Å›",Ã¦:"Ä‡",ÃŠ:"Ä‡","Â¿":"Å¼",Ã¸:"Å¼",Ã˜:"Å»",Ã±:"Å„",Ã’:"Å„","Â³":"Å‚","â‰¥":"Å‚","Â£":"Å",Ã›:"Ã³",Ã¼:"Åº",Å¸:"Åº"},spanish:{Ã¸:"Â¿",Ãˆ:"Ã©",ÃŒ:"Ã­",Ã’:"Ã±",Å„:"Ã±","Â·":"Ã¡",Ã›:"Ã³","Â°":"!","Ë™":"Ãº",Å›:"Ãº"}};function fa(e,a){const r=ma[a];if(r===void 0)return e;let n=e;for(const[s,i]of Object.entries(r))n=n.replaceAll(s,i);return n}function ga(e){const a=e.split(`
`),r=["#TITLE","#ARTIST","#BPM"];for(const n of r)if(!a.some(s=>s.startsWith(n)))return!1;if(!a.some(n=>n.startsWith(":")))return!1;try{Te(e)}catch(n){return console.log(n),!1}return!0}async function va(e){try{const a=new URL(e);if(a.host==="usdb.animux.de")return ya(e,a);if(a.host==="ultrastar-es.org")return ba(e)}catch(a){console.warn(a)}}async function ba(e){var u,d,f,o;const r=await(await fetch(`https://backend.allkaraoke.party/proxy?url=${encodeURIComponent(e)}`)).text(),n=new DOMParser().parseFromString(r,"text/html"),i=`https://ultrastar-es.org/pl/canciones/descargar/txt/${(u=n.querySelector("ul[data-id]"))==null?void 0:u.getAttribute("data-id")}`;global.location.href=i;const c=(d=n.querySelector("#listado > ul > li > dl > dd:nth-child(6) > a"))==null?void 0:d.getAttribute("href"),l=(f=n.querySelector("#listado > ul > li"))==null?void 0:f.getAttribute("data-id");return{authorUrl:c?"https://ultrastar-es.org"+c:"",author:((o=n.querySelector("#listado > ul > li > dl > dd:nth-child(6)"))==null?void 0:o.textContent)??"",video:l?"https://www.youtube.com/watch?v="+l:""}}async function ya(e,a){var d,f,o,m,k;const n=await(await fetch(`https://backend.allkaraoke.party/proxy?url=${encodeURIComponent(e)}`)).text(),s=new DOMParser().parseFromString(n,"text/html"),i=(d=s.querySelector('a[href^="?link=profil&id="]'))==null?void 0:d.textContent,c=(o=(f=s.querySelector('a[href^="?link=profil&id="]'))==null?void 0:f.getAttribute)==null?void 0:o.call(f,"href"),l=(m=s.querySelector("#tablebg > tbody > tr:nth-child(3) > td > table:nth-child(2) > tbody > tr.list_head > td:nth-child(1)"))==null?void 0:m.textContent,u=(k=s.querySelector("#tablebg > tbody > tr:nth-child(3) > td > table:nth-child(2) > tbody > tr.list_head > td:nth-child(2)"))==null?void 0:k.textContent;return global.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(l+" "+u)}`,"_blank"),global.open(`http://usdb.animux.de/index.php?link=gettxt&id=${a.searchParams.get("id")}`,"_blank"),{authorUrl:c?"http://usdb.animux.de/index.php"+c:"",author:i??"",video:""}}function ja(e){var i,c;const a=async l=>{if(e.onChange({...e.data,sourceUrl:l.target.value}),e.shouldAutoImport){const u=await va(l.target.value);u&&e.onAutoImport(u)}},r=l=>{e.onChange({...e.data,txtInput:fa(e.data.txtInput,l)})},s=!p.useMemo(()=>ga(e.data.txtInput),[e.data.txtInput])&&e.data.txtInput.length>0;return t.jsxs(I,{sx:{display:"flex",flexWrap:"wrap"},"data-test":"basic-data",children:[e.isTxtRequired&&t.jsxs("div",{children:[t.jsx("h4",{children:"Where to find songs?"}),t.jsxs("p",{children:["Any UltraStar compatible .txt file will do. You can find many already made songs on"," ",t.jsx("a",{href:"https://usdb.animux.de/",target:"_blank",rel:"noreferrer",children:"usdb.animux.de"})," or ",t.jsx("a",{href:"https://ultrastar-es.org/en",target:"_blank",rel:"noreferrer",children:"ultrastar-es.org"}),".",t.jsx("br",{}),t.jsx("br",{})]}),t.jsx("p",{children:"You don't need audio/video files, you'll be able to search for appropriate YouTube video and synchronise the lyrics to it in subsequent steps."})]}),t.jsx(R,{sx:{mt:2},value:e.data.sourceUrl,onChange:a,label:"Source URL (optional)",fullWidth:!0,size:"small","data-test":"source-url",helperText:"The link to the page from which the .TXT file was downloaded."}),e.isTxtRequired?t.jsxs(t.Fragment,{children:[t.jsx(R,{error:s,helperText:s?"This doesn't look like a valid UltraStar .TXT format":"",required:!0,sx:{mt:2},fullWidth:!0,size:"small",multiline:!0,label:"Song's UltraStar .TXT file contents",onChange:l=>e.onChange({...e.data,txtInput:l.target.value}),value:e.data.txtInput,maxRows:15,minRows:15,InputProps:{inputProps:{"data-test":"input-txt",sx:{fontFamily:"monospace"}}}}),t.jsxs(I,{sx:{display:"flex",gap:1,mt:1},children:[t.jsx(L,{onClick:()=>r("polish"),children:"Fix ðŸ‡µðŸ‡± Polish accents"}),t.jsx(L,{onClick:()=>r("spanish"),children:"Fix ðŸ‡ªðŸ‡¸ Spanish accents"})]})]}):t.jsx(I,{sx:{display:"flex",width:"100%",height:500,overflow:"auto"},children:(c=(i=e.finalSong)==null?void 0:i.tracks)==null?void 0:c.map((l,u)=>t.jsxs(I,{sx:{flex:1},children:[t.jsx("h4",{children:l.name??`Track #${u+1}`}),l.sections.filter(X).map(d=>t.jsx("p",{children:d.notes.map(f=>f.lyrics).join("")},d.start))]},u))})]})}const Ca=["children","className","disableTypography","inset","primary","primaryTypographyProps","secondary","secondaryTypographyProps"],Sa=e=>{const{classes:a,inset:r,primary:n,secondary:s,dense:i}=e;return W({root:["root",r&&"inset",i&&"dense",n&&s&&"multiline"],primary:["primary"],secondary:["secondary"]},it,a)},ka=U("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:r}=e;return[{[`& .${fe.primary}`]:a.primary},{[`& .${fe.secondary}`]:a.secondary},a.root,r.inset&&a.inset,r.primary&&r.secondary&&a.multiline,r.dense&&a.dense]}})(({ownerState:e})=>C({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4},e.primary&&e.secondary&&{marginTop:6,marginBottom:6},e.inset&&{paddingLeft:56})),La=p.forwardRef(function(a,r){const n=G({props:a,name:"MuiListItemText"}),{children:s,className:i,disableTypography:c=!1,inset:l=!1,primary:u,primaryTypographyProps:d,secondary:f,secondaryTypographyProps:o}=n,m=O(n,Ca),{dense:k}=p.useContext(de);let j=u??s,S=f;const g=C({},n,{disableTypography:c,inset:l,primary:!!j,secondary:!!S,dense:k}),w=Sa(g);return j!=null&&j.type!==A&&!c&&(j=t.jsx(A,C({variant:k?"body2":"body1",className:w.primary,component:d!=null&&d.variant?void 0:"span",display:"block"},d,{children:j}))),S!=null&&S.type!==A&&!c&&(S=t.jsx(A,C({variant:"body2",className:w.secondary,color:"text.secondary",display:"block"},o,{children:S}))),t.jsxs(ka,C({className:F(w.root,i),ownerState:g,ref:r},m,{children:[j,S]}))}),wa=La;function Ba(){const r=new Intl.DisplayNames(["en"],{type:"region"}),n={};for(let i=65;i<=90;++i)for(let c=65;c<=90;++c){let l=String.fromCharCode(i)+String.fromCharCode(c),u=r.of(l);u&&l!==u&&(n[u]=l)}return{...n,...{}}}const $a=Ba(),Me=e=>{const a=Math.floor(e/1e3/60),r=Math.floor(e/1e3)-a*60,n=Math.floor(e%1e3);return t.jsxs(re,{children:[String(a).padStart(2,"0"),":",String(r).padStart(2,"0"),".",String(n).padStart(3,"0")]})},Ia=e=>"playVideo"in e?{play:()=>e.playVideo(),pause:()=>e.pauseVideo(),seekTo:a=>e.seekTo(a,!0),setPlaybackSpeed:a=>e.setPlaybackRate(a)}:e,J=(e,a)=>t.jsx(Be,{title:"Click to play the moment just before this time",placement:"top",arrow:!0,children:t.jsx(L,{sx:{py:.15,mb:.5},variant:"contained",size:"small",disabled:!a,onClick:a?()=>{Re.resetPlayerNotes(),Ia(a).seekTo((e??0)/1e3-.7)}:void 0,children:Me(e??0)})}),Ta=Me,Ce=10;function Ra({data:e,onChange:a,videoId:r,videoGap:n=0}){var B;const s=p.useRef(null),i=p.useRef(null),[c,l]=p.useState(!1);p.useEffect(()=>{(async()=>{var y,x,v,h;e.volume===0?(a({...e,volume:.5}),await((x=(y=s.current)==null?void 0:y.getInternalPlayer())==null?void 0:x.setVolume(50))):await((h=(v=s.current)==null?void 0:v.getInternalPlayer())==null?void 0:h.setVolume(e.volume*100)),l(!0)})()},[]),p.useEffect(()=>{if(!c)return;const y=setInterval(async()=>{var v,h;const x=await((h=(v=s.current)==null?void 0:v.getInternalPlayer())==null?void 0:h.getVolume());x!==void 0&&x!==e.volume*100&&a({...e,volume:x/100})},500);return()=>{clearInterval(y)}},[c,e,a]);const[u,d]=p.useState(!1),[f,o]=p.useState(!1),m=async(y,x)=>{var v,h;await((h=(v=s.current)==null?void 0:v.getInternalPlayer())==null?void 0:h.setVolume(+x*100)),a({...e,volume:+x})},k=e.previewStart??n+60,j=e.previewEnd??k+30,[S,g]=p.useState(null);p.useEffect(()=>{var y,x;i.current&&(i.current.currentTime=35),(x=(y=s.current)==null?void 0:y.getInternalPlayer())==null||x.getDuration().then(g)},[]);const w=(B=s.current)==null?void 0:B.getInternalPlayer();return t.jsxs(I,{sx:{display:"flex",flexDirection:"column",width:"100%"},children:[t.jsxs("h3",{children:["Set song preview (start: ",J(k*1e3,w),", end:"," ",J(j*1e3,w),")"]}),t.jsx(I,{sx:{display:"flex",gap:5},children:t.jsx(ge,{"data-test":"song-preview",disabled:S===null,step:1,value:[k,j],max:(S??500)-Ce,onChange:(y,x)=>{const[v,h]=x;h-v>Ce&&a({...e,previewStart:v,previewEnd:h})}})}),t.jsx("h3",{children:"Adjust volume"}),t.jsxs(I,{sx:{display:"flex",gap:5},children:[t.jsxs(I,{children:[t.jsx("h4",{children:"Song"}),t.jsx(Ie,{videoId:r,ref:s,onPlay:()=>{var y;d(!0),f&&((y=i.current)==null||y.pause(),setTimeout(()=>o(!0),200))},onPause:()=>{o(!1)}})]}),t.jsxs(I,{children:[t.jsx("h4",{children:"Reference sound"}),t.jsx("p",{children:"Use the slider below to make the video volume roughly the same as this music."}),t.jsx("br",{}),t.jsx("audio",{ref:i,controls:!0,src:Ae,loop:!0,onLoad:y=>y.currentTarget.currentTime=35,onPlay:y=>{var x,v;y.currentTarget.volume=.5,o(!0),u&&((v=(x=s.current)==null?void 0:x.getInternalPlayer())==null||v.pauseVideo(),setTimeout(()=>d(!0),200))},onPause:()=>{var y,x;o(!1),u&&((x=(y=s.current)==null?void 0:y.getInternalPlayer())==null||x.playVideo())}})]})]}),t.jsxs("h4",{children:["Final Song Volume (",e.volume*100,")"]}),t.jsx(I,{children:t.jsx(ge,{"data-test":"volume",min:.1,max:1,step:.01,"aria-label":"Volume",value:e.volume,onChange:m})})]})}const Pa=e=>{const a=he(!0);return p.useMemo(()=>{var n,s;const r=a.data.filter(i=>i.artist===e).map(i=>i.artistOrigin).filter(Boolean).reduce((i,c)=>(i[c]?i[c]++:i[c]=1,i),{});return(s=(n=Object.entries(r).sort((i,c)=>c[1]-i[1]))==null?void 0:n[0])==null?void 0:s[0]},[e,a.data])};function Ma(e){var f;const a=he(!0),r=Pa(e.songArtist??"");p.useEffect(()=>{e.data.artistOrigin===void 0&&e.onChange({...e.data,artistOrigin:r})},[r,e.data]);const n=p.useMemo(()=>[...new Set(a.data.map(({language:o})=>Array.isArray(o)?o:[o]).flat().filter(Boolean))],[a.data]),s=$a,i=p.useMemo(()=>[...new Set(a.data.map(o=>o.genre).filter(Boolean).map(o=>o.toLowerCase().replace(/\b\w/g,m=>m.toUpperCase().trim())))],[a.data]),c=p.useMemo(()=>[...new Set(a.data.map(o=>o.edition).filter(Boolean).map(o=>o.toLowerCase().replace(/\b\w/g,m=>m.toUpperCase().trim())))].sort(),[a.data]),l=o=>{global.open(`https://www.google.com/search?q=${encodeURIComponent(`${e.songArtist} ${e.songTitle} ${o}`)}`,"_blank")},u=!!e.songTitle&&!!e.songArtist,d=+(((f=e.data)==null?void 0:f.realBpm)??0)>200;return t.jsxs(T,{container:!0,spacing:2,"data-test":"song-metadata",sx:{mt:6},children:[t.jsx(T,{item:!0,xs:6,children:t.jsx(R,{value:e.data.artist,onChange:o=>e.onChange({...e.data,artist:o.target.value}),label:"Song artist",size:"small","data-test":"song-artist",required:!0,fullWidth:!0})}),t.jsx(T,{item:!0,xs:6,children:t.jsx(R,{value:e.data.title,onChange:o=>e.onChange({...e.data,title:o.target.value}),label:"Song title",fullWidth:!0,size:"small",required:!0,"data-test":"song-title"})}),t.jsx(T,{item:!0,xs:3,children:t.jsx(oe,{onKeyDown:o=>{o.key==="Enter"&&o.preventDefault()},freeSolo:!0,disableClearable:!0,options:i,value:e.data.genre??"",onChange:(o,m)=>e.onChange({...e.data,genre:m}),renderInput:o=>t.jsx(R,{...o,onBlur:m=>e.onChange({...e.data,genre:m.target.value}),label:"Song genre (optional)",size:"small","data-test":"song-genre",fullWidth:!0})})}),t.jsx(T,{item:!0,xs:3,children:t.jsx(oe,{onKeyDown:o=>{o.key==="Enter"&&o.preventDefault()},freeSolo:!0,disableClearable:!0,options:c,value:e.data.edition??"",onChange:(o,m)=>e.onChange({...e.data,edition:m}),renderInput:o=>t.jsx(R,{...o,onBlur:m=>e.onChange({...e.data,edition:m.target.value}),label:"Song edition (optional)",size:"small","data-test":"song-edition",helperText:"Songs with the same theme, e.g. 'Christmas'",fullWidth:!0})})}),t.jsx(T,{item:!0,xs:3,children:t.jsx(oe,{onKeyDown:o=>{o.key==="Enter"&&o.preventDefault()},multiple:!0,freeSolo:!0,disableClearable:!0,options:n,value:typeof e.data.language=="string"?[e.data.language]:e.data.language,onChange:(o,m)=>{e.onChange({...e.data,language:m?m.filter(Boolean):e.data.language})},renderInput:o=>{var m;return t.jsx(R,{...o,label:"Song language",fullWidth:!0,size:"small",required:!((m=e.data.language)!=null&&m.length),"data-test":"song-language"})}})}),t.jsx(T,{item:!0,xs:3,children:t.jsxs(lt,{fullWidth:!0,children:[t.jsx(ct,{id:"song-origin-select-label",size:"small",children:"Song/artist origin (optional)"}),t.jsxs(dt,{"data-test":"artist-origin",size:"small",labelId:"song-origin-select-label",id:"song-origin-select",value:e.data.artistOrigin??"",label:"Song/artist origin (optional)",onChange:o=>e.onChange({...e.data,artistOrigin:o.target.value}),children:[t.jsx(ve,{value:"",children:"None"},"none"),Object.entries(s).map(([o,m])=>t.jsxs(ve,{value:m,children:[t.jsx(Ea,{isocode:m})," ",o]},m))]}),t.jsx(ut,{children:"Used to show the flag on the list"})]})}),t.jsx(T,{item:!0,xs:6,children:t.jsx(R,{"data-test":"release-year",value:e.data.year,onChange:o=>e.onChange({...e.data,year:o.target.value}),label:"Release year",helperText:"The year the song was released. Click the 'Lookup' button to look for it on Google",fullWidth:!0,size:"small",required:!0,...ue(()=>l("release year"),u)})}),t.jsx(T,{item:!0,xs:6,children:t.jsx(R,{"data-test":"song-bpm",value:e.data.realBpm,onChange:o=>e.onChange({...e.data,realBpm:o.target.value}),label:"Song (real) BPM",focused:d?!0:void 0,helperText:d?t.jsxs(t.Fragment,{children:["Usually songs don't have higher BPM than ",t.jsx("b",{children:"200"}),". Make sure the value is correct"]}):"The actual tempo of the song. Click the 'Lookup' button to look for it on Google",color:d?"warning":void 0,fullWidth:!0,type:"number",size:"small",required:!0,...ue(()=>l("tempo"),u)})}),t.jsx(T,{item:!0,xs:12}),t.jsx(T,{item:!0,xs:12,children:t.jsx(Ra,{...e})})]})}const Ea=z(Fe,{target:"e70j9sv0"})({name:"1jigaf4",styles:"width:1em;margin-right:0.5em"});var Ua=1,Na=4;function za(e){return Ve(e,Ua|Na)}function Aa(e){return Y("MuiButtonGroup",e)}const P=H("MuiButtonGroup",["root","contained","outlined","text","disableElevation","disabled","firstButton","fullWidth","vertical","grouped","groupedHorizontal","groupedVertical","groupedText","groupedTextHorizontal","groupedTextVertical","groupedTextPrimary","groupedTextSecondary","groupedOutlined","groupedOutlinedHorizontal","groupedOutlinedVertical","groupedOutlinedPrimary","groupedOutlinedSecondary","groupedContained","groupedContainedHorizontal","groupedContainedVertical","groupedContainedPrimary","groupedContainedSecondary","lastButton","middleButton"]),Fa=["children","className","color","component","disabled","disableElevation","disableFocusRipple","disableRipple","fullWidth","orientation","size","variant"],Va=(e,a)=>{const{ownerState:r}=e;return[{[`& .${P.grouped}`]:a.grouped},{[`& .${P.grouped}`]:a[`grouped${E(r.orientation)}`]},{[`& .${P.grouped}`]:a[`grouped${E(r.variant)}`]},{[`& .${P.grouped}`]:a[`grouped${E(r.variant)}${E(r.orientation)}`]},{[`& .${P.grouped}`]:a[`grouped${E(r.variant)}${E(r.color)}`]},{[`& .${P.firstButton}`]:a.firstButton},{[`& .${P.lastButton}`]:a.lastButton},{[`& .${P.middleButton}`]:a.middleButton},a.root,a[r.variant],r.disableElevation===!0&&a.disableElevation,r.fullWidth&&a.fullWidth,r.orientation==="vertical"&&a.vertical]},Ga=e=>{const{classes:a,color:r,disabled:n,disableElevation:s,fullWidth:i,orientation:c,variant:l}=e,u={root:["root",l,c==="vertical"&&"vertical",i&&"fullWidth",s&&"disableElevation"],grouped:["grouped",`grouped${E(c)}`,`grouped${E(l)}`,`grouped${E(l)}${E(c)}`,`grouped${E(l)}${E(r)}`,n&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return W(u,Aa,a)},Oa=U("div",{name:"MuiButtonGroup",slot:"Root",overridesResolver:Va})(({theme:e,ownerState:a})=>C({display:"inline-flex",borderRadius:(e.vars||e).shape.borderRadius},a.variant==="contained"&&{boxShadow:(e.vars||e).shadows[2]},a.disableElevation&&{boxShadow:"none"},a.fullWidth&&{width:"100%"},a.orientation==="vertical"&&{flexDirection:"column"},{[`& .${P.grouped}`]:C({minWidth:40,"&:hover":C({},a.variant==="contained"&&{boxShadow:"none"})},a.variant==="contained"&&{boxShadow:"none"}),[`& .${P.firstButton},& .${P.middleButton}`]:C({},a.orientation==="horizontal"&&{borderTopRightRadius:0,borderBottomRightRadius:0},a.orientation==="vertical"&&{borderBottomRightRadius:0,borderBottomLeftRadius:0},a.variant==="text"&&a.orientation==="horizontal"&&{borderRight:e.vars?`1px solid rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${e.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${P.disabled}`]:{borderRight:`1px solid ${(e.vars||e).palette.action.disabled}`}},a.variant==="text"&&a.orientation==="vertical"&&{borderBottom:e.vars?`1px solid rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${e.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${P.disabled}`]:{borderBottom:`1px solid ${(e.vars||e).palette.action.disabled}`}},a.variant==="text"&&a.color!=="inherit"&&{borderColor:e.vars?`rgba(${e.vars.palette[a.color].mainChannel} / 0.5)`:Z(e.palette[a.color].main,.5)},a.variant==="outlined"&&a.orientation==="horizontal"&&{borderRightColor:"transparent"},a.variant==="outlined"&&a.orientation==="vertical"&&{borderBottomColor:"transparent"},a.variant==="contained"&&a.orientation==="horizontal"&&{borderRight:`1px solid ${(e.vars||e).palette.grey[400]}`,[`&.${P.disabled}`]:{borderRight:`1px solid ${(e.vars||e).palette.action.disabled}`}},a.variant==="contained"&&a.orientation==="vertical"&&{borderBottom:`1px solid ${(e.vars||e).palette.grey[400]}`,[`&.${P.disabled}`]:{borderBottom:`1px solid ${(e.vars||e).palette.action.disabled}`}},a.variant==="contained"&&a.color!=="inherit"&&{borderColor:(e.vars||e).palette[a.color].dark},{"&:hover":C({},a.variant==="outlined"&&a.orientation==="horizontal"&&{borderRightColor:"currentColor"},a.variant==="outlined"&&a.orientation==="vertical"&&{borderBottomColor:"currentColor"})}),[`& .${P.lastButton},& .${P.middleButton}`]:C({},a.orientation==="horizontal"&&{borderTopLeftRadius:0,borderBottomLeftRadius:0},a.orientation==="vertical"&&{borderTopRightRadius:0,borderTopLeftRadius:0},a.variant==="outlined"&&a.orientation==="horizontal"&&{marginLeft:-1},a.variant==="outlined"&&a.orientation==="vertical"&&{marginTop:-1})})),Wa=p.forwardRef(function(a,r){const n=G({props:a,name:"MuiButtonGroup"}),{children:s,className:i,color:c="primary",component:l="div",disabled:u=!1,disableElevation:d=!1,disableFocusRipple:f=!1,disableRipple:o=!1,fullWidth:m=!1,orientation:k="horizontal",size:j="medium",variant:S="outlined"}=n,g=O(n,Fa),w=C({},n,{color:c,component:l,disabled:u,disableElevation:d,disableFocusRipple:f,disableRipple:o,fullWidth:m,orientation:k,size:j,variant:S}),B=Ga(w),y=p.useMemo(()=>({className:B.grouped,color:c,disabled:u,disableElevation:d,disableFocusRipple:f,disableRipple:o,fullWidth:m,size:j,variant:S}),[c,u,d,f,o,m,j,S,B.grouped]),x=jt(s),v=x.length,h=$=>{const M=$===0,b=$===v-1;return M&&b?"":M?B.firstButton:b?B.lastButton:B.middleButton};return t.jsx(Oa,C({as:l,role:"group",className:F(B.root,i),ref:r,ownerState:w},g,{children:t.jsx(pt.Provider,{value:y,children:x.map(($,M)=>t.jsx(ht.Provider,{value:h(M),children:$},M))})}))}),q=Wa;function Da({player:e,currentTime:a,effectsEnabled:r,onEffectsToggle:n}){const s=l=>e.seekTo((a+l)/1e3),[i,c]=p.useState(1);return t.jsxs(t.Fragment,{children:[t.jsxs(I,{sx:{mb:2},children:[t.jsxs(A,{variant:"h6","data-test":"current-time",children:["Current time: ",Ta(a)," (",t.jsx(re,{children:Math.round(a)})," ms)"]}),t.jsxs(I,{sx:{display:"flex",gap:1},children:[t.jsxs(q,{variant:"contained",sx:{display:"flex",mt:1,flex:1},children:[t.jsx(L,{sx:{flex:1,px:1},onClick:()=>s(-1e4),"data-test":"seek-10s",children:"-10"}),t.jsx(L,{sx:{flex:1,px:1},onClick:()=>s(-5e3),"data-test":"seek-5s",children:"-5"}),t.jsx(L,{sx:{flex:1,px:1},onClick:()=>s(-1e3),"data-test":"seek-1s",children:"-1"}),t.jsx(L,{sx:{flex:1,px:1},onClick:()=>s(-500),"data-test":"seek-0.5s",children:"-0.5"})]}),t.jsx(xt,{}),t.jsxs(q,{variant:"contained",sx:{display:"flex",mt:1,flex:1},children:[t.jsx(L,{sx:{flex:1,px:1},onClick:()=>s(500),"data-test":"seek+0.5s",children:"+0.5"}),t.jsx(L,{sx:{flex:1,px:1},onClick:()=>s(1e3),"data-test":"seek+1s",children:"+1"}),t.jsx(L,{sx:{flex:1,px:1},onClick:()=>s(5e3),"data-test":"seek+5s",children:"+5"}),t.jsx(L,{sx:{flex:1,px:1},onClick:()=>s(1e4),"data-test":"seek+10s",children:"+10"})]})]})]}),t.jsxs(I,{sx:{mb:2},children:[t.jsxs(A,{variant:"h6",children:["Playback speed: ",t.jsxs(re,{"data-test":"current-speed",children:[i*100,"%"]})]}),t.jsx(q,{variant:"contained",sx:{display:"flex",mt:1},children:[.25,.5,.75,1,1.25,1.5,2].map(l=>t.jsxs(L,{"data-test":`speed-${l}`,sx:{flex:1},onClick:()=>{c(l),e.setPlaybackSpeed(l)},disabled:i===l,children:[l*100,"%"]},l))})]})]})}const _a=["alignItems","autoFocus","component","children","dense","disableGutters","divider","focusVisibleClassName","selected","className"],qa=(e,a)=>{const{ownerState:r}=e;return[a.root,r.dense&&a.dense,r.alignItems==="flex-start"&&a.alignItemsFlexStart,r.divider&&a.divider,!r.disableGutters&&a.gutters]},Ya=e=>{const{alignItems:a,classes:r,dense:n,disabled:s,disableGutters:i,divider:c,selected:l}=e,d=W({root:["root",n&&"dense",!i&&"gutters",c&&"divider",s&&"disabled",a==="flex-start"&&"alignItemsFlexStart",l&&"selected"]},mt,r);return C({},r,d)},Ha=U(we,{shouldForwardProp:e=>Ge(e)||e==="classes",name:"MuiListItemButton",slot:"Root",overridesResolver:qa})(({theme:e,ownerState:a})=>C({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${Q.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:Z(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${Q.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:Z(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}},[`&.${Q.selected}:hover`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:Z(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:Z(e.palette.primary.main,e.palette.action.selectedOpacity)}},[`&.${Q.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${Q.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity}},a.divider&&{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:"padding-box"},a.alignItems==="flex-start"&&{alignItems:"flex-start"},!a.disableGutters&&{paddingLeft:16,paddingRight:16},a.dense&&{paddingTop:4,paddingBottom:4})),Ka=p.forwardRef(function(a,r){const n=G({props:a,name:"MuiListItemButton"}),{alignItems:s="center",autoFocus:i=!1,component:c="div",children:l,dense:u=!1,disableGutters:d=!1,divider:f=!1,focusVisibleClassName:o,selected:m=!1,className:k}=n,j=O(n,_a),S=p.useContext(de),g=p.useMemo(()=>({dense:u||S.dense||!1,alignItems:s,disableGutters:d}),[s,S.dense,u,d]),w=p.useRef(null);Oe(()=>{i&&w.current&&w.current.focus()},[i]);const B=C({},n,{alignItems:s,dense:g.dense,disableGutters:d,divider:f,selected:m}),y=Ya(B),x=We(w,r);return t.jsx(de.Provider,{value:g,children:t.jsx(Ha,C({ref:x,href:j.href||j.to,component:(j.href||j.to)&&c==="div"?"button":c,focusVisibleClassName:F(y.focusVisible,o),ownerState:B,className:F(y.root,k)},j,{classes:y,children:l}))})}),Xa=Ka;function Qa(e,a){const r=Math.floor(a);return p.useMemo(()=>e.findIndex((n,s)=>r<0?!0:r<n.start?!1:s===e.length-1||e[s+1].start>r),[r,e])}function Za({song:e,currentTime:a,beatLength:r,player:n,onRecordChange:s,onLyricChange:i,onTrackNameChange:c}){var y;const[l,u]=p.useState(0),[d,f]=p.useState(-1),[o,m]=p.useState([]),k=De(a,r,e.gap),j=e.tracks[l].sections.filter(X),S=Qa(j,k),g=x=>{f(x),Re.resetPlayerNotes(),n.seekTo((j[x].start*r+e.gap)/1e3)},w=()=>{m(x=>[...x,{type:"delete",section:d,track:l}]),d===j.length-1&&f(x=>x-1)},B=x=>{m(v=>{const h=v.at(-1);if(h&&h.type==="shift"&&h.track===l&&h.section===d){const $=[...v];return $.at(-1).shift=x,$}return[...v,{type:"shift",section:d,track:l,shift:x}]})};return p.useEffect(()=>{s(o)},[s,o]),t.jsxs(tr,{children:[t.jsxs(be,{direction:"row",children:[t.jsxs(A,{variant:"h6",mb:0,sx:{flex:1,display:"flex",alignItems:"center"},children:["Edit verses",e.tracks.length>1&&t.jsx(q,{variant:"contained",sx:{ml:2},size:"small",children:e.tracks.map((x,v)=>t.jsxs(L,{onClick:()=>u(v),disabled:l===v,"data-test":`track-${v+1}`,children:["Track ",v+1]},v))})]}),t.jsx(R,{label:"Track name",placeholder:"Set track name",sx:{flex:1},size:"small",value:((y=e.tracks[l])==null?void 0:y.name)??"",onChange:x=>c(l,x.target.value),"data-test":"track-name"})]}),t.jsxs(be,{direction:"row",spacing:2,sx:{height:"400px",mt:3},children:[t.jsx(ft,{sx:{overflowY:"auto"},children:j.map((x,v)=>t.jsx(gt,{disablePadding:!0,"data-test":`section-${v}`,sx:{maxWidth:250,overflowX:"hidden",textWrap:"ellipsis",whiteSpace:"nowrap"},children:t.jsx(Xa,{onClick:()=>g(v),selected:d===v,children:t.jsx(wa,{primaryTypographyProps:{fontWeight:v===S?"bold":"normal"},primary:X(x)?x.notes.map(h=>h.lyrics).join(""):"[pause]"})})},x.start))}),t.jsx(ar,{children:d>-1&&t.jsxs(t.Fragment,{children:[d===0&&t.jsx("h3",{"data-test":"use-gap-info",children:"Use gap shift to change when this section starts"}),d>0&&t.jsx(t.Fragment,{children:t.jsx(R,{"data-test":"change-start-beat",size:"small",type:"number",onChange:x=>B(+x.target.value),value:ce([j[d]]),label:"Change start beat",InputProps:{inputProps:{step:1}},fullWidth:!0,sx:{mb:2},helperText:t.jsxs(t.Fragment,{children:["Timestamp:"," ",J(ce([j[d]])*r+e.gap,n)]})})}),t.jsx(rr,{children:j[d].notes.map((x,v)=>t.jsx(nr,{style:{width:`${x.lyrics.length}ch`},value:x.lyrics,"data-test":`lyric-input-${v}`,onChange:h=>i({section:d,track:l,noteIndex:v,newLyric:h.target.value})},v))}),t.jsx(L,{variant:"contained",color:"error",onClick:w,fullWidth:!0,"data-test":"delete-section",children:"Delete section"})]})}),t.jsxs(Ja,{children:[t.jsx(I,{sx:{overflowY:"auto",maxHeight:"34rem"},"data-test":"change-list",children:o.map((x,v)=>{let h="",$=Se;return x.type==="delete"?($=Se,h="Deleted"):x.type==="shift"&&($=er,h=`Start -> ${x.shift}`),t.jsx($,{children:t.jsxs("strong",{children:["Track: ",x.track+1,", Section: ",x.section+1,", ",h]})},v)})}),o.length>0&&t.jsx(L,{"data-test":"undo-change",variant:"contained",color:"warning",onClick:()=>m(x=>x.filter((v,h)=>h!==x.length-1)),fullWidth:!0,children:"Undo last change"})]})]})]})}const Ja=z("div",{target:"e18sxv6t7"})({name:"82a6rk",styles:"flex:1"}),Ee=z("div",{target:"e18sxv6t6"})({name:"m1a2da",styles:"padding:0.5rem"}),Se=z(Ee,{target:"e18sxv6t5"})({name:"hwfcu5",styles:"color:red"}),er=z(Ee,{target:"e18sxv6t4"})({name:"zzs6wi",styles:"color:#0059ff"}),tr=z("div",{target:"e18sxv6t3"})(""),ar=z("div",{target:"e18sxv6t2"})({name:"82a6rk",styles:"flex:1"}),rr=z("div",{target:"e18sxv6t1"})({name:"19876q9",styles:"display:flex;gap:0.25rem;margin-bottom:1rem;align-items:center;flex-wrap:wrap"}),nr=z("input",{target:"e18sxv6t0"})({name:"qwuk9c",styles:"font-family:monospace;background:#f6f6f6;border-radius:0.25rem;width:3rem;padding:0.25rem 0.15rem;border:0.25rem solid #ededed"});function sr({song:e,player:a,beatLength:r}){return t.jsx(t.Fragment,{})}function or(e,a){var c;const n=(c=a.tracks[0].sections.filter(X).at(-1))==null?void 0:c.notes.at(-1),s=e-a.gap,i=n.start+n.length;return Number((6e4/(s/i*a.bar)).toFixed(2))}function ir({current:e,onChange:a,player:r,song:n}){const s=Math.max(...n.tracks.map(u=>_e(u.sections))),i=qe(s,n)+n.gap,[c,l]=p.useState(Math.round(i));return t.jsxs(I,{sx:{display:"flex",gap:2,mb:2},children:[t.jsx(R,{"data-test":"desired-end",size:"small",type:"number",value:c,onChange:u=>l(+u.target.value),label:"Desired last note end time (in milliseconds)",sx:{flex:1},helperText:c?t.jsxs(t.Fragment,{children:["Estimated proper Tempo (BPM) of the lyrics:"," ",t.jsx(re,{"data-test":"desired-bpm",children:or(c,n)})]}):" "}),t.jsx(R,{"data-test":"change-bpm",size:"small",type:"number",value:e,onChange:u=>a(+u.target.value),label:"Tempo (BPM) of the lyrics",sx:{flex:.5},helperText:" ",InputProps:{inputProps:{step:"0.1"}}})]})}function lr({current:e,onChange:a,player:r,finalGap:n}){return t.jsxs(I,{sx:{flex:1},children:[t.jsxs(A,{variant:"h6",children:["Lyrics Gap shift (final: ",J(n,r),")"]}),t.jsxs(I,{sx:{display:"flex",gap:1,mt:1},children:[t.jsxs(q,{sx:{flex:1},children:[t.jsx(L,{sx:{flex:1,px:1},onClick:()=>a(e-1e3),"data-test":"shift-gap-1s",children:"-1000"}),t.jsx(L,{sx:{flex:1,px:1},onClick:()=>a(e-500),"data-test":"shift-gap-0.5s",children:"-500"}),t.jsx(L,{sx:{flex:1,px:1},onClick:()=>a(e-50),"data-test":"shift-gap-0.05s",children:"-50"})]}),t.jsx(R,{sx:{py:0,flex:1},size:"small",type:"text",value:e,onChange:s=>a(+s.target.value),label:"Miliseconds","data-test":"shift-gap"}),t.jsxs(q,{sx:{flex:1},children:[t.jsx(L,{sx:{flex:1,px:1},onClick:()=>a(e+50),"data-test":"shift-gap+0.05s",children:"+50"}),t.jsx(L,{sx:{flex:1,px:1},onClick:()=>a(e+500),"data-test":"shift-gap+0.5s",children:"+500"}),t.jsx(L,{sx:{flex:1,px:1},onClick:()=>a(e+1e3),"data-test":"shift-gap+1s",children:"+1000"})]})]})]})}function cr({current:e,onChange:a,player:r,finalGap:n}){return t.jsxs(I,{sx:{flex:1},children:[t.jsxs(A,{variant:"h6",children:["Video Gap shift (final: ",J((n??0)*1e3,r),")"]}),t.jsxs(I,{sx:{display:"flex",gap:1,mt:1},children:[t.jsxs(q,{sx:{flex:1},children:[t.jsx(L,{sx:{flex:1,px:1.25},onClick:()=>a(e-10),"data-test":"shift-video-gap-10s",children:"-10"}),t.jsx(L,{sx:{flex:1,px:1.25},onClick:()=>a(e-5),"data-test":"shift-video-gap-5s",children:"-5"}),t.jsx(L,{sx:{flex:1,px:1.25},onClick:()=>a(e-1),"data-test":"shift-video-gap-1s",children:"-1"})]}),t.jsx(R,{"data-test":"shift-video-gap",sx:{py:0,flex:1},size:"small",type:"text",value:e,onChange:s=>a(+s.target.value),label:"Seconds"}),t.jsxs(q,{sx:{flex:1},children:[t.jsx(L,{sx:{flex:1,px:1.25},onClick:()=>a(e+1),"data-test":"shift-video-gap+1s",children:"+1"}),t.jsx(L,{sx:{flex:1,px:1.25},onClick:()=>a(e+5),"data-test":"shift-video-gap+5s",children:"+5"}),t.jsx(L,{sx:{flex:1,px:1.25},onClick:()=>a(e+10),"data-test":"shift-video-gap+10s",children:"+10"})]})]})]})}const dr=(e,a)=>({...e,gap:e.gap+a}),ur=(e,a)=>({...e,videoGap:(e.videoGap??0)+a}),pr=(e,a)=>({...e,bpm:a}),hr=(e,a)=>({...e,tracks:e.tracks.map((r,n)=>{const s=a.filter(c=>c.track===n);let i=[...r.sections].filter(X);return s.forEach(c=>{if(c.type==="delete")i=i.filter((l,u)=>u!==c.section);else if(c.type==="shift"){const l=c.shift-ce([i[c.section]]);i=i.map((u,d)=>d<c.section?u:{...u,notes:u.notes.map(f=>({...f,start:f.start+l}))})}}),{...r,sections:i}})}),xr=(e,a)=>({...e,tracks:e.tracks.map((r,n)=>({...r,name:a[n]??r.name}))}),mr=(e,a)=>({...e,tracks:e.tracks.map((r,n)=>{const s=a[n]??{};return{...r,sections:r.sections.map((i,c)=>{const l=s[c]??{};return X(i)?{...i,notes:i.notes.map((u,d)=>({...u,lyrics:l[d]??u.lyrics}))}:i})}})}),pe=800,ke=pe/16*9;function fr({song:e,onUpdate:a,visible:r}){const n=p.useRef(null),[s,i]=p.useState(0),[c,l]=p.useState(0),[u,d]=p.useState(0),[f,o]=p.useState(e.bpm),[m,k]=p.useState(0),[j,S]=p.useState([]),[g,w]=p.useState(!1),[B,y]=p.useState(e.tracks.map(b=>b.name??void 0)),[x,v]=p.useState({}),h=p.useMemo(()=>{let b=za(e);return b=Ye(b),b=He(b),b=me(b),b=dr(b,c),b=ur(b,u),b=pr(b,f),b=hr(b,j),b=xr(b,B),b=mr(b,x),b=me(b),b=Ke(b),b},[c,u,e,f,j,B,x]);p.useEffect(()=>{a==null||a(h)},[a,h]);const $=p.useMemo(()=>({id:"test",mode:Xe.DUEL,players:[{number:0,track:0},{number:1,track:e.tracks.length-1}],tolerance:6}),[e]);let M;return M=Qe(h),p.useEffect(()=>{var b;r||(b=n.current)==null||b.pause()},[r]),t.jsxs(T,{container:!0,spacing:2,sx:{display:r?void 0:"none"},children:[t.jsx(T,{item:!0,xs:8,"data-test":"player-container",children:t.jsx(I,{sx:{width:pe,height:ke},children:t.jsx(Ze,{song:h,showControls:!0,autoplay:!1,width:pe,height:ke,ref:n,onCurrentTimeUpdate:i,players:$.players,effectsEnabled:g,singSetup:$,onSongEnd:()=>{}},m)})}),t.jsxs(T,{item:!0,xs:4,children:[t.jsx(A,{variant:"h5",mb:2,children:"Playback controls"}),n.current&&t.jsx(Da,{player:n.current,currentTime:s,effectsEnabled:g,onEffectsToggle:()=>w(b=>!b)}),!n.current&&t.jsx("h2",{children:"Start the song to see the manipulation form"})]}),n.current&&t.jsxs(t.Fragment,{children:[t.jsx(T,{item:!0,xs:8,children:t.jsxs(I,{sx:{display:"flex",gap:5,flex:1},children:[t.jsx(cr,{player:n.current,onChange:b=>{const D=b-u;d(b),l(K=>K+D*1e3)},current:u,finalGap:h.videoGap}),t.jsx(lr,{player:n.current,onChange:l,current:c,finalGap:h.gap})]})}),t.jsxs(T,{item:!0,xs:4,children:[t.jsxs(V,{children:["Use ",t.jsx("strong",{children:"Video shift gap"})," to crop the beginning of the video if it starts with an intro."]}),t.jsxs(V,{children:["Use ",t.jsx("strong",{children:"Lyrics shift gap"})," to sync the start of the lyrics to the video. You can lower the"," ",t.jsx("strong",{children:"Playback speed"})," above to make sure you got it just right."]})]}),t.jsxs(T,{item:!0,xs:8,children:[t.jsx(A,{variant:"h5",mb:2,children:"Advanced"}),t.jsx(ir,{player:n.current,onChange:o,current:f,song:h},h.gap),t.jsx(sr,{player:n.current,song:h,beatLength:M})]}),t.jsxs(T,{item:!0,xs:4,children:[t.jsx(V,{children:"If the lyrics desynchronise over time, probably the tempo (BPM) of the lyrics is wrong."}),t.jsxs(V,{children:["You can either use ",t.jsx("strong",{children:"Last note end time"})," - enter the millisecond when the last note should end (seek through the video for the moment as ",t.jsx("strong",{children:"Current time"})," panel show the exact millisecond) and a suggested BPM value will appear below."]}),t.jsxs(V,{children:[t.jsx("strong",{children:"Tempo (BPM)"})," field allows to fine-tune the tempo."]})]}),t.jsx(T,{item:!0,xs:8,children:t.jsx(Za,{song:h,currentTime:s,beatLength:M,player:n.current,onRecordChange:S,onTrackNameChange:(b,D)=>y(K=>{const xe=[...K];return xe[b]=D===""?void 0:D,xe}),onLyricChange:b=>v(D=>{var K;return{...D,[b.track]:{...D[b.track],[b.section]:{...(K=D[b.track])==null?void 0:K[b.section],[b.noteIndex]:b.newLyric}}}})})}),t.jsxs(T,{item:!0,xs:4,children:[t.jsxs(V,{children:["If the lyrics there are more lyrics than in the video or there are longer/shorter interludes between verses, you can ",t.jsx("strong",{children:"Edit verses"}),"."]}),t.jsx(V,{children:"Select a verse by clicking on it."}),t.jsxs(V,{children:["You can either ",t.jsx("strong",{children:"Change its start beat"}),' (which will "move in time" the verse and all subsequent ones) or ',t.jsx("strong",{children:"Delete it"})," (it won't affect the timing of other verses). You can also edit the lyrics of each note."]}),t.jsxs(V,{children:[t.jsx("strong",{children:"List of changes"})," on the right allows you to see and undo the actions one by one."]})]})]})]})}const V=z("p",{target:"e2gsf9o0"})({name:"1tcko1c",styles:"font-size:0.85rem;margin-bottom:1rem;line-height:1.25rem;strong{font-weight:bold;}"});function gr(e){var a,r,n;return t.jsx(I,{"data-test":"sync-lyrics",children:e.data&&e.data.video.length<15&&!!((n=(r=(a=e.data.tracks)==null?void 0:a[0])==null?void 0:r.sections)!=null&&n.length)&&t.jsx(fr,{song:e.data,onUpdate:e.onChange,visible:e.visible})})}function vr(e){return Array.isArray(e)?e.length===0:!e}const N=["basic-data","author-and-video","sync","metadata"];function Cr({song:e}){const a=!!e,{data:r}=he(!0);Je(!1);const n=et();tt(!1);const s=at("step"),[i,c]=p.useState(Math.max(0,N.indexOf(s)));p.useEffect(()=>{N[i]&&ha({step:N[i]})},[i]);const[l,u]=p.useState({sourceUrl:(e==null?void 0:e.sourceUrl)??"",txtInput:""}),[d,f]=p.useState({author:(e==null?void 0:e.author)??"",authorUrl:(e==null?void 0:e.authorUrl)??"",video:e!=null&&e.video?`https://www.youtube.com/watch?v=${e.video}`:""}),[o,m]=p.useState({artist:(e==null?void 0:e.artist)??"",title:(e==null?void 0:e.title)??"",realBpm:e!=null&&e.realBpm?String(e.realBpm):"",year:(e==null?void 0:e.year)??"",language:(e==null?void 0:e.language)??[],volume:(e==null?void 0:e.volume)??0,previewStart:(e==null?void 0:e.previewStart)??void 0,previewEnd:(e==null?void 0:e.previewEnd)??void 0,genre:e==null?void 0:e.genre,edition:e==null?void 0:e.edition,artistOrigin:e==null?void 0:e.artistOrigin}),[k,j]=p.useState(e),S=p.useRef(""),g=p.useMemo(()=>{try{return a?{...e,video:$e(d.video)||e.video,author:d.author,authorUrl:d.authorUrl,sourceUrl:l.sourceUrl}:l.txtInput?Te(l.txtInput,d.video,d.author,d.authorUrl,l.sourceUrl):void 0}catch(h){S.current=h.message,console.error(h)}},[l.txtInput,d.video,d.author,d.authorUrl,l.sourceUrl,e,a]),w=p.useMemo(()=>!a&&g&&(r==null?void 0:r.find(h=>se.generateSongFile(h)===se.generateSongFile(g))),[r,g,a]);p.useEffect(()=>{g&&(g.video&&!d.video&&f(h=>({...h,video:`https://www.youtube.com/watch?v=${g.video}`})),g.author&&!d.author&&f(h=>({...h,author:h.author||(g==null?void 0:g.author)||"",authorUrl:h.authorUrl||(g==null?void 0:g.authorUrl)||""})),g.sourceUrl&&!l.sourceUrl&&u(h=>({...h,sourceUrl:g.sourceUrl})),["year","language","realBpm","genre","artist","title","volume","previewStart","previewEnd","artistOrigin"].forEach(h=>{g[h]&&vr(o[h])&&m($=>({...$,[h]:g[h]}))}))},[g,o.year,o.language,o.realBpm,o.genre,o.artist,o.volume,o.title,o.previewStart,o.previewEnd,l.sourceUrl,d.video]);const B=!!l.txtInput||a,y=!!d.video,x=N[i]==="author-and-video"?y:!0,v={...k,...o,author:d.author,authorUrl:d.authorUrl,realBpm:+o.realBpm,sourceUrl:l.sourceUrl,id:rt(o)};return t.jsxs(nt,{injectFirst:!0,children:[t.jsx(st,{}),t.jsxs(br,{children:[!a&&t.jsx("div",{style:{marginBottom:"1rem"},children:t.jsx(ot,{to:"menu/",children:t.jsx("a",{children:"Return to the main menu"})})}),t.jsxs(pa,{activeStep:i,sx:{mb:2},nonLinear:a,children:[t.jsx(te,{completed:B,children:t.jsx(ae,{color:"inherit",onClick:()=>c(0),children:"Basic Info"})},0),t.jsx(te,{completed:y,children:t.jsx(ae,{color:"inherit",onClick:()=>c(1),children:"Author and video data"})},1),t.jsx(te,{children:t.jsx(ae,{color:"inherit",onClick:()=>c(2),children:"Sync lyrics to video"})},2),t.jsx(te,{children:t.jsx(ae,{color:"inherit",onClick:()=>c(3),children:"Fill song metadata"})},3)]}),t.jsxs("form",{onSubmit:async h=>{h.preventDefault(),i<N.length-1?c($=>$+1):N.at(i)==="metadata"&&(await se.store(v),vt(v.id),n("edit/list/",{id:v.id,created:a?null:"true",song:null}))},children:[N.at(i)==="basic-data"&&t.jsx(ja,{shouldAutoImport:!y,isTxtRequired:!e,onAutoImport:f,onChange:u,data:l,finalSong:v}),N.at(i)==="author-and-video"&&t.jsx(xa,{songArtist:g==null?void 0:g.artist,songTitle:g==null?void 0:g.title,onChange:f,data:d}),g&&t.jsx(gr,{onChange:j,data:g,visible:N.at(i)==="sync"}),N.at(i)==="metadata"&&t.jsx(Ma,{videoGap:k==null?void 0:k.videoGap,onChange:m,data:o,songArtist:g==null?void 0:g.artist,songTitle:g==null?void 0:g.title,videoId:g.video}),w&&t.jsxs(bt,{severity:"warning","data-test":"possible-duplicate",children:[t.jsx(yt,{children:"Possible duplicate"}),"There is already a song with similar artist and/or name:"," ",t.jsxs("b",{children:[w.artist," - ",w.title]})]}),t.jsxs(I,{sx:{display:"flex",justifyContent:"flex-end"},children:[t.jsx(L,{"data-test":"previous-button",sx:{mt:2,align:"right"},onClick:()=>c(h=>h-1),disabled:i===0,children:"Previous"}),N.at(i)==="metadata"?t.jsx(L,{"data-test":"save-button",sx:{mt:2,align:"right"},type:"submit",variant:"contained",children:"Save"}):t.jsx(L,{"data-test":"next-button",sx:{mt:2,align:"right"},variant:"contained",type:"submit",disabled:!x||i===N.length-1,children:"Next"})]})]})]})]})}const br=z("div",{target:"ecp0zlc0"})({name:"1ec6m7r",styles:"background:white;margin:30px auto 0;width:1260px;height:100%"});export{Cr as default};
//# sourceMappingURL=ConvertView-D6zLOtby.js.map
