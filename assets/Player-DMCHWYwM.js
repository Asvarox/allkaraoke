import{a5 as Me,c6 as Wt,c7 as Pe,c8 as we,r as m,j as u,c9 as Yt,ca as Xt,cb as ke,ax as Te,cc as q,cd as je,ce as Ce,cf as pt,ag as D,aU as st,bk as v,aq as vt,ar as bt,a2 as x,ay as yt,bi as Gt,R as Re,cg as Ie,bu as Ee,aY as Ne,ba as Ut,b7 as $e,ae as C,N as xt,O as St,aS as Kt,ch as Oe,aP as _e,b9 as N,ci as tt,aG as Fe,am as W,a9 as ht,aO as et,cj as J,ah as V,ck as Ct,cl as ot,cm as Ae,a_ as O,aF as Le,aZ as Be,cn as Ve}from"./index-TlFYa9Sg.js";function De(t,e,n){var r=t.length;return n=n===void 0?r:n,!e&&n>=r?t:Me(t,e,n)}var He="\\ud800-\\udfff",ze="\\u0300-\\u036f",qe="\\ufe20-\\ufe2f",We="\\u20d0-\\u20ff",Ye=ze+qe+We,Xe="\\ufe0e\\ufe0f",Ge="\\u200d",Ue=RegExp("["+Ge+He+Ye+Xe+"]");function Jt(t){return Ue.test(t)}function Ke(t){return t.split("")}var Zt="\\ud800-\\udfff",Je="\\u0300-\\u036f",Ze="\\ufe20-\\ufe2f",Qe="\\u20d0-\\u20ff",ts=Je+Ze+Qe,es="\\ufe0e\\ufe0f",ss="["+Zt+"]",dt="["+ts+"]",gt="\\ud83c[\\udffb-\\udfff]",ns="(?:"+dt+"|"+gt+")",Qt="[^"+Zt+"]",te="(?:\\ud83c[\\udde6-\\uddff]){2}",ee="[\\ud800-\\udbff][\\udc00-\\udfff]",rs="\\u200d",se=ns+"?",ne="["+es+"]?",is="(?:"+rs+"(?:"+[Qt,te,ee].join("|")+")"+ne+se+")*",as=ne+se+is,os="(?:"+[Qt+dt+"?",dt,te,ee,ss].join("|")+")",cs=RegExp(gt+"(?="+gt+")|"+os+as,"g");function ls(t){return t.match(cs)||[]}function us(t){return Jt(t)?ls(t):Ke(t)}function hs(t){return function(e){e=Wt(e);var n=Jt(e)?us(e):void 0,r=n?n[0]:e.charAt(0),s=n?De(n,1).join(""):e.slice(1);return r[t]()+s}}var ds=hs("toUpperCase");const gs=ds;function fs(t){return gs(Wt(t).toLowerCase())}var ms=1,ps=4;function cr(t){return Pe(t,ms|ps)}function Rt(t){return t&&t.length?we(t):[]}var vs=function(t,e){var n=m.useRef(function(){});m.useEffect(function(){n.current=t}),m.useEffect(function(){if(e!==null){var r=setInterval(function(){return n.current()},e||0);return function(){return clearInterval(r)}}},[e])};const bs=vs;function ys(t){const e=m.useRef(t);return m.useEffect(()=>{e.current=t},[t]),e.current}function xs({onClose:t,closeButtonText:e}){return u.jsx(Yt,{onClose:t,children:u.jsx(Xt,{children:u.jsx(ke,{smooth:!1,onBack:t,onFinish:t,closeButtonText:e,skipText:"Back"})})})}function Ss({onResume:t,onExit:e,onRestart:n}){const r=m.useRef(null),s=m.useRef(null);m.useEffect(()=>{var a;(a=r.current)==null||a.focus()},[r]);const[i,c]=m.useState(!1),{register:o}=Te({enabled:!i});return u.jsxs(Yt,{onClose:t,children:[u.jsxs(Xt,{children:[u.jsx(q,{...o("button-resume-song",t),ref:r,children:"Resume song"}),u.jsx(q,{...o("button-restart-song",n),children:"Restart song"}),u.jsx(q,{...o("button-exit-song",e),children:"Exit song"}),u.jsx(q,{...o("input-settings",()=>c(!0)),children:"Microphones settings"}),u.jsx("hr",{}),u.jsx(je,{ref:s,...o("input-lag",()=>{var a;return(a=s.current)==null?void 0:a.focus()})})]}),i&&u.jsx(xs,{onClose:()=>c(!1),closeButtonText:"Back to Pause Menu"})]})}const re=Ce()?1e3:8e3;function Ms(t){return Math.floor((pt(t)-re)/1e3)}const Ps=2e4;function ws(t){return pt(t)-(t.videoGap??0)*1e3>Ps}function ks({playerRef:t,isEnabled:e}){const[n]=D(st),r=v.getSong(),s=m.useMemo(()=>ws(r),[r]),i=m.useMemo(()=>pt(r),[r]),c=v.getCurrentTime(!1)<i-re*1.2,o=e&&c&&s;vt({accept:()=>{t==null||t.seekTo(Ms(r));const{artist:d,title:h}=v.getSong();Gt.capture("introSkipped",{name:`${d} - ${h}`,artist:d,title:h})}},o);const l=m.useMemo(()=>({accept:"Skip Intro",back:"Pause Menu"}),[]);return bt(l,o),!n&&o?u.jsxs(Ts,{visible:o,"data-test":"skip-intro-info",children:["Press ",u.jsx(js,{children:"Enter"})," to skip the intro"]}):null}const Ts=x("div",{target:"e3375ar1"})(yt,";pointer-events:none;position:fixed;bottom:29rem;transform:scale(",t=>t.visible?1:0,");opacity:",t=>t.visible?1:0,";text-align:center;font-size:5rem;text-shadow:0 0 3.5rem black;width:100%;z-index:4;padding:0.5rem;transition:ease 500ms;"),js=x("kbd",{target:"e3375ar0"})("margin:0.2rem;padding:0.2rem 2rem;border-radius:1.3rem;border:0.5rem solid rgb(204, 204, 204);border-bottom-color:rgb(150, 150, 150);border-right-color:rgb(150, 150, 150);line-height:1.4;display:inline-block;background-color:rgb(247, 247, 247);text-shadow:0 1rem 0 #fff;opacity:",t=>t.disabled?.25:1,";"),Cs=15e3;function Rs({onSongEnd:t,isEnabled:e}){const[n]=D(st),r=v.getDuration(),s=m.useMemo(()=>Math.max(...v.getPlayers().map(p=>Ie(p.getLastNotesSection()))),[]),i=m.useMemo(()=>{const p=Ee(s,v.getSong());return e&&r*1e3>p+Cs},[r,s,e]),[c,o]=m.useState(0),[a,l]=m.useState(!1);bs(()=>o(v.getCurrentBeat()),1e3);const d=Ne(i&&c>s,5e3)&&!a;vt({accept:()=>{l(!0),setTimeout(t,700);const{artist:p,title:y}=v.getSong();Gt.capture("outroSkipped",{name:`${p} - ${y}`,artist:p,title:y})}},d);const g=m.useMemo(()=>({accept:"Skip Outro",back:"Pause Menu"}),[]);return bt(g,d),!n&&i?u.jsxs(Is,{visible:d,children:["Press ",u.jsx(Es,{children:"Enter"})," to skip the outro"]}):null}const Is=x("div",{target:"ehmmgcc1"})(yt,";pointer-events:none;position:fixed;bottom:29rem;transform:scale(",t=>t.visible?1:0,");opacity:",t=>t.visible?1:0,";text-align:center;font-size:5rem;text-shadow:0 0 3.5rem black;width:100%;z-index:4;padding:0.5rem;transition:ease 500ms;"),Es=x("kbd",{target:"ehmmgcc0"})("margin:0.2rem;padding:0.2rem 2rem;border-radius:1.3rem;border:0.5rem solid rgb(204, 204, 204);border-bottom-color:rgb(150, 150, 150);border-right-color:rgb(150, 150, 150);line-height:1.4;display:inline-block;background-color:rgb(247, 247, 247);text-shadow:0 1rem 0 #fff;opacity:",t=>t.disabled?.25:1,";"),Ns=Re.memo(Rs);function $s({players:t}){const e=v.getCurrentTime(!1),n=v.getSongBeatLength(),r=v.getDuration(),s=v.getSong(),i=m.useMemo(()=>Rt(s.tracks.filter((a,l)=>t.find(d=>d.track===l)).map(({sections:a})=>Ut(a)*n+s.gap)),[s,n,t]),c=m.useMemo(()=>Rt(s.tracks.filter((a,l)=>t.find(d=>d.track===l)).map(({sections:a})=>$e(a)*n+s.gap)),[s,n,t]),o=r*1e3;return!e||!r?null:u.jsxs(Mt,{children:[i.map(a=>u.jsx(It,{position:a/o},a)),c.map(a=>u.jsx(It,{position:a/o},a)),u.jsx(Fs,{fill:e/o})]})}const Mt=x("div",{target:"e19spujm2"})({name:"1q7pdku",styles:"position:absolute;height:0.6rem;width:100%;background:rgba(0, 0, 0, 0.5);left:0;top:calc(50% - 0.3rem)"}),Os=x(Mt,{target:"e19spujm1"})("top:0;margin-left:-0.25rem;width:0.5rem;background:",C.colors.text.active,";opacity:75%;"),It=t=>u.jsx(Os,{style:{left:`${Math.min(t.position*100,100)}%`}}),_s=x(Mt,{target:"e19spujm0"})({name:"1ssqmyb",styles:"top:0;background:white;opacity:50%"}),Fs=t=>u.jsx(_s,{style:{width:`${Math.round(t.fill*1e4)/100}%`}});var Pt={},As=St;Object.defineProperty(Pt,"__esModule",{value:!0});var ie=Pt.default=void 0,Ls=As(xt()),Bs=u,Vs=(0,Ls.default)((0,Bs.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2z"}),"Circle");ie=Pt.default=Vs;var wt={},Ds=St;Object.defineProperty(wt,"__esModule",{value:!0});var ae=wt.default=void 0,Hs=Ds(xt()),zs=u,qs=(0,Hs.default)((0,zs.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}),"Error");ae=wt.default=qs;var kt={},Ws=St;Object.defineProperty(kt,"__esModule",{value:!0});var oe=kt.default=void 0,Ys=Ws(xt()),Xs=u,Gs=(0,Ys.default)((0,Xs.jsx)("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}),"Warning");oe=kt.default=Gs;function Us({status:t,tooltipPosition:e="end",...n}){return u.jsxs(Ks,{...n,children:[t==="ok"?u.jsx(Js,{"data-test":"status-ok"}):t==="unavailable"?u.jsx(Zs,{"data-test":"status-unavailable"}):u.jsx(Qs,{"data-test":"status-unstable"}),t==="unavailable"?u.jsx(Et,{position:e,children:u.jsxs("span",{children:["The device is ",u.jsx("strong",{children:"disconnected"}),". Reconnect it, please."]})}):t==="unstable"?u.jsx(Et,{position:e,children:u.jsxs("span",{children:["The connection seems ",u.jsx("strong",{children:"unstable"}),". Connect to the same Wifi."]})}):null]})}const Ks=x("span",{target:"e1yb3fjk4"})({name:"186aqlb",styles:"position:absolute;right:0.5rem;top:0.5rem;font-size:3rem;z-index:10;svg{width:3rem;height:3rem;text-shadow:black;}"}),Js=x(ie,{target:"e1yb3fjk3"})({name:"19x2ge",styles:"fill:#ffffff;stroke:black;stroke-width:1px"}),Zs=x(ae,{target:"e1yb3fjk2"})({name:"f0g68e",styles:"fill:#ff0000"}),Qs=x(oe,{target:"e1yb3fjk1"})({name:"w492oh",styles:"fill:#f89400;stroke:black"}),Et=x("div",{target:"e1yb3fjk0"})(yt,";position:absolute;",t=>t.position==="end"?"left: 100%":"right: 150%",";top:-0.5rem;font-size:1.5rem;height:100%;display:flex;align-items:center;width:25rem;background:rgba(0, 0, 0, 0.75);padding:0.5rem;margin-left:2rem;"),tn=(t,e=333,n)=>{const[r,s]=m.useState("ok");return m.useEffect(()=>{const i=setInterval(()=>{s(Kt.getInputStatus(t))},e);return()=>{clearInterval(i)}},[t,e,n]),r};function en({player:t,bottom:e=!1}){const n=Kt.getPlayerVolume(t.number),r=tn(t.number);return u.jsxs(sn,{children:[r!=="unavailable"&&u.jsx(Oe,{playerNumber:t.number,volume:n}),u.jsx(nn,{status:r,tooltipPosition:"start"}),u.jsx(rn,{playerNumber:t.number})]})}const sn=x("div",{target:"e11j9crn2"})({name:"qoosmx",styles:"position:absolute;width:20rem;right:0;top:0;height:100%"}),nn=x(Us,{target:"e11j9crn1"})({name:"1jv40im",styles:"top:auto;right:1rem;bottom:1rem"}),rn=x(_e,{target:"e11j9crn0"})({name:"165qyih",styles:"z-index:2;font-size:2rem;margin-right:1rem;-webkit-text-stroke:0.1rem black;bottom:1.5rem"});function Nt({player:t,playerChanges:e,bottom:n=!1,effectsEnabled:r}){const s=v.getPlayer(t.number),[i]=D(st),c=C.colors.players[t.number].text,o=e[s.getTrackIndex()]??[],a=s.getCurrentSection(),l=s.getNextSection(),d=s.getNextSection(2),h=v.getCurrentBeat(),g=v.getSongBeatLength(),p=Math.max(0,...o.filter(P=>P<=(a==null?void 0:a.start))),y=o.find(P=>P>(a==null?void 0:a.start))??1/0,f=(y-h)*g,M=(y-h)/(y-p),R=f<2500,k=N(a),$=k?Ut([a])-a.start:0;return u.jsxs(ln,{shouldBlink:R,bottom:n,children:[!i&&r&&u.jsx(en,{player:t}),f<1/0&&u.jsx(mn,{color:c,progress:M<=1?M*100:0}),k?u.jsx(u.Fragment,{children:u.jsxs(Y,{"data-test":`lyrics-current-player-${t.number}`,effectsEnabled:r,children:[u.jsx(an,{children:u.jsx(cn,{color:c,percent:Math.min(2,(h-a.start)/$)})}),a==null?void 0:a.notes.map(P=>{const w=r?Math.max(0,Math.min(2,(h-P.start)/P.length)):h>=P.start?1:0;return u.jsxs(un,{type:P.type,children:[u.jsxs(hn,{children:[u.jsx(gn,{fill:w,color:c,children:P.lyrics.trim()}),P.lyrics.endsWith(" ")&&" "]}),P.lyrics]},P.start)}),(l==null?void 0:l.start)===y&&u.jsx($t,{shouldShake:!0})]})}):u.jsx(Y,{effectsEnabled:r,children:" "}),N(l)?u.jsxs(Y,{nextLine:!0,"data-test":`lyrics-next-player-${t.number}`,effectsEnabled:r,children:[l.notes.map(P=>u.jsx(m.Fragment,{children:P.lyrics},P.start)),(d==null?void 0:d.start)===y&&u.jsx($t,{})]}):u.jsx(Y,{effectsEnabled:r,nextLine:!0,children:" "})]})}const an=x("span",{target:"e1agvfe38"})({name:"1sngsgs",styles:"position:relative;height:0"}),on=x("span",{target:"e1agvfe37"})({name:"7drlms",styles:"position:absolute;width:15rem;height:3.1rem;margin:0.7rem 0;right:10rem"}),cn=({percent:t,color:e})=>{const n=m.useMemo(()=>{const r=tt(e).toRgb();return`${r.r}, ${r.g}, ${r.b}`},[e]);return u.jsx(on,{style:{transformOrigin:"right",transform:`scaleX(${Math.min(1,2-t)})`,right:`${Math.max(0,1-t)*15}rem`,background:`linear-gradient(270deg, ${n}, 1) 0%, rgba(${e}, 0.5) 25%, rgba(${n}, 0) 100%)`}})},ln=x("div",{target:"e1agvfe36"})("@keyframes blink{100%{background-color:rgba(0, 0, 0, ",t=>t.bottom?"0.85":"0.5",");}30%{background-color:rgba(0, 0, 0, ",t=>t.bottom?"0.85":"0.5",");}50%{background-color:rgba(200, 200, 200, ",t=>t.bottom?"0.85":"0.5",");}30%{background-color:rgba(0, 0, 0, ",t=>t.bottom?"0.85":"0.5",");}0%{background-color:rgba(0, 0, 0, ",t=>t.bottom?"0.85":"0.5",");}}box-sizing:border-box;padding:1rem;background:rgba(0, 0, 0, ",t=>t.bottom?"0.9":"0.5",");width:100%;text-align:center;line-height:1;margin:2rem 0;position:relative;",t=>t.shouldBlink?"animation: blink 350ms ease-in-out infinite both;":"",";"),un=x("span",{target:"e1agvfe35"})("font-style:",t=>t.type==="freestyle"?"italic":"normal",";"),hn=x("span",{target:"e1agvfe34"})({name:"nffb2y",styles:"position:absolute;z-index:1"}),dn=x("span",{target:"e1agvfe33"})(""),gn=({fill:t,color:e,children:n})=>u.jsx(dn,{style:{clipPath:`inset(0 ${(1-(t===0?0:t+.05))*100}% -5rem 0)`,color:`${e}`},children:n}),fn=x("div",{target:"e1agvfe32"})("position:absolute;height:1rem;background:",t=>t.color,";width:100%;"),mn=t=>u.jsx(fn,{style:{transformOrigin:"left",transform:`scaleX(${t.progress/100})`},color:t.color}),$t=x(Fe,{shouldForwardProp:t=>t!=="shouldShake",target:"e1agvfe31"})("@keyframes shake{10%,90%{transform:translate3d(-0.1rem, 0, 0);}20%,80%{transform:translate3d(0.2rem, 0, 0);}30%,50%,70%{transform:translate3d(-0.4rem, 0, 0);}40%,60%{transform:translate3d(0.4rem, 0, 0);}}",t=>t.shouldShake&&"animation: shake 0.92s cubic-bezier(0.36, 0.07, 0.19, 0.97) both infinite;"," margin-left:2rem;",t=>t.shouldShake?`fill: ${C.colors.text.active};`:""," font-size:",t=>t.shouldShake?4:3,"rem;"),Y=x("div",{target:"e1agvfe30"})("font-size:",({nextLine:t,effectsEnabled:e})=>e?3.5+(t?0:1):2,"rem;height:",({effectsEnabled:t})=>t?4.5:2,"rem;",({effectsEnabled:t})=>t?"":"-webkit-text-stroke-width: 2px",";color:",({nextLine:t})=>t?C.colors.text.inactive:C.colors.text.default,";font-family:'Comic Sans MS','Comic Sans','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;z-index:10;"),pn=new Intl.NumberFormat(void 0,{maximumFractionDigits:0});function Ot({score:t}){return u.jsx(u.Fragment,{children:pn.format(t)})}function ce(t,e,n,r,s){return s&&n?C.colors.players[e].starPerfect:s?C.colors.players[e].perfect:n&&r?C.colors.players[e].star:r?C.colors.players[e].hit:C.colors.players[e].miss}function vn(t,e,n,r){return ce(t,e,r.note.type==="star",n,r.isPerfect)}const ct={},bn=t=>{if(!ct[t]){const e=tt(t);ct[t]=[[e.setAlpha(.8).toRgbString(),e.setAlpha(.9).toRgbString(),e.setAlpha(1).toRgbString()],[e.setAlpha(0).toRgbString()],[e.setAlpha(.1).toRgbString(),e.setAlpha(.3).toRgbString(),e.setAlpha(.2).toRgbString()]]}return ct[t]};function ft(t,e,n,r,s,i,c,o=1){if(s<=0)return;e.globalAlpha=1;const a=e.createRadialGradient(n,r,0,n,r,s/2),[l,d,h]=bn(c);a.addColorStop(0,l[W(0,l.length-1)]),a.addColorStop(.05,l[W(0,l.length-1)]),a.addColorStop(.15,h[W(0,h.length-1)]),a.addColorStop(1,d[W(0,d.length-1)]),e.beginPath(),e.arc(n,r,s/2,0,2*Math.PI),e.closePath(),e.fillStyle=a,e.fill(),e.fillStyle=c,e.globalAlpha=1}function le(t,e,n,r,s,i,c,o,a=1){s>0&&ft(t,e,n,r,s,i,o,a)}const Z=(t,e)=>t-e+Math.random()*e*2,_t=(t=0)=>Math.sign(t+Math.random()-.5),yn=300,xn=50,X=1.3;class Sn{constructor(e,n,r){this.x=e,this.y=n,this.color=r,this.finished=!1,this.tick=(s,i,c)=>{const o=1-this.ttl/this.startingTtl,a=this.ttl,l=this.width*o,d=this.width*this.heightModifier*o,h=this.x-l/2+a*this.velocityX,g=this.y+d/2+a*this.velocityY;le(i,s,h,g,l,d,this.initialAngle+a,this.color,.7*o),this.ttl=this.ttl-c,this.finished=this.ttl<=0},this.startingTtl=this.ttl=Z(yn,xn),this.velocityX=X*Math.random()-X/2,this.velocityY=X*Math.random()-X/2,this.width=25,this.initialAngle=180-Math.random()*360,this.heightModifier=.5+Math.random()/2}}const Mn=`
precision mediump float;
`,nt=Mn.replace(/\n/g,""),Pn=`
attribute vec3 aVertexPosition;
attribute vec2 aTextureCoord;
`,ue=Pn.replace(/\n/g,""),wn=`
varying vec3 vVertexPosition;
varying vec2 vTextureCoord;
`,rt=wn.replace(/\n/g,""),kn=nt+ue+rt+`
uniform mat4 uMVMatrix;
uniform mat4 uPMatrix;

void main() {
    vTextureCoord = aTextureCoord;
    vVertexPosition = aVertexPosition;
    
    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
}
`;kn.replace(/\n/g,"");const Tn=nt+rt+`
void main() {
    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
}
`;Tn.replace(/\n/g,"");const jn=nt+ue+rt+`
void main() {
    vTextureCoord = aTextureCoord;
    vVertexPosition = aVertexPosition;
    
    gl_Position = vec4(aVertexPosition, 1.0);
}
`;jn.replace(/\n/g,"");const Cn=nt+rt+`
uniform sampler2D uRenderTexture;

void main() {
    gl_FragColor = texture2D(uRenderTexture, vTextureCoord);
}
`;Cn.replace(/\n/g,"");const he=6,T=30,b=T+6,Rn=t=>{const e=t.canvas.width,n=t.canvas.height,r=Math.max(0,(e-n*(16/9))/2),s=10+(e-2*r)*.15+r,i=n-t.paddingVertical*2;return{width:e-s*2,height:i/t.playerCount,baseX:s,baseY:t.paddingVertical+t.playerIndex*i/t.playerCount}};function Ft({canvas:t,currentSectionIndex:e,song:n,songBeatLength:r,minPitch:s,maxPitch:i,track:c,playerIndex:o,playerCount:a,paddingVertical:l}){var $;const d=n.tracks[c].sections,h=d[e],g=d[e+1],p=Rn({canvas:t,playerCount:a,playerIndex:o,paddingVertical:l}),y=N(h)?($=h==null?void 0:h.notes)==null?void 0:$.at(-1):void 0,f=N(h)?(g==null?void 0:g.start)??y.start+y.length:h.end,M=h.start*r,R=(f-h.start)*r,k=(p.height-20-T)/(i-s+he*2);return{playerCanvas:p,currentSection:h,sectionEndBeat:f,timeSectionGap:M,maxTime:R,pitchStepHeight:k}}function At(t,e,n,r,s,i,c,o){const a=Math.max(r,s/2),l=Math.min(a/2,s/2,i);t.beginPath(),t.moveTo(e+l,n),t.lineTo(e+a-l,n),t.quadraticCurveTo(e+a,n,e+a,n+l),t.lineTo(e+a,n+s-l),t.quadraticCurveTo(e+a,n+s,e+a-l,n+s),t.lineTo(e+l,n+s),t.quadraticCurveTo(e,n+s,e,n+s-l),t.lineTo(e,n+l),t.quadraticCurveTo(e,n,e+l,n),t.closePath(),c&&t.fill(),o&&t.stroke()}function Tt(t,e,n,r,s,i,c,o,a=.1){At(t,e,n,r,s,i,c,o),c&&a>0&&(t.save(),At(t,e,n,r,s,i,!1,!1),t.clip(),t.fillStyle=`rgba(255,255,255,${a})`,t.fillRect(e,n,r,s/2.2),t.restore())}function Q(t,e){t.fillStyle=e.fill,t.strokeStyle=e.stroke,t.lineWidth=e.lineWidth}function G(t,e,n,r,s,i){i==="star"?Q(t,C.colors.lines.star):i==="freestyle"||i==="rap"?Q(t,C.colors.lines.freestyle):Q(t,C.colors.lines.normal),t.shadowBlur=10,t.shadowColor="rgb(31,31,31)",t.shadowOffsetX=0,t.shadowOffsetY=0,Tt(t,e,n,r,s,100,!0,!0,.075),t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}function I(t,e,n,r,s,i,c,o,a){Q(t,ce(t,i,a,c,o)),t.shadowBlur=5,t.shadowColor="rgba(31,31,31, .7)",t.shadowOffsetX=1,t.shadowOffsetY=1,Tt(t,e,n,r,s,100,!0,!0,c?.15:0),t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}const S=10,U={start:{x:0,y:0,w:T/2+S,h:T+S*2},middle:{x:T/2+S,y:0,w:1,h:T+S*2},end:{x:T/2+1+S,y:0,w:T/2+S,h:T+S*2}},E={start:{x:0,y:0,w:b/2+S,h:b+S*2},middle:{x:b/2+S,y:0,w:1,h:b+S*2},end:{x:b/2+1+S,y:0,w:b/2+S,h:b+S*2}},_={blueMiss:{draw:(t,e,n,r,s)=>I(t,e,n,r,s,0,!1,!1,!1),width:T+1,height:T,padding:S,fragments:U},blueHit:{draw:(t,e,n,r,s)=>I(t,e,n,r,s,0,!0,!1,!1),width:b+1,height:b,padding:S,fragments:E},bluePerfect:{draw:(t,e,n,r,s)=>I(t,e,n,r,s,0,!0,!0,!1),width:b+1,height:b,padding:S,fragments:E},blueStarMiss:{draw:(t,e,n,r,s)=>I(t,e,n,r,s,0,!1,!1,!0),width:T+1,height:T,padding:S,fragments:U},blueStarHit:{draw:(t,e,n,r,s)=>I(t,e,n,r,s,0,!0,!1,!0),width:b+1,height:b,padding:S,fragments:E},blueStarPerfect:{draw:(t,e,n,r,s)=>I(t,e,n,r,s,0,!0,!0,!0),width:b+1,height:b,padding:S,fragments:E},redMiss:{draw:(t,e,n,r,s)=>I(t,e,n,r,s,1,!1,!1,!1),width:T+1,height:T,padding:S,fragments:U},redHit:{draw:(t,e,n,r,s)=>I(t,e,n,r,s,1,!0,!1,!1),width:b+1,height:b,padding:S,fragments:E},redPerfect:{draw:(t,e,n,r,s)=>I(t,e,n,r,s,1,!0,!0,!1),width:b+1,height:b,padding:S,fragments:E},redStarMiss:{draw:(t,e,n,r,s)=>I(t,e,n,r,s,1,!1,!1,!0),width:T+1,height:T,padding:S,fragments:U},redStarHit:{draw:(t,e,n,r,s)=>I(t,e,n,r,s,1,!0,!1,!0),width:b+1,height:b,padding:S,fragments:E},redStarPerfect:{draw:(t,e,n,r,s)=>I(t,e,n,r,s,1,!0,!0,!0),width:b+1,height:b,padding:S,fragments:E},noteNormal:{draw:(t,e,n,r,s)=>G(t,e,n,r,s,"normal"),width:b+1,height:b,padding:S,fragments:E},noteStar:{draw:(t,e,n,r,s)=>G(t,e,n,r,s,"star"),width:b+1,height:b,padding:S,fragments:E},noteFreestyle:{draw:(t,e,n,r,s)=>G(t,e,n,r,s,"freestyle"),width:b+1,height:b,padding:S,fragments:E},noteRap:{draw:(t,e,n,r,s)=>G(t,e,n,r,s,"rap"),width:b+1,height:b,padding:S,fragments:E}};function In(t,e){const n=document.createElement("canvas");return n.width=t,n.height=e,n}const de=Math.max(...Object.values(_).map(t=>t.padding*2+t.width)),ge=Object.values(_).map(t=>t.padding*2+t.height).reduce((t,e)=>t+e,0),fe=In(de,ge),mt=fe.getContext("2d");let A=0;const Lt=Object.entries(_).map(([t,e])=>{const n=e.padding*2,r={name:t,x:0,y:A,w:e.width+n,h:e.height+n};return A=A+e.height+n,r}).reduce((t,e)=>({...t,[e.name]:e}),{}),me=()=>{mt.clearRect(0,0,de,ge),A=0,Object.entries(_).forEach(([t,e])=>{e.draw(mt,e.padding,A+e.padding,e.width,e.height),A=A+e.padding*2+e.height})};me();ht.songStarted.subscribe(me);const pe=(t,e)=>({canvas:fe,ctx:mt,x:Lt[t].x+_[t].fragments[e].x,y:Lt[t].y+_[t].fragments[e].y,w:_[t].fragments[e].w,h:_[t].fragments[e].h,padding:_[t].padding}),lt=(t,e,n,r,s,i,c,o=1,a=1)=>{const l=pe(e,n),{canvas:d,w:h,h:g,y:p,x:y,padding:f}=l,M=f*o,R=f*a;return t.imageSmoothingEnabled=!1,t.drawImage(d,y,p,h,g,r-M,s-R,i??h,c??g),t.imageSmoothingEnabled=!0,l};function ve(t,e,n,r,s){const i=pe(e,"start"),c=Math.max(s,(i.h-i.padding*2)/2),o=Math.min(1,c/2/(i.w-i.padding)),a=o*i.w,l=a-i.padding*o,d=c-2*l;lt(t,e,"start",n,r,a,void 0,o),d>0&&lt(t,e,"middle",n+a,r,d,void 0,o),lt(t,e,"end",n+d+a,r,a,void 0,o)}const En=t=>`note${fs(t)}`;function be(t,e,n,r,s){const i=En(s.type);ve(t,i,e,n,r)}function Nn(t,e,n,r,s,i){t.save(),Tt(t,e,n,r,s,100,!1,!1),t.clip(),t.beginPath(),t.strokeStyle="rgba(255,255,255, .35)",t.lineWidth=3,t.lineJoin="round",t.moveTo(e,n+s/2-i.frequencyRecords[0].preciseDistance*s/3);for(let c=1;c<i.frequencyRecords.length;c++)t.lineTo(e+c*(r/(i.frequencyRecords.length-1)),n+s/2-i.frequencyRecords[c].preciseDistance*s/3);t.stroke(),t.closePath(),t.restore(),t.lineJoin="miter"}const $n=(t,e,n,r)=>{let s=t===0?"blue":"red";return n&&r?s=`${s}StarPerfect`:n?s=`${s}Perfect`:r&&e?s=`${s}StarHit`:e?s=`${s}Hit`:r&&!e?s=`${s}StarMiss`:s=`${s}Miss`,s};function On(t,e,n,r,s,i,c){const o=$n(s,i,c.isPerfect,c.note.type==="star");ve(t,o,e,n,r)}class _n{constructor(){this.particles=[],this.lastTick=Date.now(),this.getTimeDelta=e=>{const n=Date.now()-e,r=n-this.lastTick;return this.lastTick=n,r},this.tick=(e,n,r=0)=>{const s=this.getTimeDelta(r);this.particles.forEach(i=>i.tick(e,n,s)),this.particles=this.particles.filter(i=>!i.finished)},this.add=e=>this.particles.push(e)}}const F=new _n,Fn=50/60*1e3,An=25/60*1e3,Ln=60,Bt=.3;class Bn{constructor(e,n,r,s){this.x=e,this.y=n,this.color=r,this.delay=s,this.finished=!1,this.tick=(i,c,o)=>{if(this.delay-- >0)return;const a=this.ttl/this.startingTtl,l=this.startingTtl-this.ttl,d=this.width*a,h=this.width*this.heightModifier*a,g=this.x-d/2+l*this.velocityX,p=this.y-h/2+l*this.velocityY;le(c,i,g,p,d,h,this.initialAngle+l,this.color,.8*a),this.velocityX=this.velocityX-.009,this.velocityY=this.velocityY*1.0075,this.ttl=this.ttl-o,this.finished=this.ttl<=0},this.startingTtl=this.ttl=Z(Fn,An),this.velocityX=Z(.5,Bt)*_t(.2),this.velocityY=Z(.4,Bt)*_t(),this.width=Ln,this.initialAngle=180-Math.random()*360,this.heightModifier=.5+Math.random()/2}}class Vn{constructor(e,n,r,s,i,c){this.finished=!0,this.tick=(h,g)=>{};const o=i.type==="star"?C.colors.players[s].star.fill:C.colors.players[s].perfect.fill,a=tt(o).lighten(15).toRgbString(),l=tt(o).darken(15).toRgbString(),d=r/8;for(let h=0;h<d;h++){const g=Math.random();let p=o;g>.66?p=a:g>.33&&(p=l);const y=n+20*(Math.random()-.5);c.add(new Bn(e+h*5,y,p,(d-h)/10))}}}const Vt=200;class Dn{constructor(e,n,r,s){this.x=e,this.y=n,this.width=r,this.note=s,this.finished=!1,this.ttl=Vt,this.tick=(i,c,o)=>{const a=this.ttl/Vt;i.save(),i.globalAlpha=a,i.translate(0,b*(1-a)),be(i,this.x,this.y,this.width,this.note),i.globalAlpha=1,i.restore(),this.ttl=this.ttl-o,this.finished=this.ttl<=0}}}const ut=50/60*1e3,K=.05,Hn=200,Dt=4,zn=Math.pow;function Ht(t){return 1-zn(1-t,2)}class qn{constructor(e,n,r,s){this.x=e,this.y=n,this.finished=!1,this.tick=(i,c,o)=>{const a=this.ttl/ut;let l=Ht(1-Math.min(1,(1-a)*6));const d=this.maxWidth*l*3/4,h=this.maxWidth*l;ft(c,i,this.x,this.y,d,h,"white",l*.35),l=Ht(a);const g=l*this.maxWidth/4,p=l*this.maxWidth/4,y=this.x,f=this.y,M=ut-this.ttl;i.globalAlpha=l*.2,ft(c,i,y+M*this.velocityX,f+M*this.velocityY,g,p,"white",l*.2),this.ttl=this.ttl-o,this.finished=this.ttl<=0},this.ttl=ut,this.velocityX=K*Math.random()-K/2,this.velocityY=K*Math.random()-K/2,this.maxWidth=Math.min(.1+s,1)*(Math.sin(r/70)*Dt+(Hn-Dt))}}const zt=20;class Wn{constructor(e,n,r,s,i){this.x=e,this.y=n,this.w=r,this.h=s,this.seed=i,this.finished=!1,this.ttl=2/60*1e3,this.tick=(c,o,a)=>{c.strokeStyle="rgba(255,255,255,.25)",c.lineWidth=2,c.beginPath();for(let l=0;l<this.w;l++){const d=this.x+this.w-l,h=(this.h/2+2)*Math.sin(d/zt+this.seed/250);c.lineTo(d,this.y+this.h/2+h)}c.stroke(),c.beginPath();for(let l=0;l<this.w;l++){const d=this.x+this.w-l,h=-1*(this.h/2+2)*Math.sin(d/zt+this.seed/250);c.lineTo(d,this.y+this.h/2+h)}c.stroke(),this.ttl=this.ttl-a,this.finished=this.ttl<=0}}}const qt=20;function Yn(t,e){return t.find(n=>n.start<=e&&n.start+n.length>=e)}class Xn{constructor(e,n=0,r=1){this.canvas=e,this.verticalMargin=n,this.scaleFactor=r,this.loop=!1,this.pauseTime=0,this.pausedOn=0,this.shaders=null,this.start=()=>{ht.sectionChange.subscribe(this.onSectionEnd),this.loop=!0,this.drawFrame()},this.pause=()=>{this.end(),this.pausedOn=Date.now()},this.resume=()=>{this.pauseTime+=Date.now()-this.pausedOn,this.start()},this.end=()=>{var s;this.loop=!1,(s=this.shaders)==null||s.cleanup(),ht.sectionChange.unsubscribe(this.onSectionEnd)},this.isPlaying=()=>this.loop,this.drawFrame=()=>{const s=Date.now(),i=this.canvas.getContext("2d");if(i){if(v.isPlaying()&&(i.clearRect(0,0,this.canvas.width,this.canvas.height),et.getPlayers().forEach((o,a)=>{this.drawPlayer(o.number,i)}),F.tick(i,this.canvas,this.pauseTime)),J.get()===30){const c=Date.now(),o=1e3/30,a=c-s>o?o:o-(c-s);this.loop&&setTimeout(this.drawFrame,a,J.get())}J.get()!==30&&this.loop&&window.requestAnimationFrame(this.drawFrame)}},this.drawPlayer=(s,i)=>{const c=this.getDrawingData(s),{currentSection:o}=Ft(c);if(V.get()==="high"&&this.setDistortionForce(c),!N(o))return;const a=this.calculateDisplacements(o,c);this.drawNotesToSing(i,c,a),this.drawSungNotes(i,c,a),V.get()==="high"&&this.drawFlare(i,c,a)},this.setDistortionForce=s=>{var c,o,a;const i=s.currentSection;if(!N(i))(o=this.shaders)==null||o.updatePlayerForce(s.playerNumber,(((c=this.shaders)==null?void 0:c.getPlayerForce(s.playerNumber))??0)*.99);else{const l=Math.max(0,s.currentBeat-qt),d=s.currentPlayerNotes.filter(f=>f.note.start+f.note.length>=l).filter(f=>Ct(f)===0).reduce((f,M)=>f+M.length-Math.max(0,l-M.start),0),h=s.currentPlayerNotes.at(-1),g=((h==null?void 0:h.start)??0)+((h==null?void 0:h.length)??0),p=s.currentBeat-g,y=Math.max(Math.min(Math.pow((d-p/1.5)/qt,3),.98),0);(a=this.shaders)==null||a.updatePlayerForce(s.playerNumber,y)}},this.drawNotesToSing=(s,i,c)=>{N(i.currentSection)&&i.currentSection.notes.forEach(o=>{const{x:a,y:l,w:d,h}=this.getNoteCoords(i,o,o.pitch,!0,c[o.start]);be(s,a,l,d,o)})},this.drawSungNotes=(s,i,c)=>{N(i.currentSection)&&i.currentPlayerNotes.forEach(o=>{const a=Ct(o),{x:l,y:d,w:h,h:g}=this.getNoteCoords(i,o,o.note.pitch+a,a===0,c[o.note.start]);(a>0||h>g/2.5)&&(On(s,l,d,h,i.playerNumber,a===0,o),o.vibrato&&F.add(new Wn(l,d,h,g,i.currentTime)),a===0&&o.frequencyRecords.length>3&&!ot.includes(o.note.type)&&Nn(s,l,d,h,g,o))})},this.drawFlare=(s,i,c)=>{var a;if(!N(i.currentSection))return;const o=Yn(i.currentPlayerNotes,i.currentBeat-185/i.songBeatLength);if(o&&o.distance===0){const l=c[o.note.start]||[0,0],{x:d,y:h,w:g,h:p}=this.getNoteCoords(i,o,o.note.pitch,!0,l),y=ot.includes(o.note.type)?0:o.frequencyRecords.at(-1).preciseDistance,f=d+g,M=this.getPreciseY(h,p,y);F.add(new qn(f,M,i.currentTime,1)),F.add(new Sn(Ae(Math.max(d,f-50),f),M,vn(s,i.playerNumber,!0,o).fill)),(a=this.shaders)==null||a.updatePlayerCenter(i.playerNumber,f,M)}},this.onSectionEnd=s=>{if(v.isPlaying()){const i=this.getDrawingData(s,-1);if(!N(i.currentSection))return;this.fadeoutNotes(i.currentSection,i),this.explodeNotes(i.currentSection,i)}},this.fadeoutNotes=(s,i)=>{V.get()==="high"&&s.notes.forEach(c=>{const{x:o,y:a,w:l,h:d}=this.getNoteCoords(i,c,c.pitch,!0);F.add(new Dn(o,a,l,c))})},this.explodeNotes=(s,i)=>{V.get()==="high"&&i.playerNotes.filter(o=>(o.distance===0||ot.includes(o.note.type))&&s.notes.includes(o.note)).forEach(o=>{const{x:a,y:l,w:d,h}=this.getNoteCoords(i,o,o.note.pitch,!0);F.add(new Vn(a,l+h/2,d,i.playerNumber,o.note,F))})},this.calculateDisplacements=(s,i)=>{const c={};return V.get()==="high"?s.notes.forEach(o=>{const a=i.playerNotes.filter(g=>g.note.start===o.start).filter(g=>g.note.start+g.note.length+30>=i.currentBeat&&g.distance===0).map(g=>g.start+30<i.currentBeat?g.length-(i.currentBeat-30-g.start):g.length).reduce((g,p)=>Math.min(g+p,30),0),l=Math.max(0,(a-5)/(o.type==="star"?3:5)),d=(Math.random()-.5)*l,h=(Math.random()-.5)*l;c[o.start]=[d,h]}):s.notes.forEach(o=>{c[o.start]=[0,0]}),c},this.getDrawingData=(s,i=0)=>{const c=et.getPlayers(),o=c.findIndex(f=>f.number===s),a=c.length,l=v.getPlayer(s),d=l.getCurrentSectionIndex()+i,h=v.getSong(),g=l.getTrackIndex(),p=h.tracks[g].sections[d],y=l.getPlayerNotes();return{playerNumber:s,playerIndex:o,playerCount:a,song:h,songBeatLength:v.getSongBeatLength(),minPitch:l.getMinPitch(),maxPitch:l.getMaxPitch(),canvas:this.canvas,currentTime:v.getCurrentTime(),frequencies:l.getPlayerFrequencies(),playerNotes:y,currentPlayerNotes:y.filter(f=>f.note.start>=((p==null?void 0:p.start)??1/0)),track:l.getTrackIndex(),currentBeat:v.getCurrentBeat(),currentSectionIndex:d,currentSection:p,paddingVertical:this.verticalMargin}},this.getNoteCoords=(s,{start:i,length:c},o,a,l=[0,0])=>{const{sectionEndBeat:d,currentSection:h,playerCanvas:g,pitchStepHeight:p}=Ft(s),y=N(h)?h.notes[0].start:1,f=g.width/(d-y),[M,R]=a?l:[0,0],k=p*(s.maxPitch-o+he);return{x:Math.floor(g.baseX+f*(i-y)+M),y:Math.floor(g.baseY+10+k+R-(a?3:0)),w:Math.floor(f*c),h:a?b:T}},this.getPreciseY=(s,i,c)=>s+i/2-c*i/3}}const Gn=`precision mediump float;

const float MAX_FORCE = 300.0;
const int SAMPLE_COUNT = 8; // 2^x
const float INTENSITY = 0.051;
// get our varyings
varying vec3 vVertexPosition;
varying vec2 vTextureCoord;
// the uniform we declared inside our javascript
uniform float uTime;
uniform sampler2D planeTexture;
uniform vec2 uResolution;

uniform vec2 uP0center;
uniform float uP0force;

uniform vec2 uP1center;
uniform float uP1force;

float rnd(float n) {
    return fract(sin(n) * 43758.5453);
}
float random (vec2 st) {
    return rnd(dot(st.xy, vec2(12.9898, 78.233)));
}

vec4 directionalBlur(in vec2 uv, in vec2 direction, in float intensity)
{
    vec4 color = vec4(0.0);

    for (int i=1; i<=SAMPLE_COUNT; i++)
    {
        color += texture2D(planeTexture,uv+float(i)*intensity/float(SAMPLE_COUNT)*direction);
    }

    return color/float(SAMPLE_COUNT);
}

float distort(vec2 center, float force, float comparedIntensity) {
    float actualForce = force * MAX_FORCE;
    vec2 centerAbs = center * uResolution;

    vec2 direction = gl_FragCoord.xy - centerAbs.xy;
    float dist = length(direction) / length(uResolution);


    float intensity = max(0.0, 0.50 - dist) * INTENSITY * pow(force, 1.5);
    if (intensity > comparedIntensity) {
        vec4 newColor = directionalBlur(gl_FragCoord.xy / uResolution, normalize(direction), intensity);
        gl_FragColor = newColor;
    }
    return intensity;
}

void main() {
    gl_FragColor = texture2D(planeTexture, vTextureCoord);
    float p1intensity = distort(uP0center, uP0force, 0.0);
    float p2intensity = distort(uP1center, uP1force, p1intensity);
}`,Un=`
precision mediump float;

// default mandatory variables
attribute vec3 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat4 uMVMatrix;
uniform mat4 uPMatrix;

uniform mat4 planeTextureMatrix;

// custom varyings
varying vec3 vVertexPosition;
varying vec2 vTextureCoord;

void main() {
    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);

    // varyings
    vVertexPosition = aVertexPosition;
    vTextureCoord = (planeTextureMatrix * vec4(aTextureCoord, 0.0, 1.0)).xy;
}`,Kn=1920;function Jn({currentStatus:t,width:e,height:n,playerSetups:r,onSongEnd:s,playerChanges:i,effectsEnabled:c,videoPlayerRef:o,isPauseMenuVisible:a}){var $,P;const[l]=D(V),[d]=D(st),h=m.useRef(null),g=m.useRef(null),p=m.useRef(null);m.useEffect(()=>(v.startInputMonitoring(),()=>{v.stopInputMonitoring()}),[]);const y=Kn,f=y*(n/e),M=f/n;m.useEffect(()=>{if(!(!h.current||!p.current))return g.current=new Xn(h.current,p.current.offsetHeight*M),g.current.start(),()=>{var w;(w=g.current)==null||w.end()}},[h.current,($=p.current)==null?void 0:$.offsetHeight,M]),m.useEffect(()=>{var w,L,H,z;a&&((w=g.current)!=null&&w.isPlaying())?(L=g.current)==null||L.pause():!a&&!((H=g.current)!=null&&H.isPlaying())&&((z=g.current)==null||z.resume())},[a]),m.useEffect(()=>{t===O.ENDED&&s&&s()},[t,s]);const R=et.getPlayers(),k=!d&&R.length===2;return u.jsxs(Zn,{children:[l==="high"&&u.jsxs(u.Fragment,{children:[u.jsx("script",{type:"x-shader/x-fragment",id:"plane-fs",children:Gn}),u.jsx("script",{id:"plane-vs",type:"x-shader/x-vertex",children:Un}),u.jsx(tr,{id:"canvas",style:{zIndex:1e4}})]}),u.jsx(Qn,{id:"plane",children:u.jsx("canvas",{ref:h,width:y,height:f,"data-sampler":"planeTexture"})}),c&&u.jsxs(u.Fragment,{children:[u.jsx(ks,{playerRef:o,isEnabled:!a}),u.jsx(Ns,{onSongEnd:s,isEnabled:!a})]}),u.jsx($s,{players:r}),k&&u.jsx(Nt,{player:R[0],playerChanges:i,effectsEnabled:c}),u.jsx(er,{children:c&&u.jsx(u.Fragment,{children:((P=v.getSingSetup())==null?void 0:P.mode)===Le.CO_OP?u.jsx("span",{"data-test":"players-score","data-score":v.getPlayerScore(0),children:u.jsx(Ot,{score:v.getPlayerScore(0)})}):et.getPlayers().map(w=>u.jsx("span",{"data-test":`player-${w.number}-score`,"data-score":v.getPlayerScore(w.number),children:u.jsx(Ot,{score:v.getPlayerScore(w.number)})},w.number))})}),u.jsx("div",{ref:p,children:u.jsx(Nt,{player:R[k?1:0],playerChanges:i,bottom:!0,effectsEnabled:c})})]})}const Zn=x("div",{target:"eq90wxp3"})({name:"y3i90j",styles:"height:100%;color:white;-webkit-text-stroke:0.2rem black;font-weight:bold;position:relative;display:flex;flex-direction:column"}),Qn=x("div",{target:"eq90wxp2"})({name:"1x1omeb",styles:"position:absolute;top:0;left:0;width:100%;height:100%;canvas{width:100%;height:100%;}"}),tr=x("div",{target:"eq90wxp1"})({name:"1b4920d",styles:"position:absolute;top:0;left:0;width:100%;height:100%"}),er=x("div",{target:"eq90wxp0"})({name:"1kstjp",styles:"flex:1;height:100%;box-sizing:border-box;font-size:5.5rem;display:flex;justify-content:center;gap:4rem;padding-right:4rem;flex-direction:column;text-align:right;z-index:1"});function sr(t,e){const[n,r]=m.useState(0);return m.useEffect(()=>{t.current&&e===O.PLAYING&&n===0&&t.current.getDuration().then(s=>{r(s),v.setDuration(s)})},[n,t,e]),n}function nr({song:t,width:e,height:n,autoplay:r=!0,showControls:s=!1,onCurrentTimeUpdate:i,onSongEnd:c,onStatusChange:o,players:a,playerChanges:l=[[],[]],effectsEnabled:d=!0,singSetup:h,restartSong:g,...p},y){const f=m.useRef(null),[M,R]=m.useState(0),[k,$]=m.useState(O.UNSTARTED),[P]=D(Ve),[w,L]=m.useState(!1);m.useEffect(()=>(v.setSong(t),v.setSingSetup(h),()=>{v.resetSingSetup()}),[t,h]),m.useEffect(()=>{if(f.current&&k===O.PLAYING){const j=setInterval(async()=>{if(!f.current)return;const B=Math.max(0,await f.current.getCurrentTime()*1e3-P);R(B),i==null||i(B),v.setCurrentTime(B),v.update()},1e3/J.get());return()=>clearInterval(j)}},[f,i,k,P]);const H=sr(f,k);m.useImperativeHandle(y,()=>({seekTo:j=>f.current.seekTo(j),setPlaybackSpeed:j=>f.current.setPlaybackSpeed(j),play:()=>f.current.playVideo(),pause:()=>f.current.pauseVideo()}));const z=m.useCallback(j=>{$(j),o==null||o(j)},[$,o]),it=d&&c!==void 0,ye=()=>{var j;L(!0),(j=f.current)==null||j.pauseVideo()},jt=()=>{var j;L(!1),(j=f.current)==null||j.playVideo()},xe=()=>{w?jt():ye()},at=ys(k);m.useEffect(()=>{var B;if(!it)return;const j=at!==O.PAUSED&&at!==O.BUFFERING&&k===O.PAUSED;k===O.PLAYING&&w?(B=f.current)==null||B.pauseVideo():j&&!w&&L(!0)},[w,k,at,it]),vt({back:xe},it,[w]);const Se=m.useMemo(()=>({back:"Pause Menu"}),[]);return bt(Se,d),u.jsxs(rr,{...p,children:[w&&u.jsx(Ss,{onExit:c,onResume:jt,onRestart:g}),k!==O.UNSTARTED&&u.jsx(ir,{style:{width:`${e}px`,height:`${n}px`},children:u.jsx(Jn,{isPauseMenuVisible:w,effectsEnabled:d,playerChanges:l,duration:H,currentStatus:k,song:t,width:e,height:n,onSongEnd:c,playerSetups:a,videoPlayerRef:f.current})}),u.jsx(ar,{children:u.jsx(Be,{ref:f,video:t.video,width:e,height:n,controls:s,autoplay:r,disablekb:!0,volume:t.volume,startAt:t.videoGap??0,onStateChange:z})})]})}const rr=x("div",{target:"e39m8x62"})({name:"bjn8wh",styles:"position:relative"}),ir=x("div",{target:"e39m8x61"})({name:"qkt6ng",styles:"position:absolute;z-index:1;background-color:rgba(0, 0, 0, 0.2);pointer-events:none;width:100%;height:100%;top:0;left:0"}),ar=x("div",{target:"e39m8x60"})({name:"j387f9",styles:"overflow:hidden;height:100%"}),lr=m.forwardRef(nr);export{Us as P,xs as S,tn as a,Ot as b,cr as c,lr as d,pn as f,ys as u};
//# sourceMappingURL=Player-DMCHWYwM.js.map
