{"version":3,"mappings":"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AAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;A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","names":["Listener","listeners","onUpdate","args","forEach","callback","addListener","listener","push","removeListener","filter","clearAllListeners","console","log","CAMERA_GRANT_KEY","storedGrant","localStorage","getItem","CameraManager","constructor","stream","recorder","videoData","permissionGranted","JSON","parse","requestPermissions","navigator","mediaDevices","getUserMedia","video","stopRecord","setItem","stringify","disable","startRecord","frameRate","settings","getVideoTracks","getSettings","width","height","canvas","srcObject","play","MediaRecorder","mimeType","ondataavailable","evt","data","start","e","warn","getVideo","blob","Blob","type","URL","createObjectURL","_a","stop","_b","getTracks","track","clearData","length","restartRecord","getPermissionStatus","document","createElement","CameraManager$1","GameEvent","name","subscribers","lastParams","subscribe","getLast","unsubscribe","cb","dispatch","capture","Function","events","sectionChange","undefined","playerAdded","playerRemoved","songStarted","songEnded","remoteMicConnected","remoteMicDisconnected","playerNameChanged","playerInputChanged","player","oldI","newI","old","source","new","inputListChanged","karaokeConnectionStatusChange","remoteMicPlayerSet","remoteMicMonitoringStarted","remoteMicMonitoringStopped","micMonitoringStarted","micMonitoringStopped","playerChangeRequested","songStatStored","songScoreUpdated","remoteMicSubscribed","remoteKeyboardPressed","remoteSongSearch","remoteMicListUpdated","remoteKeyboardLayout","remoteReadinessRequested","remoteMicPermissionsSet","readinessConfirmed","minPlayerNumberChanged","sendMessage","connection","payload","send","t","getPingTime","Date","now","pack","msgpackr","unpack","buffer","RemoteMicInput$2","frequencies","volumes","requestReadinessPromise","getChannelsCount","getFrequencies","freqs","Array","isArray","at","getVolumes","getInputLag","requestReadiness","Promise","resolve","off","on","startMonitoring","handleRTCData","stopMonitoring","RemoteMic$1","id","pingTime","pingInterval","getInput","input","setPlayerNumber","playerNumber","onDisconnect","clearInterval","setPermission","level","isPinging","latency","onPong","pingClient","setTimeout","getLatency","RemoteMicInput","Setting","defaultValue","driver","value","get","window","set","newValue","newListener","GraphicsLevel","GRAPHICS_LEVEL_KEY","GraphicSetting","MicSetupPreference","MIC_SETUP_PREFERENCE_KEY","MicSetupPreferenceSetting","FpsCount","FPSCountSetting","ExcludedLanguagesSetting","MobilePhoneModeSetting","InputLagSetting","RemoteMicPermissions","DefaultRemoteMicPermission","BackgroundMusic","BackgroundMusicSetting","useSettingValue","currentValue","setCurrentValue","useState","useEffect","abstractStorage","storeValue","key","getValue","val","storage","session","sessionStorage","RememberedAccessesKey","RememberedSubscriptionsKey","RemoteMicManager","remoteMics","micAccessMap","subscriptions","addRemoteMic","silent","remoteMic","RemoteMic","getPermission","removeRemoteMic","find","getRemoteMics","getRemoteMicById","broadcast","event","broadcastToChannel","channel","permission","addSubscription","Set","removeSubscription","remoteMicId","RemoteMicManager$1","ALPHANUMERIC_REGEX","clearString","str","removeAccents","toLowerCase","normalize","replace","latinize","getSongId","song","artist","title","typesMap","R","F","txtTypesMap","rap","freestyle","star","normal","getPropertyValueFromTxt","txt","regex","RegExp","match","Number","vals","split","LINE_BREAK_RELATIVE_REGEXP","getVideoId","url","searchParams","safeJsonParse","convertTxtToSong","text","videoLink","author","authorUrl","sourceUrl","trackNames","additionalData","year","artistOrigin","lastUpdate","edition","genre","videoGap","realBpm","previewStart","previewEnd","volume","Math","floor","language","bpm","bar","gap","tracks","linkUrl","message","sections","lastStart","line","startsWith","test","end","notes","trim","Object","keys","includes","lastSection","pitch","lyrics","join","map","section","isNotesSection","toTxtValue","toString","notesToText","note","convertSongToTxt","parsedValues","lines","first","values","concat","Boolean","CURRENT_VISIT_KEY","LAST_VISIT_KEY","VISIT_TIMEOUT_MS","currentTime","currentVisit","isFirstVisit","defaultLastVisit","lastVisit","String","getFirstNoteFromSection","getFirstNoteStartFromSections","firstNoteSection","Infinity","getLastNoteEndFromSections","getLastNoteEnd","lastNote","getNoteAtBeat","beat","tolerance","generateSearchString","getSongPreview","songData","local","tracksCount","search","localForage","createInstance","DELETED_SONGS_KEY","legacyStorage","LEGACY_DELETED_SONGS_KEY","captureException","error","SongsService","finalIndex","indexWithDeletedSongs","store","generateSongFile","toISOString","reloadIndex","songId","localSong","getLocal","fetch","then","response","getIndex","includeDeleted","getCurrentIndex","getDeletedSongsList","defaultIndex","storageIndex","deletedSongs","all","json","getLocalIndex","lastVisitDate","storageIndexWithUpdatedSongs","defaultSong","isAfter","localSongs","removeItem","isNew","isDeleted","sort","a","b","localeCompare","deleteSong","softDeleteSong","deletedItems","restoreSong","item","decodeURIComponent","getKeys","specialKeys","SongDao","ROOM_ID_KEY","NetworkServer","transport","roomId","started","connect","sender","peer","custom","deleted","getRoomId","v4","transportName","addEventListener","close","disconnect","isE2E","isE2ETests","location","e2eOverrides","host","port","path","options","import","PeerJSServerTransport","onConnect","onClose","Peer","peerJSOptions","conn","state","WEBSOCKETS_SERVER","WebSocketServerTransport","pswd","WebSocket","binaryType","onopen","SenderWrapper","socket","recipients","callbacksMap","Map","actualCallback","removeEventListener","delete","urlParams","URLSearchParams","server","isWebsockets","DrawingTestInput","deviceId","setFrequency","getStatus","DrawingTestInput$1","DummyInput","timestamp","interval","isMonitoring","setInterval","sin","cos","dummyInput","AubioStrategy","init","context","Pitch","aubio","detector","sampleRate","setTolerance","getFrequency","do","getSampleSize","UserMediaService","status","requestAndTrack","enumerateDevices","fnc","setStatus","result","newStatus","userMediaService","MicInput","startedMonitoring","echoCancellation","audio","exact","AudioContext","createMediaStreamSource","splitter","createChannelSplitter","analyserCh0","createAnalyser","fftSize","minDecibels","analyserCh1","strategy","dataCh0","Float32Array","dataCh1","getFloatTimeDomainData","calculateVolume","i","sum","sqrt","MicInput$1","mic","RemoteMicInput$1","getInputId","inputs","channels","label","DrawingTestInputSource","inputName","getDefault","getInputs","subscribeToListChange","unsubscribeToListChange","singstarWirelessMicMapper","singstarWiredMicMapper","singstarGenericMapper","getPreferred","ch","mapInputName","MicrophoneInputSource","inputList","devices","extra","device","kind","getCapabilities","channelCount","max","range","preferred","flat","_MicrophoneInputSource","mapRemoteMicToInput","RemoteMicrophoneInputSource","InputManager","getInputStatus","PlayersManager","getPlayer","sourceNameToInput","getPlayerFrequency","getPlayerVolume","getPlayerInputLag","getPlayers","monitoringStarted","sourceName","InputManager$1","noDistanceNoteTypes","noPointsNoteTypes","MIDDLEA","SEMITONE","MAX_NAME_LENGTH","pitchToFrequency","pow","pitchFromFrequency","freq","round","getDistanceInCents","noteFreq","getCentDistance","targetNote","cents","distance","sign","abs","calcDistanceBetweenPitches","noteDistance","calcDistance","frequency","GameState","getTolerance","preciseDistance","WINDOW_SIZE","detectVibrato","opChangePoints","change","lastChange","changePoints","intervals","slice","record","maxInterval","minInterval","min","averageIntervals","reduce","SINGING_BREAK_TOLERANCE_MS","appendFrequencyToPlayerNotes","playerNotes","beatLength","noteCandidate","breakToleranceBeat","noteEndBeat","isThisNoteDifferentThanLast","isDistanceDifferent","roundedStart","isPerfect","vibrato","frequencyRecords","lastPlayerNoteEndBeat","lastNoteEndBeat","roundedLength","getPlayerNoteDistance","MAX_POINTS","noteTypesMultipliers","perfect","countsToBeats","counts","sumDetailedScore","beatsToPoints","pointsPerBeat","addDetailedScores","s1","s2","divideDetailedScores","divideBy","countSungBeats","memoize","calculateDetailedScoreData","trackNumber","beatsPerTrack","maxCounts","calculateScore","PlayerState","number","gameState","realFrequencyRecords","realPlayerNotes","storedSectionIndex","getNumber","update","getCurrentTime","currentTimestamp","lastRealRecord","lastTimestamp","timestampStep","updatePlayerNotes","dispatchSectionUpdate","currentSectionIndex","getCurrentSectionIndex","recordBeat","getSongBeatLength","recordSection","getSectionByBeat","getPlayerNotes","getPlayerFrequencies","getSectionIndexByBeat","getTrack","findIndex","index","getCurrentBeat","getCurrentSection","sectionIndex","getNextSection","getPreviousSection","getLastNotesSection","last","getScore","getSong","getTrackIndex","getDetailedScore","getMinPitch","getMaxPitch","getSingSetup","players","resetNotes","GAME_MODE","DUEL","PASS_THE_MIC","CO_OP","currentBeat","GameStateClass","duration","singSetup","playerStates","playing","setCurrentTime","accountGap","setSong","setSingSetup","resetSingSetup","isPlaying","setDuration","getDuration","getPlayerCount","getPlayerScore","mode","curr","playerState","getPlayerDetailedScore","scores","fs","pointsScores","summedPoints","pointsScore","tuple","startInputMonitoring","stopInputMonitoring","resetPlayerNotes","DummyInputSource","selectedPlayerInputToId","InputSourceListManager","initialiseInputSource","lazily","list","loadMics","Microphone","getInputList","getInputForPlayerSelected","returnDefault","InputSources","SELECTED_INPUTS_KEY","PlayerEntity","nameOverride","changeInput","restartMonitoringPromise","newInput","oldInput","toJSON","getName","isDefaultName","setName","newName","oldName","fromJSON","_PlayerEntity","MAX_PLAYERS","minPlayerNumber","requestingPromise","storePlayers","request","some","inputSourceListManager","getMinPlayerNumber","setMinPlayerNumber","previousMinPlayerNumber","addPlayer","newPlayer","removePlayer","storedPlayers","RemoteMicServer","_","microphone","debounce","PlayersManager$1","unselectedRemoteMic","selectedRemoteMic","playerNumberIndex","phoneId","newPlayerNumber","currentPlayer","toast","success","jsxs","Fragment","jsx","warning","sendPlayerStates","trackSongData","setup","sameScores","every","score","posthog","mobilePhoneMode","getSongKey","fetchSongStats","storageKey","plays","storeSongStats","stats","currentState","date","PLAYER_NAMES_SESSION_STORAGE_KEY","PREVIOUS_PLAYER_NAMES_STORAGE_KEY","isNonNull","currentNames","thisPlayNames","newNamesSet","__","SimplifiedMic","noiseSuppression","autoGainControl","SimplifiedMic$1","MIC_ID_KEY","roundTo","num","precision","multiplier","NetworkClient","clientId","reconnecting","connected","sendFrequencies","throttle","sendEvent","onFrequencyUpdate","getClientId","setClientId","isConnected","connectToServer","reason","reconnect","pingStart","pinging","ping","p","help","getElementById","remove","reload","sendKeyStroke","searchSong","requestPlayerChange","confirmReadiness","getSongList","sendRequest","setInputLag","debug","reject","timeout","clearTimeout","PeerJSClientTransport","unavailableIdRetries","unavailableIdRetryTimeout","connectToRoom","open","disconnected","onError","destroy","WebSocketClientTransport","readyState","onmessage","onclose","info","onerror","client","__exposeSingletons","__singletons","RemoteMicClient","GameEvents","inputManager","InputSourceManager","inputSources","isDev","process","useEventListener","setValue","subscriber","useEventEffect","effect","eventList","useEventListenerSelector","selector","dependencies","initialValueRef","useMemo","blueFillBase","blueFill","blueStroke","redFillBase","redFill","redStroke","playerColors","fill","stroke","lineWidth","starPerfect","hit","miss","styles","colors","active","activeBorder","default","inactive","focusable","props","css","focused","focusAnimation","keyframes","typography","REGULAR_ALPHA_CHARS","keyboard","lock","supportsEscAsBack","preventDefault","stopPropagation","useKeyboard","params","enabled","deps","param","useHotkeys","up","down","left","right","accept","back","random","useIsVisible","createPersistedState","KeyboardHelpView","isCollapsed","setIsVisible","helps","entries","Container","UseKeyboardIndicator","view","Component","defaultLabel","KeyhelpComponent","Section","SectionHelp","SectionKeys","Kbd","HelpIcon","HorizontalVerticalBase","vertical","horizontal","Horizontal","Vertical","HorizontalVertical","Accept","KeyboardReturn","Back","ShiftLetter","letter","toUpperCase","shiftR","_styled","target","collapsed","visible","disabled","KeyboardHelpContext","createContext","setKeyboard","helpEntry","unsetKeyboard","KeyboardHelpProvider","children","keyboards","setKeyboards","kbs","omit","remote","rest","BackgroundContext","setVisibility","useBackground","shouldBeVisible","background","useContext","LayoutWithBackgroundProvider","setVisible","useCallback","Background","BackgroundStatic","theme","graphicSetting","NormalizeFontSize","size","MicIcon","SvgIcon","MicIconRed","MicIconBlue","BottomBar","setActiveTab","ItemContainer","ItemIcon","ItemTitle","ListIcon","SettingsIcon","Button","buttonFocused","buttonFocusedAnimation","MenuButton","MenuContainer","Modal","Backdrop","CONFIRM_WIFI_KEY","ConfirmWifiModal","closed","setClosed","React","closeModal","onChange","Menu","Wrapper","IconsWrapper","PhoneAndroid","Wifi","Laptop","nextIndex","current","direction","nextValueIndex","indexOf","nextValue","Switcher","onClick","restProps","ConfigurationPosition","ConfigValue","InfoText","expanded","Input","forwardRef","className","adornment","forwardedRef","inputRef","useRef","focus","Label","StyledInput","Adornment","usePersistedName","Connect","isVisible","connectionStatus","connectionError","handleConnect","showConnectionTip","setShowConnectionTip","Form","ConnectButton","CircularProgress","Warning","QrCode2","useDebounce","delay","debouncedValue","setDebouncedValue","handler","RemoteSongSearch","onSearchStateChange","setSearch","debouncedSearch","previousSearch","usePrevious","useUnmount","SearchInput","Search","RemoteMicKeyboard","isHorizontal","isVertical","onPress","ActionsContainer","ArrowsContainer","ArrowButton","KeyboardArrowUp","KeyboardArrowLeft","Games","KeyboardArrowRight","KeyboardArrowDown","ActionButton","ArrowBack","ArrowForward","Break","Shuffle","ButtonBase","_ref","PlayerChangeModal","onModalClose","header","selectPlayer","joined","color","PlayerNumberCircle","PlayerColorCircle","PlayerChange","memo","isOpen","setIsOpen","PlayerChangeContainer","SwapHorizIcon","usePermissions","permissions","VolumeIndicator","isMicOn","maxVolume","setMaxVolume","backgroundColor","indicatorColor","IndicatorContainer","Debug","Indicator","transform","MicPreview","setVolume","updateVolumes","Ping","setLatency","useMicrophoneStatus","isOpera","userAgent","allowMic","enableMicOpera","enableMic","getProperEnableMicImage","UserMediaEnabled","fallback","showImages","WarningContainer","WarningIcon","AdditionalInfo","setMonitoringStarted","isKeepAwakeOn","setIsKeepAwakeOn","searchActive","setSearchActive","body","requestFullscreen","screen","orientation","unlock","micPreview","Panel","NoPermissionsMsg","KeepAwake","MicInputState","collapse","ConfirmReadiness","onConfirm","isAfterReload","setIsAfterReload","confirm","ReadyButton","RemoteInputLag","isLoading","setIsLoading","catch","finally","changeValue","Value","ManagePlayers","Entry","setOpen","RemoteMicEntry","RemoteMicId","RemoteMicName","isSelf","RemoteSettings","reset","generateLangMap","langNames","Intl","DisplayNames","langMap","j","code","fromCharCode","of","Akan","Hebrew","Indonesian","Javanese","Romanian","Yiddish","Tagalog","English","Korean","Swedish","Latin","langMap2","languageNameToIsoCode","Flag","isoCode","isocode","useSongIndex","songIndex","setSongIndex","emptyList","loadSongs","RemoteSongList","originalSongList","overrides","setOverrides","songList","uniqBy","SongItemContainer","Language","ArtistTitle","Title","Artist","noSleep","NoSleep","activeTab","setKeepAwake","turnOn","isEnabled","enable","BottomBarFiller","dotparty","logo","pride","Logo","PrideLogo","StyledLogo","DotParty","isChromium","RecommendedBrowsers","RecommendChrome","GithubRibbon","Ribbon","position","top","border","transformOrigin","MenuWithLogo","supportedBrowsers","waitFinishedSound","classicBackgroundMusicSound","wooshSound","backgroundMusic$2","menuBackSound","menuEnterSound","menuNavigateSound","menuNavigate","Howl","src","menuEnter","menuBack","waitFinished","preload","woosh","backgroundMusic","backgroundMusicSound","loop","classicBackgroundMusic","useBackgroundMusic","backgroundMusicSelection","music","useKeyboardHelp","setHelp","clearHelp","useKeyboardNav","onBackspace","backspaceHelp","additionalHelp","currentlySelected","setCurrentlySelected","elementList","newElementList","actions","currentlySelectedActionLabel","handleEnter","handleBackspace","handleNavigation","currentIndex","defaultSelection","register","onActive","isDefault","propName","keyboardNavigationChangeFocus","newElements","focusElement","startViewTransition","useSmoothNavigate","baseNavigate","useLocation","to","smooth","InputLag","inputLag","InputLagField","blur","Settings","navigate","goBack","graphicLevel","setGraphicLevel","fpsCount","setFpsCount","setMobilePhoneMode","setBackgroundMusic","inputLagRef","camera","setCamera","isRequestInProgress","setIsRequestInProgress","enableCamera","cameraValue","Pre","inputAction","action","InputProps","endAdornment","Tooltip","mr","AuthorAndVid","searchForVideo","encodeURIComponent","songArtist","songTitle","isSearchableForVideo","videoId","Box","display","flexWrap","TextField","mt","flexDirection","alignItems","YouTube","accents","polish","È","í","π","ê","Í","Œ","å","œ","ú","æ","Ê","ø","Ø","ñ","Ò","Û","ü","Ÿ","spanish","Ì","ń","ś","fixDiacritics","accentSet","fixedTxt","accent","replacement","replaceAll","isValidUltrastarTxtFormat","songTxt","requiredTags","isValid","tag","importSongFromSource","urlObj","importUsDbAnimuxSong","importUltrastarEsSong","doc","DOMParser","parseFromString","txtUrl","querySelector","getAttribute","href","authorPath","textContent","obj","BasicData","onSourceUrlEdit","shouldAutoImport","onAutoImport","fixAccents","txtInput","isTxtInputValid","isTxtRequired","inputProps","sx","fontFamily","overflow","finalSong","flex","formatMs","msec","minutes","seconds","miliseconds","padStart","ytPlayerAdapter","playVideo","pause","pauseVideo","seekTo","timeSec","setPlaybackSpeed","rate","setPlaybackRate","ms","py","mb","MIN_PREVIEW_LENGTH","PreviewAndVolumeAdjustment","reference","initialised","setInitialised","getInternalPlayer","currentVolume","getVolume","isPlayerPlaying","setIsPlayerPlaying","isReferencePlaying","setIsReferencePlaying","handleSliderChange","internalPlayer","Slider","currentTarget","SongMetadata","definedLanguages","definedGenres","l","searchGoogle","phrase","Grid","Autocomplete","AdjustPlayback","effectsEnabled","onEffectsToggle","seekBy","bySec","currentSpeed","setCurrentSpeed","Typography","ButtonGroup","px","Divider","speed","useCurrentSectionIndex","wholeBeat","EditSection","onRecordChange","onTrackNameChange","setTrack","selectedSection","setSelectedSection","changeRecords","setChangeRecords","onSectionClick","deleteSection","records","selected","shiftSection","newStart","lastRecord","newRecords","shift","SectionEdtiorContainer","Stack","ml","List","overflowY","ListItem","ListItemButton","ListItemText","fontWeight","SectionEditForm","step","SectionChangeList","maxHeight","SectionChangeDelete","SectionChangeShift","ChangeEntry","ListTracks","calculateProperBPM","desiredEndMs","notesSections","desiredLengthMs","bpmLength","toFixed","beatToMs","ManipulateBpm","lastNoteEndMs","desiredLastNoteEnd","setDesiredLastNoteEnd","ShiftGap","finalGap","ShiftVideoGap","HEADSTART_MS","shortenNoteSections","getSectionEnd","addPauseSections","padSizeBeats","lastEnd","sectionsWithPauses","normaliseSectionPaddings","desiredPadding","shiftSections","shiftBeats","addHeadstart","desiredHeadstart","actualHeadstart","normaliseGap","earliestTrack","currentNoteStart","thisNoteStart","firstSection","normaliseSpaces","normaliseLyricSpaces","usePlayerVolume","playerRef","useUnstuckOnStartSong","currentStatus","playerKey","setPlayerKey","UNSTARTED","useUnstuckOnBuffering","BUFFERING","onLine","useUnstuckYouTubePlayer","VideoState","ENDED","PLAYING","PAUSED","CUED","stateMap","YoutubeVideoPlayer","autoplay","startAt","controls","disablekb","onStateChange","ref","setCurrentStatus","setSize","useImperativeHandle","w","h","newVolume","loadVideoById","opts","playerVars","rel","modestbranding","DirectVideo","createCallback","onPlay","onPause","onEnded","playerApi","time","dummyVideo","OfflineVideoPlayer","VideoPlayer","VITE_APP_OFFLINE","Heading","SCompletedAnim","Lottie","completedAnimationSegment","CompletedAnim","completedAnimation","SelectPreference","onPreferenceSelected","previouslySelected","onBack","skipText","Option","OptionIconContainer","PhoneIphone","OptionDescription","PhotoCamera","QrCode","Person","Usb","moreInfoMixin","usePlayerMicData","onMeasure","intervalMs","playerVolume","playerFrequency","usePlayerMic","setData","VolumeIndicatorBase","percent","PlayerMicCheck","elem","setElem","style","linkObject","ConnectRemoteMic","useRoute","pathname","link","QRCode","QRCodeSVG","Description","QRCodeInstruction","CopyLinkInstruction","InputCopyContainer","InputCopy","CopyButton","clipboard","writeText","useMicrophoneList","load","usePlayerInput","sources","sourceList","selectedPlayerInput","playerInputData","playerInput","cycleSource","startingIndex","nextSource","cycleInput","newIndex","usePlayerNumberPreset","targetPlayerCount","playerCount","takenNumbers","availableNumbers","from","useRemoteMicAutoselect","nextPlayerToAutoSwitch","isWindows","PlayerSelector","SwitcherWithPlayerHeader","SwitcherWithMicCheck","MicCheck","Advanced","onSetupComplete","micInputs","isDifferentMics","onSave","closeButtonText","names","MicCheckContainer","useIsPlayerMicAudible","inputLabel","isAudible","setIsAudible","previousMeasurements","attempts","audible","BuiltIn","selectedMic","Mics","setMic","autoselect","defaultDevice","cycleMic","Header","AudibleStatus","AudibleIconContainer","SuccessIcon","ErrorIcon","changePreference","Error","Check","RemoteMics","onContinue","isComplete","SingStarMics","showAdvancedTip","setShowAdvancedTip","isSetup","isSameDeviceId","isMicInput","areAllPreferred","listChanged","setListChanged","initial","ChromeIssue","Skip","LAST_SELECTED_KEY","SelectInputView","onFinish","playerNames","preference","setPreference","setIsComplete","wasMonitoring","storedPreference","setStoredPreference","storePreference","flushSync","pref","SelectInputModal","PauseMenu","onResume","onExit","onRestart","menuRef","isInputModalOpen","setIsInputModalOpen","getSongFirstNoteMs","firstNote","SKIP_INTRO_MS","getSkipIntroTime","SKIP_INTRO_THRESHOLD_MS","songHasLongIntro","SkipIntro","hasLongIntro","songFirstNoteMs","canSkip","skipIntro","SHOW_OUTRO_THRESHOLD_MS","SkipOutro","onSongEnd","singingEndBeat","singingEndTime","setCurrentBeat","skipping","setSkipping","useInterval","skipOutro","SkipOutro$1","DurationBar","firstNotes","uniq","v","lastNotes","durationMs","Bar","Marker","BarFill","BaseMarker","BaseBarFill","useDevicePing","PingContainer","PlayerStatus","tooltipPosition","StatusContainer","ThumbUpAlt","UnavailableIcon","UnstableIcon","StatusDescription","usePlayerMicStatus","LyricsVolumeIndicator","bottom","StyledPlayerStatus","StyledPing","Lyrics","playerChanges","playerColor","thisPlayerChanges","nextSection","subsequentSection","previousChange","nextChange","timeToNextChange","passTheMicProgress","shouldBlink","hasNotes","beatsBetweenSectionAndNote","LyricsContainer","PassTheMicProgress","LyricsLine","HeadstartContainer","Headstart","LyricContainer","LyricActiveContainer","LyricActive","endsWith","PassTheMicSymbol","BaseHeadstart","BaseLyricActive","clipPath","BasePassTheMicProgress","progress","shouldForwardProp","prop","shouldShake","nextLine","formatter","NumberFormat","maximumFractionDigits","ScoreText","format","getColor","ctx","isStar","isHit","getNoteColor","playerNote","randomFloat","randomInt","cachedColors","getColors","c","tinycolor","setAlpha","toRgbString","ray","x","y","alpha","globalAlpha","gradient","createRadialGradient","cFirst","cLast","c0","addColorStop","beginPath","arc","PI","closePath","fillStyle","debris","angle","spreadValue","spread","randomSign","weight","baseTtlMs","ttlSpreadMs","velocityModifier","SungTriangle","finished","tick","delta","percentage","ttl","startingTtl","ticksLeft","heightModifier","velocityX","velocityY","initialAngle","Shaders","plane","updatePlayerCenter","uniforms","updatePlayerForce","force","getPlayerForce","cleanup","curtains","dispose","Curtains","pixelRatio","premultipliedAlpha","container","gl","BLEND","blendFunc","ONE","ONE_MINUS_SRC_ALPHA","planeElement","planeDimensions","getBoundingClientRect","vertexShaderID","fragmentShaderID","resolution","playerUniforms","Plane","loadCanvas","onRender","visibility","pitchPadding","NOTE_HEIGHT","BIG_NOTE_HEIGHT","getPlayerCanvas","drawingData","pixelsOverRatio","paddingHorizontal","paddedHeight","paddingVertical","baseX","baseY","playerIndex","calculateData","songBeatLength","minPitch","maxPitch","currentSection","playerCanvas","sectionEndBeat","timeSectionGap","maxTime","pitchStepHeight","simpleRoundRect","radius","actualWidth","actualRadius","moveTo","lineTo","quadraticCurveTo","roundRect","glass","save","clip","fillRect","restore","applyColor","strokeStyle","drawRawNote","noteType","shadowBlur","shadowColor","shadowOffsetX","shadowOffsetY","drawRawPlayerNote","SHADOW_PAD","smallNoteFragments","middle","bigNoteFragments","spriteMap","blueMiss","draw","padding","fragments","blueHit","bluePerfect","blueStarMiss","blueStarHit","blueStarPerfect","redMiss","redHit","redPerfect","redStarMiss","redStarHit","redStarPerfect","noteNormal","noteStar","noteFreestyle","noteRap","createCanvas","maxWidth","sprite","add","cachedCanvas","getContext","currentHeight","positions","pads","acc","entry","getSprite","fragment","drawSprite","destCtx","destX","destY","destW","destH","paddingWScale","paddingHScale","spriteData","finalWPadding","finalHPadding","imageSmoothingEnabled","drawImage","drawSpriteWithStartAndEnd","spriteName","startData","widthScale","endingsWidth","endingsSize","middleSize","getSpriteName","capitalize","drawNote","drawPlayerFrequencyTrace","lineJoin","drawPlayerNote","ParticleManager","particles","lastTick","getTimeDelta","timeShift","currentTick","particle","ParticleManager$1","baseTtl","ttlSpread","initialWidth","TriangleParticle","elapsedTicks","ExplodingNoteParticle","particleManager","lightColor","lighten","darkColor","darken","density","rand","finalColor","finalY","initialTtl","FadeoutNote","translate","velocity","WIDTH","WIDTH_SPREAD","easeOutQuart","RayParticle","seed","widthModifier","easing","mainRayWidth","mainRayHeight","INTERVAL_PX","VibratoParticle","deltaY","MAX_LOOKUP_RANGE","getPlayerNoteAtBeat","CanvasDrawing","verticalMargin","scaleFactor","pauseTime","pausedOn","shaders","onSectionEnd","drawFrame","resume","startTime","clearRect","drawPlayer","endTime","baseTimeout","finalTimeout","requestAnimationFrame","getDrawingData","setDistortionForce","displacements","calculateDisplacements","drawNotesToSing","drawSungNotes","drawFlare","sungNotes","currentPlayerNotes","lastPlayerNote","lastPlayerNoteEnd","beatsSinceLastHit","forcePercent","_c","getNoteCoords","displacement","finalX","getPreciseY","fadeoutNotes","explodeNotes","sungNotesStreak","sungNote","currLength","sungNoteLength","displacementRange","displacementX","displacementY","sectionShift","big","sectionStart","dx","dy","pitchY","fragShader","vertShader","MAX_RENDER_RESOLUTION_W","GameOverlay","playerSetups","videoPlayerRef","isPauseMenuVisible","drawer","overlayWidth","overlayHeight","overlayScaleFactor","offsetHeight","showMultipleLines","Screen","zIndex","GameCanvas","Scores","usePlayerSetDuration","dur","Player","showControls","onCurrentTimeUpdate","onStatusChange","restartSong","pauseMenu","setPauseMenu","onStateChangeCallback","isPauseMenuAvailable","openPauseMenu","closePauseMenu","togglePauseMenu","previousStatus","wasJustPaused","Overlay","PlayerContainer","shiftGap","gapShift","shiftVideoGap","setBpm","applyChanges","changes","trackIndex","changeList","applyTrackNames","playerWidth","playerHeight","EditSong","setGapShift","videoGapShift","setVideoGapShift","overrideBpm","setOverrideBpm","setEffectsEnabled","setTrackNames","newSong","processed","cloneDeep","newShift","HelpText","newNames","SyncLyricsToVideo","SHARE_SONGS_KEY","useShareSongs","shareSong","ShareSongsModal","shareSongs","setShareSongs","handleClose","handleAgree","agreed","Dialog","DialogTitle","DialogContent","DialogContentText","DialogActions","steps","Convert","isEdit","songs","currentStep","setCurrentStep","basicData","setBasicData","authorAndVid","setAuthorAndVid","metadataEntity","setMetadataEntity","editedSong","setEditedSong","conversionResult","possibleDuplicate","addedSong","property","isBasicInfoCompleted","isAuthorAndVidCompleted","isNextStepAvailable","StyledEngineProvider","marginBottom","Link","Stepper","Step","StepButton","Alert","AlertTitle","justifyContent","align","fixVideoGap","processSong","useSong","loadedSong","Edit","useLanguageList","langs","lang","langId","count","languages","MIN_SONGS_COUNT","ExcludeLanguagesView","closeText","excludedLanguages","setExcludedLanguages","availableLanguages","languageList","otherSongCount","songCount","toggleLanguage","languageNames","preferredLanguages","toExclude","areAllLanguagesExcluded","LanguageListContainer","excluded","LanguageEntry","CheckBoxOutlineBlank","CheckBox","LanguageName","LanguageFlagBackground","Disclaimer","NextButtonContainer","CountUp","filteringFunctions","excludeLanguages","songLang","cleanSearch","duet","yearBefore","yearAfter","updatedAfter","after","dateAfter","applyFilters","appliedFilters","filters","useLanguageFilter","useSongListFilter","setFilters","deferredFilters","useDeferredValue","prefilteredList","filteredList","filtersData","available","allSongs","useSongList","groupedSongList","groups","newSongs","firstCharacter","isFinite","group","MAX_REMEMBERED_SONGS_COUNT","selectRandomSong","previouslySelectedSongs","maxRememberedCount","possibleOptions","useTwoDimensionalNavigation","itemsPerRow","cursorPosition","setCursorPosition","songIndexMatrix","chunk","songGroupMatrix","previousMatrix","isAtLastColumn","moveToSong","columns","positionToValue","matrix","def","row","positionToSongIndex","positionToGroup","previousFocusedSong","currentFocusedSong","moveCursor","newX","newY","maxXInRow","focusedSong","focusedGroup","useSongSelectionKeyboardNavigation","groupedSongs","onEnter","songsPerRow","showPlaylistsState","setShowPlaylistsState","previousPlaylistsState","arePlaylistsVisible","leavingKey","isAtFirstColumn","blockBack","setBlockBack","useLayoutEffect","navigateToGroup","currentGroup","nextGroupIndex","trailing","navigateVertically","repeat","currentlySelectedGroupIndex","navigateHorizontally","ignoreFilters","randomlySelectedSongs","randomSong","closePlaylist","previousShowFilters","enteringKey","useSongSelection","preselectedSong","keyboardControl","setKeyboardControl","handleKeyboardControl","showFilters","setShowFilters","preselected","setPreselected","preselectedSongIndex","firstNewSongIndex","songPreview","usePlaylists","songLanguages","addDays","playlist","Playlists","playlists","Playlist","QuickSearch","onSongFiltered","searchInput","isFocused","setIsFocused","onLeave","enableOnTags","focusSearch","searchLength","FilterItem","large","SHOW_TIP_TIMEOUT_MS","SelectRandomTip","SKIPPED_ORIGINS","SongFlag","isLangArtistOrigin","useSongStats","setStats","setSongStats","useEditScore","singId","newScores","previousScore","newData","FinalSongCard","handleClick","onClickCallback","SongCardContainer","SongCardBackground","backgroundImage","SongInfo","SongCardStatsIndicator","MultiTrackIndicator","PeopleAltIcon","SongListEntryDetailsArtist","SongListEntryDetailsTitle","ExpandedData","SongAuthor","SongListEntryStats","SongListEntryDetails","lastPlayed","playedToday","SongStatIndicator","gameModeNames","difficultyNames","useSetGameMode","useSetTolerance","GameSettings","onNextStep","onExitKeyboardControl","rememberedMode","setMode","handleNextButton","changeMode","changeTolerance","GSSwitcher","ModeDescription","PlayButton","NoiseDetection","isBuiltIn","measures","handleMeasure","noiseDetected","setNoiseDetected","noDetection","detection","avgNoDetectionVolume","avgDetectionVolume","isNoisy","NoiseWarningContainer","SinglePlayer","PlayerName","MicChecksContainer","placeholder","onBlur","autocompleteMenu","isInputFocused","setIsInputFocused","focusedOption","setFocusedOption","filteredOptions","option","handleKeyDown","scrollIntoView","behavior","block","handleBlur","AutocompleteMenu","AutocompleteMenuitem","getTrackName","multipleTracks","inputTouched","setInputTouched","nameRef","togglePlayerTrack","onNameChange","currentName","Track","PlayerSettings","initialisePlayerSetup","playerSetup","setPlayerSetup","gameEvents","playerList","updatePlayer","newSetup","showModal","setShowModal","startSong","areInputsConfigured","PlayerSettingContainer","PlayerSettingTitle","SongSettings","setStep","onSongStepFinish","finalSetup","viewTransitionName","GameConfiguration","getViewportSize","clientWidth","visualViewport","useViewportSize","windowSize","setWindowSize","handleResize","PREVIEW_LENGTH","SongPreviewComponent","focusEffect","showVideo","setShowVideo","windowWidth","windowHeight","undebounced","startSeconds","endSeconds","videoWidth","videoHeight","finalHeight","SongBPMIndicator","SongPreviewContainer","Video","Content","_ref2","BaseSongPreviewContainer","animationDuration","show","BaseSongBPMIndicator","useTheme","mounts","useBlockScroll","classList","documentElement","focusMultiplier","MAX_SONGS_PER_ROW","SongSelection","onSongSelected","previewTop","previewLeft","previewWidth","previewHeight","setPositions","onRemoteSearch","previouslyFocusedGroup","previouslyFocusedSong","previousSong","offsetTop","inline","offsetLeft","offsetWidth","expandSong","LoaderContainer","SongListContainer","NoSongsFound","SongPreview","SongsGroupContainer","SongsGroupHeader","SongsGroup","SongListEntry","AddSongs","highlight","dim","SingASong","languageSelection","setLanguageSelection","useFullscreen","sleep","AUTOSTART_TIMEOUT_S","WaitForReadiness","areAllPlayersReady","setAreAllPlayersReady","confirmedPlayers","setConfirmedPlayers","allInputsReady","inputsReady","minTimeElapsed","maxTimeElapsed","race","paused","playerStatuses","confirmed","WaitingForReady","PlayerList","PlayerEntry","ConfirmStatus","CheckCircleOutline","TimeoutMessage","MAX_SECTION_PAUSE_MS","getSingableBeats","segmentSections","noteSections","segments","lastSegment","lastSectionEnd","calculateAmplitude","sums","shiftSolution","takeFromLeft","pos","pop","takeFromRight","ceil","arrSum","arr","generatePlayerChanges","currentBuffer","idealSize","CHANGES_COUNT","segmentSingableBeatsCount","bufferSum","currentAmplitude","candidates","candidatesAmplitudes","minimalAmplitude","minimalAmplitudeIndex","GameTip","as","randomValue","CameraRoll","videoSrc","setVideoSrc","playbackRate","SongPage","FocusedSongContainer","BackgroundImage","ContentLayer","FocusedSongData","SongTitle","SongArtist","SongCreator","BaseBackgroundImage","ContentElement","MAX_POINTS_ANIM_LENGTH","MIN_POINTS_ANIM_LENGTH","PlayerScoreView","highestScore","highScores","useColors","revealHighScore","setAnimDone","playerScore","detailedScore","isHighScore","playerName","singSetupId","ScoreTextPlayer","ScoreTextScore","HighScoreBadge","win","highscore","ResultsView","isCoop","finalPlayers","finishedAnims","setFinishedAnims","isAnimDone","anim","playerScores","ScoresContainer","which","SongSelectionButton","StyledPhotoRoll","useRecentPlayerNames","HighScoreRename","setNewName","HighScoresView","editScore","ScoreContainer","ScorePosition","ScorePlayerName","ScoreScore","ScoreDate","isCurrentSing","PostGameView","onClickSongSelection","PostGameTip","useHighScores","singleScore","PostGame","Singing","returnToSongSelection","isEnded","setIsEnded","isOverlayVisible","setIsOverlayVisible","setPlayerState","isTransitionTimeout","setIsTransitionTimeout","BackgroundContainer","BaseOverlay","Game","setPreselectedSong","resetKey","setResetKey","handleSelect","Jukebox","currentlyPlaying","setCurrentlyPlaying","shuffledList","setShuffledList","shuffle","playNext","navigateUrl","SkipSongButton","PlayThisSongButton","SelectInput","ErrorFallback","resetError","origin","clear","GameScreens","GetSongsBPMs","bpms","VITE_APP_GET_SONG_BPM_API_TOKEN","getSongBPMData","ExcludeLanguages","Tile","Image","AnimatedTile","previousVideoId","usePreviousDistinct","TileAnimated","BaseTile","minTime","RandomTile","videoIds","setVideoId","setTime","isMobileDevice","isMobile","cols","rows","songStats","LogoIcon","screenshot1","screenshot2","LandingPage","LogoContainer","Stats","StatSegment","StatsDescription","StatText","StatSubText","Typewriter","strings","artists","autoStart","ManageSongs","SuggestMobilePhone","setPhoneMode","QuickSetup","matchMedia","matches","fullscreenElement","SuggestMobileMode","RemoteMicSettings","defaultPermission","setDefaultPermission","forceUpdate","useUpdate","EntryLabel","RemoteMicPing","DevicePing","FBEmbedCode","show_posts","small_header","adapt_container_width","hide_cover","show_facepile","appId","k","FacebookLink","setWidth","fbRef","node","__html","small","Welcome","BackgroundMusicCredit","FullscreenButton","isFullScreen","setIsFullScreen","IconButton","exitFullscreen","FullscreenExit","Fullscreen","QRCodeModal","Toolbar","isModalOpen","setIsModalOpen","ToolbarContainer","LazySongList","lazy","__vitePreload","App","setupPreference","createTheme","ThemeProvider","Global","ErrorBoundary","Router","Route","Redirect","Suspense","dsn","tracesSampleRate","environment","tunnel","VITE_APP_SENTRY_TUNNEL","api_host","loaded","ph","storedUser","identify","setUser","root","createRoot","render","ToastContainer","POSITION","BOTTOM_LEFT"],"sources":["../../src/utils/Listener.ts","../../src/Camera/CameraManager.ts","../../src/GameEvents/GameEvents.ts","../../src/Camera/eventListeners.ts","../../src/RemoteMic/Network/sendMessage.ts","../../src/RemoteMic/Network/utils.ts","../../src/RemoteMic/RemoteMicInput.ts","../../src/Scenes/Settings/SettingsState.ts","../../src/utils/storage.ts","../../src/RemoteMic/RemoteMicManager.ts","../../src/utils/clearString.ts","../../src/Songs/utils/getSongId.ts","../../src/Songs/utils/convertTxtToSong.ts","../../src/Songs/utils/isNotesSection.ts","../../src/Songs/utils/convertSongToTxt.ts","../../src/Stats/lastVisit.ts","../../src/Songs/utils/notesSelectors.ts","../../src/Songs/utils.ts","../../src/Songs/SongsService.ts","../../src/RemoteMic/Network/Server/NetworkServer.ts","../../src/utils/isE2E.ts","../../src/utils/peerJSOptions.ts","../../src/RemoteMic/Network/Server/Transport/PeerJSServer.ts","../../src/RemoteMic/Network/Server/Transport/WebSocketServer.ts","../../src/RemoteMic/Network/Server.ts","../../src/Scenes/Game/Singing/Input/DrawingTestInput.tsx","../../src/Scenes/Game/Singing/Input/DummyInput.tsx","../../src/Scenes/Game/Singing/Input/MicStrategies/Aubio.ts","../../src/UserMedia/userMediaService.ts","../../src/Scenes/Game/Singing/Input/MicInput.tsx","../../src/Scenes/Game/Singing/Input/RemoteMicInput.tsx","../../src/Players/utils.ts","../../src/Scenes/SelectInput/InputSources/DrawingTest.ts","../../src/Scenes/SelectInput/InputSources/Microphone.ts","../../src/Scenes/SelectInput/InputSources/Remote.ts","../../src/Scenes/Game/Singing/Input/InputManager.ts","../../src/consts.ts","../../src/utils/pitchToFrequency.ts","../../src/Scenes/Game/Singing/GameState/Helpers/calcDistance.tsx","../../src/Scenes/Game/Singing/GameState/Helpers/detectVibrato.ts","../../src/Scenes/Game/Singing/GameState/Helpers/appendFrequencyToPlayerNotes.ts","../../src/Scenes/Game/Singing/Helpers/getPlayerNoteDistance.ts","../../src/Scenes/Game/Singing/GameState/Helpers/calculateScore.ts","../../src/Scenes/Game/Singing/GameState/PlayerState.ts","../../src/Songs/utils/getSongBeatLength.ts","../../src/interfaces.ts","../../src/Scenes/Game/Singing/GameState/Helpers/getCurrentBeat.ts","../../src/Scenes/Game/Singing/GameState/GameState.ts","../../src/Scenes/SelectInput/InputSources/Dummy.ts","../../src/Scenes/SelectInput/InputSources/index.ts","../../src/Players/PlayersManager.ts","../../src/RemoteMic/eventListeners.tsx","../../src/Scenes/Game/eventListeners.ts","../../src/Songs/stats/common.ts","../../src/Songs/stats/index.ts","../../src/hooks/players/consts.ts","../../src/utils/isNonNull.ts","../../src/Stats/players.ts","../../src/Scenes/Game/Singing/Input/SimplifiedMic.tsx","../../src/RemoteMic/Network/Client/NetworkClient.ts","../../src/RemoteMic/Network/Client/Transport/PeerJSClient.ts","../../src/RemoteMic/Network/Client/Transport/WebSocketClient.ts","../../src/RemoteMic/Network/Client.ts","../../src/utils/exposeSingletons.ts","../../src/utils/isDev.ts","../../src/GameEvents/hooks.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/styles.ts","../../src/Elements/cssMixins.ts","../../src/hooks/useKeyboard.ts","../../src/Scenes/KeyboardHelp/HelpView.tsx","../../src/Scenes/KeyboardHelp/Context.tsx","../../src/Elements/LayoutWithBackground.tsx","../../src/Elements/NormalizeFontSize.tsx","../../src/Elements/MicIcon.tsx","../../src/Scenes/RemoteMic/BottomBar.tsx","../../src/Elements/Button.tsx","../../src/Elements/Menu.tsx","../../src/Elements/Modal.tsx","../../src/Scenes/RemoteMic/Components/ConfrimWifiModal.tsx","../../src/Elements/Switcher.tsx","../../src/Elements/Input.tsx","../../src/Scenes/RemoteMic/Panels/Microphone/Connect.tsx","../../src/hooks/useDebounce.ts","../../src/Scenes/RemoteMic/Panels/Microphone/RemoteSongSearch.tsx","../../src/Scenes/RemoteMic/Panels/Microphone/Keyboard.tsx","../../src/Scenes/RemoteMic/Components/PlayerChangeModal.tsx","../../src/Scenes/RemoteMic/Components/PlayerNumberCircle.tsx","../../src/Scenes/RemoteMic/Panels/Microphone/PlayerChange.tsx","../../src/Scenes/RemoteMic/hooks/usePermissions.ts","../../src/Scenes/RemoteMic/Panels/Microphone/VolumeIndicator.tsx","../../src/Scenes/RemoteMic/Panels/Microphone/MicPreview.tsx","../../src/Scenes/RemoteMic/Panels/Microphone/Ping.tsx","../../src/UserMedia/hooks.ts","../../src/utils/isOpera.ts","../../src/UserMedia/allow-mic.png","../../src/UserMedia/enable-mic-opera.png","../../src/UserMedia/enable-mic.png","../../src/UserMedia/UserMediaEnabled.tsx","../../src/Scenes/RemoteMic/Panels/Microphone.tsx","../../src/Scenes/RemoteMic/Panels/Microphone/ConfirmReadiness.tsx","../../src/Scenes/RemoteMic/Panels/RemoteSettings/InputLag.tsx","../../src/Scenes/RemoteMic/Panels/RemoteSettings/ManagePlayers.tsx","../../src/Scenes/RemoteMic/Panels/RemoteSettings.tsx","../../src/utils/languageNameToIsoCode.ts","../../src/Elements/Flag.tsx","../../src/Songs/hooks/useSongIndex.ts","../../src/Scenes/RemoteMic/Panels/RemoteSongList.tsx","../../src/Scenes/RemoteMic/RemoteMic.tsx","../../src/Elements/dotparty.gif","../../src/Elements/logo.gif","../../src/Elements/pride.png","../../src/Elements/Logo.tsx","../../src/utils/isChromium.ts","../../src/Elements/RecommendedBrowsers.tsx","../../src/Scenes/Welcome/GithubRibbon.tsx","../../src/Elements/MenuWithLogo.tsx","../../src/assets/376817__original_sound__impact-cinematic.wav","../../src/assets/421888__b-sean__retro.mp3","../../src/assets/60013__qubodup__whoosh.mp3","../../src/assets/Funk Cool Groove (No Copyright Music) By Anwar Amr.mp3","../../src/assets/menu_back.wav","../../src/assets/menu_enter.wav","../../src/assets/menu_navigate.wav","../../src/SoundManager.ts","../../src/hooks/useBackgroundMusic.ts","../../src/hooks/useKeyboardHelp.ts","../../src/hooks/useKeyboardNav.ts","../../src/utils/startViewTransition.ts","../../src/hooks/useSmoothNavigate.ts","../../src/Scenes/Settings/InputLag.tsx","../../src/Scenes/Settings/Settings.tsx","../../src/Scenes/Convert/Elements.tsx","../../src/Scenes/Convert/Steps/AuthorAndVid.tsx","../../src/Scenes/Convert/Steps/utils/fixDiacritics.ts","../../src/Scenes/Convert/Steps/utils/validateUltrastar.ts","../../src/Scenes/Convert/importUltrastarEsSong.ts","../../src/Scenes/Convert/Steps/BasicData.tsx","../../src/Scenes/Convert/Steps/SyncLyricsToVideo/Helpers/formatMs.tsx","../../src/Scenes/Convert/Steps/PreviewAndVolumeAdjustment.tsx","../../src/Scenes/Convert/Steps/SongMetadata.tsx","../../src/Scenes/Convert/Steps/SyncLyricsToVideo/Components/AdjustPlayback.tsx","../../src/Scenes/Game/Singing/Hooks/useCurrentSectionIndex.ts","../../src/Scenes/Convert/Steps/SyncLyricsToVideo/Components/EditSection.tsx","../../src/Scenes/Convert/Steps/SyncLyricsToVideo/Components/ListTracks.tsx","../../src/Scenes/Convert/calculateProperBpm.ts","../../src/Scenes/Game/Singing/GameState/Helpers/beatToMs.ts","../../src/Scenes/Convert/Steps/SyncLyricsToVideo/Components/ManipulateBpm.tsx","../../src/Scenes/Convert/Steps/SyncLyricsToVideo/Components/ShiftGap.tsx","../../src/Scenes/Convert/Steps/SyncLyricsToVideo/Components/ShiftVideoGap.tsx","../../src/Scenes/Convert/Steps/SyncLyricsToVideo/Helpers/normaliseSectionPaddings.ts","../../src/Scenes/Convert/Steps/SyncLyricsToVideo/Helpers/addHeadstart.ts","../../src/Scenes/Convert/Steps/SyncLyricsToVideo/Helpers/normaliseGap.ts","../../src/Scenes/Convert/Steps/SyncLyricsToVideo/Helpers/normaliseLyricSpaces.ts","../../src/hooks/usePlayerVolume.ts","../../src/hooks/useUnstuckYouTubePlayer.ts","../../src/Elements/VideoPlayer/Youtube.tsx","../../src/Elements/VideoPlayer/DirectVideo.tsx","../../src/Elements/VideoPlayer/dummy.mp4","../../src/Elements/VideoPlayer/Offline.tsx","../../src/Elements/VideoPlayer/index.tsx","../../src/hooks/usePrevious.ts","../../src/Elements/Menu/Heading.tsx","../../src/Scenes/SelectInput/SelectPreference.tsx","../../src/hooks/players/usePlayerMic.ts","../../src/Elements/VolumeIndicator.tsx","../../src/Scenes/ConnectRemoteMic/ConnectRemoteMic.tsx","../../src/Scenes/SelectInput/hooks/useMicrophoneList.ts","../../src/Scenes/SelectInput/hooks/usePlayerInput.ts","../../src/Scenes/SelectInput/hooks/usePlayerNumberPreset.ts","../../src/Scenes/SelectInput/hooks/useRemoteMicAutoselect.ts","../../src/utils/isWindows.ts","../../src/Scenes/SelectInput/Variants/Advanced.tsx","../../src/Scenes/SelectInput/MicCheck.tsx","../../src/Scenes/SelectInput/Variants/BuiltIn.tsx","../../src/Scenes/SelectInput/Variants/RemoteMics.tsx","../../src/Scenes/SelectInput/Variants/SingStarMics.tsx","../../src/Scenes/SelectInput/Variants/Skip.tsx","../../src/Scenes/SelectInput/SelectInputView.tsx","../../src/Scenes/SelectInput/SelectInputModal.tsx","../../src/Scenes/Game/Singing/GameOverlay/Components/PauseMenu.tsx","../../src/Songs/utils/getSongFirstNoteMs.ts","../../src/Songs/utils/getSkipIntroTime.ts","../../src/utils/songHasLongIntro.ts","../../src/Scenes/Game/Singing/GameOverlay/Components/SkipIntro.tsx","../../src/Scenes/Game/Singing/GameOverlay/Components/SkipOutro.tsx","../../src/Scenes/Game/Singing/GameOverlay/Components/DurationBar.tsx","../../src/Scenes/SingASong/SongSelection/SongSettings/MicCheck/Ping.tsx","../../src/Scenes/SingASong/SongSelection/SongSettings/MicCheck/Status.tsx","../../src/hooks/players/usePlayerMicStatus.ts","../../src/Scenes/Game/Singing/GameOverlay/Components/LyricsVolumeIndicator.tsx","../../src/Scenes/Game/Singing/GameOverlay/Components/Lyrics.tsx","../../src/Scenes/Game/Singing/GameOverlay/Components/ScoreText.tsx","../../src/Scenes/Game/Singing/GameOverlay/Drawing/Elements/utils/getNoteColor.ts","../../src/utils/randomValue.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/Elements/ray.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/Elements/debris.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/Particles/utils.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/Particles/SungTriangle.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/Shaders/Shaders.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/calculateData.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/Elements/roundRect.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/applyColor.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/Elements/Cache/Elements/note.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/Elements/Cache/Elements/playerNote.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/Elements/Cache/spriteMap.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/Elements/Cache/utils/createCanvas.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/Elements/Cache/cachedSprites.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/Elements/spriteWithStartAndEnd.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/Elements/note.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/Elements/playerFrequencyTrace.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/Elements/playerNote.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/ParticleManager.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/Particles/Triangle.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/Particles/ExplodingNote.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/Particles/FadeoutNote.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/Particles/Ray.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/Particles/Vibrato.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/CanvasDrawing.ts","../../src/Scenes/Game/Singing/GameOverlay/Drawing/Shaders/shader.frag?raw","../../src/Scenes/Game/Singing/GameOverlay/Drawing/Shaders/shader.vert?raw","../../src/Scenes/Game/Singing/GameOverlay/GameOverlay.tsx","../../src/Scenes/Game/Singing/Player.tsx","../../src/Scenes/Convert/Steps/SyncLyricsToVideo/EditSong.tsx","../../src/Scenes/Convert/Steps/SyncLyricsToVideo.tsx","../../src/Scenes/Edit/ShareSongsModal.tsx","../../src/Scenes/Convert/Convert.tsx","../../src/Scenes/Convert/Steps/SyncLyricsToVideo/Helpers/fixVideoGap.ts","../../src/Songs/hooks/useSong.ts","../../src/Scenes/Edit/Edit.tsx","../../src/Scenes/ExcludeLanguages/ExcludeLanguagesView.tsx","../../src/Scenes/SingASong/SongSelection/Hooks/useSongList.ts","../../src/Scenes/SingASong/SongSelection/Hooks/selectRandomSong.ts","../../src/Scenes/SingASong/SongSelection/Hooks/useSongSelectionKeyboardNavigation.ts","../../src/Scenes/SingASong/SongSelection/Hooks/useSongSelection.ts","../../src/Scenes/SingASong/SongSelection/Playlists.tsx","../../src/Scenes/SingASong/SongSelection/QuickSearch.tsx","../../src/Scenes/SingASong/SongSelection/SelectRandomTip.tsx","../../src/Elements/Flag/mapping.ts","../../src/Scenes/SingASong/SongSelection/SongCard/SongFlag.tsx","../../src/Songs/stats/hooks.ts","../../src/Scenes/SingASong/SongSelection/SongCard.tsx","../../src/Scenes/SingASong/SongSelection/SongSettings/GameSettings.tsx","../../src/Scenes/SingASong/SongSelection/SongSettings/MicCheck/NoiseDetection.tsx","../../src/Scenes/SingASong/SongSelection/SongSettings/MicCheck/SinglePlayer.tsx","../../src/Scenes/SingASong/SongSelection/SongSettings/MicCheck.tsx","../../src/Elements/Autocomplete.tsx","../../src/Scenes/SingASong/SongSelection/SongSettings/PlayerSettings/SinglePlayer.tsx","../../src/Scenes/SingASong/SongSelection/SongSettings/PlayerSettings.tsx","../../src/Scenes/SingASong/SongSelection/SongSettings/SongSettings.tsx","../../src/hooks/useViewportSize.ts","../../src/Scenes/SingASong/SongSelection/SongPreview.tsx","../../src/hooks/useBlockScroll.ts","../../src/Scenes/SingASong/SongSelection/SongSelection.tsx","../../src/Scenes/SingASong/SingASong.tsx","../../src/hooks/useFullscreen.ts","../../src/assets/459342__papaninkasettratat__cinematic-music-short.mp3","../../src/utils/sleep.ts","../../src/Scenes/Game/Singing/WaitForReadiness.tsx","../../src/Scenes/Game/Singing/Helpers/generatePlayerChanges.ts","../../src/Elements/GameTip.tsx","../../src/Scenes/Game/Singing/PostGame/Views/Results/CameraRoll.tsx","../../src/Scenes/Game/SongPage.tsx","../../src/Scenes/Game/Singing/PostGame/Views/Results/PlayerScore.tsx","../../src/Scenes/Game/Singing/PostGame/Views/Results.tsx","../../src/hooks/players/useRecentPlayerNames.ts","../../src/Scenes/Game/Singing/PostGame/Views/HighScoreRename.tsx","../../src/Scenes/Game/Singing/PostGame/Views/HighScores.tsx","../../src/Scenes/Game/Singing/PostGame/PostGameView.tsx","../../src/Scenes/Game/Singing/PostGame/PostGame.tsx","../../src/Scenes/Game/Singing/Singing.tsx","../../src/Scenes/Game/Game.tsx","../../src/Scenes/Jukebox/Jukebox.tsx","../../src/Scenes/SelectInput/SelectInput.tsx","../../src/Elements/ErrorFallback.tsx","../../src/styles.ts","../../src/Elements/GameScreens.tsx","../../src/Scenes/Edit/GetSongsBPMs.tsx","../../src/Scenes/ExcludeLanguages/ExcludeLanguages.tsx","../../src/Scenes/LandingPage/AnimatedTile.tsx","../../src/Scenes/LandingPage/Background.tsx","../../src/Scenes/LandingPage/LogoIcon.tsx","../../src/Scenes/LandingPage/screenshot1.webp","../../src/Scenes/LandingPage/screenshot2.webp","../../src/Scenes/LandingPage/LandingPage.tsx","../../src/Scenes/ManageSongs/ManageSongs.tsx","../../src/Scenes/QuickSetup/SuggestMobileMode.tsx","../../src/Scenes/QuickSetup/QuickSetup.tsx","../../src/Scenes/Settings/RemoteMicSettings.tsx","../../src/Scenes/Welcome/FacebookLink.tsx","../../src/Scenes/Welcome/Welcome.tsx","../../src/Toolbar/Fullscreen.tsx","../../src/Toolbar/QRCodeModal.tsx","../../src/Toolbar/Toolbar.tsx","../../src/App.tsx","../../src/main.tsx"],"sourcesContent":["type Callback<ARG extends Array<any>> = (...args: ARG) => void;\nexport default class Listener<ARG extends Array<any> = []> {\n  private listeners: Callback<ARG>[] = [];\n  protected onUpdate = (...args: ARG) => {\n    this.listeners.forEach((callback) => callback(...args));\n  };\n\n  public addListener = (listener: Callback<ARG>) => {\n    this.listeners.push(listener);\n\n    return () => {\n      this.removeListener(listener);\n    };\n  };\n\n  public removeListener = (listener: Callback<ARG>) => {\n    this.listeners = this.listeners.filter((callback) => callback !== listener);\n  };\n\n  public clearAllListeners = () => {\n    console.log('clearing all listeners');\n    this.listeners = [];\n  };\n}\n","import Listener from 'utils/Listener';\n\nconst CAMERA_GRANT_KEY = 'CAMERA_GRANT_KEY';\n\nconst storedGrant = localStorage.getItem(CAMERA_GRANT_KEY);\n\nclass CameraManager extends Listener<[boolean]> {\n  private canvas: HTMLCanvasElement;\n  private video: HTMLVideoElement;\n  private stream: MediaStream | null = null;\n  private recorder: MediaRecorder | null = null;\n  private videoData: Blob[] = [];\n\n  public constructor() {\n    super();\n    this.video = document.createElement('video');\n    this.video.width = 480;\n    this.video.height = this.video.width * (9 / 16);\n\n    this.canvas = document.createElement('canvas');\n    this.canvas.width = this.video.width;\n    this.canvas.height = this.video.height;\n  }\n\n  private permissionGranted: boolean | null = storedGrant !== null ? JSON.parse(storedGrant) : null;\n  public requestPermissions = async () => {\n    try {\n      this.stream = await navigator.mediaDevices.getUserMedia({ video: true });\n      this.permissionGranted = true;\n      await this.stopRecord();\n    } catch (e) {\n      this.permissionGranted = false;\n    }\n    localStorage.setItem(CAMERA_GRANT_KEY, JSON.stringify(this.permissionGranted));\n    this.onUpdate(this.permissionGranted);\n\n    return this.permissionGranted;\n  };\n\n  public disable = () => {\n    this.permissionGranted = false;\n    localStorage.setItem(CAMERA_GRANT_KEY, JSON.stringify(this.permissionGranted));\n    this.onUpdate(this.permissionGranted);\n  };\n\n  public startRecord = async () => {\n    if (!this.permissionGranted) return;\n    try {\n      this.stream = await navigator.mediaDevices.getUserMedia({ video: { frameRate: 2 } });\n\n      const settings = this.stream.getVideoTracks()[0].getSettings();\n\n      this.video.width = settings.width ?? this.video.width;\n      this.video.height = settings.height ?? this.video.height;\n      this.canvas.width = this.video.width;\n      this.canvas.height = this.video.height;\n      this.video.srcObject = this.stream;\n      await this.video.play();\n\n      this.recorder = new MediaRecorder(this.stream, { mimeType: 'video/webm' });\n\n      this.recorder.ondataavailable = (evt) => {\n        this.videoData.push(evt.data);\n      };\n\n      this.recorder.start();\n    } catch (e) {\n      console.warn(e);\n    }\n  };\n\n  public getVideo = () => {\n    const blob = new Blob(this.videoData, { type: 'video/webm' });\n\n    return URL.createObjectURL(blob);\n  };\n\n  public stopRecord = async () => {\n    if (!this.permissionGranted) return;\n    this.recorder?.stop();\n    this.stream?.getTracks().forEach((track) => track.stop());\n  };\n  public clearData = () => {\n    this.videoData.length = 0;\n  };\n\n  public restartRecord = async () => {\n    await this.stopRecord();\n    await this.clearData();\n    await this.startRecord();\n  };\n\n  public getPermissionStatus = () => this.permissionGranted;\n}\n\nexport default new CameraManager();\n","import { PlayerEntity, SelectedPlayerInput } from 'Players/PlayersManager';\nimport { transportErrorReason } from 'RemoteMic/Network/Client/NetworkClient';\nimport {\n  NetworkRemoteMicListMessage,\n  NetworkSetPermissionsMessage,\n  NetworkSubscribeMessage,\n  keyStrokes,\n} from 'RemoteMic/Network/messages';\nimport { HelpEntry } from 'Scenes/KeyboardHelp/Context';\nimport { SongStats } from 'Songs/stats/common';\nimport { SingSetup, Song, SongPreview } from 'interfaces';\nimport posthog from 'posthog-js';\n\nexport class GameEvent<T extends (...args: any[]) => void> {\n  protected subscribers: Array<T> = [];\n  public lastParams: Parameters<T> | null = null;\n\n  public subscribe = (callback: T, getLast = false) => {\n    this.unsubscribe(callback);\n    this.subscribers.push(callback);\n    if (getLast && this.lastParams !== null) {\n      callback(...this.lastParams);\n    }\n  };\n\n  public unsubscribe = (callback: T) => {\n    this.subscribers = this.subscribers.filter((cb) => cb !== callback);\n  };\n\n  public dispatch = (...args: Parameters<T>) => {\n    this.log && console.log('dispatch', this.name, ...args);\n    this.subscribers.forEach((callback) => callback(...args));\n    this.lastParams = args;\n\n    if (this.track) {\n      posthog.capture(this.name, this.track instanceof Function ? this.track(...args) : args);\n    }\n  };\n\n  public constructor(\n    private name: string,\n    private track: boolean | ((...args: Parameters<T>) => any) = false,\n    private log = true,\n  ) {}\n}\n\nexport const events = {\n  sectionChange: new GameEvent<(player: number, previousSectionIndex: number) => void>(\n    'sectionChange',\n    undefined,\n    false,\n  ),\n  // newPlayerNote: new GameEvent<(player: number, playerNote: PlayerNote) => void>('//', true),\n  // playerNoteUpdate: new GameEvent<(player: number, playerNote: PlayerNote) => void>('//', true),\n\n  playerAdded: new GameEvent<(playerNumber: number) => void>('playerAdded', false),\n  playerRemoved: new GameEvent<(player: PlayerEntity) => void>('playerRemoved', false),\n\n  songStarted: new GameEvent<(song: Song | SongPreview, singSetup: SingSetup) => void>('songStarted', false),\n  songEnded: new GameEvent<\n    (song: Song | SongPreview, singSetup: SingSetup, scores: Array<{ name: string; score: number }>) => void\n  >('songEnded', false),\n\n  remoteMicConnected: new GameEvent<(remoteMic: { id: string; name: string; silent: boolean }) => void>(\n    'remoteMicConnected',\n  ),\n  remoteMicDisconnected: new GameEvent<(remoteMic: { id: string; name: string }, silent: boolean) => void>(\n    'remoteMicDisconnected',\n  ),\n  playerNameChanged: new GameEvent<(playerNumber: number, oldName: string | undefined) => void>('playerNameChanged'),\n  playerInputChanged: new GameEvent<\n    (playerNumber: number, oldInput: SelectedPlayerInput | undefined, newInput: SelectedPlayerInput | undefined) => void\n  >('playerInputChanged', (player, oldI, newI) => ({ player, old: oldI?.source, new: newI?.source })),\n  inputListChanged: new GameEvent<(initial: boolean) => void>('inputListChanged'),\n\n  karaokeConnectionStatusChange: new GameEvent<\n    (status: 'connecting' | 'connected' | 'disconnected' | 'reconnecting' | 'error', e?: transportErrorReason) => void\n  >('karaokeConnectionStatusChange'),\n  remoteMicPlayerSet: new GameEvent<(playerNumber: number | null) => void>('remoteMicPlayerSet'),\n  remoteMicMonitoringStarted: new GameEvent('remoteMicMonitoringStarted'),\n  remoteMicMonitoringStopped: new GameEvent('remoteMicMonitoringStopped'),\n\n  micMonitoringStarted: new GameEvent('micMonitoringStarted'),\n  micMonitoringStopped: new GameEvent('micMonitoringStopped'),\n  playerChangeRequested: new GameEvent<(remoteMicId: string, newPlayerNumber: number | null) => void>(\n    'playerChangeRequested',\n    true,\n  ),\n\n  songStatStored: new GameEvent<(key: string, stats: SongStats) => void>('songStatStored'),\n  songScoreUpdated: new GameEvent<(key: string, stats: SongStats, newName: string) => void>(\n    'songScoreUpdated',\n    () => undefined,\n  ),\n\n  remoteMicSubscribed: new GameEvent<(id: string, channel: NetworkSubscribeMessage['channel']) => void>(\n    'remoteMicSubscribed',\n  ),\n  remoteKeyboardPressed: new GameEvent<(key: keyStrokes) => void>('remoteKeyboardPressed'),\n  remoteSongSearch: new GameEvent<(search: string) => void>('remoteSongSearch', true),\n  remoteMicListUpdated: new GameEvent<(list: NetworkRemoteMicListMessage['list']) => void>('remoteMicListUpdated'),\n  remoteKeyboardLayout: new GameEvent<(help: HelpEntry | undefined) => void>('remoteKeyboardLayout'),\n  remoteReadinessRequested: new GameEvent('remoteReadinessRequested'),\n  remoteMicPermissionsSet: new GameEvent<(level: NetworkSetPermissionsMessage['level']) => void>(\n    'remoteMicPermissionsSet',\n  ),\n  readinessConfirmed: new GameEvent<(deviceId: string) => void>('remoteReadinessConfirmed'),\n  minPlayerNumberChanged: new GameEvent<(previous: number, current: number) => void>('minPlayerNumberChanged'),\n};\n\nexport default events;\n","import CameraManager from 'Camera/CameraManager';\nimport events from 'GameEvents/GameEvents';\n\nevents.songStarted.subscribe(() => {\n  CameraManager.clearData();\n  CameraManager.startRecord();\n});\nevents.songEnded.subscribe(() => {\n  CameraManager.stopRecord();\n});\n","import { NetworkMessages } from 'RemoteMic/Network/messages';\nimport { SenderInterface } from 'RemoteMic/Network/Server/Transport/interface';\n\nfunction sendMessage<T extends NetworkMessages>(\n  connection: SenderInterface | null | undefined,\n  type: T['t'],\n  payload?: Omit<T, 't'>,\n) {\n  connection?.send({ t: type, ...payload } as NetworkMessages);\n}\n\nexport default sendMessage;\n","import * as msgpackr from 'msgpackr';\n\nexport function getPingTime() {\n  return Date.now();\n}\n\nexport const pack = <T>(data: T): Buffer => {\n  return msgpackr.pack(data);\n};\n\nexport const unpack = <T>(buffer: Uint8Array): T => {\n  return msgpackr.unpack(buffer);\n};\n","import { SenderInterface } from 'RemoteMic/Network/Server/Transport/interface';\nimport { NetworkMessages, NetworkSetPermissionsMessage } from 'RemoteMic/Network/messages';\nimport sendMessage from 'RemoteMic/Network/sendMessage';\nimport { getPingTime } from 'RemoteMic/Network/utils';\n\nclass RemoteMicInput {\n  private frequencies: number[] | number[][] = [0];\n  private volumes = [0];\n\n  private requestReadinessPromise: null | Promise<boolean> = null;\n\n  public constructor(private connection: SenderInterface) {}\n\n  getChannelsCount = () => 1;\n\n  getFrequencies = () => {\n    const freqs = this.frequencies;\n\n    if (Array.isArray(freqs[0])) {\n      this.frequencies = [freqs[0].at(-1)!];\n    }\n    return freqs;\n  };\n  getVolumes = () => this.volumes;\n\n  getInputLag = () => 200;\n\n  requestReadiness = () => {\n    console.log('requestReadiness');\n    if (!this.requestReadinessPromise) {\n      this.requestReadinessPromise = new Promise<boolean>((resolve) => {\n        const listener = (data: NetworkMessages) => {\n          if (data.t === 'confirm-readiness') {\n            resolve(true);\n            this.connection.off('data', listener);\n            this.requestReadinessPromise = null;\n          }\n        };\n\n        this.connection.on('data', listener);\n\n        sendMessage(this.connection, 'request-readiness');\n      });\n    }\n    return this.requestReadinessPromise!;\n  };\n  startMonitoring = async () => {\n    sendMessage(this.connection, 'start-monitor');\n\n    this.connection?.on('data', this.handleRTCData);\n  };\n\n  stopMonitoring = async () => {\n    sendMessage(this.connection, 'stop-monitor');\n\n    this.connection?.off('data', this.handleRTCData);\n  };\n\n  private handleRTCData = (data: NetworkMessages) => {\n    if (data.t === 'freq') {\n      this.frequencies = [data[0], data[0]];\n      this.volumes = [data[1], data[1]];\n    }\n  };\n}\n\nexport class RemoteMic {\n  private input: RemoteMicInput;\n  private pingTime: number = 9999;\n  private pingInterval: ReturnType<typeof setTimeout> | null = null;\n  constructor(public id: string, public name: string, public connection: SenderInterface) {\n    this.input = new RemoteMicInput(connection);\n\n    this.pingClient();\n  }\n\n  public getInput = () => this.input;\n\n  public setPlayerNumber = (playerNumber: number | null) => {\n    sendMessage(this.connection, 'set-player-number', { playerNumber });\n  };\n\n  public onDisconnect = () => {\n    if (this.pingInterval !== null) {\n      clearInterval(this.pingInterval);\n    }\n  };\n\n  public setPermission = (level: NetworkSetPermissionsMessage['level']) => {\n    sendMessage<NetworkSetPermissionsMessage>(this.connection, 'set-permissions', { level });\n  };\n\n  private isPinging = false;\n  private latency: number = 9999;\n\n  public onPong = () => {\n    this.latency = getPingTime() - this.pingTime;\n    this.isPinging = false;\n\n    this.pingClient();\n  };\n\n  private pingClient = () => {\n    this.pingInterval = setTimeout(() => {\n      this.pingTime = getPingTime();\n      this.isPinging = true;\n      sendMessage(this.connection, 'ping');\n    }, 1000);\n  };\n\n  public getLatency = () => (this.isPinging ? getPingTime() - this.pingTime : this.latency);\n\n  public getPingTime = () => this.pingTime;\n}\n","import { milliseconds } from 'interfaces';\nimport { useEffect, useState } from 'react';\nimport { ValuesType } from 'utility-types';\n\nclass Setting<T> {\n  private value: T | undefined = undefined;\n\n  private listeners: Array<(newValue: T) => void> = [];\n  public constructor(\n    private name: string,\n    private defaultValue: T,\n    private driver: 'localStorage' | 'sessionStorage' = 'localStorage',\n  ) {}\n\n  public get = (): T => {\n    if (this.value === undefined) {\n      this.value = JSON.parse(window[this.driver].getItem(`settings-${this.name}`)!) ?? this.defaultValue;\n    }\n    return this.value as T;\n  };\n\n  public set = (newValue: T) => {\n    this.value = newValue;\n\n    window[this.driver].setItem(`settings-${this.name}`, JSON.stringify(newValue));\n    this.listeners.forEach((listener) => listener(newValue));\n  };\n\n  public addListener = (newListener: (newValue: T) => void) => {\n    this.listeners.push(newListener);\n\n    return () => {\n      this.listeners = this.listeners.filter((listener) => listener !== newListener);\n    };\n  };\n}\n\nexport const GraphicsLevel = ['high', 'low'] as const;\nconst GRAPHICS_LEVEL_KEY = 'graphics-level';\nexport const GraphicSetting = new Setting<ValuesType<typeof GraphicsLevel>>(GRAPHICS_LEVEL_KEY, GraphicsLevel[0]);\n\nexport const MicSetupPreference = [null, 'skip', 'remoteMics', 'mics', 'advanced', 'built-in'] as const;\nconst MIC_SETUP_PREFERENCE_KEY = 'mic-setup-preference';\nexport const MicSetupPreferenceSetting = new Setting<ValuesType<typeof MicSetupPreference>>(\n  MIC_SETUP_PREFERENCE_KEY,\n  MicSetupPreference[0],\n  'sessionStorage',\n);\n\nexport const FpsCount = [60, 30] as const;\nexport const FPSCountSetting = new Setting<ValuesType<typeof FpsCount>>('fps-count', FpsCount[0]);\n\nexport const ExcludedLanguagesSetting = new Setting<string[] | null>('EXCLUDED_LANGUAGES_KEY_V2', null);\n\nexport const MobilePhoneModeSetting = new Setting<boolean | null>('MOBILE_PHONE_MODE_KEY', null);\n\nexport const InputLagSetting = new Setting<milliseconds>('INPUT_LAG', 0);\n\nexport const RemoteMicPermissions = ['write', 'read'] as const;\nexport const DefaultRemoteMicPermission = new Setting<ValuesType<typeof RemoteMicPermissions>>(\n  'DefaultRemoteMicPermission',\n  'write',\n);\n\nexport const BackgroundMusic = ['New', 'Classic'] as const;\nexport const BackgroundMusicSetting = new Setting<ValuesType<typeof BackgroundMusic>>(\n  'background-music',\n  BackgroundMusic[0],\n);\n\nexport function useSettingValue<T>(value: Setting<T>) {\n  const [currentValue, setCurrentValue] = useState(value.get());\n\n  useEffect(() => {\n    return value.addListener(setCurrentValue);\n  }, [value]);\n\n  return [currentValue, value.set] as const;\n}\n","const abstractStorage = (type: typeof sessionStorage | typeof localStorage) => ({\n  storeValue: <T>(key: string, value: T) => {\n    type.setItem(key, JSON.stringify(value));\n  },\n  getValue: <T = any>(key: string): T | null => {\n    const val = type.getItem(key);\n\n    if (val === null) {\n      return null;\n    }\n\n    return JSON.parse(val);\n  },\n});\n\nconst storage = {\n  ...abstractStorage(localStorage),\n  session: abstractStorage(sessionStorage),\n};\n\nexport default storage;\n","import events from 'GameEvents/GameEvents';\nimport { SenderInterface } from 'RemoteMic/Network/Server/Transport/interface';\nimport { NetworkMessages, NetworkSetPermissionsMessage, NetworkSubscribeMessage } from 'RemoteMic/Network/messages';\nimport { RemoteMic } from 'RemoteMic/RemoteMicInput';\nimport { DefaultRemoteMicPermission } from 'Scenes/Settings/SettingsState';\nimport Listener from 'utils/Listener';\nimport storage from 'utils/storage';\n\nconst RememberedAccessesKey = 'RememberedAccessesKey';\nconst RememberedSubscriptionsKey = 'rememberedSubscriptionsKey';\ntype subscriptionChannels = NetworkSubscribeMessage['channel'];\n\nclass RemoteMicManager extends Listener<[string, NetworkSetPermissionsMessage['level']]> {\n  private remoteMics: RemoteMic[] = [];\n  private micAccessMap: Record<string, NetworkSetPermissionsMessage['level']> =\n    storage.getValue(RememberedAccessesKey) ?? {};\n\n  private subscriptions: Record<subscriptionChannels, string[]> = storage.session.getValue(\n    RememberedSubscriptionsKey,\n  ) ?? { 'remote-mics': [] };\n\n  public addRemoteMic = (id: string, name: string, connection: SenderInterface, silent: boolean) => {\n    this.remoteMics = this.remoteMics.filter((remoteMic) => remoteMic.id !== id);\n    this.remoteMics = [...this.remoteMics, new RemoteMic(id, name, connection)];\n    this.setPermission(id, this.getPermission(id));\n\n    events.remoteMicConnected.dispatch({ id, name, silent });\n  };\n\n  public removeRemoteMic = (id: string, silent = false) => {\n    const remoteMic = this.remoteMics.find((remoteMic) => remoteMic.id === id);\n    this.remoteMics = this.remoteMics.filter((remoteMic) => remoteMic.id !== id);\n    if (remoteMic) {\n      remoteMic.onDisconnect();\n      events.remoteMicDisconnected.dispatch(remoteMic, silent);\n    }\n  };\n\n  public getRemoteMics = () => this.remoteMics;\n\n  public getRemoteMicById = (id: string) => this.remoteMics.find((remoteMic) => remoteMic.id === id);\n\n  public broadcast = (event: NetworkMessages) => {\n    this.getRemoteMics().forEach((remoteMic) => remoteMic.connection.send(event));\n  };\n\n  public broadcastToChannel = (channel: subscriptionChannels, event: NetworkMessages) => {\n    this.subscriptions[channel].forEach((id) => this.getRemoteMicById(id)?.connection.send(event));\n  };\n\n  public getPermission = (id: string) => this.micAccessMap[id] ?? DefaultRemoteMicPermission.get();\n\n  public setPermission = (id: string, permission: NetworkSetPermissionsMessage['level']) => {\n    this.getRemoteMicById(id)?.setPermission(permission);\n\n    this.micAccessMap[id] = permission;\n\n    storage.storeValue(RememberedAccessesKey, this.micAccessMap);\n    this.onUpdate(id, permission);\n  };\n\n  public addSubscription = (id: string, channel: subscriptionChannels) => {\n    this.subscriptions[channel] = [...new Set([...this.subscriptions[channel], id])];\n    storage.session.storeValue(RememberedSubscriptionsKey, this.subscriptions);\n    events.remoteMicSubscribed.dispatch(id, channel);\n  };\n\n  public removeSubscription = (id: string, channel: subscriptionChannels) => {\n    this.subscriptions[channel] = this.subscriptions[channel]?.filter((remoteMicId) => remoteMicId !== id) ?? [];\n    storage.session.storeValue(RememberedSubscriptionsKey, this.subscriptions);\n  };\n}\n\nexport default new RemoteMicManager();\n","import latinize from 'latinize';\n\nconst ALPHANUMERIC_REGEX = /[^0-9a-z]/gi;\n\nexport default function clearString(str: string) {\n  return removeAccents(str).toLowerCase().normalize('NFKD').replace(ALPHANUMERIC_REGEX, '');\n}\nexport function removeAccents(str: string) {\n  return latinize(str);\n}\n","import { Song, SongPreview } from 'interfaces';\nimport { removeAccents } from '../../utils/clearString';\n\nexport default function getSongId(song: Pick<Song | SongPreview, 'artist' | 'title'> & { id?: string }) {\n  return song.id\n    ? song.id\n    : removeAccents(`${song?.artist}-${song?.title}`)\n        .toLowerCase()\n        /// remove non-alphanumeric characters and replace spaces with dashes\n        .replace(/[^a-z0-9\\s-]/g, '')\n        .replace(/\\s+/g, '-')\n        /// remove trailing dashes  &  remove dashes from the start\n        .replace(/-+$/, '')\n        .replace(/^-+/, '')\n        .replace(/-+/g, '-');\n}\n","import { ExtractOptional, NotesSection, Section, Song } from 'interfaces';\nimport { ValuesType } from 'utility-types';\nimport getSongId from './getSongId';\n\nexport const typesMap = {\n  R: 'rap',\n  F: 'freestyle',\n  '*': 'star',\n  ':': 'normal',\n} as const;\n\nexport const txtTypesMap: Record<ValuesType<typeof typesMap>, keyof typeof typesMap> = {\n  rap: 'R',\n  freestyle: 'F',\n  star: '*',\n  normal: ':',\n};\n\nexport type SongTXTKeys =\n  | 'ID'\n  | 'TRACKNAMES'\n  | 'YEAR'\n  | 'LASTUPDATE'\n  | 'EDITION'\n  | 'GENRE'\n  | 'LANGUAGE'\n  | 'VIDEOGAP'\n  | 'REALBPM'\n  | 'PREVIEWSTART'\n  | 'PREVIEWEND'\n  | 'VOLUME'\n  | 'CREATOR'\n  | 'CREATORURL'\n  | 'SOURCEURL'\n  | 'TITLE'\n  | 'ARTIST'\n  | 'ARTISTORIGIN'\n  | 'BPM'\n  | 'GAP'\n  | 'VIDEOID';\n\nfunction getPropertyValueFromTxt(txt: string, key: SongTXTKeys, type?: 'string'): string | undefined;\nfunction getPropertyValueFromTxt(txt: string, key: SongTXTKeys, type?: 'array'): string[] | undefined;\nfunction getPropertyValueFromTxt(txt: string, key: SongTXTKeys, type?: 'number'): number | undefined;\nfunction getPropertyValueFromTxt(txt: string, key: SongTXTKeys, type: 'string' | 'number' | 'array' = 'string') {\n  const regex = new RegExp(`#${key}\\\\:(.*)`);\n\n  const value = txt.match(regex)?.[1];\n  if (value === undefined) return undefined;\n  if (type === 'number') {\n    return Number(value.replace(',', '.')) ?? 0;\n  } else if (type === 'array') {\n    const vals = value.split(', ');\n\n    return vals.length > 1 ? vals : value;\n  }\n  return value;\n}\n\nconst LINE_BREAK_RELATIVE_REGEXP = /- -?\\d+ -?\\d+/;\n\nexport function getVideoId(url: string) {\n  try {\n    const linkUrl = new URL(url);\n    return linkUrl.searchParams.get('v') || false;\n  } catch (e: any) {\n    return false;\n  }\n}\nfunction safeJsonParse<T extends any, DV extends any = T>(str: any, defaultValue: DV): T | DV {\n  try {\n    return JSON.parse(str);\n  } catch (e) {\n    return defaultValue;\n  }\n}\n\nexport default function convertTxtToSong(\n  text: string,\n  videoLink?: string,\n  author?: string,\n  authorUrl?: string,\n  sourceUrl?: string,\n): Song {\n  const trackNames: string[] = safeJsonParse<string[]>(getPropertyValueFromTxt(text, 'TRACKNAMES'), []);\n\n  const additionalData = {\n    year: getPropertyValueFromTxt(text, 'YEAR'),\n    artistOrigin: getPropertyValueFromTxt(text, 'ARTISTORIGIN'),\n    lastUpdate: getPropertyValueFromTxt(text, 'LASTUPDATE'),\n    edition: getPropertyValueFromTxt(text, 'EDITION'),\n    genre: getPropertyValueFromTxt(text, 'GENRE'),\n    videoGap: getPropertyValueFromTxt(text, 'VIDEOGAP', 'number'),\n    realBpm: getPropertyValueFromTxt(text, 'REALBPM', 'number'),\n    previewStart: getPropertyValueFromTxt(text, 'PREVIEWSTART', 'number'),\n    previewEnd: getPropertyValueFromTxt(text, 'PREVIEWEND', 'number'),\n    volume: getPropertyValueFromTxt(text, 'VOLUME', 'number'),\n    author: getPropertyValueFromTxt(text, 'CREATOR') ?? author,\n    authorUrl: getPropertyValueFromTxt(text, 'CREATORURL') ?? authorUrl,\n    sourceUrl: getPropertyValueFromTxt(text, 'SOURCEURL') ?? sourceUrl,\n    // todo upgrade eslint and use `satisfies` instead of `as`\n  } as ExtractOptional<Song>;\n\n  if (additionalData.videoGap) additionalData.videoGap = Math.floor(additionalData.videoGap);\n  const title = getPropertyValueFromTxt(text, 'TITLE') ?? '';\n  const artist = getPropertyValueFromTxt(text, 'ARTIST') ?? '';\n\n  const song: Song = {\n    id: getPropertyValueFromTxt(text, 'ID') ?? getSongId({ title, artist }),\n    title,\n    artist,\n    language: getPropertyValueFromTxt(text, 'LANGUAGE', 'array') ?? [],\n    bpm: Number(getPropertyValueFromTxt(text, 'BPM')?.replace(',', '.') ?? 0),\n    bar: 4,\n    gap: Number(getPropertyValueFromTxt(text, 'GAP')?.replace(',', '.') ?? 0),\n    video: getPropertyValueFromTxt(text, 'VIDEOID') ?? '',\n    ...additionalData,\n    tracks: [],\n  };\n\n  if (song.video === '' && videoLink) {\n    try {\n      const linkUrl = new URL(videoLink);\n      song.video = linkUrl.searchParams.get('v') || 'Invalid link';\n    } catch (e: any) {\n      song.video = `Invalid link: ${e.message}`;\n    }\n  }\n\n  let sections: Section[] = [];\n  let lastStart = 0;\n\n  text.split('\\n').forEach((line) => {\n    if (line.startsWith('#')) return;\n    const split = line.split(' ');\n\n    // Sometimes the txts are wrongly formatted and include breaks/notes that just overlap\n    // The assumption here is that tracks should start and end roughly similarly, so if a next\n    // track starts just as the previous ends, it's considered a wrong formatting issue rather\n    // than a new track\n    if (Number(split[1]) < lastStart * 0.75 && sections.length) {\n      // new track (song is a duet)\n      if (trackNames[song.tracks.length]) song.tracks.push({ sections, name: trackNames[song.tracks.length] });\n      else song.tracks.push({ sections });\n      sections = [];\n    }\n\n    if (LINE_BREAK_RELATIVE_REGEXP.test(line)) {\n      // \"Pause\" or relative line break\n      const [, start, end] = split;\n      sections.push({ start: Number(start), end: Number(end), type: 'pause' });\n      sections.push({ start: Number(end), type: 'notes', notes: [] });\n\n      lastStart = Number(end);\n    } else if (line.startsWith('-')) {\n      // new section\n      sections.push({ start: Number(line.split('-')[1].trim()), notes: [], type: 'notes' });\n    } else if (Object.keys(typesMap).includes(line[0])) {\n      if (sections.length === 0) {\n        sections = [{ start: 0, notes: [], type: 'notes' }];\n      }\n      // Note\n      const lastSection = sections[sections.length - 1];\n\n      const [type, start, length, pitch, ...lyrics] = split;\n\n      (lastSection as NotesSection).notes.push({\n        type: typesMap[type as 'R' | '*' | ':'] ?? 'normal',\n        start: Number(start),\n        length: Number(length),\n        pitch: Number(pitch),\n        lyrics: lyrics.join(' '),\n      });\n      lastStart = Number(split[1]);\n    }\n  });\n\n  if (trackNames[song.tracks.length]) song.tracks.push({ sections, name: trackNames[song.tracks.length] });\n  else song.tracks.push({ sections });\n\n  song.tracks = song.tracks.map((track) => ({\n    ...track,\n    // get rid of sections with no notes\n    sections: track.sections.filter((section) => section.type === 'pause' || section.notes.length),\n  }));\n\n  return song;\n}\n","import { NotesSection, Section } from 'interfaces';\n\nexport default function isNotesSection(section: Section | undefined | null): section is NotesSection {\n  return section?.type === 'notes' && !!section.notes.length;\n}\n","import { Note, Song } from 'interfaces';\nimport { SongTXTKeys, txtTypesMap } from './convertTxtToSong';\nimport isNotesSection from './isNotesSection';\n\nfunction toTxtValue(key: SongTXTKeys, value: string | string[] | number | undefined) {\n  if (value === undefined) return undefined;\n  return `#${key}:${\n    typeof value === 'number' ? value.toString(10).replace('.', ',') : Array.isArray(value) ? value.join(', ') : value\n  }`;\n}\n\nconst notesToText = (notes: Note[]) =>\n  notes.map((note) => `${txtTypesMap[note.type]} ${note.start} ${note.length} ${note.pitch} ${note.lyrics}`).join('\\n');\n\nexport default function convertSongToTxt(song: Song) {\n  const parsedValues: Record<keyof Omit<Song, 'tracks' | 'bar'>, string | undefined> = {\n    id: toTxtValue('ID', song.id),\n    artist: toTxtValue('ARTIST', song.artist),\n    artistOrigin: toTxtValue('ARTISTORIGIN', song.artistOrigin),\n    title: toTxtValue('TITLE', song.title),\n    author: toTxtValue('CREATOR', song.author),\n    authorUrl: toTxtValue('CREATORURL', song.authorUrl),\n    bpm: toTxtValue('BPM', song.bpm),\n    realBpm: toTxtValue('REALBPM', song.realBpm),\n    year: toTxtValue('YEAR', song.year),\n    sourceUrl: toTxtValue('SOURCEURL', song.sourceUrl),\n    previewStart: toTxtValue('PREVIEWSTART', song.previewStart),\n    previewEnd: toTxtValue('PREVIEWEND', song.previewEnd),\n    video: toTxtValue('VIDEOID', song.video),\n    videoGap: toTxtValue('VIDEOGAP', song.videoGap),\n    volume: toTxtValue('VOLUME', song.volume),\n    genre: toTxtValue('GENRE', song.genre),\n    language: toTxtValue('LANGUAGE', song.language),\n    lastUpdate: toTxtValue('LASTUPDATE', song.lastUpdate),\n    edition: toTxtValue('EDITION', song.edition),\n    gap: toTxtValue('GAP', song.gap),\n  };\n  const trackNames = song.tracks.map((track) => track.name ?? null);\n\n  const lines: string[] = [];\n  song.tracks\n    .map((track) => track.sections)\n    .forEach(([first, ...sections]) => {\n      lines.push(isNotesSection(first) ? notesToText(first.notes) : `- ${first.start} ${first.end}`);\n\n      sections.forEach((section) =>\n        lines.push(\n          isNotesSection(section)\n            ? `- ${section.start}\\n${notesToText(section.notes)}`\n            : `- ${section.start} ${section.end}`,\n        ),\n      );\n    });\n\n  return Object.values(parsedValues)\n    .concat(trackNames.filter(Boolean).length ? toTxtValue('TRACKNAMES', JSON.stringify(trackNames)) : [])\n    .concat(lines)\n    .concat('E')\n    .filter((value) => value !== undefined)\n    .join('\\n');\n}\n","const CURRENT_VISIT_KEY = 'CURRENT_VISIT_KEY';\nconst LAST_VISIT_KEY = 'LAST_VISIT_KEY';\n\nconst VISIT_TIMEOUT_MS = 3 * 60 * 60 * 1_000;\n\nconst currentTime = Date.now();\nconst currentVisit = Number(localStorage.getItem(CURRENT_VISIT_KEY) ?? currentTime);\n\n// One of the few ways to determine if user already visited the site before\n// Note that this is simulated in E2E tests - adjust them if you change this\nconst isFirstVisit = localStorage.getItem('posthog-user-id') === null;\n\n// If it's the first visit, don't show new songs\n// If the user visited the site before, show new songs added since the functionality was implemented\nconst defaultLastVisit = isFirstVisit ? currentTime : 1673642382501; // implementation time\nlet lastVisit = Number(localStorage.getItem(LAST_VISIT_KEY) ?? defaultLastVisit);\n\nif (isFirstVisit || currentTime - currentVisit > VISIT_TIMEOUT_MS) {\n  localStorage.setItem(LAST_VISIT_KEY, String(currentVisit));\n  lastVisit = currentVisit;\n}\nlocalStorage.setItem(CURRENT_VISIT_KEY, String(currentTime));\n\nexport { lastVisit };\n","import { NotesSection, Section } from 'interfaces';\nimport isNotesSection from './isNotesSection';\n\nexport const getFirstNoteFromSection = (section: NotesSection) => {\n  return section.notes[0];\n};\nexport const getFirstNoteStartFromSections = (sections: Section[]) => {\n  const firstNoteSection = sections.find(isNotesSection);\n\n  return firstNoteSection ? getFirstNoteFromSection(firstNoteSection).start : Infinity;\n};\nexport const getLastNoteEndFromSections = (sections: Section[]) => {\n  const notesSections = sections.filter(isNotesSection);\n  const lastSection = notesSections.at(-1);\n\n  return lastSection ? getLastNoteEnd(lastSection) : 0;\n};\n\nexport const getLastNoteEnd = (section: NotesSection) => {\n  const lastNote = section.notes.at(-1)!;\n\n  return lastNote.start + lastNote.length;\n};\n\nexport const getNoteAtBeat = (section: NotesSection, beat: number, tolerance = 0) => {\n  return section.notes.find((note) => note.start - tolerance <= beat && note.start + note.length + tolerance >= beat);\n};\n","import { Song, SongPreview } from '../interfaces';\nimport clearString from '../utils/clearString';\nimport getSongId from './utils/getSongId';\nimport { getFirstNoteStartFromSections } from './utils/notesSelectors';\n\nconst generateSearchString = (song: Pick<Song, 'title' | 'artist'>) => clearString(`${song.artist}${song.title}`);\n\nexport const getSongPreview = (songData: Song, local = false): SongPreview => ({\n  ...songData,\n  id: getSongId(songData),\n  tracksCount: songData.tracks.length,\n  tracks: songData.tracks.map(({ name, sections }) => ({\n    name,\n    start: getFirstNoteStartFromSections(sections),\n  })),\n  search: generateSearchString(songData),\n  local,\n});\n","import { captureException } from '@sentry/react';\nimport convertSongToTxt from 'Songs/utils/convertSongToTxt';\nimport convertTxtToSong from 'Songs/utils/convertTxtToSong';\nimport getSongId from 'Songs/utils/getSongId';\nimport { lastVisit } from 'Stats/lastVisit';\nimport { isAfter } from 'date-fns';\nimport { Song, SongPreview } from 'interfaces';\nimport localForage from 'localforage';\nimport { getSongPreview } from './utils';\n\nconst storage = localForage.createInstance({\n  name: 'songs_v2',\n});\n\nconst DELETED_SONGS_KEY = 'DELETED_SONGS_V2';\n\nconst legacyStorage = localForage.createInstance({\n  name: 'songs',\n});\nconst LEGACY_DELETED_SONGS_KEY = 'DELETED_SONGS';\n\nif (localStorage.getItem('MIGRATED_V1_SONGS') !== 'true') {\n  (async () => {\n    const legacyIndex = (await legacyStorage.keys()).filter((key) => key !== LEGACY_DELETED_SONGS_KEY);\n\n    legacyIndex.map(async (key) => {\n      try {\n        const songData = await legacyStorage.getItem<Song>(key);\n        // validate the song (if it is actual song and not some random data)\n        const song = convertTxtToSong(convertSongToTxt(songData!));\n\n        if (song) {\n          await storage.setItem(getSongId(song), { ...song, id: getSongId(song) });\n        }\n      } catch (e) {\n        captureException(e);\n        console.error(e);\n      }\n    });\n    localStorage.setItem('MIGRATED_V1_SONGS', 'true');\n  })();\n}\n\nclass SongsService {\n  private finalIndex: SongPreview[] | null = null;\n  private indexWithDeletedSongs: SongPreview[] | null = null;\n  public store = async (song: Song) => {\n    await storage.setItem(this.generateSongFile(song), { ...song, lastUpdate: new Date().toISOString() });\n    await this.reloadIndex();\n  };\n\n  public get = async (songId: string) => {\n    const localSong = await this.getLocal(songId);\n\n    if (!localSong) {\n      return await fetch(`./songs/${songId}.txt`)\n        .then((response) => response.text())\n        .then(convertTxtToSong);\n    }\n\n    return localSong;\n  };\n\n  public getIndex = async (includeDeleted = false): Promise<SongPreview[]> => {\n    if (this.finalIndex === null) {\n      await this.reloadIndex();\n    }\n\n    return includeDeleted ? this.indexWithDeletedSongs! : this.finalIndex!;\n  };\n\n  public getCurrentIndex = () => this.finalIndex;\n\n  public getDeletedSongsList = async () => {\n    const list = await storage.getItem<string[]>(DELETED_SONGS_KEY);\n\n    return list ?? [];\n  };\n\n  public generateSongFile = (song: Pick<Song | SongPreview, 'artist' | 'title'> & { id?: string }) => getSongId(song);\n\n  public reloadIndex = async () => {\n    const [defaultIndex, storageIndex, deletedSongs] = await Promise.all([\n      fetch('./songs/index.json').then((response) => response.json() as Promise<SongPreview[]>),\n      this.getLocalIndex(),\n      this.getDeletedSongsList(),\n    ]);\n    const lastVisitDate = new Date(lastVisit);\n\n    // Filter out local songs that were updated to default index\n    const storageIndexWithUpdatedSongs = storageIndex.filter((song) => {\n      const defaultSong = defaultIndex.find((localSong) => localSong.id === song.id);\n      if (!defaultSong) return true;\n      return isAfter(new Date(song.lastUpdate ?? 0), new Date(defaultSong.lastUpdate ?? 0));\n    });\n    const localSongs = storageIndexWithUpdatedSongs.map((song) => song.id);\n\n    storageIndex.forEach((song) => {\n      if (!localSongs.includes(song.id)) {\n        storage.removeItem(song.id);\n      }\n    });\n\n    this.indexWithDeletedSongs = [\n      ...storageIndexWithUpdatedSongs,\n      ...defaultIndex.filter((song) => !localSongs.includes(this.generateSongFile(song))),\n    ].map((song) => ({\n      ...song,\n      isNew: song.lastUpdate ? isAfter(new Date(song.lastUpdate), lastVisitDate) : false,\n      isDeleted: deletedSongs?.includes(this.generateSongFile(song)),\n    }));\n\n    this.indexWithDeletedSongs.sort((a, b) =>\n      `${a.artist} ${a.title}`.localeCompare(`${b.artist} ${b.title}`.toLowerCase()),\n    );\n\n    this.finalIndex = this.indexWithDeletedSongs.filter((song) => !song.isDeleted);\n  };\n\n  public deleteSong = async (songId: string) => {\n    await storage.removeItem(songId);\n\n    return this.reloadIndex();\n  };\n\n  public softDeleteSong = async (songId: string) => {\n    const deletedItems = await this.getDeletedSongsList();\n    await storage.setItem(DELETED_SONGS_KEY, [...new Set([...deletedItems, songId])]);\n    return this.reloadIndex();\n  };\n  public restoreSong = async (songId: string) => {\n    const deletedItems = await this.getDeletedSongsList();\n    await storage.setItem(\n      DELETED_SONGS_KEY,\n      deletedItems.filter((item) => item !== songId),\n    );\n    return this.reloadIndex();\n  };\n\n  private getLocal = async (songId: string) => storage.getItem<Song>(decodeURIComponent(songId));\n  public getLocalIndex = async () => {\n    const allSongs = await Promise.all((await this.getKeys()).map(this.getLocal));\n\n    return allSongs\n      .filter((song): song is Song => song !== null)\n      .map((song) => {\n        try {\n          return getSongPreview(song, true);\n        } catch (e) {\n          captureException(e);\n          console.error(e);\n          return null;\n        }\n      })\n      .filter((song): song is SongPreview => song !== null);\n  };\n\n  private getKeys = async () => {\n    const specialKeys = [DELETED_SONGS_KEY];\n\n    return (await storage.keys()).filter((key) => !specialKeys.includes(key));\n  };\n}\n\nexport default new SongsService();\n","import events from 'GameEvents/GameEvents';\nimport { ServerTransport } from 'RemoteMic/Network/Server/Transport/interface';\nimport { NetworkMessages } from 'RemoteMic/Network/messages';\nimport RemoteMicManager from 'RemoteMic/RemoteMicManager';\nimport { InputLagSetting } from 'Scenes/Settings/SettingsState';\nimport SongDao from 'Songs/SongsService';\nimport { v4 } from 'uuid';\n\nconst ROOM_ID_KEY = 'room_id_key';\n\nexport class NetworkServer {\n  private roomId = window.sessionStorage.getItem(ROOM_ID_KEY)!;\n  private started = false;\n  public transportName: string;\n\n  public constructor(private transport: ServerTransport) {\n    if (!this.roomId) {\n      this.roomId = v4();\n    }\n    this.transportName = transport.name;\n\n    window.addEventListener('beforeunload', () => {\n      RemoteMicManager.getRemoteMics().forEach((remoteMic) => remoteMic.connection.close());\n      this.transport?.disconnect();\n    });\n  }\n\n  public start = () => {\n    if (this.started) return;\n    this.started = true;\n    console.log('connection started', this.roomId);\n    window.sessionStorage.setItem(ROOM_ID_KEY, this.roomId);\n\n    this.transport.connect(\n      this.roomId,\n      () => {\n        this.transport.addListener((event, sender) => {\n          const type = event.t;\n          if (type === 'register') {\n            RemoteMicManager.addRemoteMic(event.id, event.name, sender, event.silent);\n          } else if (type === 'unregister') {\n            RemoteMicManager.removeRemoteMic(sender.peer, true);\n          } else if (type === 'subscribe-event') {\n            RemoteMicManager.addSubscription(sender.peer, event.channel);\n          } else if (type === 'unsubscribe-event') {\n            RemoteMicManager.removeSubscription(sender.peer, event.channel);\n          } else if (type === 'ping') {\n            sender.send({ t: 'pong' } as NetworkMessages);\n          } else if (type === 'pong') {\n            RemoteMicManager.getRemoteMicById(sender.peer)?.onPong();\n          } else if (type === 'request-songlist') {\n            Promise.all([SongDao.getLocalIndex(), SongDao.getDeletedSongsList()]).then(([custom, deleted]) => {\n              sender.send({\n                t: 'songlist',\n                custom: custom.map((song) => ({\n                  artist: song.artist,\n                  title: song.title,\n                  video: song.video,\n                  language: song.language,\n                })),\n                deleted,\n              });\n            });\n          } else if (RemoteMicManager.getPermission(sender.peer) === 'write') {\n            if (type === 'keystroke') {\n              events.remoteKeyboardPressed.dispatch(event.key);\n            } else if (type === 'search-song') {\n              events.remoteSongSearch.dispatch(event.search);\n            } else if (type === 'request-mic-select') {\n              events.playerChangeRequested.dispatch(event.id, event.playerNumber);\n            } else if (type === 'get-input-lag-request') {\n              sender.send({ t: 'get-input-lag-response', value: InputLagSetting.get() });\n            } else if (type === 'set-input-lag-request') {\n              InputLagSetting.set(event.value);\n              sender.send({ t: 'get-input-lag-response', value: InputLagSetting.get() });\n            }\n          }\n        });\n      },\n      () => {\n        this.started = false;\n      },\n    );\n  };\n\n  public getRoomId = () => this.roomId;\n}\n","export default function isE2E() {\n  return window.isE2ETests || window.location.search.includes('e2e-test');\n}\n","import { PeerJSOption } from 'peerjs';\nimport isE2E from 'utils/isE2E';\n\nconst e2eOverrides: PeerJSOption = isE2E()\n  ? {\n      host: 'localhost',\n      port: 3001,\n      path: '/',\n    }\n  : {};\n\nconst options: PeerJSOption = {\n  host: import.meta.env.VITE_APP_BACKEND_HOST,\n  path: '/peerjs',\n  ...e2eOverrides,\n  // debug: 3,\n};\n\nexport default options;\n","import { SenderInterface, ServerTransport, transportCloseReason } from 'RemoteMic/Network/Server/Transport/interface';\nimport { NetworkMessages } from 'RemoteMic/Network/messages';\nimport RemoteMicManager from 'RemoteMic/RemoteMicManager';\nimport { Peer } from 'peerjs';\nimport Listener from 'utils/Listener';\nimport peerJSOptions from 'utils/peerJSOptions';\n\nexport class PeerJSServerTransport extends Listener<[NetworkMessages, SenderInterface]> implements ServerTransport {\n  public readonly name = 'PeerJS';\n  private peer: Peer | null = null;\n\n  public connect(\n    roomId: string,\n    onConnect: () => void,\n    onClose: (reason: transportCloseReason, originalEvent: any) => void,\n  ) {\n    this.peer = new Peer(roomId, peerJSOptions);\n\n    this.peer.on('open', function (id) {\n      onConnect();\n      console.log('My peer ID is: ' + id);\n    });\n    this.peer.on('connection', (conn) => {\n      conn.on('data', (data: NetworkMessages) => {\n        this.onUpdate(data, conn);\n      });\n\n      conn.on('error', (data) => console.warn('error', data));\n\n      // iceStateChanged works - close/disconnected/error doesn't for some reason\n      // @ts-expect-error `iceStateChanged` is not included in TS definitions\n      conn.on('iceStateChanged', (state) => {\n        if (state === 'disconnected' || state === 'closed') {\n          this.onUpdate({ t: 'unregister' }, conn);\n        }\n      });\n\n      conn.on('close', () => {\n        RemoteMicManager.removeRemoteMic(conn.peer);\n      });\n    });\n  }\n\n  public disconnect = () => {\n    this.peer?.disconnect();\n  };\n}\n","import { SenderInterface, ServerTransport, transportCloseReason } from 'RemoteMic/Network/Server/Transport/interface';\nimport { NetworkMessages } from 'RemoteMic/Network/messages';\nimport { pack, unpack } from 'RemoteMic/Network/utils';\nimport Listener from 'utils/Listener';\n\nexport interface ForwardedMessage {\n  t: 'forward';\n  sender: string;\n  payload: NetworkMessages;\n}\n\ninterface WebsocketConnectedMessage {\n  t: 'connected';\n}\n\nexport type WebsocketMessage = ForwardedMessage | WebsocketConnectedMessage;\n\nexport const WEBSOCKETS_SERVER = import.meta.env.VITE_APP_WEBSOCKET_URL;\n\nexport class WebSocketServerTransport extends Listener<[NetworkMessages, SenderInterface]> implements ServerTransport {\n  public readonly name = 'WebSockets';\n  private connection: WebSocket | null = null;\n\n  public constructor(private pswd: string) {\n    super();\n  }\n\n  public connect(\n    roomId: string,\n    onConnect: () => void,\n    onClose: (reason: transportCloseReason, originalEvent: any) => void,\n  ) {\n    this.connection = new WebSocket(WEBSOCKETS_SERVER);\n    this.connection.binaryType = 'arraybuffer';\n    this.connection.onopen = () => {\n      this.connection?.send(pack({ t: 'register-room', id: roomId, pswd: this.pswd }));\n      onConnect();\n\n      this.connection?.addEventListener('message', (message) => {\n        const payload: WebsocketMessage = unpack(message.data);\n\n        // @ts-ignore\n        if (!['ping', 'pong', 'freq'].includes(payload?.payload?.t)) console.log('received', payload);\n\n        if (payload.t === 'forward') {\n          const { sender, payload: data } = payload;\n          const conn = new SenderWrapper(sender, this.connection!);\n\n          this.onUpdate(data, conn);\n        }\n      });\n    };\n  }\n\n  public disconnect = () => {\n    this.connection?.close();\n  };\n}\n\ntype callback = (data: any) => void;\n\nclass SenderWrapper implements SenderInterface {\n  constructor(public peer: string, private socket: WebSocket) {}\n\n  public send = (payload: NetworkMessages) => {\n    const data = { t: 'forward', recipients: [this.peer], payload };\n    if (!['ping', 'pong', 'freq'].includes(payload?.t)) console.log('sending', this.peer, payload);\n    this.socket.send(pack(data));\n  };\n\n  private callbacksMap: Map<callback, callback> = new Map();\n\n  public on = (event: string, callback: (data: any) => void) => {\n    if (event === 'data') {\n      this.callbacksMap.set(callback, (message) => {\n        const data: WebsocketMessage = unpack(message.data);\n        if (data.t === 'forward') {\n          const { sender, payload } = data;\n          if (sender === this.peer) {\n            callback(payload);\n          }\n        }\n      });\n      this.socket.addEventListener('message', this.callbacksMap.get(callback)!);\n    }\n  };\n\n  public off = (event: string, callback: (data: any) => void) => {\n    if (event === 'data') {\n      const actualCallback = this.callbacksMap.get(callback);\n      this.socket.removeEventListener('message', actualCallback!);\n      this.callbacksMap.delete(callback);\n    }\n  };\n\n  public close = () => {\n    this.socket.close();\n  };\n}\n","import { NetworkServer } from 'RemoteMic/Network/Server/NetworkServer';\nimport { PeerJSServerTransport } from 'RemoteMic/Network/Server/Transport/PeerJSServer';\nimport { WebSocketServerTransport } from 'RemoteMic/Network/Server/Transport/WebSocketServer';\n\nif (window.location.search.includes('pswd')) {\n  const urlParams = new URLSearchParams(window.location.search);\n  const pswd = urlParams.get('pswd');\n  if (pswd) {\n    window.sessionStorage.setItem('pswd', pswd);\n\n    urlParams.delete('pswd');\n    window.location.search = urlParams.toString();\n  }\n}\nconst pswd = window.sessionStorage.getItem('pswd');\n\nconst server = new NetworkServer(pswd ? new WebSocketServerTransport(pswd) : new PeerJSServerTransport());\n\nexport const isWebsockets = server.transportName === 'WebSockets';\nexport default server;\n","import InputInterface from './Interface';\n\nclass DrawingTestInput implements InputInterface {\n  private frequencies: [number, number] = [440, 410];\n  private volumes: [number, number] = [1, 1];\n\n  public startMonitoring = async () => {};\n\n  public getFrequencies = (deviceId?: string) => this.frequencies;\n  public getVolumes = (deviceId?: string) => this.volumes;\n\n  public stopMonitoring = async (deviceId?: string) => {};\n\n  public getInputLag = () => 0;\n  public getChannelsCount = () => 2;\n\n  public setFrequency = (channel: 0 | 1, value: number) => (this.frequencies[channel] = value);\n\n  public requestReadiness = () => Promise.resolve(true);\n\n  public getStatus = () => 'ok' as const;\n}\n\nexport default new DrawingTestInput();\n","import InputInterface from './Interface';\n\nclass DummyInput implements InputInterface {\n  private frequencies: [number, number] = [410, 210];\n  private volumes: [number, number] = [1, 1];\n  private timestamp = 0;\n  private interval: number | null = null;\n\n  private isMonitoring = false;\n\n  public startMonitoring = async () => {\n    if (this.isMonitoring) return;\n    this.isMonitoring = true;\n    this.interval = window.setInterval(() => {\n      this.timestamp = this.timestamp + 32;\n\n      const secPart = 0; // this.timestamp % 1000;\n      if (secPart > 232 && secPart < 708) {\n        this.frequencies[0] = 0;\n        this.frequencies[1] = 0;\n      } else {\n        this.frequencies[0] = Math.sin(this.timestamp / 1000) * 50 + 100;\n        this.frequencies[1] = Math.cos(this.timestamp / 1000) * 50 + 200;\n\n        // this.volumes = this.frequencies.map((freq) => (1.5 + Math.random()) / 80) as [number, number];\n      }\n    }, 32);\n  };\n\n  public getFrequencies = () => this.frequencies;\n  public getVolumes = () => this.volumes;\n\n  public stopMonitoring = async () => {\n    if (!this.isMonitoring) return;\n    this.isMonitoring = false;\n    if (this.interval) {\n      window.clearInterval(this.interval);\n    }\n  };\n\n  public getInputLag = () => 150;\n  public getChannelsCount = () => 2;\n  public requestReadiness = () => Promise.resolve(true);\n\n  public getStatus = () => 'ok' as const;\n}\n\nexport default new DummyInput();\n","import aubio from 'aubiojs';\nimport { FrequencyDetectionStrategy } from './interfaces';\n\nexport default class AubioStrategy implements FrequencyDetectionStrategy {\n  private detector: any;\n\n  public init = async (context: AudioContext, buffer: number): Promise<void> => {\n    const { Pitch } = await aubio();\n\n    this.detector = new Pitch('default', buffer, buffer / 8, context.sampleRate);\n    this.detector.setTolerance(0.5);\n  };\n\n  public getSampleSize(): number {\n    return 1 << 11;\n  }\n\n  public getFrequency = async (data: Float32Array) => {\n    return this.detector.do(data);\n  };\n}\n","import Listener from 'utils/Listener';\n\ntype accessStatus = 'uninitialised' | 'requested' | 'accepted' | 'declined';\nclass UserMediaService extends Listener<[accessStatus]> {\n  private status: accessStatus = 'uninitialised';\n\n  public getUserMedia: typeof navigator.mediaDevices.getUserMedia = async (...args) =>\n    this.requestAndTrack(() => navigator.mediaDevices.getUserMedia(...args));\n\n  public enumerateDevices: typeof navigator.mediaDevices.enumerateDevices = async (...args) =>\n    this.requestAndTrack(() => navigator.mediaDevices.enumerateDevices(...args));\n\n  private requestAndTrack = async <T extends CallableFunction>(fnc: T) => {\n    try {\n      if (this.status !== 'accepted') this.setStatus('requested');\n      const result = await fnc();\n      this.setStatus('accepted');\n\n      return result;\n    } catch (e) {\n      this.setStatus('declined');\n      throw e;\n    }\n  };\n\n  private setStatus = (newStatus: accessStatus) => {\n    this.status = newStatus;\n\n    this.onUpdate(newStatus);\n  };\n\n  public getStatus = () => this.status;\n}\n\nexport default new UserMediaService();\n","import { captureException } from '@sentry/react';\nimport events from 'GameEvents/GameEvents';\nimport AubioStrategy from 'Scenes/Game/Singing/Input/MicStrategies/Aubio';\nimport userMediaService from 'UserMedia/userMediaService';\nimport Listener from 'utils/Listener';\nimport InputInterface from './Interface';\n\nclass MicInput extends Listener<[[number, number], [number, number]]> implements InputInterface {\n  private stream: MediaStream | null = null;\n  private context: AudioContext | null = null;\n\n  private interval: ReturnType<typeof setInterval> | null = null;\n\n  private frequencies: [number, number] = [0, 0];\n  private volumes: [number, number] = [0, 0];\n\n  private startedMonitoring = false;\n\n  public startMonitoring = async (deviceId?: string, echoCancellation = false) => {\n    if (this.startedMonitoring) return;\n    this.startedMonitoring = true;\n\n    try {\n      this.stream = await userMediaService.getUserMedia({\n        audio: {\n          ...(deviceId ? { deviceId, exact: true } : {}),\n          echoCancellation: echoCancellation,\n        },\n        video: false,\n      });\n      try {\n        this.context = new AudioContext();\n\n        const source = this.context.createMediaStreamSource(this.stream);\n        const splitter = this.context.createChannelSplitter(2);\n        source.connect(splitter);\n\n        const analyserCh0 = this.context.createAnalyser();\n        analyserCh0.fftSize = 2048;\n        analyserCh0.minDecibels = -100;\n        const analyserCh1 = this.context.createAnalyser();\n        analyserCh1.fftSize = 2048;\n        analyserCh1.minDecibels = -100;\n        splitter.connect(analyserCh0, 0);\n        splitter.connect(analyserCh1, 1);\n\n        const strategy = new AubioStrategy();\n        await strategy.init(this.context, analyserCh0.fftSize);\n\n        this.interval = setInterval(async () => {\n          const dataCh0 = new Float32Array(analyserCh0.fftSize);\n          const dataCh1 = new Float32Array(analyserCh1.fftSize);\n\n          analyserCh0.getFloatTimeDomainData(dataCh0);\n          analyserCh1.getFloatTimeDomainData(dataCh1);\n\n          this.frequencies = await Promise.all([strategy.getFrequency(dataCh0), strategy.getFrequency(dataCh1)]);\n\n          this.volumes = [this.calculateVolume(dataCh0), this.calculateVolume(dataCh1)];\n\n          this.onUpdate(this.frequencies, this.volumes);\n        }, this.context.sampleRate / analyserCh0.fftSize);\n\n        events.micMonitoringStarted.dispatch();\n      } catch (e) {\n        captureException(e);\n        console.error(e);\n      }\n    } catch (e) {\n      captureException(e, { level: 'warning' });\n      console.warn(e);\n    }\n  };\n\n  public getFrequencies = () => {\n    return this.frequencies;\n  };\n  public getVolumes = () => this.volumes;\n\n  public stopMonitoring = async () => {\n    if (!this.startedMonitoring) return;\n    this.startedMonitoring = false;\n    this.interval && clearInterval(this.interval);\n    this.stream?.getTracks().forEach(function (track) {\n      track.stop();\n    });\n    try {\n      await this.context?.close();\n    } catch (e) {\n      console.log('MicInput.stoMonitoring error', e);\n    }\n\n    events.micMonitoringStopped.dispatch();\n  };\n\n  public getInputLag = () => 180;\n  public getChannelsCount = () => 2;\n\n  private calculateVolume(input: Float32Array) {\n    let i;\n    let sum = 0.0;\n    for (i = 0; i < input.length; ++i) {\n      sum += input[i] * input[i];\n    }\n    return Math.sqrt(sum / input.length);\n  }\n  public requestReadiness = () => Promise.resolve(true);\n\n  public getStatus = () => 'ok' as const;\n}\n\nexport default new MicInput();\n","import RemoteMicManager from 'RemoteMic/RemoteMicManager';\nimport InputInterface from './Interface';\n\nclass RemoteMicInput implements InputInterface {\n  private frequencies: [number] = [0];\n  private volumes: [number] = [1];\n\n  public startMonitoring = async (remoteMicId?: string) => {\n    return RemoteMicManager.getRemoteMicById(remoteMicId ?? '')\n      ?.getInput()\n      .startMonitoring();\n  };\n\n  public getFrequencies = (deviceId?: string) => {\n    const val = RemoteMicManager.getRemoteMicById(deviceId ?? '')\n      ?.getInput()\n      .getFrequencies();\n\n    return val ?? this.frequencies;\n  };\n  public getVolumes = (deviceId?: string) => {\n    const val = RemoteMicManager.getRemoteMicById(deviceId ?? '')\n      ?.getInput()\n      .getVolumes();\n\n    return val ?? this.volumes;\n  };\n\n  public stopMonitoring = async (deviceId?: string) =>\n    RemoteMicManager.getRemoteMicById(deviceId ?? '')\n      ?.getInput()\n      .stopMonitoring();\n\n  public requestReadiness = (deviceId?: string) =>\n    RemoteMicManager.getRemoteMicById(deviceId ?? '')\n      ?.getInput()\n      .requestReadiness() ?? Promise.resolve(true);\n\n  public getInputLag = (deviceId?: string) =>\n    RemoteMicManager.getRemoteMicById(deviceId ?? '')\n      ?.getInput()\n      .getInputLag() ?? 0;\n\n  public getChannelsCount = () => 1;\n\n  public getStatus = (deviceId?: string) => {\n    const mic = RemoteMicManager.getRemoteMicById(deviceId ?? '');\n\n    if (!mic || mic.getLatency() > 1500) {\n      return 'unavailable' as const;\n    } else if (mic.getLatency() > 500) {\n      return 'unstable' as const;\n    }\n\n    return 'ok' as const;\n  };\n}\n\nexport default new RemoteMicInput();\n","import { SelectedPlayerInput } from 'Players/PlayersManager';\n\nexport const getInputId = (input: Pick<SelectedPlayerInput, 'deviceId' | 'channel'>) =>\n  `${input.deviceId};${input.channel}`;\n","import { getInputId } from 'Players/utils';\nimport { InputSource } from './interfaces';\n\nconst inputs = [\n  {\n    channels: 2,\n    channel: 1,\n    label: 'Drawing Test Input',\n    id: getInputId({ deviceId: 'default', channel: 1 }),\n    deviceId: 'default',\n  },\n];\n\nexport class DrawingTestInputSource {\n  public static readonly inputName = 'DrawingTest';\n\n  public static getDefault = () => inputs[0];\n\n  public static getInputs = async (): Promise<InputSource[]> => inputs;\n\n  public static subscribeToListChange = (callback: () => void) => undefined;\n  public static unsubscribeToListChange = (callback: () => void) => undefined;\n}\n","import { captureException } from '@sentry/react';\nimport { getInputId } from 'Players/utils';\nimport userMediaService from 'UserMedia/userMediaService';\nimport { range } from 'lodash-es';\nimport { InputSource } from './interfaces';\n\ninterface NameMapper {\n  test: (label: string, channel: number, channels: number) => boolean;\n  map: (label: string, channel: number) => string;\n}\n\nconst singstarWirelessMicMapper: NameMapper = {\n  test: (label) =>\n    label.toLowerCase().includes('wireless mic #') || label.toLowerCase().includes('sony wireless singstar'),\n  map: (label, channel) => `SingStar Wireless - ${channel === 0 ? 'Blue' : 'Red'}`,\n};\nconst singstarWiredMicMapper: NameMapper = {\n  test: (label) => label.toLowerCase().includes('usbmic serial#') || label.toLowerCase().includes('singstar'),\n  map: (label, channel) => `SingStar Wired - ${channel === 0 ? 'Blue' : 'Red'}`,\n};\nconst singstarGenericMapper: NameMapper = {\n  test: (label, channel, channels) => channels === 2 && label.toLowerCase().includes('singstar'),\n  map: (label, channel) => `SingStar Mic - ${channel === 0 ? 'Blue' : 'Red'}`,\n};\n\nconst getPreferred = (...[label, ch, channels]: Parameters<NameMapper['test']>) =>\n  singstarWiredMicMapper.test(label, ch, channels) ||\n  singstarWirelessMicMapper.test(label, ch, channels) ||\n  singstarGenericMapper.test(label, ch, channels)\n    ? ch\n    : undefined;\n\nconst mapInputName = (label: string, channel: number, channels: number) => {\n  if (singstarWirelessMicMapper.test(label, channel, channels)) return singstarWirelessMicMapper.map(label, channel);\n  if (singstarWiredMicMapper.test(label, channel, channels)) return singstarWiredMicMapper.map(label, channel);\n  if (singstarGenericMapper.test(label, channel, channels)) return singstarGenericMapper.map(label, channel);\n\n  return channels > 1 ? `${label} (ch ${channel + 1})` : label;\n};\n\nexport class MicrophoneInputSource {\n  private static inputList: InputSource[] = [];\n  public static readonly inputName = 'Microphone';\n\n  public static getDefault = () =>\n    MicrophoneInputSource.inputList.find((input) => input.id === getInputId({ deviceId: 'default', channel: 0 })) ??\n    MicrophoneInputSource.inputList[0] ??\n    null;\n\n  public static getInputs = async (): Promise<InputSource[]> => {\n    let devices: MediaDeviceInfo[] = [];\n\n    try {\n      await userMediaService.getUserMedia({ audio: true });\n\n      devices = await userMediaService.enumerateDevices();\n    } catch (e) {\n      captureException(e, { level: 'warning', extra: { message: 'Microphone.getInputs' } });\n      console.warn(e);\n    }\n\n    MicrophoneInputSource.inputList = (devices as any as Array<MediaStreamTrack & MediaDeviceInfo>)\n      .filter((device) => device.kind === 'audioinput')\n      .map((device) => {\n        const channels = device.getCapabilities?.()?.channelCount?.max ?? 1;\n\n        return range(0, channels).map((channel) => ({\n          label: mapInputName(device.label, channel, channels),\n          channel,\n          channels,\n          deviceId: device.deviceId,\n          id: getInputId({ deviceId: device.deviceId, channel }),\n          preferred: getPreferred(device.label, channel, channels),\n        }));\n      })\n      .flat();\n\n    return MicrophoneInputSource.inputList;\n  };\n\n  public static subscribeToListChange = (callback: () => void) =>\n    navigator.mediaDevices.addEventListener('devicechange', callback);\n  public static unsubscribeToListChange = (callback: () => void) =>\n    navigator.mediaDevices.removeEventListener('devicechange', callback);\n}\n","import events from 'GameEvents/GameEvents';\nimport { getInputId } from 'Players/utils';\nimport { RemoteMic } from 'RemoteMic/RemoteMicInput';\nimport RemoteMicManager from 'RemoteMic/RemoteMicManager';\nimport { InputSource } from './interfaces';\n\nconst mapRemoteMicToInput = (remoteMic: RemoteMic): InputSource => ({\n  label: `📱${remoteMic.name}`,\n  id: getInputId({ deviceId: remoteMic.id, channel: 0 }),\n  deviceId: remoteMic.id,\n  channels: 1,\n  channel: 0,\n});\n\nexport class RemoteMicrophoneInputSource {\n  public static readonly inputName = 'Remote Microphone';\n\n  public static getDefault = () => RemoteMicManager.getRemoteMics().map(mapRemoteMicToInput)[0] ?? null;\n\n  public static getInputs = async (): Promise<InputSource[]> =>\n    RemoteMicManager.getRemoteMics().map(mapRemoteMicToInput);\n\n  public static subscribeToListChange = (callback: () => void) => {\n    events.remoteMicConnected.subscribe(callback);\n    events.remoteMicDisconnected.subscribe(callback);\n  };\n  public static unsubscribeToListChange = (callback: () => void) => {\n    events.remoteMicConnected.unsubscribe(callback);\n    events.remoteMicDisconnected.unsubscribe(callback);\n  };\n}\n","import events from 'GameEvents/GameEvents';\nimport PlayersManager from 'Players/PlayersManager';\nimport DrawingTestInput from 'Scenes/Game/Singing/Input/DrawingTestInput';\nimport dummyInput from 'Scenes/Game/Singing/Input/DummyInput';\nimport InputInterface from 'Scenes/Game/Singing/Input/Interface';\nimport MicInput from 'Scenes/Game/Singing/Input/MicInput';\nimport RemoteMicInput from 'Scenes/Game/Singing/Input/RemoteMicInput';\nimport { DrawingTestInputSource } from 'Scenes/SelectInput/InputSources/DrawingTest';\nimport { MicrophoneInputSource } from 'Scenes/SelectInput/InputSources/Microphone';\nimport { RemoteMicrophoneInputSource } from 'Scenes/SelectInput/InputSources/Remote';\nimport { InputSourceNames } from 'Scenes/SelectInput/InputSources/interfaces';\n\nclass InputManager {\n  private isMonitoring = false;\n\n  constructor() {\n    events.inputListChanged.subscribe(async () => {\n      if (this.isMonitoring) {\n        await this.stopMonitoring();\n        this.startMonitoring();\n      }\n    });\n  }\n\n  public getInputStatus = (playerNumber: number) => {\n    const player = PlayersManager.getPlayer(playerNumber);\n    if (!player) return 'unavailable';\n\n    const source = this.sourceNameToInput(player.input.source);\n\n    return source.getStatus(player.input.deviceId, player.input.channel);\n  };\n\n  public getPlayerFrequency = (playerNumber: number) => {\n    const input = PlayersManager.getPlayer(playerNumber)?.input;\n    // Player got removed\n    if (!input) return 0;\n\n    const frequencies = this.sourceNameToInput(input.source).getFrequencies(input.deviceId);\n\n    return frequencies[input.channel];\n  };\n\n  public getPlayerVolume = (playerNumber: number) => {\n    const input = PlayersManager.getPlayer(playerNumber)?.input;\n    if (!input) {\n      return 0;\n    }\n    const volumes = this.sourceNameToInput(input.source).getVolumes(input.deviceId);\n\n    return volumes[input.channel];\n  };\n\n  public getPlayerInputLag = (playerNumber: number) => {\n    const player = PlayersManager.getPlayer(playerNumber);\n    if (!player) {\n      return 0;\n    } else {\n      return this.sourceNameToInput(player.input.source).getInputLag();\n    }\n  };\n\n  public startMonitoring = async () => {\n    await Promise.all(\n      PlayersManager.getPlayers().map((player) =>\n        this.sourceNameToInput(player.input.source).startMonitoring(player.input.deviceId),\n      ),\n    );\n    this.isMonitoring = true;\n  };\n\n  public stopMonitoring = async () => {\n    await Promise.all(\n      PlayersManager.getPlayers().map((player) =>\n        this.sourceNameToInput(player.input.source).stopMonitoring(player.input.deviceId),\n      ),\n    );\n    this.isMonitoring = false;\n  };\n\n  public monitoringStarted = () => this.isMonitoring;\n\n  // todo: Create eg. \"InputSourceManager\" and have the logic there?\n  public sourceNameToInput = (sourceName: InputSourceNames): InputInterface => {\n    if (sourceName === MicrophoneInputSource.inputName) return MicInput;\n    if (sourceName === DrawingTestInputSource.inputName) return DrawingTestInput;\n    if (sourceName === RemoteMicrophoneInputSource.inputName) return RemoteMicInput;\n    return dummyInput;\n  };\n}\n\nexport default new InputManager();\n","export const noDistanceNoteTypes = ['freestyle', 'rap'];\nexport const noPointsNoteTypes: string[] = [];\n\nexport const MIDDLEA = 440;\nexport const SEMITONE = 69;\n\nexport const MAX_NAME_LENGTH = 20;\n","import { MIDDLEA, SEMITONE } from 'consts';\n\nexport default function pitchToFrequency(note: number) {\n  return MIDDLEA * Math.pow(2, (note - SEMITONE) / 12);\n}\n","import { MIDDLEA, SEMITONE } from 'consts';\nimport pitchToFrequency from 'utils/pitchToFrequency';\nimport GameState from '../GameState';\n\nexport const pitchFromFrequency = (freq: number) =>\n  Math.round(12 * (Math.log(freq / MIDDLEA) / Math.log(2))) + SEMITONE;\n\nconst getDistanceInCents = (noteFreq: number, freq: number) =>\n  Math.floor((1200 * Math.log(freq / noteFreq)) / Math.log(2));\n\nconst getCentDistance = (targetNote: number, freq: number, tolerance: number) => {\n  const noteFreq = pitchToFrequency(targetNote);\n  const cents = getDistanceInCents(noteFreq, freq);\n  // To handle cases for cents like -1150 (=50) or 1150 (=-50)\n  const distance = Math.sign(cents) * ((((Math.abs(cents) % 1200) + 600) % 1200) - 600);\n\n  return distance / (tolerance * 100 + 50);\n};\n\nexport const calcDistanceBetweenPitches = (note: number, targetNote: number, tolerance: number) => {\n  // +6 / - 6 are here to avoid distances like -8 in favor of +4\n  // (so smallest between \"too high\" or \"too low\" pitch to hit the note in whatever octave)\n  const noteDistance = (((note % 12) - (targetNote % 12) + 18) % 12) - 6;\n\n  return Math.abs(noteDistance) <= tolerance ? 0 : noteDistance;\n};\n\nexport const calcDistance = (frequency: number, targetNote: number) => {\n  const tolerance = GameState.getTolerance();\n  const note = pitchFromFrequency(frequency);\n  let preciseDistance: number = -1;\n  const distance = calcDistanceBetweenPitches(note, targetNote, tolerance);\n\n  if (distance === 0) {\n    preciseDistance = getCentDistance(targetNote, frequency, tolerance);\n  }\n\n  return { distance, preciseDistance };\n};\n","import { FrequencyRecord } from 'interfaces';\n\nconst WINDOW_SIZE = 6;\n\nexport default function detectVibrato(data: FrequencyRecord[]): boolean {\n  const opChangePoints: Array<FrequencyRecord & { change: '>' | '<'; interval: number }> = [];\n\n  for (let i = 1; i < data.length; i++) {\n    if (Math.round(data[i].frequency / 2) === Math.round(data[i - 1].frequency / 2)) continue;\n\n    const change = data[i].frequency > data[i - 1].frequency ? '>' : '<';\n    if (opChangePoints.length === 0) {\n      opChangePoints.push({\n        ...data[i],\n        interval: data[i].timestamp - data[i - 1].timestamp,\n        change,\n      });\n    } else {\n      const lastChange = opChangePoints.at(-1)!;\n      if (lastChange.change !== change) {\n        opChangePoints.push({\n          ...data[i],\n          interval: data[i].timestamp - lastChange.timestamp,\n          change,\n        });\n      }\n    }\n  }\n\n  const changePoints = opChangePoints;\n\n  for (let i = 0; i < changePoints.length - WINDOW_SIZE; i++) {\n    const window = changePoints.slice(i, i + WINDOW_SIZE - 1);\n\n    const intervals = window.map((record) => record.interval);\n    // const pitches = window.map((record) => record.pitch);\n    const maxInterval = Math.max(...intervals);\n    const minInterval = Math.min(...intervals);\n\n    const averageIntervals = intervals.reduce((sum, i) => sum + i, 0) / intervals.length;\n\n    if (maxInterval < averageIntervals * 1.75 && minInterval > averageIntervals / 1.75) return true;\n  }\n\n  return false;\n}\n","import { noDistanceNoteTypes } from 'consts';\nimport { FrequencyRecord, Note, PlayerNote } from 'interfaces';\nimport { calcDistance } from './calcDistance';\nimport detectVibrato from './detectVibrato';\n\nconst SINGING_BREAK_TOLERANCE_MS = 100;\n\nexport function appendFrequencyToPlayerNotes(\n  playerNotes: PlayerNote[],\n  record: FrequencyRecord,\n  note: Note,\n  beatLength: number,\n) {\n  if (record.frequency === 0) return;\n  const noteCandidate = {\n    ...record,\n    beat: Math.max(0, record.timestamp) / beatLength,\n    ...calcDistance(record.frequency, note.pitch),\n  };\n  const lastNote = playerNotes.at(-1);\n\n  const breakToleranceBeat = SINGING_BREAK_TOLERANCE_MS / beatLength;\n\n  const noteEndBeat = note.start + note.length;\n  const isThisNoteDifferentThanLast = !lastNote || lastNote.note.start !== note.start;\n  const isDistanceDifferent =\n    !lastNote || (lastNote.distance !== noteCandidate.distance && !noDistanceNoteTypes.includes(note.type));\n\n  if (\n    isThisNoteDifferentThanLast ||\n    isDistanceDifferent ||\n    noteCandidate.beat - (lastNote.start + lastNote.length) > breakToleranceBeat\n  ) {\n    const roundedStart = noteCandidate.beat - breakToleranceBeat < note.start ? note.start : noteCandidate.beat;\n    playerNotes.push({\n      // If this is the first player note for the note, round player note start to note's start\n      start: Math.min(isThisNoteDifferentThanLast ? roundedStart : noteCandidate.beat, noteEndBeat),\n      length: 0,\n      distance: noteCandidate.distance,\n      note,\n      isPerfect: false,\n      vibrato: false,\n      frequencyRecords: [\n        {\n          frequency: noteCandidate.frequency,\n          preciseDistance: noteCandidate.preciseDistance,\n          timestamp: noteCandidate.timestamp,\n        },\n      ],\n    });\n\n    // Round the last player note length to the end of the note, so it looks a bit smoother\n    if (lastNote && note.start !== lastNote.note.start) {\n      const lastPlayerNoteEndBeat = lastNote.start + lastNote.length;\n      const lastNoteEndBeat = lastNote.note.start + lastNote.note.length;\n      const roundedLength =\n        lastPlayerNoteEndBeat + breakToleranceBeat > lastNoteEndBeat ? lastNoteEndBeat : lastPlayerNoteEndBeat;\n      lastNote.length = Math.max(0, roundedLength - lastNote.start);\n    }\n  } else {\n    lastNote.length = Math.max(0, Math.min(noteCandidate.beat, note.start + note.length) - lastNote.start);\n    lastNote.frequencyRecords.push({\n      frequency: noteCandidate.frequency,\n      timestamp: noteCandidate.timestamp,\n      preciseDistance: noteCandidate.preciseDistance,\n    });\n\n    lastNote.isPerfect = lastNote.distance === 0 && Math.abs(lastNote.length - lastNote.note.length) < 0.5;\n\n    lastNote.vibrato = lastNote.distance === 0 && detectVibrato(lastNote.frequencyRecords);\n  }\n}\n","import { noDistanceNoteTypes } from 'consts';\nimport { PlayerNote } from 'interfaces';\n\nexport default function getPlayerNoteDistance(note: PlayerNote) {\n  return noDistanceNoteTypes.includes(note.note.type) ? 0 : note.distance;\n}\n","import isNotesSection from 'Songs/utils/isNotesSection';\nimport { noPointsNoteTypes } from 'consts';\nimport { DetailedScore, PlayerNote, Song } from 'interfaces';\nimport { memoize } from 'lodash-es';\nimport tuple from '../../../../../utils/tuple';\nimport getPlayerNoteDistance from '../../Helpers/getPlayerNoteDistance';\n\nexport const MAX_POINTS = 3_500_000;\n\nconst noteTypesMultipliers: DetailedScore = {\n  freestyle: 0.25,\n  rap: 0.25,\n  star: 2,\n  normal: 1,\n  perfect: 0.5,\n  vibrato: 0.25,\n};\n\nconst countsToBeats = (counts: DetailedScore): DetailedScore => ({\n  freestyle: counts.freestyle * noteTypesMultipliers.freestyle,\n  rap: counts.rap * noteTypesMultipliers.rap,\n  star: counts.star * noteTypesMultipliers.star,\n  normal: counts.normal * noteTypesMultipliers.normal,\n  perfect: counts.perfect * noteTypesMultipliers.perfect,\n  vibrato: counts.vibrato * noteTypesMultipliers.vibrato,\n});\n\nexport const sumDetailedScore = (counts: DetailedScore) =>\n  counts.freestyle + counts.rap + counts.star + counts.normal + counts.perfect + counts.vibrato;\n\nexport const beatsToPoints = (counts: DetailedScore, pointsPerBeat: number): DetailedScore => ({\n  freestyle: counts.freestyle * pointsPerBeat,\n  rap: counts.rap * pointsPerBeat,\n  star: counts.star * pointsPerBeat,\n  normal: counts.normal * pointsPerBeat,\n  perfect: counts.perfect * pointsPerBeat,\n  vibrato: counts.vibrato * pointsPerBeat,\n});\n\nexport const addDetailedScores = (s1: DetailedScore, s2: DetailedScore): DetailedScore => ({\n  freestyle: s1.freestyle + s2.freestyle,\n  rap: s1.rap + s2.rap,\n  star: s1.star + s2.star,\n  normal: s1.normal + s2.normal,\n  perfect: s1.perfect + s2.perfect,\n  vibrato: s1.vibrato + s2.vibrato,\n});\n\nexport const divideDetailedScores = (counts: DetailedScore, divideBy: number): DetailedScore => ({\n  freestyle: counts.freestyle / divideBy,\n  rap: counts.rap / divideBy,\n  star: counts.star / divideBy,\n  normal: counts.normal / divideBy,\n  perfect: counts.perfect / divideBy,\n  vibrato: counts.vibrato / divideBy,\n});\n\nconst countSungBeats = memoize((song: Song): DetailedScore[] => {\n  return song.tracks.map(({ sections }) => {\n    const counts: DetailedScore = {\n      freestyle: 0,\n      rap: 0,\n      star: 0,\n      normal: 0,\n      perfect: 0,\n      vibrato: 0,\n    };\n    sections.filter(isNotesSection).forEach((section) => {\n      const notes = section.notes.filter((note) => !noPointsNoteTypes.includes(note.type));\n\n      notes.forEach((note) => {\n        counts[note.type] = counts[note.type] + note.length;\n        counts.perfect = counts.perfect + note.length;\n        counts.vibrato = counts.vibrato + note.length;\n      });\n    });\n\n    return counts;\n  });\n});\n\nexport function calculateDetailedScoreData(playerNotes: PlayerNote[], song: Song, trackNumber: number) {\n  const beatsPerTrack = countSungBeats(song);\n\n  const counts: DetailedScore = {\n    freestyle: 0,\n    rap: 0,\n    star: 0,\n    normal: 0,\n    perfect: 0,\n    vibrato: 0,\n  };\n\n  if (!beatsPerTrack[trackNumber]) {\n    console.error(`No beat count for track ${trackNumber} in song`, song);\n    return tuple([0, counts, counts]);\n  }\n\n  const maxCounts = countsToBeats(countSungBeats(song)[trackNumber]);\n\n  const pointsPerBeat = MAX_POINTS / sumDetailedScore(maxCounts);\n\n  for (let i = 0; i < playerNotes.length; i++) {\n    const note = playerNotes[i];\n    if (noPointsNoteTypes.includes(note.note.type)) continue;\n    if (getPlayerNoteDistance(note) !== 0) continue;\n\n    counts[note.note.type] = counts[note.note.type] + note.length;\n\n    if (note.isPerfect) counts.perfect = counts.perfect + note.length;\n    if (note.vibrato) counts.vibrato = counts.vibrato + note.length;\n  }\n\n  return tuple([pointsPerBeat, countsToBeats(counts), maxCounts]);\n}\n\nexport default function calculateScore(playerNotes: PlayerNote[], song: Song, trackNumber: number): number {\n  const [pointsPerBeat, counts] = calculateDetailedScoreData(playerNotes, song, trackNumber);\n\n  return sumDetailedScore(counts) * pointsPerBeat;\n}\n","import events from 'GameEvents/GameEvents';\nimport { GameStateClass } from 'Scenes/Game/Singing/GameState/GameState';\nimport isNotesSection from 'Songs/utils/isNotesSection';\nimport { getNoteAtBeat } from 'Songs/utils/notesSelectors';\nimport { FrequencyRecord, NotesSection, PlayerNote } from 'interfaces';\nimport InputManager from '../Input/InputManager';\nimport { appendFrequencyToPlayerNotes } from './Helpers/appendFrequencyToPlayerNotes';\nimport calculateScore, { calculateDetailedScoreData } from './Helpers/calculateScore';\n\nclass PlayerState {\n  private frequencyRecords: FrequencyRecord[] = [];\n  private playerNotes: PlayerNote[] = [];\n  private realFrequencyRecords: FrequencyRecord[] = [];\n  private realPlayerNotes: PlayerNote[] = [];\n  private min = Infinity;\n  private max = -Infinity;\n\n  private storedSectionIndex = 0;\n\n  public constructor(private number: number, private gameState: GameStateClass) {\n    this.getTrack()\n      .sections.filter(isNotesSection)\n      .forEach((section) =>\n        section.notes.forEach((note) => {\n          this.min = Math.min(this.min, note.pitch);\n          this.max = Math.max(this.max, note.pitch);\n        }),\n      );\n  }\n\n  public getNumber = () => this.number;\n\n  public update = () => {\n    const currentTime = this.gameState.getCurrentTime();\n\n    const frequency = InputManager.getPlayerFrequency(this.number);\n    const currentTimestamp = currentTime - InputManager.getPlayerInputLag(this.number);\n\n    // If it's a pack of frequencies (from remote mic), restore last \"real\" frequencies,\n    // add and recalculate for the received pack, and store newly computed\n    // frequencies for the moment when new package arrive.\n    // If it's a single frequency, just add it to the notes\n    if (Array.isArray(frequency)) {\n      const lastRealRecord = this.realFrequencyRecords.at(-1) || this.frequencyRecords.at(0);\n      const lastTimestamp = lastRealRecord?.timestamp ?? 0;\n      const timestampStep = (currentTimestamp - lastTimestamp) / frequency.length;\n\n      this.frequencyRecords = this.realFrequencyRecords;\n      this.playerNotes = this.realPlayerNotes;\n\n      for (let i = 0; i < frequency.length; i++) {\n        const timestamp = lastTimestamp + timestampStep * (i + 1);\n        this.updatePlayerNotes(timestamp, frequency[i]);\n      }\n\n      this.realFrequencyRecords = [...this.frequencyRecords];\n      this.realPlayerNotes = [...this.playerNotes];\n      // Last note can be mutated, so we create a shallow copy of it\n      const lastNote = this.realPlayerNotes.at(-1);\n\n      if (lastNote) {\n        this.realPlayerNotes[this.realPlayerNotes.length - 1] = {\n          ...lastNote,\n          // This can be mutated as well\n          frequencyRecords: [...(lastNote.frequencyRecords ?? [])],\n        };\n      }\n    } else {\n      this.updatePlayerNotes(currentTimestamp, frequency);\n    }\n\n    this.dispatchSectionUpdate();\n  };\n\n  private dispatchSectionUpdate = () => {\n    const currentSectionIndex = this.getCurrentSectionIndex();\n    if (this.storedSectionIndex !== currentSectionIndex) {\n      events.sectionChange.dispatch(this.number, this.storedSectionIndex);\n      this.storedSectionIndex = currentSectionIndex;\n    }\n  };\n\n  public updatePlayerNotes = (timestamp: number, frequency: number) => {\n    const record = { timestamp, frequency };\n    this.frequencyRecords.push(record);\n\n    const recordBeat = record.timestamp / this.gameState.getSongBeatLength();\n    const recordSection = this.getSectionByBeat(recordBeat);\n\n    if (isNotesSection(recordSection)) {\n      const note = getNoteAtBeat(recordSection, recordBeat, 0) ?? getNoteAtBeat(recordSection, recordBeat, 0.5);\n\n      if (note) appendFrequencyToPlayerNotes(this.playerNotes, record, note, this.gameState.getSongBeatLength());\n    }\n  };\n\n  public getPlayerNotes = () => this.playerNotes;\n  public getPlayerFrequencies = () => this.frequencyRecords;\n\n  public getSectionIndexByBeat = (beat: number) => {\n    return this.getTrack().sections.findIndex((section, index, sections) => {\n      if (beat < 0) return true;\n      if (beat < section.start) return false;\n      if (index === sections.length - 1) return true;\n      return sections[index + 1].start > beat;\n    });\n  };\n\n  public getCurrentSectionIndex = () => this.getSectionIndexByBeat(this.gameState.getCurrentBeat());\n\n  public getSectionByBeat = (beat: number) => this.getTrack().sections[this.getSectionIndexByBeat(beat)] ?? null;\n\n  public getCurrentSection = () => {\n    const sectionIndex = this.getCurrentSectionIndex();\n\n    return this.getTrack().sections[sectionIndex] ?? null;\n  };\n\n  public getNextSection = (index = 1) => {\n    const sectionIndex = this.getCurrentSectionIndex();\n\n    return sectionIndex > -1 ? this.getTrack().sections[sectionIndex + index] ?? null : null;\n  };\n\n  public getPreviousSection = (index = 1) => {\n    const sectionIndex = this.getCurrentSectionIndex();\n\n    return sectionIndex > -1 ? this.getTrack().sections[sectionIndex - index] ?? null : null;\n  };\n\n  public getLastNotesSection = () => {\n    const last = this.getTrack().sections.at(-1);\n    return isNotesSection(last) ? last : (this.getTrack().sections.at(-2) as NotesSection);\n  };\n\n  public getScore = () => calculateScore(this.playerNotes, this.gameState.getSong()!, this.getTrackIndex());\n  public getDetailedScore = () =>\n    calculateDetailedScoreData(this.playerNotes, this.gameState.getSong()!, this.getTrackIndex());\n\n  public getMinPitch = () => this.min;\n  public getMaxPitch = () => this.max;\n\n  public getTrackIndex = () => this.gameState.getSingSetup()!.players[this.number].track;\n  public getTrack = () => this.gameState.getSong()!.tracks[this.getTrackIndex()];\n\n  public resetNotes = () => {\n    this.playerNotes = [];\n  };\n}\n\nexport default PlayerState;\n","import { Song, SongPreview } from 'interfaces';\nimport { memoize } from 'lodash-es';\n\nexport default memoize(function getSongBeatLength(song: Song | SongPreview): number {\n  return (60 / song.bpm / song.bar) * 1000;\n});\n","import { ValuesType } from 'utility-types';\n\nexport type NoteType = 'normal' | 'star' | 'freestyle' | 'rap';\nexport interface Note {\n  start: number;\n  length: number;\n  pitch: number;\n  type: NoteType;\n  lyrics: string;\n}\n\nexport interface NotesSection {\n  // end: never;\n  start: number;\n  notes: Note[];\n  type: 'notes';\n}\n\nexport interface PauseSection {\n  start: number;\n  end: number;\n  // notes: never;\n  type: 'pause';\n}\n\nexport type Section = NotesSection | PauseSection;\n\nexport const GAME_MODE = {\n  DUEL: 'DUEL',\n  PASS_THE_MIC: 'PASS_THE_MIC',\n  CO_OP: 'CO_OP',\n} as const;\n\nexport interface PlayerSetup {\n  track: number;\n  number: number;\n}\n\nexport interface SingSetup {\n  id: string;\n  players: PlayerSetup[];\n  mode: ValuesType<typeof GAME_MODE>;\n  tolerance: number;\n}\n\nexport interface Song {\n  lastUpdate: string | undefined;\n  author: string | undefined;\n  authorUrl: string | undefined;\n  genre: string | undefined;\n  year: string | undefined;\n  edition: string | undefined;\n  language: string | string[];\n  sourceUrl: string | undefined;\n  videoGap: number | undefined;\n  artist: string;\n  artistOrigin: string | undefined;\n  title: string;\n  video: string;\n  previewStart: number | undefined;\n  previewEnd: number | undefined;\n  gap: number;\n  bpm: number;\n  realBpm: number | undefined;\n  bar: number;\n  tracks: SongTrack[];\n  volume: number | undefined;\n  id: string;\n}\n\nexport interface SongTrack {\n  name?: string;\n  sections: Section[];\n}\n\nexport interface SongPreview extends Omit<Song, 'tracks'> {\n  id: string;\n  tracksCount: number;\n  tracks: Array<Pick<SongTrack, 'name'> & { start: number }>;\n  search: string;\n  isNew?: boolean;\n  isDeleted?: boolean;\n  local?: boolean;\n}\n\nexport interface FrequencyRecord {\n  timestamp: number;\n  frequency: number;\n}\n\nexport interface NoteFrequencyRecord extends FrequencyRecord {\n  preciseDistance: number;\n}\n\nexport interface PlayerNote {\n  start: number;\n  length: number;\n  distance: number;\n  note: Note;\n  isPerfect: boolean;\n  vibrato: boolean;\n  frequencyRecords: NoteFrequencyRecord[];\n}\n\ntype UndefinedKeys<T> = {\n  [K in keyof T]: undefined extends T[K] ? K : never;\n}[keyof T];\n\nexport type ExtractOptional<T> = Pick<T, Exclude<UndefinedKeys<T>, undefined>>;\n\nexport type DetailedScore = Record<Note['type'] | 'perfect' | 'vibrato', number>;\n\nexport interface HighScoreEntity {\n  singSetupId: string;\n  name: string;\n  score: number;\n  date: string;\n}\n\nexport type seconds = number;\nexport type milliseconds = number;\n\n// From https://github.com/peers/peerjs/blob/releases/2.0.0/lib/enums.ts\nexport enum PeerErrorType {\n  BrowserIncompatible = 'browser-incompatible',\n  Disconnected = 'disconnected',\n  InvalidID = 'invalid-id',\n  InvalidKey = 'invalid-key',\n  Network = 'network',\n  PeerUnavailable = 'peer-unavailable',\n  SslUnavailable = 'ssl-unavailable',\n  ServerError = 'server-error',\n  SocketError = 'socket-error',\n  SocketClosed = 'socket-closed',\n  UnavailableID = 'unavailable-id',\n  WebRTC = 'webrtc',\n}\n","export default function getCurrentBeat(currentTime: number, beatLength: number, gap: number, round = true): number {\n  const currentBeat = (currentTime - gap) / beatLength;\n  return round ? Math.floor(currentBeat) : currentBeat;\n}\n","import PlayerState from 'Scenes/Game/Singing/GameState/PlayerState';\nimport getSongBeatLength from 'Songs/utils/getSongBeatLength';\nimport { GAME_MODE, SingSetup, Song } from 'interfaces';\nimport tuple from 'utils/tuple';\nimport InputManager from '../Input/InputManager';\nimport { addDetailedScores, beatsToPoints, divideDetailedScores } from './Helpers/calculateScore';\nimport getCurrentBeat from './Helpers/getCurrentBeat';\n\nexport class GameStateClass {\n  private song: Song | null = null;\n  private currentTime: number = 0;\n  private duration: number = 0;\n  private singSetup: SingSetup | null = null;\n  private playerStates: PlayerState[] = [];\n  private playing: boolean = false;\n\n  public setCurrentTime = (currentTime: number) => (this.currentTime = currentTime);\n  public getCurrentTime = (accountGap = true) => {\n    return this.currentTime - (accountGap && this.song ? this.song.gap : 0);\n  };\n\n  public getSongBeatLength = () => getSongBeatLength(this.song!);\n  public getCurrentBeat = () => {\n    return getCurrentBeat(this.getCurrentTime(), this.getSongBeatLength(), 0, false);\n  };\n\n  public setSong = (song: Song) => (this.song = song);\n  public getSong = () => this.song;\n\n  public getSingSetup = () => this.singSetup;\n  public setSingSetup = (singSetup: SingSetup) => {\n    this.singSetup = singSetup;\n\n    this.playerStates = singSetup.players.map(({ number }, index) => new PlayerState(number, this));\n    this.currentTime = 0;\n    this.playing = true;\n  };\n\n  public resetSingSetup = () => {\n    this.playing = false;\n  };\n\n  public isPlaying = () => this.playing;\n\n  public getTolerance = () => this.getSingSetup()?.tolerance ?? 2;\n\n  public setDuration = (duration: number) => (this.duration = duration);\n  public getDuration = () => this.duration;\n\n  public getPlayer = (playerNumber: number) => this.playerStates.find((player) => player.getNumber() === playerNumber);\n\n  public getPlayers = () => this.playerStates;\n\n  public getPlayerCount = () => this.playerStates.length;\n\n  public getPlayerScore = (player: number) => {\n    if (this.getSingSetup()?.mode === GAME_MODE.CO_OP) {\n      const score = this.getPlayers().reduce((curr, playerState) => curr + playerState.getScore(), 0);\n\n      return score / this.getPlayerCount();\n    } else {\n      return this.getPlayer(player)?.getScore() ?? -1;\n    }\n  };\n\n  public getPlayerDetailedScore = (player: number) => {\n    if (this.getSingSetup()?.mode === GAME_MODE.CO_OP) {\n      const scores = this.getPlayers().map((playerState) => playerState.getDetailedScore());\n\n      // getDetailedScore returns beats - calculate actual points for each player\n      const [fs, ...pointsScores] = scores.map(\n        ([pointsPerBeat, counts, maxCounts]) =>\n          [beatsToPoints(counts, pointsPerBeat), beatsToPoints(maxCounts, pointsPerBeat)] as const,\n      );\n\n      const summedPoints = pointsScores.reduce(\n        (curr, pointsScore) => [addDetailedScores(curr[0], pointsScore[0]), addDetailedScores(curr[1], pointsScore[1])],\n        fs,\n      );\n      return tuple([\n        divideDetailedScores(summedPoints[0], this.getPlayerCount()),\n        divideDetailedScores(summedPoints[1], this.getPlayerCount()),\n      ]);\n    } else {\n      const [pointsPerBeat, counts, maxCounts] = this.getPlayer(player)!.getDetailedScore();\n\n      return tuple([beatsToPoints(counts, pointsPerBeat), beatsToPoints(maxCounts, pointsPerBeat)]);\n    }\n  };\n\n  public startInputMonitoring = async () => {\n    return InputManager.startMonitoring();\n  };\n\n  public stopInputMonitoring = () => {\n    return InputManager.stopMonitoring();\n  };\n\n  public update = () => {\n    this.playerStates.forEach((player) => player.update());\n  };\n  public resetPlayerNotes = () => {\n    this.playerStates.forEach((player) => player.resetNotes());\n  };\n}\n\nexport default new GameStateClass();\n","import { getInputId } from 'Players/utils';\nimport { InputSource } from './interfaces';\n\nconst inputList = [\n  {\n    channels: 2,\n    channel: 0,\n    label: 'Dummy Input 1',\n    id: getInputId({ deviceId: 'default', channel: 0 }),\n    deviceId: 'default',\n  },\n  {\n    channels: 2,\n    channel: 1,\n    label: 'Dummy Input 2',\n    id: getInputId({ deviceId: 'default', channel: 1 }),\n    deviceId: 'default',\n  },\n];\n\nexport class DummyInputSource {\n  public static readonly inputName = 'Dummy';\n\n  public static getDefault = () => inputList[0];\n\n  public static getInputs = async (): Promise<InputSource[]> => inputList;\n\n  public static subscribeToListChange = (callback: () => void) => undefined;\n  public static unsubscribeToListChange = (callback: () => void) => undefined;\n}\n","import events from 'GameEvents/GameEvents';\nimport { SelectedPlayerInput } from 'Players/PlayersManager';\nimport { DrawingTestInputSource } from 'Scenes/SelectInput/InputSources/DrawingTest';\nimport {\n  InputSourceList,\n  InputSourceManagerInterface,\n  InputSourceNames,\n} from 'Scenes/SelectInput/InputSources/interfaces';\nimport { DummyInputSource } from './Dummy';\nimport { MicrophoneInputSource } from './Microphone';\nimport { RemoteMicrophoneInputSource } from './Remote';\n\nconst selectedPlayerInputToId = (input: SelectedPlayerInput) => `${input.deviceId};${input.channel}`;\n\nclass InputSourceListManager {\n  private inputList: Record<InputSourceNames, InputSourceList>;\n\n  constructor() {\n    this.inputList = {\n      [MicrophoneInputSource.inputName]: this.initialiseInputSource(MicrophoneInputSource, true),\n      [DummyInputSource.inputName]: this.initialiseInputSource(DummyInputSource),\n      [RemoteMicrophoneInputSource.inputName]: this.initialiseInputSource(RemoteMicrophoneInputSource),\n      [DrawingTestInputSource.inputName]: this.initialiseInputSource(DrawingTestInputSource),\n    };\n  }\n\n  private initialiseInputSource = <T extends InputSourceManagerInterface>(source: T, lazily = false) => {\n    if (!lazily) {\n      source.getInputs().then((list) => {\n        this.inputList[source.inputName].list = list;\n        events.inputListChanged.dispatch(true);\n\n        source.subscribeToListChange(async () => {\n          this.inputList[source.inputName].list = await source.getInputs();\n          events.inputListChanged.dispatch(false);\n        });\n      });\n    }\n\n    return {\n      list: [],\n      getDefault: source.getDefault,\n    };\n  };\n\n  public loadMics = () => {\n    if (!this.inputList.Microphone.list.length) {\n      this.inputList.Microphone = this.initialiseInputSource(MicrophoneInputSource);\n    }\n  };\n\n  public getInputList = () => this.inputList;\n\n  public getInputForPlayerSelected = (input: SelectedPlayerInput, returnDefault = true) => {\n    const source = this.inputList[input.source];\n    return (\n      source.list.find((item) => item.id === selectedPlayerInputToId(input)) ??\n      (returnDefault ? source.getDefault() : null)\n    );\n  };\n}\nexport default new InputSourceListManager();\n","import events from 'GameEvents/GameEvents';\nimport RemoteMicServer from 'RemoteMic/Network/Server';\nimport RemoteMicManager from 'RemoteMic/RemoteMicManager';\nimport GameState from 'Scenes/Game/Singing/GameState/GameState';\nimport InputManager from 'Scenes/Game/Singing/Input/InputManager';\nimport inputSourceListManager from 'Scenes/SelectInput/InputSources';\nimport { InputSourceNames } from 'Scenes/SelectInput/InputSources/interfaces';\nimport { debounce } from 'lodash-es';\nimport storage from 'utils/storage';\n\nconst SELECTED_INPUTS_KEY = 'playerselectedinputs';\n\nexport interface SelectedPlayerInput {\n  source: InputSourceNames;\n  deviceId?: string;\n  channel: number;\n}\n\nexport class PlayerEntity {\n  public nameOverride: string = '';\n  constructor(public number: number, public input: SelectedPlayerInput, public name?: string) {}\n\n  public changeInput = (input: InputSourceNames, channel = 0, deviceId?: string) => {\n    let restartMonitoringPromise: null | Promise<void> = null;\n    if (InputManager.monitoringStarted()) {\n      restartMonitoringPromise = InputManager.stopMonitoring();\n    }\n\n    const newInput: SelectedPlayerInput = { source: input, deviceId, channel };\n    const oldInput = this.input;\n    this.input = newInput;\n\n    events.playerInputChanged.dispatch(this.number, oldInput, newInput);\n\n    if (restartMonitoringPromise) {\n      restartMonitoringPromise.then(InputManager.startMonitoring);\n    }\n  };\n\n  public toJSON = () => ({\n    number: this.number,\n    input: this.input,\n    name: this.name,\n  });\n\n  public getName = () => {\n    return this.nameOverride || (this.name ?? `Player #${this.number + 1}`);\n  };\n\n  public isDefaultName = () => this.name === undefined;\n\n  public setName = (newName: string) => {\n    const oldName = this.name;\n    this.name = newName;\n    events.playerNameChanged.dispatch(this.number, oldName);\n  };\n\n  public static fromJSON = (data: ReturnType<PlayerEntity['toJSON']>) =>\n    new PlayerEntity(data.number, data.input, data.name);\n}\n\nclass PlayersManager {\n  public readonly MAX_PLAYERS = 2;\n  private minPlayerNumber = 2;\n\n  private players: PlayerEntity[] = [];\n  private requestingPromise: Promise<any> | null = null;\n  public constructor() {\n    const storedPlayers = storage.session.getValue<ReturnType<PlayerEntity['toJSON']>[]>(SELECTED_INPUTS_KEY) ?? [];\n    if (storedPlayers.length) {\n      this.players = storedPlayers.map(PlayerEntity.fromJSON);\n\n      if (this.getPlayers().some((player) => player.input.source === 'Microphone')) {\n        // If any microphones are selected, load the list\n        inputSourceListManager.loadMics();\n      }\n      if (this.getPlayers().some((player) => player.input.source === 'Remote Microphone')) {\n        // If there are some remote mics, restart the server\n        RemoteMicServer.start();\n      }\n    } else {\n      this.players = [\n        new PlayerEntity(0, { source: 'Dummy', deviceId: 'default', channel: 0 }),\n        new PlayerEntity(1, { source: 'Dummy', deviceId: 'default', channel: 1 }),\n      ];\n    }\n\n    events.playerInputChanged.subscribe((playerNumber, _, newInput) => {\n      const player = this.getPlayer(playerNumber);\n      if (!newInput || !player) return;\n\n      if (newInput.source === 'Remote Microphone') {\n        const microphone = RemoteMicManager.getRemoteMicById(newInput.deviceId!);\n\n        if (microphone) {\n          player.nameOverride = microphone.name;\n        }\n      } else {\n        player.nameOverride = '';\n      }\n\n      this.storePlayers();\n    });\n\n    events.playerNameChanged.subscribe(debounce(this.storePlayers, 1000));\n\n    events.remoteMicConnected.subscribe(({ id, name }) => {\n      this.getPlayers().forEach((player) => {\n        if (player.input.source === 'Remote Microphone' && player.input.deviceId === id && player.getName() !== name) {\n          player.nameOverride = name;\n        }\n      });\n    });\n  }\n\n  private storePlayers = () => {\n    storage.session.storeValue(\n      SELECTED_INPUTS_KEY,\n      this.getPlayers().map((player) => player.toJSON()),\n    );\n  };\n\n  public requestReadiness = async () => {\n    if (!this.requestingPromise) {\n      this.requestingPromise = new Promise((resolve) => {\n        const request = async () => {\n          // todo fix this -- if there's an input that is not connected, no input will be able to\n          // confirm readiness. It should request what it can and watch for input list changes\n          // and could also be simplified to only care about remote mic.\n          // Found when for some reason regular mic was assigned to a player without an id. getInputForPlayerSelected\n          // returned null and the readiness was never requested for remote mic connected for the other player.\n          const allInputsConnected = !this.getPlayers()\n            .filter((player) => player.input.source === 'Remote Microphone')\n            .some((player) => inputSourceListManager.getInputForPlayerSelected(player.input, false) === null);\n\n          if (allInputsConnected) {\n            await Promise.all(\n              this.getPlayers().map((player) =>\n                InputManager.sourceNameToInput(player.input.source)\n                  .requestReadiness(player.input.deviceId)\n                  .then(() => {\n                    events.readinessConfirmed.dispatch(player.input.deviceId!);\n                  }),\n              ),\n            );\n            events.inputListChanged.unsubscribe(request);\n            this.requestingPromise = null;\n            resolve(true);\n          }\n        };\n\n        events.inputListChanged.subscribe(request);\n        request();\n      });\n    }\n\n    return this.requestingPromise;\n  };\n\n  public getPlayers = () => this.players;\n  public getPlayer = (number: number) => this.players.find((player) => player.number === number);\n\n  public getMinPlayerNumber = () => this.minPlayerNumber;\n  public setMinPlayerNumber = (minPlayerNumber: number) => {\n    const previousMinPlayerNumber = this.minPlayerNumber;\n    this.minPlayerNumber = minPlayerNumber;\n    events.minPlayerNumberChanged.dispatch(previousMinPlayerNumber, minPlayerNumber);\n  };\n\n  public addPlayer = (playerNumber: number) => {\n    if (GameState.isPlaying() || this.getPlayer(playerNumber)) {\n      return;\n    }\n    const newPlayer = new PlayerEntity(playerNumber, { source: 'Dummy', deviceId: 'default', channel: 0 });\n    this.players.push(newPlayer);\n    this.storePlayers();\n\n    events.playerAdded.dispatch(newPlayer.number);\n    events.playerInputChanged.dispatch(newPlayer.number, undefined, newPlayer.input);\n\n    return newPlayer;\n  };\n\n  public removePlayer = (playerNumber: number) => {\n    if (GameState.isPlaying()) {\n      return;\n    }\n    const player = this.getPlayer(playerNumber);\n\n    if (player) {\n      this.players = this.players.filter((player) => player.number !== playerNumber);\n      this.storePlayers();\n      events.playerRemoved.dispatch(player);\n    }\n  };\n\n  public getInputs = () => this.getPlayers().map((player) => player.input);\n}\n\nexport default new PlayersManager();\n","import events from 'GameEvents/GameEvents';\nimport PlayersManager from 'Players/PlayersManager';\nimport RemoteMicManager from 'RemoteMic/RemoteMicManager';\nimport InputManager from 'Scenes/Game/Singing/Input/InputManager';\nimport { RemoteMicrophoneInputSource } from 'Scenes/SelectInput/InputSources/Remote';\nimport { toast } from 'react-toastify';\n\nevents.playerRemoved.subscribe((player) => {\n  if (player.input.source === RemoteMicrophoneInputSource.inputName) {\n    const remoteMic = RemoteMicManager.getRemoteMicById(player.input.deviceId!);\n\n    if (remoteMic) {\n      remoteMic.setPlayerNumber(null);\n    }\n  }\n});\n\nevents.playerInputChanged.subscribe((playerNumber, oldInput, newInput) => {\n  if (oldInput?.source === RemoteMicrophoneInputSource.inputName) {\n    const playerNumber = PlayersManager.getPlayers().find(\n      (player) => player.input.source === 'Remote Microphone' && player.input.deviceId === oldInput.deviceId,\n    )?.number;\n    const unselectedRemoteMic = RemoteMicManager.getRemoteMicById(oldInput.deviceId!);\n\n    unselectedRemoteMic?.setPlayerNumber(playerNumber !== undefined ? playerNumber : null);\n  }\n  if (newInput?.source === 'Remote Microphone') {\n    const selectedRemoteMic = RemoteMicManager.getRemoteMicById(newInput.deviceId!);\n\n    selectedRemoteMic?.setPlayerNumber(playerNumber);\n  }\n});\nevents.remoteMicConnected.subscribe(({ id }) => {\n  const playerNumberIndex = PlayersManager.getPlayers().find(\n    (player) => player.input.source === 'Remote Microphone' && player.input.deviceId === id,\n  )?.number;\n\n  if (playerNumberIndex !== undefined) {\n    const remoteMic = RemoteMicManager.getRemoteMicById(id);\n\n    remoteMic?.setPlayerNumber(playerNumberIndex);\n\n    if (InputManager.monitoringStarted()) {\n      remoteMic?.getInput()?.startMonitoring();\n    }\n  }\n});\n\nevents.playerChangeRequested.subscribe((phoneId, newPlayerNumber) => {\n  const currentPlayer = PlayersManager.getPlayers().find((player) => player.input.deviceId === phoneId);\n\n  if (currentPlayer) {\n    currentPlayer.changeInput('Dummy', 0);\n  }\n  if (newPlayerNumber !== null) {\n    PlayersManager.getPlayer(newPlayerNumber)?.changeInput('Remote Microphone', 0, phoneId);\n  }\n});\n\nevents.remoteMicConnected.subscribe(({ name, silent }) => {\n  if (!silent) {\n    toast.success(\n      <>\n        Remote microphone <b className=\"ph-no-capture\">{name}</b> connected!\n      </>,\n    );\n  }\n});\nevents.remoteMicDisconnected.subscribe(({ name }, silent) => {\n  if (!silent) {\n    toast.warning(\n      <>\n        Remote microphone <b className=\"ph-no-capture\">{name}</b> disconnected!\n      </>,\n    );\n  }\n});\n\nconst sendPlayerStates = () => {\n  const remoteMics = RemoteMicManager.getRemoteMics().map((mic) => ({\n    id: mic.id,\n    name: mic.name,\n    number: PlayersManager.getPlayers().find((player) => player.input.deviceId === mic.id)?.number ?? null,\n  }));\n\n  RemoteMicManager.broadcastToChannel('remote-mics', { t: 'remote-mics-list', list: remoteMics });\n};\n\nevents.inputListChanged.subscribe(sendPlayerStates);\nevents.playerInputChanged.subscribe(sendPlayerStates);\nevents.remoteMicSubscribed.subscribe(sendPlayerStates);\n","import events from 'GameEvents/GameEvents';\nimport PlayersManager from 'Players/PlayersManager';\nimport { InputSourceNames } from 'Scenes/SelectInput/InputSources/interfaces';\nimport { MobilePhoneModeSetting } from 'Scenes/Settings/SettingsState';\nimport { SingSetup, Song, SongPreview } from 'interfaces';\nimport posthog from 'posthog-js';\n\nconst trackSongData =\n  (event: string) =>\n  ({ artist, title }: Song | SongPreview, setup: SingSetup, scores: Array<{ name: string; score: number }> = []) => {\n    const sameScores = scores.length > 1 && scores.every((score) => score.score === scores[0].score);\n\n    const inputs: Record<string, InputSourceNames> = {};\n    PlayersManager.getPlayers().forEach((player, index) => (inputs[`input${index}`] = player.input.source));\n\n    posthog.capture(event, {\n      name: `${artist} - ${title}`,\n      artist,\n      title,\n      mode: setup.mode,\n      tolerance: setup.tolerance,\n      players: setup.players.length,\n      sameScores,\n      mobilePhoneMode: !!MobilePhoneModeSetting.get(),\n      ...inputs,\n      ...scores.reduce((curr, score, index) => ({ ...curr, [`score${index}`]: score.score }), {}),\n    });\n  };\n\nevents.songStarted.subscribe(trackSongData('songStarted'));\nevents.songEnded.subscribe(trackSongData('songEnded'));\n","import { SingSetup, SongPreview } from 'interfaces';\nimport localForage from 'localforage';\n\nexport interface SongStats {\n  plays: number;\n  scores: Array<{\n    setup: SingSetup;\n    scores: Array<{ name: string; score: number }>;\n    date: string;\n  }>;\n}\n\nexport const getSongKey = (song: Pick<SongPreview, 'artist' | 'title'>) => `${song.artist}-${song.title}`.toLowerCase();\n\nexport const fetchSongStats = async (song: Pick<SongPreview, 'artist' | 'title'>) => {\n  const storageKey = getSongKey(song);\n  return (await localForage.getItem<SongStats>(storageKey)) || { plays: 0, scores: [] };\n};\n\nexport const storeSongStats = async (song: Pick<SongPreview, 'artist' | 'title'>, stats: SongStats) => {\n  await localForage.setItem<SongStats>(getSongKey(song), stats);\n};\n","import events from 'GameEvents/GameEvents';\nimport localForage from 'localforage';\nimport { getSongKey, SongStats, storeSongStats } from 'Songs/stats/common';\n\nevents.songEnded.subscribe(async (song, setup, scores) => {\n  let currentState = await localForage.getItem<SongStats>(getSongKey(song));\n\n  const score = { setup, scores, date: new Date().toISOString() };\n  if (currentState) {\n    // there might be cases where only { plays: number } is stored\n    currentState.scores = [...(currentState?.scores ?? []), score];\n    currentState.plays = currentState.scores.length;\n  } else {\n    currentState = {\n      plays: 1,\n      scores: [score],\n    };\n  }\n\n  await storeSongStats(song, currentState);\n  events.songStatStored.dispatch(getSongKey(song), currentState);\n});\n","export const PLAYER_NAMES_SESSION_STORAGE_KEY = 'session-player-names';\nexport const PREVIOUS_PLAYER_NAMES_STORAGE_KEY = 'previous-player-names';\n","export function isNonNull<T>(value: T): value is NonNullable<T> {\n  return value !== null && value !== undefined;\n}\n","import { PLAYER_NAMES_SESSION_STORAGE_KEY, PREVIOUS_PLAYER_NAMES_STORAGE_KEY } from 'hooks/players/consts';\n\nimport events from 'GameEvents/GameEvents';\nimport PlayersManager from 'Players/PlayersManager';\nimport { isNonNull } from 'utils/isNonNull';\n\nevents.songStarted.subscribe((_, singSetup) => {\n  let currentNames = JSON.parse(window.sessionStorage.getItem(PLAYER_NAMES_SESSION_STORAGE_KEY)!) || [];\n  const thisPlayNames = singSetup.players\n    .map(({ number }) => PlayersManager.getPlayer(number))\n    .filter(isNonNull)\n    .map((player) => player.getName().trim());\n\n  const newNamesSet = [...currentNames].concat(...thisPlayNames);\n  currentNames = [...new Set(newNamesSet)].filter(Boolean);\n\n  window.sessionStorage.setItem(PLAYER_NAMES_SESSION_STORAGE_KEY, JSON.stringify(currentNames));\n  window.sessionStorage.setItem(PREVIOUS_PLAYER_NAMES_STORAGE_KEY, JSON.stringify(thisPlayNames));\n});\n\nevents.songScoreUpdated.subscribe((_, __, newName) => {\n  debugger;\n  let currentNames = JSON.parse(window.sessionStorage.getItem(PLAYER_NAMES_SESSION_STORAGE_KEY)!) || [];\n\n  const newNamesSet = [...currentNames].concat(newName);\n  currentNames = [...new Set(newNamesSet)].filter(Boolean);\n\n  window.sessionStorage.setItem(PLAYER_NAMES_SESSION_STORAGE_KEY, JSON.stringify(currentNames));\n});\n","import { captureException } from '@sentry/react';\nimport events from 'GameEvents/GameEvents';\nimport AubioStrategy from 'Scenes/Game/Singing/Input/MicStrategies/Aubio';\nimport userMediaService from 'UserMedia/userMediaService';\nimport Listener from 'utils/Listener';\nimport InputInterface from './Interface';\n\nclass SimplifiedMic extends Listener<[number, number]> implements InputInterface {\n  private stream: MediaStream | null = null;\n  private context: AudioContext | null = null;\n\n  private interval: ReturnType<typeof setInterval> | null = null;\n\n  private frequencies: [number, number] = [0, 0];\n  private volumes: [number, number] = [0, 0];\n\n  private startedMonitoring = false;\n\n  public startMonitoring = async (deviceId?: string, echoCancellation = false) => {\n    if (this.startedMonitoring) return;\n    this.startedMonitoring = true;\n\n    try {\n      this.stream = await userMediaService.getUserMedia({\n        audio: {\n          echoCancellation: true,\n          noiseSuppression: true,\n          autoGainControl: false,\n        },\n        video: false,\n      });\n      try {\n        this.context = new AudioContext();\n\n        const source = this.context.createMediaStreamSource(this.stream);\n\n        const analyserCh0 = this.context.createAnalyser();\n        analyserCh0.fftSize = 2048;\n        analyserCh0.minDecibels = -100;\n        source.connect(analyserCh0);\n\n        const strategy = new AubioStrategy();\n        await strategy.init(this.context, analyserCh0.fftSize);\n\n        this.interval = setInterval(async () => {\n          const dataCh0 = new Float32Array(analyserCh0.fftSize);\n\n          analyserCh0.getFloatTimeDomainData(dataCh0);\n          const freq = await strategy.getFrequency(dataCh0);\n          const volume = this.calculateVolume(dataCh0);\n\n          this.frequencies = [freq, freq];\n\n          this.volumes = [volume, volume];\n\n          this.onUpdate(freq, volume);\n        }, this.context.sampleRate / analyserCh0.fftSize);\n\n        events.micMonitoringStarted.dispatch();\n      } catch (e) {\n        captureException(e);\n        console.error(e);\n      }\n    } catch (e) {\n      captureException(e, { level: 'warning', extra: { message: 'SimplifiedMic.startMonitoring' } });\n      console.warn(e);\n    }\n  };\n\n  public getFrequencies = () => {\n    return this.frequencies;\n  };\n  public getVolumes = () => this.volumes;\n\n  public stopMonitoring = async () => {\n    if (!this.startedMonitoring) return;\n    this.startedMonitoring = false;\n    this.interval && clearInterval(this.interval);\n    this.stream?.getTracks().forEach(function (track) {\n      track.stop();\n    });\n    try {\n      await this.context?.close();\n    } catch (e) {\n      console.log('MicInput.stoMonitoring error', e);\n    }\n\n    events.micMonitoringStopped.dispatch();\n  };\n\n  public getInputLag = () => 180;\n  public getChannelsCount = () => 2;\n\n  private calculateVolume(input: Float32Array) {\n    let i;\n    let sum = 0.0;\n    for (i = 0; i < input.length; ++i) {\n      sum += input[i] * input[i];\n    }\n    return Math.sqrt(sum / input.length);\n  }\n  public requestReadiness = () => Promise.resolve(true);\n\n  public getStatus = () => 'ok' as const;\n}\n\nexport default new SimplifiedMic();\n","import events from 'GameEvents/GameEvents';\nimport { throttle } from 'lodash-es';\nimport posthog from 'posthog-js';\nimport { ClientTransport } from 'RemoteMic/Network/Client/Transport/interface';\nimport {\n  keyStrokes,\n  NetworkGetInputLagResponseMessage,\n  NetworkMessages,\n  NetworkRequestMicSelectMessage,\n  NetworkSongListMessage,\n  NetworkSubscribeMessage,\n  NetworkUnsubscribeMessage,\n} from 'RemoteMic/Network/messages';\nimport sendMessage from 'RemoteMic/Network/sendMessage';\nimport { getPingTime } from 'RemoteMic/Network/utils';\nimport SimplifiedMic from 'Scenes/Game/Singing/Input/SimplifiedMic';\nimport storage from 'utils/storage';\nimport { v4 } from 'uuid';\n\nexport const MIC_ID_KEY = 'MIC_CLIENT_ID';\n\nconst roundTo = (num: number, precision: number) => {\n  if (num === 0) return 0;\n\n  const multiplier = Math.pow(10, precision);\n\n  return Math.round(num * multiplier) / multiplier;\n};\n\nexport type transportCloseReason = string;\nexport type transportErrorReason = string;\n\nexport class NetworkClient {\n  private clientId = storage.getValue(MIC_ID_KEY);\n  private roomId: string | null = null;\n\n  private reconnecting = false;\n  private connected = false;\n\n  private frequencies: number[] = [];\n\n  public constructor(private transport: ClientTransport) {}\n\n  private sendFrequencies = throttle((volume: number) => {\n    const freqs = this.frequencies.map((freq) => roundTo(freq, 2));\n    this.frequencies.length = 0;\n    this.sendEvent('freq', [freqs, roundTo(volume, 4)]);\n  }, 50);\n\n  // Chunk frequencies and send them in packages\n  // One package throttled with 75ms contains ~10 frequencies\n  private onFrequencyUpdate = throttle((freq: number, volume: number) => {\n    this.frequencies.push(freq);\n\n    this.sendFrequencies(volume);\n  }, 1_000 / 60);\n\n  public getClientId = () => this.clientId;\n  private setClientId = (id: string) => {\n    this.clientId = id;\n    storage.storeValue(MIC_ID_KEY, id);\n  };\n\n  public connect = (roomId: string, name: string, silent: boolean) => {\n    if (this.clientId === null) this.setClientId(v4());\n    this.roomId = roomId;\n\n    if (this.transport.isConnected()) {\n      console.log('not reconnecting', this.transport);\n      return;\n    }\n\n    if (!this.reconnecting) {\n      events.karaokeConnectionStatusChange.dispatch('connecting');\n    }\n    this.transport.connect(\n      this.clientId,\n      this.roomId,\n      () => {\n        this.connectToServer(roomId, name, silent);\n      },\n      (reason, event) => {\n        console.log('closed connection :o', reason, event);\n        window.removeEventListener('beforeunload', this.disconnect);\n\n        if (this.reconnecting) {\n          events.karaokeConnectionStatusChange.dispatch('reconnecting');\n        } else if (!this.connected) {\n          events.karaokeConnectionStatusChange.dispatch('error', reason);\n          posthog.capture('remote_mic_connection_error', { reason });\n        } else {\n          events.karaokeConnectionStatusChange.dispatch('disconnected');\n        }\n\n        events.remoteMicPlayerSet.dispatch(null);\n        events.remoteKeyboardLayout.dispatch(undefined);\n\n        SimplifiedMic.removeListener(this.onFrequencyUpdate);\n        SimplifiedMic.stopMonitoring();\n\n        if (!this.reconnecting && this.connected) {\n          this.reconnecting = true;\n          setTimeout(() => this.reconnect(roomId, name), 1500);\n        }\n        this.connected = false;\n      },\n      console.warn,\n    );\n  };\n\n  public latency = 999;\n  public pingStart = Date.now();\n  public pinging = false;\n  private ping = () => {\n    this.pinging = true;\n    this.pingStart = getPingTime();\n\n    this.sendEvent('ping', { p: this.pingStart });\n  };\n\n  private onPong = () => {\n    this.latency = getPingTime() - this.pingStart;\n    this.pinging = false;\n\n    setTimeout(this.ping, 1000);\n  };\n\n  public connectToServer = (roomId: string, name: string, silent: boolean) => {\n    this.connected = true;\n    this.reconnecting = false;\n    events.karaokeConnectionStatusChange.dispatch('connected');\n    this.sendEvent('register', { name, id: this.clientId!, silent });\n    this.ping();\n    window.addEventListener('beforeunload', this.disconnect);\n\n    this.transport.addListener((data) => {\n      const type = data.t;\n\n      if (type === 'start-monitor') {\n        SimplifiedMic.removeListener(this.onFrequencyUpdate);\n        SimplifiedMic.addListener(this.onFrequencyUpdate);\n        // echoCancellation is turned on because without it there is silence from the mic\n        // every other second (possibly some kind of Chrome Mobile bug)\n        SimplifiedMic.startMonitoring(undefined, true);\n      } else if (type === 'stop-monitor') {\n        SimplifiedMic.removeListener(this.onFrequencyUpdate);\n        SimplifiedMic.stopMonitoring();\n      } else if (type === 'set-player-number') {\n        events.remoteMicPlayerSet.dispatch(data.playerNumber);\n      } else if (type === 'keyboard-layout') {\n        events.remoteKeyboardLayout.dispatch(data.help);\n      } else if (type === 'reload-mic') {\n        window.removeEventListener('beforeunload', this.disconnect);\n        this.sendEvent('unregister');\n        window.sessionStorage.setItem('reload-mic-request', '1');\n        document.getElementById('phone-ui-container')?.remove();\n        window.location.reload();\n      } else if (type === 'request-readiness') {\n        events.remoteReadinessRequested.dispatch();\n      } else if (type === 'pong') {\n        this.onPong();\n      } else if (type === 'ping') {\n        this.sendEvent('pong');\n      } else if (type === 'set-permissions') {\n        events.remoteMicPermissionsSet.dispatch(data.level);\n      } else if (type === 'remote-mics-list') {\n        events.remoteMicListUpdated.dispatch(data.list);\n      }\n    });\n  };\n\n  private reconnect = (roomId: string, name: string) => {\n    if (this.reconnecting) {\n      events.karaokeConnectionStatusChange.dispatch('reconnecting');\n      this.connect(roomId, name, false);\n      setTimeout(() => this.reconnect(roomId, name), 2000);\n    }\n  };\n\n  public sendKeyStroke = (key: keyStrokes) => {\n    this.sendEvent('keystroke', { key });\n  };\n\n  public searchSong = (search: string) => {\n    this.sendEvent('search-song', { search });\n  };\n\n  public requestPlayerChange = (id: string, playerNumber: number | null) => {\n    this.sendEvent<NetworkRequestMicSelectMessage>('request-mic-select', { id, playerNumber });\n  };\n\n  public confirmReadiness = () => {\n    this.sendEvent('confirm-readiness');\n  };\n\n  public subscribe = (channel: NetworkSubscribeMessage['channel']) => {\n    this.sendEvent<NetworkSubscribeMessage>('subscribe-event', { channel });\n  };\n\n  public unsubscribe = (channel: NetworkSubscribeMessage['channel']) => {\n    this.sendEvent<NetworkUnsubscribeMessage>('unsubscribe-event', { channel });\n  };\n\n  public getSongList = () => this.sendRequest<NetworkSongListMessage>({ t: 'request-songlist' }, 'songlist');\n\n  public getInputLag = () =>\n    this.sendRequest<NetworkGetInputLagResponseMessage>({ t: 'get-input-lag-request' }, 'get-input-lag-response');\n\n  public setInputLag = (value: number) =>\n    this.sendRequest<NetworkGetInputLagResponseMessage>(\n      { t: 'set-input-lag-request', value },\n      'get-input-lag-response',\n    );\n\n  private sendEvent = <T extends NetworkMessages>(type: T['t'], payload?: Parameters<typeof sendMessage<T>>[2]) => {\n    if (!this.transport.isConnected()) {\n      console.debug('not connected, skipping', type, payload);\n    } else {\n      this.transport.sendEvent({ t: type, ...payload } as T);\n    }\n  };\n\n  private sendRequest = <T extends NetworkMessages>(\n    { t, ...payload }: NetworkMessages,\n    response: T['t'],\n  ): Promise<T> => {\n    return new Promise<T>((resolve, reject) => {\n      const timeout = setTimeout(() => {\n        this.transport.removeListener(callback);\n        reject(`${t} timed out waiting for ${response}`);\n      }, 10_000);\n\n      const callback = (event: NetworkMessages) => {\n        if (event.t === response) {\n          clearTimeout(timeout);\n          this.transport.removeListener(callback);\n          resolve(event as T);\n        }\n      };\n      this.transport.addListener(callback);\n\n      this.sendEvent(t, payload);\n    });\n  };\n\n  public disconnect = () => {\n    this.transport.close();\n  };\n}\n","import { transportCloseReason, transportErrorReason } from 'RemoteMic/Network/Client/NetworkClient';\nimport { ClientTransport } from 'RemoteMic/Network/Client/Transport/interface';\nimport { NetworkMessages } from 'RemoteMic/Network/messages';\nimport { DataConnection, Peer } from 'peerjs';\nimport Listener from 'utils/Listener';\nimport peerJSOptions from 'utils/peerJSOptions';\n\nexport class PeerJSClientTransport extends Listener<[NetworkMessages]> implements ClientTransport {\n  private peer: Peer | null = null;\n  private connection: DataConnection | null = null;\n  private roomId: string | null = null;\n\n  private unavailableIdRetries = 0;\n  private unavailableIdRetryTimeout: any = null;\n\n  private connectToRoom = (\n    roomId: string,\n    onConnect: () => void,\n    onClose: (reason: transportCloseReason, originalEvent: any) => void,\n  ) => {\n    this.connection = this.peer!.connect(roomId);\n\n    this.connection.on('open', () => {\n      onConnect();\n    });\n\n    this.connection.on('close', () => onClose('closed', null));\n\n    this.connection?.on('data', (data: NetworkMessages) => {\n      console.log(data);\n      this.onUpdate(data);\n    });\n  };\n\n  public connect(\n    clientId: string,\n    roomId: string,\n    onConnect: () => void,\n    onClose: (reason: transportCloseReason, originalEvent: any) => void,\n    onError: (error: transportErrorReason, originalEvent: any) => void,\n  ): void {\n    if (this.peer && !this.peer.disconnected) {\n      this.connectToRoom(roomId, onConnect, onClose);\n    } else {\n      this.peer = new Peer(clientId, { ...peerJSOptions, debug: 3 });\n\n      this.peer.on('open', () => {\n        this.connectToRoom(roomId, onConnect, onClose);\n      });\n\n      this.peer.on('error', (e) => {\n        // Happens when the device goes from offline to online\n        if (e.type === 'unavailable-id' && this.unavailableIdRetries < 3 && this.unavailableIdRetryTimeout === null) {\n          this.peer?.destroy?.();\n          this.unavailableIdRetryTimeout = setTimeout(() => {\n            this.unavailableIdRetryTimeout = null;\n            this.unavailableIdRetries++;\n            this.connect(clientId, roomId, onConnect, onClose, onError);\n          }, 1750);\n        } else {\n          this.unavailableIdRetries = 0;\n          console.error(e.type, e);\n          onClose(e.type, e);\n        }\n      });\n    }\n  }\n\n  public sendEvent(event: NetworkMessages) {\n    this.connection?.send(event);\n  }\n\n  public isConnected = () => !!this.connection?.open && !this.peer?.disconnected;\n\n  public close = () => {\n    this.connection?.close();\n  };\n}\n","import { transportCloseReason, transportErrorReason } from 'RemoteMic/Network/Client/NetworkClient';\nimport { ClientTransport } from 'RemoteMic/Network/Client/Transport/interface';\nimport { ForwardedMessage, WEBSOCKETS_SERVER } from 'RemoteMic/Network/Server/Transport/WebSocketServer';\nimport { NetworkMessages } from 'RemoteMic/Network/messages';\nimport { pack, unpack } from 'RemoteMic/Network/utils';\nimport Listener from 'utils/Listener';\n\nexport class WebSocketClientTransport extends Listener<[NetworkMessages]> implements ClientTransport {\n  private connection: WebSocket | null = null;\n  private roomId: string | null = null;\n\n  public connect(\n    clientId: string,\n    roomId: string,\n    onConnect: () => void,\n    onClose: (reason: transportCloseReason, originalEvent: any) => void,\n    onError: (error: transportErrorReason, originalEvent: any) => void,\n  ): void {\n    this.roomId = roomId;\n    this.connection = new WebSocket(WEBSOCKETS_SERVER);\n    this.connection.binaryType = 'arraybuffer';\n\n    this.connection.onopen = () => {\n      this.connection?.send(pack({ t: 'register-player', id: clientId, roomId: roomId }));\n    };\n\n    this.connection.onmessage = (message) => {\n      const data = unpack<ForwardedMessage>(message.data);\n      if (data.t === 'forward') {\n        this.onUpdate(data.payload);\n      } else if (data.t === 'connected') {\n        onConnect();\n      }\n    };\n\n    this.connection.onclose = (event) => {\n      let reason = 'unknown';\n      try {\n        reason = JSON.parse(event.reason)?.error;\n      } catch (e) {\n        console.info('could not parse close reason', event);\n      }\n      this.clearAllListeners();\n      onClose(reason, event);\n    };\n\n    this.connection.onerror = (event) => {\n      this.clearAllListeners();\n      onError('error', event);\n    };\n  }\n\n  public sendEvent(event: NetworkMessages) {\n    this.connection?.send(pack({ t: 'forward', recipients: [this.roomId], payload: event }));\n  }\n\n  // readyState >=2 means that the connection is closing or closed\n  public isConnected = () => (this.connection?.readyState ?? Infinity) < 2;\n\n  public close = () => {\n    this.connection?.close();\n  };\n}\n","import { NetworkClient } from 'RemoteMic/Network/Client/NetworkClient';\nimport { PeerJSClientTransport } from 'RemoteMic/Network/Client/Transport/PeerJSClient';\nimport { WebSocketClientTransport } from 'RemoteMic/Network/Client/Transport/WebSocketClient';\n\nconst urlParams = new URLSearchParams(window.location.search);\nconst transport = urlParams.get('transport');\n\nconst client: NetworkClient = new NetworkClient(\n  transport === 'websocket' ? new WebSocketClientTransport() : new PeerJSClientTransport(),\n);\n\nexport default client;\n","import CameraManager from 'Camera/CameraManager';\nimport GameEvents from 'GameEvents/GameEvents'; // @ts-ignore\nimport PlayersManager from 'Players/PlayersManager';\nimport RemoteMicClient from 'RemoteMic/Network/Client';\nimport RemoteMicServer from 'RemoteMic/Network/Server';\nimport RemoteMicManager from 'RemoteMic/RemoteMicManager';\nimport GameState from 'Scenes/Game/Singing/GameState/GameState';\nimport inputManager from 'Scenes/Game/Singing/Input/InputManager';\nimport inputSources from 'Scenes/SelectInput/InputSources';\nimport SongDao from 'Songs/SongsService';\nimport UserMediaService from 'UserMedia/userMediaService';\n\n// @ts-ignore\nwindow.__exposeSingletons = () => {\n  // @ts-ignore\n  window.__singletons = {\n    RemoteMicClient,\n    RemoteMicServer,\n    GameState,\n    GameEvents,\n    RemoteMicManager,\n    SongDao,\n    InputManager: inputManager,\n    InputSourceManager: inputSources,\n    CameraManager,\n    UserMediaService,\n    PlayersManager,\n  };\n};\n\nif (process.env.NODE_ENV === 'development') {\n  // @ts-ignore\n  window.__exposeSingletons();\n  // @ts-ignore\n  console.log(window.__singletons);\n} else {\n  console.log(`Run window.__exposeSingletons() and inspect window.__singletons for debugging`);\n}\n","import isE2E from 'utils/isE2E';\n\nexport default function isDev() {\n  return process.env.NODE_ENV === 'development' && !isE2E();\n}\n","import { GameEvent } from 'GameEvents/GameEvents';\nimport { useEffect, useMemo, useState } from 'react';\n\nexport function useEventListener<T extends (...args: any[]) => void>(event: GameEvent<T>, getLast = false) {\n  const [value, setValue] = useState<Parameters<T> | null>(null);\n\n  useEffect(() => {\n    const subscriber = ((...args: Parameters<T>) => {\n      setValue(args);\n    }) as T;\n    event.subscribe(subscriber, getLast);\n    return () => event.unsubscribe(subscriber);\n  }, [event]);\n\n  return value;\n}\n\ntype AnyFunc = (...args: any[]) => void;\nexport function useEventEffect<T1 extends AnyFunc, T2 extends AnyFunc>(\n  events: [GameEvent<T1>, GameEvent<T2>],\n  effect: T1 | T2,\n): void;\nexport function useEventEffect<T1 extends AnyFunc>(events: GameEvent<T1>, effect: T1): void;\nexport function useEventEffect<T extends AnyFunc>(event: GameEvent<T> | GameEvent<T>[], effect: T) {\n  const eventList = Array.isArray(event) ? event : [event];\n\n  useEffect(() => {\n    eventList.forEach((e) => e.subscribe(effect));\n\n    return () => eventList.forEach((e) => e.unsubscribe(effect));\n  }, [...eventList, effect]);\n}\n\nexport function useEventListenerSelector<S extends any>(\n  event: GameEvent<any> | GameEvent<any>[],\n  selector: () => S,\n  dependencies: any[] = [],\n) {\n  const initialValueRef = useMemo(selector, []);\n  const [value, setValue] = useState<S>(initialValueRef);\n\n  const eventList = Array.isArray(event) ? event : [event];\n\n  useEffect(() => {\n    setValue(selector());\n  }, dependencies);\n\n  useEffect(() => {\n    const subscriber = () => setValue(selector());\n    eventList.forEach((e) => e.subscribe(subscriber));\n\n    return () => eventList.forEach((e) => e.unsubscribe(subscriber));\n  }, [...eventList]);\n\n  return value;\n}\n","export const blueFillBase = '0, 153, 255';\nexport const blueFill = (a = 1) => `rgba(${blueFillBase}, ${a})`;\nexport const blueStroke = (a = 1) => `rgba(0, 77, 128, ${a})`;\nexport const redFillBase = '255, 54, 54';\nexport const redFill = (a = 1) => `rgba(${redFillBase}, ${a})`;\nexport const redStroke = (a = 1) => `rgba(117, 25, 25, ${a})`;\n\nconst playerColors = [\n  {\n    text: blueFillBase,\n    star: {\n      fill: 'rgba(255, 183, 0, .5)',\n      stroke: 'rgba(255, 183, 0, 0)',\n      lineWidth: 1,\n    },\n    perfect: {\n      fill: blueFill(1),\n      stroke: 'white',\n      lineWidth: 1,\n    },\n    starPerfect: {\n      fill: 'rgba(255, 213, 0, 1)',\n      stroke: 'rgba(255, 183, 0, 1)',\n      lineWidth: 2,\n    },\n    hit: {\n      fill: blueFill(0.9),\n      stroke: blueStroke(0),\n      lineWidth: 1,\n    },\n    miss: {\n      fill: blueFill(0.25),\n      stroke: blueStroke(1),\n      lineWidth: 1,\n    },\n  },\n  {\n    text: redFillBase,\n    star: {\n      fill: 'rgba(255, 183, 0, .5)',\n      stroke: 'rgba(255, 183, 0, 0)',\n      lineWidth: 1,\n    },\n    perfect: {\n      fill: redFill(1),\n      stroke: 'white',\n      lineWidth: 1,\n    },\n    starPerfect: {\n      fill: 'rgba(255, 213, 0, 1)',\n      stroke: 'rgba(255, 183, 0, 1)',\n      lineWidth: 2,\n    },\n    hit: {\n      fill: redFill(0.9),\n      stroke: redStroke(0),\n      lineWidth: 1,\n    },\n    miss: {\n      fill: redFill(0.25),\n      stroke: redStroke(1),\n      lineWidth: 1,\n    },\n  },\n];\n\nconst styles = {\n  colors: {\n    players: playerColors,\n    lines: {\n      normal: {\n        fill: 'rgba(127, 127, 127, .7)',\n        stroke: 'black',\n        lineWidth: 1,\n      },\n      star: {\n        fill: 'rgba(158, 144, 106, 1)',\n        stroke: 'rgba(255, 183, 0, 1)',\n        lineWidth: 1,\n      },\n      freestyle: {\n        fill: 'rgba(255, 255, 255, 0.1)',\n        stroke: 'black',\n        lineWidth: 2,\n      },\n    },\n    text: {\n      active: 'orange',\n      activeBorder: 'rgb(101,75,22)',\n      default: 'white',\n      inactive: 'grey',\n    },\n  },\n};\n\nexport default styles;\n","import { css, keyframes } from '@emotion/react';\nimport styles from '../Scenes/Game/Singing/GameOverlay/Drawing/styles';\n\nexport const focusable = (props: { focused?: boolean }) => css`\n  ${!!props.focused && focused};\n\n  :hover {\n    ${focused};\n  }\n`;\n\nconst focusAnimation = keyframes`\n  100% {\n    box-shadow: inset 0px 0px 0px 2px ${styles.colors.text.active};\n  }\n  50% {\n    box-shadow: inset 0px 0px 0px 4px ${styles.colors.text.active};\n  }\n  0% {\n    box-shadow: inset 0px 0px 0px 2px ${styles.colors.text.active};\n  }\n`;\n\nexport const focused = css`\n  animation: ${focusAnimation} 1000ms ease-in-out infinite both;\n`;\n\nexport const typography = css`\n  font-weight: bold;\n  -webkit-text-stroke: thin black;\n  color: white;\n`;\n","import events from 'GameEvents/GameEvents';\nimport { useEventEffect } from 'GameEvents/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\n\ntype Callback = (e?: KeyboardEvent) => void;\n\n// All besides H (help) character\nexport const REGULAR_ALPHA_CHARS = 'a,b,c,d,e,f,g,i,j,k,l,m,n,o,p,r,s,t,u,w,x,y,z';\n\ntry {\n  // @ts-expect-error\n  navigator?.keyboard?.lock?.(['Escape']);\n} catch (e) {\n  console.warn(e);\n}\n\n// @ts-expect-error\nexport const supportsEscAsBack = !!navigator?.keyboard?.lock;\n\nexport interface Params {\n  up?: Callback;\n  down?: Callback;\n  left?: Callback;\n  right?: Callback;\n  accept?: Callback;\n  back?: Callback;\n  random?: Callback;\n  // alphanumeric?: () => void,\n}\n\nconst cb = (callback?: Callback) => (e: KeyboardEvent) => {\n  if (callback) {\n    e.preventDefault();\n    e.stopPropagation();\n    callback(e);\n  }\n};\n\n// useHotkeys doesn't seem to be updatable to 4.0 due to https://github.com/JohannesKlauss/react-hotkeys-hook/issues/1074\nexport default function useKeyboard(params: Params, enabled = true, deps?: any[]) {\n  useEventEffect(events.remoteKeyboardPressed, (param) => {\n    if (enabled) {\n      if (param in params) {\n        params[param]?.();\n      }\n    }\n  });\n\n  useHotkeys('up', cb(params.up), { enabled: enabled && !!params?.up }, deps);\n  useHotkeys('down', cb(params.down), { enabled: enabled && !!params?.down }, deps);\n  useHotkeys('left', cb(params.left), { enabled: enabled && !!params?.left }, deps);\n  useHotkeys('right', cb(params.right), { enabled: enabled && !!params?.right }, deps);\n  useHotkeys('Enter', cb(params.accept), { enabled: enabled && !!params?.accept }, deps);\n  useHotkeys('Escape,Backspace', cb(params.back), { enabled: enabled && !!params?.back }, deps);\n  useHotkeys('Shift+R', cb(params.random), { enabled: enabled && !!params?.random }, deps);\n}\n","import styled from '@emotion/styled';\nimport { KeyboardReturn } from '@mui/icons-material';\nimport HelpIcon from '@mui/icons-material/Help';\nimport { typography } from 'Elements/cssMixins';\nimport { MobilePhoneModeSetting, useSettingValue } from 'Scenes/Settings/SettingsState';\nimport { supportsEscAsBack } from 'hooks/useKeyboard';\nimport { ComponentType } from 'react';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport createPersistedState from 'use-persisted-state';\nimport { RegularHelpEntry } from './Context';\ninterface Props {\n  help: RegularHelpEntry;\n}\n\nconst useIsVisible = createPersistedState('keyboard-help-visibility');\n\nexport default function KeyboardHelpView({ help }: Props) {\n  const [isCollapsed, setIsVisible] = useIsVisible(true);\n\n  useHotkeys('h', () => setIsVisible(!isCollapsed), undefined, [isCollapsed]);\n\n  const helps = Object.entries(help ?? {}).filter(([, value]) => value !== undefined);\n\n  const [mobilePhoneMode] = useSettingValue(MobilePhoneModeSetting);\n\n  if (mobilePhoneMode) {\n    return null;\n  }\n\n  return (\n    <>\n      <Container\n        data-test=\"help-container\"\n        onClick={() => setIsVisible(!isCollapsed)}\n        collapsed={!isCollapsed}\n        visible={!!helps.length}\n        data-collapsed={!isCollapsed}>\n        {isCollapsed ? (\n          <>\n            <UseKeyboardIndicator>Use indicated keys on your keyboard</UseKeyboardIndicator>\n            {helps.map(([type, label]) => {\n              const { view: Component, defaultLabel } = KeyhelpComponent[type as keyof RegularHelpEntry];\n              return (\n                <Section key={type}>\n                  <SectionHelp>{label ?? defaultLabel}</SectionHelp>\n                  <SectionKeys>\n                    <Component />\n                  </SectionKeys>\n                </Section>\n              );\n            })}\n            <Section>\n              <SectionHelp>Show/hide this help</SectionHelp>\n              <SectionKeys>\n                <Kbd>H</Kbd>\n              </SectionKeys>\n            </Section>\n          </>\n        ) : (\n          <HelpIcon onClick={() => setIsVisible(!isCollapsed)} />\n        )}\n      </Container>\n    </>\n  );\n}\n\nconst HorizontalVerticalBase = ({ vertical = false, horizontal = false }) => (\n  <>\n    <Kbd disabled={!vertical}>↑</Kbd>\n    <br />\n    <Kbd disabled={!horizontal}>←</Kbd>\n    <Kbd disabled={!vertical}>↓</Kbd>\n    <Kbd disabled={!horizontal}>→</Kbd>\n  </>\n);\n\nconst Horizontal = () => <HorizontalVerticalBase horizontal />;\nconst Vertical = () => <HorizontalVerticalBase vertical />;\nconst HorizontalVertical = () => <HorizontalVerticalBase vertical horizontal />;\nconst Accept = () => (\n  <Kbd>\n    Enter <KeyboardReturn />\n  </Kbd>\n);\nconst Back = () => (supportsEscAsBack ? <Kbd>Escape</Kbd> : <Kbd>Backspace ⌫</Kbd>);\nconst ShiftLetter = (letter: string) => () =>\n  (\n    <>\n      <Kbd>Shift</Kbd> + <Kbd>{letter.toUpperCase()}</Kbd>\n    </>\n  );\n\nconst KeyhelpComponent: Record<keyof RegularHelpEntry, { view: ComponentType; defaultLabel: string }> = {\n  'horizontal-vertical': { view: HorizontalVertical, defaultLabel: 'Navigate' },\n  horizontal: { view: Horizontal, defaultLabel: 'Navigate' },\n  vertical: { view: Vertical, defaultLabel: 'Navigate' },\n  accept: { view: Accept, defaultLabel: 'Select' },\n  back: { view: Back, defaultLabel: 'Go back' },\n  shiftR: { view: ShiftLetter('r'), defaultLabel: 'Pick random' },\n};\n\nconst Section = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  gap: 1rem;\n`;\n\nconst SectionKeys = styled.div`\n  flex-wrap: nowrap;\n  text-align: center;\n  flex: 2;\n  color: white;\n  font-weight: bold;\n`;\nconst SectionHelp = styled.span`\n  flex: 3;\n  ${typography};\n  font-size: 2rem;\n  text-align: right;\n`;\n\nconst UseKeyboardIndicator = styled.div`\n  position: absolute;\n  inset: 0 0 0 0;\n  background: rgba(0, 0, 0, 0.75);\n  ${typography};\n  font-size: 2rem;\n  padding: 2rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  opacity: 0;\n  transition: 300ms;\n  visibility: hidden;\n`;\n\nconst Container = styled.div<{ collapsed: boolean; visible: boolean }>`\n  position: fixed;\n  top: 10rem;\n  right: 5.5rem;\n  padding: 0.5rem;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  width: ${(props) => (props.collapsed ? 'auto' : '34rem')};\n  opacity: ${(props) => (props.collapsed ? 0.5 : 1)};\n  visibility: ${(props) => (props.visible ? 'visible' : 'hidden')};\n  cursor: pointer;\n\n  z-index: 10000;\n\n  @media (max-width: 560px) {\n    display: none;\n  }\n\n  view-transition-name: help-view;\n\n  :hover {\n    ${UseKeyboardIndicator} {\n      opacity: 1;\n      visibility: visible;\n    }\n  }\n\n  svg {\n    fill: white;\n  }\n`;\n\nconst Kbd = styled.kbd<{ disabled?: boolean }>`\n  margin: 0.2rem;\n  padding: 0.12rem 0.9rem;\n  border-radius: 0.3rem;\n  border: 0.1rem solid rgb(204, 204, 204);\n  color: rgb(51, 51, 51);\n  line-height: 1.4;\n  font-size: 1.6rem;\n  display: inline-block;\n  box-shadow: 0 0.1rem 0 rgba(0, 0, 0, 0.2), inset 0 0 0 0.2rem #ffffff;\n  background-color: rgb(247, 247, 247);\n  text-shadow: 0 0.1rem 0 #fff;\n  font-weight: normal;\n\n  opacity: ${(props) => (props.disabled ? 0.25 : 1)};\n`;\n","import events from 'GameEvents/GameEvents';\nimport { useEventEffect } from 'GameEvents/hooks';\nimport { omit } from 'lodash-es';\nimport { createContext, FunctionComponent, PropsWithChildren, useEffect, useState } from 'react';\nimport RemoteMicManager from 'RemoteMic/RemoteMicManager';\nimport KeyboardHelpView from './HelpView';\n\ntype keys = 'horizontal' | 'vertical' | 'horizontal-vertical' | 'accept' | 'back' | 'shiftR';\n\ntype remoteActions = 'search';\n\nexport type RegularHelpEntry = Partial<Record<keys, string | null>>;\nexport type HelpEntry = RegularHelpEntry & { remote?: remoteActions[] };\n\nexport const KeyboardHelpContext = createContext({\n  setKeyboard: (name: string, helpEntry: HelpEntry): void => {},\n  unsetKeyboard: (name: string): void => {},\n});\n\ntype KeyboardsList = Record<string, HelpEntry>;\n\nexport const KeyboardHelpProvider: FunctionComponent<PropsWithChildren> = ({ children }) => {\n  const [keyboards, setKeyboards] = useState<KeyboardsList>({});\n\n  const setKeyboard = (name: string, helpEntry: HelpEntry) => {\n    setKeyboards((kbs) => ({\n      ...kbs,\n      [name]: helpEntry,\n    }));\n  };\n\n  const unsetKeyboard = (name: string) => setKeyboards((kbs) => omit(kbs, [name]));\n\n  const [name, help] = Object.entries(keyboards).at(-1) ?? [];\n\n  useEventEffect(events.remoteMicConnected, ({ id }) => {\n    RemoteMicManager.getRemoteMicById(id)?.connection.send({\n      t: 'keyboard-layout',\n      help,\n    });\n  });\n\n  useEffect(() => {\n    RemoteMicManager.broadcast({\n      t: 'keyboard-layout',\n      help,\n    });\n  }, [name]);\n\n  const { remote, ...rest } = help ?? {};\n\n  return (\n    <KeyboardHelpContext.Provider value={{ setKeyboard, unsetKeyboard }}>\n      {children}\n      <KeyboardHelpView help={rest} />\n    </KeyboardHelpContext.Provider>\n  );\n};\n","import styled from '@emotion/styled';\nimport React, { createContext, useCallback, useContext, useEffect, useState } from 'react';\nimport { blueFill, blueStroke, redStroke } from 'Scenes/Game/Singing/GameOverlay/Drawing/styles';\n\nexport const BackgroundContext = createContext({\n  visible: true,\n  setVisibility: (visible: boolean): void => undefined,\n});\n\nexport const useBackground = (shouldBeVisible: boolean) => {\n  const background = useContext(BackgroundContext);\n  useEffect(() => {\n    if (shouldBeVisible !== background.visible) {\n      background.setVisibility(shouldBeVisible);\n    }\n  }, [shouldBeVisible, background.visible, background.setVisibility]);\n};\n\nexport default function LayoutWithBackgroundProvider({ children }: React.PropsWithChildren) {\n  const [visible, setVisible] = useState(true);\n\n  const setVisibility = useCallback(\n    (newValue: boolean) => {\n      setVisible(newValue);\n    },\n    [setVisible],\n  );\n\n  return (\n    <BackgroundContext.Provider value={{ visible, setVisibility }}>\n      {visible && <Background />}\n      {children}\n    </BackgroundContext.Provider>\n  );\n}\n\nexport const BackgroundStatic = styled.div`\n  background-color: white;\n  background-image: linear-gradient(-45deg, ${redStroke()}, ${blueFill()}, ${blueStroke()}, ${redStroke()});\n  background-size: 400% 400%;\n\n  width: 100%;\n  height: 100%;\n`;\n\nconst Background = styled(BackgroundStatic)`\n  z-index: -1;\n  top: 0;\n  position: fixed;\n\n  ${(props) => (props.theme.graphicSetting === 'high' ? 'animation: gradient 15s ease infinite' : '')};\n  ${(props) => (props.theme.graphicSetting === 'low' ? 'background-position: 100% 50%' : '')};\n\n  @keyframes gradient {\n    0% {\n      background-position: 0% 50%;\n    }\n    50% {\n      background-position: 100% 50%;\n    }\n    100% {\n      background-position: 0% 50%;\n    }\n  }\n`;\n","export default function NormalizeFontSize({ size = 16 }) {\n  return (\n    <style>\n      {`html {\n                font-size: ${size}px !important;\n            }`}\n    </style>\n  );\n}\n","import styled from '@emotion/styled';\nimport { SvgIcon } from '@mui/material';\nimport styles from 'Scenes/Game/Singing/GameOverlay/Drawing/styles';\nimport { ComponentProps } from 'react';\n\nexport const MicIcon = ({ ...props }: ComponentProps<typeof SvgIcon>) => (\n  <SvgIcon viewBox=\"0 0 512 512\" {...props}>\n    <path\n      stroke=\"black\"\n      strokeWidth=\"2%\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      d=\"M252.529,162.029l168.125,210.156c-12.313,1.25-24.031,6.438-33.031,15.438s-14.188,20.719-15.438,33.031L162.029,252.545  c-3.563-24.922,4.813-50.078,22.625-67.891C202.467,166.857,227.623,158.467,252.529,162.029z M398.936,398.936  c-9.063,9.063-13.031,22.063-10.625,34.656l45.281,45.25c12.5,12.5,32.75,12.5,45.25,0s12.5-32.75,0-45.25l-45.25-45.281  C420.998,385.904,407.998,389.873,398.936,398.936z M162.029,162.029c18.594-18.594,43.188-29.891,68.969-32.297  c-3.375-24.563-14.906-49.391-35.031-69.516c-43.75-43.75-109.594-48.813-147.063-11.313  c-37.5,37.484-32.438,103.328,11.313,147.078c20.125,20.125,44.938,31.656,69.5,35.031  C132.154,205.217,143.436,180.623,162.029,162.029z\"\n    />\n  </SvgIcon>\n);\n\nexport const MicIconRed = styled(MicIcon)`\n  fill: rgba(${styles.colors.players[1].text});\n`;\nexport const MicIconBlue = styled(MicIcon)`\n  fill: rgba(${styles.colors.players[0].text});\n`;\n","import styled from '@emotion/styled';\nimport ListIcon from '@mui/icons-material/List';\nimport SettingsIcon from '@mui/icons-material/Settings';\nimport { MicIcon } from 'Elements/MicIcon';\nimport styles from 'Scenes/Game/Singing/GameOverlay/Drawing/styles';\nimport { PhoneTabs } from 'Scenes/RemoteMic/RemoteMic';\n\ninterface Props {\n  active: PhoneTabs;\n  setActiveTab: (active: PhoneTabs) => void;\n}\n\nexport default function BottomBar({ active, setActiveTab }: Props) {\n  return (\n    <Container>\n      <ItemContainer\n        active={active === 'microphone'}\n        onClick={() => setActiveTab('microphone')}\n        data-test=\"menu-microphone\">\n        <ItemIcon>\n          <MicIcon />\n        </ItemIcon>\n        <ItemTitle>Microphone</ItemTitle>\n      </ItemContainer>\n      <ItemContainer\n        active={active === 'song-list'}\n        onClick={() => setActiveTab('song-list')}\n        data-test=\"menu-song-list\">\n        <ItemIcon>\n          <ListIcon />\n        </ItemIcon>\n        <ItemTitle>Song list</ItemTitle>\n      </ItemContainer>\n      <ItemContainer active={active === 'settings'} onClick={() => setActiveTab('settings')} data-test=\"menu-settings\">\n        <ItemIcon>\n          <SettingsIcon />\n        </ItemIcon>\n        <ItemTitle>Settings</ItemTitle>\n      </ItemContainer>\n    </Container>\n  );\n}\n\nconst Container = styled.div`\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  display: flex;\n  align-items: stretch;\n  width: 100%;\n  gap: 1px;\n  background: #424242;\n\n  @media (max-height: 500px) and (min-aspect-ratio: 16/10) {\n    max-width: 400px;\n    transform: scale(0.75);\n    transform-origin: bottom left;\n  }\n`;\n\nconst ItemContainer = styled.div<{ active?: boolean }>`\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  background: black;\n  padding: 1rem;\n  font-size: 1.5rem;\n  gap: 0.5rem;\n  color: ${(props) => (props.active ? styles.colors.text.active : '#cecece')};\n`;\n\nconst ItemIcon = styled.div`\n  svg {\n    width: 2.5rem;\n    height: 2.5rem;\n  }\n  font-size: 2rem;\n`;\nconst ItemTitle = styled.div``;\n","import { css } from '@emotion/react';\nimport styled from '@emotion/styled';\nimport { focused, typography } from 'Elements/cssMixins';\nimport isE2E from 'utils/isE2E';\nimport styles from '../Scenes/Game/Singing/GameOverlay/Drawing/styles';\n\nexport const Button = styled.button<{ focused?: boolean }>`\n  padding: 0.1rem 0.3rem;\n  font-size: 2.6rem;\n  display: block;\n  text-align: center;\n  cursor: pointer;\n  border: 0;\n\n  background-color: rgba(0, 0, 0, 0.75);\n  text-transform: uppercase;\n  letter-spacing: 0.2rem;\n\n  ${typography};\n\n  pointer-events: auto;\n  ${(props) => props.focused && buttonFocused};\n  box-sizing: border-box;\n\n  transition: 300ms;\n\n  :not(:disabled) {\n    :hover {\n      ${focused};\n    }\n  }\n`;\n// Disable for E2E as they wait for animation to finish (and since it's infinite they timeout)\nconst buttonFocusedAnimation = isE2E()\n  ? css``\n  : css`\n      @keyframes button-focus-loop {\n        0%,\n        100% {\n          transform: scale(1.045);\n        }\n        50% {\n          transform: scale(1.055);\n        }\n      }\n      animation: button-focus-loop 600ms ease-in-out infinite both;\n    `;\n\nexport const buttonFocused = css`\n  transform: scale(1.05);\n  background: ${styles.colors.text.active};\n\n  ${buttonFocusedAnimation};\n`;\n","import styled from '@emotion/styled';\nimport { Button } from './Button';\n\ntype ButtonSizes = 'small' | 'normal';\n\nexport const MenuButton = styled(Button)<{ focused?: boolean; size?: ButtonSizes }>`\n  margin: 0.5rem 0;\n  height: ${(props) => (props.size === 'small' ? '5rem' : '10rem')};\n  border: 0 solid black;\n\n  :disabled {\n    cursor: default;\n    color: #989898;\n    background-color: #212121;\n    border-width: 0.3rem;\n  }\n`;\n\nexport const MenuContainer = styled.div`\n  background: rgba(0, 0, 0, 0.5);\n  padding: 1.5rem;\n  width: 100vw;\n  box-sizing: border-box;\n  max-width: 75rem;\n  margin: 2rem auto 0 auto;\n  font-size: 2.6rem;\n  display: flex;\n  flex-direction: column;\n  gap: 2rem;\n\n  view-transition-name: menu-container;\n`;\n","import styled from '@emotion/styled';\nimport { PropsWithChildren } from 'react';\n\ninterface Props extends PropsWithChildren {\n  onClose?: () => void;\n}\n\nexport default function Modal({ children, onClose }: Props) {\n  return (\n    <>\n      <Backdrop onClick={onClose} />\n      <Container onClick={onClose}>\n        <div onClick={(e) => e.stopPropagation()}>{children}</div>\n      </Container>\n    </>\n  );\n}\n\nconst Container = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100vw;\n  height: 100vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n  overflow: auto;\n`;\n\nconst Backdrop = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  background: rgba(0, 0, 0, 0.7);\n  width: 100vw;\n  height: 100vh;\n  z-index: 2;\n  backdrop-filter: blur(20px);\n`;\n","import styled from '@emotion/styled';\nimport { Laptop, PhoneAndroid, Wifi } from '@mui/icons-material';\nimport { MenuButton, MenuContainer } from 'Elements/Menu';\nimport Modal from 'Elements/Modal';\nimport styles from 'Scenes/Game/Singing/GameOverlay/Drawing/styles';\nimport React, { useEffect } from 'react';\nimport storage from 'utils/storage';\n\ninterface Props {}\n\nconst CONFIRM_WIFI_KEY = 'confirmed-wifi';\n\nexport default function ConfirmWifiModal({}: Props) {\n  const [closed, setClosed] = React.useState(storage.session.getValue(CONFIRM_WIFI_KEY) ?? false);\n\n  const closeModal = () => {\n    storage.session.storeValue(CONFIRM_WIFI_KEY, true);\n    setClosed(true);\n  };\n\n  useEffect(() => {\n    if (navigator?.connection) {\n      if (navigator?.connection?.type === 'wifi') {\n        closeModal();\n      } else {\n        const onChange = () => {\n          if (navigator?.connection?.type === 'wifi') {\n            closeModal();\n          }\n        };\n        navigator?.connection?.addEventListener?.('change', onChange);\n\n        return () => navigator?.connection?.removeEventListener?.('change', onChange);\n      }\n    }\n  }, []);\n\n  if (closed) return null;\n\n  return (\n    <Modal onClose={closeModal}>\n      <Menu>\n        <Wrapper>\n          <h3>\n            Connect to the <strong>same Wi-Fi</strong>\n          </h3>\n          <IconsWrapper>\n            <PhoneAndroid />\n            ...\n            <Wifi />\n            ...\n            <Laptop />\n          </IconsWrapper>\n\n          <h4>Connect to the same Wi-Fi as the game.</h4>\n        </Wrapper>\n        <h6>Otherwise microphones might not work properly.</h6>\n        <MenuButton onClick={closeModal} focused data-test=\"confirm-wifi-connection\">\n          I'm connected, continue\n        </MenuButton>\n      </Menu>\n    </Modal>\n  );\n}\n\nconst Menu = styled(MenuContainer)`\n  gap: 1rem;\n`;\n\nconst Wrapper = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 2rem;\n`;\n\nconst IconsWrapper = styled.div`\n  margin: 2rem 0;\n  display: flex;\n  color: white;\n  align-items: center;\n  gap: 2rem;\n\n  @keyframes pulse {\n    0% {\n      color: ${styles.colors.text.default};\n      transform: scale(1);\n    }\n    25% {\n      color: ${styles.colors.text.active};\n      transform: scale(1.1);\n    }\n    50% {\n      color: ${styles.colors.text.default};\n      transform: scale(1);\n    }\n  }\n\n  svg {\n    animation: pulse 2s infinite;\n    font-size: 7rem;\n\n    :nth-of-type(1) {\n      animation-delay: 0s;\n    }\n    :nth-of-type(2) {\n      animation-delay: 0.5s;\n    }\n    :nth-of-type(3) {\n      animation-delay: 1s;\n    }\n  }\n`;\n","import styled from '@emotion/styled';\nimport { focusable, typography } from 'Elements/cssMixins';\nimport { PropsWithChildren, ReactNode } from 'react';\nimport styles from 'Scenes/Game/Singing/GameOverlay/Drawing/styles';\nimport { ValuesType } from 'utility-types';\n\ninterface Props extends PropsWithChildren {\n  focused: boolean;\n  label: ReactNode;\n  value: ReactNode;\n  info?: ReactNode;\n  onClick?: () => void;\n}\n\nexport function nextIndex<T extends readonly any[]>(values: T, current: number, direction: 1 | -1 = 1): number {\n  return direction === 1 ? (current + 1) % values.length : (current + values.length - 1) % values.length;\n}\nexport function nextValueIndex<T extends readonly any[]>(\n  values: T,\n  current: ValuesType<T>,\n  direction: 1 | -1 = 1,\n): number {\n  return nextIndex(values, values.indexOf(current), direction);\n}\nexport function nextValue<T extends readonly any[]>(\n  values: T,\n  current: ValuesType<T>,\n  direction: 1 | -1 = 1,\n): ValuesType<T> {\n  return values[nextValueIndex(values, current, direction)];\n}\n\nexport const Switcher = ({ focused, label, value, onClick, info, children, ...restProps }: Props) => (\n  <Container>\n    <ConfigurationPosition focused={focused} onClick={onClick} {...restProps}>\n      <span>{label ? <>{label}:</> : ''}</span> <ConfigValue>{value}</ConfigValue>\n      {children ?? null}\n    </ConfigurationPosition>\n    {info && <InfoText>{info}</InfoText>}\n  </Container>\n);\n\nconst Container = styled.div``;\n\nexport const InfoText = styled.div`\n  ${typography};\n  font-size: 2rem;\n  padding: 1rem 0.5rem 0;\n  text-align: justify;\n`;\n\nconst ConfigurationPosition = styled.span<{ focused: boolean; expanded?: boolean }>`\n  background: rgba(0, 0, 0, 0.7);\n\n  width: auto;\n  ${typography};\n\n  text-align: right;\n  font-size: ${({ expanded }) => (expanded ? '6rem' : '2.7rem')};\n  cursor: pointer;\n  padding: 0.65rem;\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n\n  ${focusable}\n`;\n\nconst ConfigValue = styled.span`\n  color: ${styles.colors.text.active};\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n  padding-left: 1rem;\n`;\n","import styled from '@emotion/styled';\nimport { InfoText } from 'Elements/Switcher';\nimport { focusable, typography } from 'Elements/cssMixins';\nimport styles from 'Scenes/Game/Singing/GameOverlay/Drawing/styles';\nimport { REGULAR_ALPHA_CHARS } from 'hooks/useKeyboard';\nimport {\n  DetailedHTMLProps,\n  ForwardedRef,\n  InputHTMLAttributes,\n  ReactNode,\n  forwardRef,\n  useImperativeHandle,\n  useRef,\n} from 'react';\nimport { useHotkeys } from 'react-hotkeys-hook';\n\ninterface Props extends Omit<DetailedHTMLProps<InputHTMLAttributes<HTMLInputElement>, HTMLInputElement>, 'onChange'> {\n  focused: boolean;\n  label: ReactNode;\n  value: string;\n  onChange: (value: string) => void;\n  disabled?: boolean;\n  adornment?: ReactNode;\n  info?: ReactNode;\n}\n\nexport const Input = forwardRef(\n  (\n    { focused, label, value, onChange, disabled, className, adornment, info, ...restProps }: Props,\n    forwardedRef: ForwardedRef<HTMLInputElement>,\n  ) => {\n    const inputRef = useRef<HTMLInputElement>(null);\n    useImperativeHandle(forwardedRef, () => inputRef.current!);\n\n    useHotkeys(REGULAR_ALPHA_CHARS, () => inputRef.current?.focus(), { enabled: focused });\n\n    return (\n      <div>\n        <Container focused={focused} className={className}>\n          <Label>{label}</Label>\n          <StyledInput\n            value={value}\n            onChange={(e) => onChange(e.target.value)}\n            {...restProps}\n            disabled={disabled}\n            ref={inputRef}\n          />\n          {adornment && <Adornment>{adornment}</Adornment>}\n        </Container>\n        {info && <InfoText>{info}</InfoText>}\n      </div>\n    );\n  },\n);\n\nconst Adornment = styled.span``;\n\nconst Container = styled.div<{ focused: boolean }>`\n  background: black;\n  caret: underscore;\n  ${focusable};\n  ${typography};\n  width: auto;\n  display: flex;\n  cursor: text;\n  padding: 0.25em;\n  align-items: center;\n`;\n\nconst Label = styled.span`\n  padding-right: 0.5em;\n  white-space: nowrap;\n  width: auto;\n\n  svg {\n    font-size: 1em;\n  }\n`;\n\nconst StyledInput = styled.input`\n  padding: 0;\n  border: 0;\n  background: transparent;\n  caret: underscore;\n  ${typography};\n  color: ${styles.colors.text.active};\n  width: 100%;\n  font-size: 1em;\n\n  &:focus {\n    outline: none;\n  }\n`;\n","import styled from '@emotion/styled';\nimport { QrCode2, Warning, Wifi } from '@mui/icons-material';\nimport { CircularProgress } from '@mui/material';\nimport { Input } from 'Elements/Input';\nimport { MenuButton } from 'Elements/Menu';\nimport RemoteMicClient from 'RemoteMic/Network/Client';\nimport { transportErrorReason } from 'RemoteMic/Network/Client/NetworkClient';\nimport { ConnectionStatuses } from 'Scenes/RemoteMic/RemoteMic';\nimport { MAX_NAME_LENGTH } from 'consts';\nimport { FormEventHandler, useEffect, useRef, useState } from 'react';\nimport createPersistedState from 'use-persisted-state';\n\ninterface Props {\n  roomId: string;\n  isVisible: boolean;\n  connectionStatus: ConnectionStatuses;\n  onConnect: (silent: boolean) => void;\n  connectionError?: transportErrorReason;\n}\n\nconst usePersistedName = createPersistedState<string>('remote_mic_name');\n\nfunction Connect({ isVisible, roomId, connectionStatus, onConnect, connectionError }: Props) {\n  const [name, setName] = usePersistedName('');\n  const inputRef = useRef<HTMLInputElement | null>(null);\n\n  const disabled = connectionStatus !== 'uninitialised' && connectionStatus !== 'error';\n\n  const connectToServer = (silent = false) => {\n    RemoteMicClient.connect(roomId, name, silent);\n    onConnect(silent);\n  };\n\n  const handleConnect: FormEventHandler<HTMLFormElement> = (e) => {\n    e.preventDefault();\n\n    if (name === '') {\n      inputRef.current?.focus();\n    } else {\n      connectToServer();\n    }\n  };\n\n  useEffect(() => {\n    inputRef.current?.focus();\n\n    if (window.sessionStorage.getItem('reload-mic-request') !== null) {\n      // give other components option to read the property on mount before its removed\n      window.setTimeout(() => window.sessionStorage.removeItem('reload-mic-request'), 1);\n      connectToServer(true);\n    }\n  }, []);\n\n  const [showConnectionTip, setShowConnectionTip] = useState(false);\n\n  useEffect(() => {\n    setShowConnectionTip(false);\n    if (connectionStatus === 'connecting' || connectionStatus === 'reconnecting') {\n      const timeout = setTimeout(() => setShowConnectionTip(true), 2000);\n\n      return () => clearTimeout(timeout);\n    }\n  }, [connectionStatus]);\n\n  return isVisible ? (\n    <>\n      <Form onSubmit={handleConnect}>\n        <Input\n          maxLength={MAX_NAME_LENGTH}\n          focused={false}\n          label=\"Name\"\n          placeholder=\"Enter your name…\"\n          value={name}\n          onChange={setName}\n          ref={inputRef}\n          disabled={disabled}\n          autoFocus\n          data-test=\"player-name-input\"\n        />\n        <ConnectButton type=\"submit\" disabled={disabled} data-test=\"connect-button\">\n          {connectionStatus === 'connecting' && <CircularProgress size={'1em'} />}\n          {connectionStatus === 'uninitialised' ? 'Connect' : connectionStatus.toUpperCase()}\n        </ConnectButton>\n        {(showConnectionTip || connectionError) && (\n          <>\n            {showConnectionTip && <h3>If it doesn't connect</h3>}\n            {connectionError && (\n              <>\n                <h3>\n                  <strong>\n                    <Warning />\n                  </strong>{' '}\n                  Could not connect:\n                </h3>\n                <h6>\n                  Error code: <strong>{connectionError}</strong>\n                </h6>\n                <br />\n              </>\n            )}\n            {connectionError === 'peer-unavailable' ? (\n              <>\n                <h4>The game seems to be offline 🤔</h4>\n                <h5>\n                  1. Refresh (<strong>F5</strong>) the Karaoke Game on the PC\n                </h5>\n                <h5>\n                  2. Scan the{' '}\n                  <strong>\n                    <QrCode2 /> QR Code\n                  </strong>{' '}\n                  again\n                </h5>\n                <h5>\n                  3. Make sure you are in the same{' '}\n                  <strong>\n                    <Wifi /> Wi-Fi\n                  </strong>\n                </h5>\n              </>\n            ) : connectionError === 'network' ? (\n              <>\n                <h4>No internet access 💀</h4>\n                <h5>\n                  Make sure you are in the same{' '}\n                  <strong>\n                    <Wifi /> Wi-Fi\n                  </strong>\n                  and that it has internet connection\n                </h5>\n              </>\n            ) : (\n              <>\n                <h5>\n                  1. Make sure you are in the same{' '}\n                  <strong>\n                    <Wifi /> Wi-Fi\n                  </strong>\n                </h5>\n                <h5>\n                  2. Refresh (<strong>F5</strong>) the Karaoke Game on the PC\n                </h5>\n                <h5>\n                  3. Scan the{' '}\n                  <strong>\n                    <QrCode2 /> QR Code\n                  </strong>{' '}\n                  again\n                </h5>\n              </>\n            )}\n          </>\n        )}\n      </Form>\n    </>\n  ) : null;\n}\nexport default Connect;\n\nconst Form = styled.form`\n  display: flex;\n  flex-direction: column;\n`;\n\nconst ConnectButton = styled(MenuButton)`\n  margin-bottom: 0;\n  height: 72px;\n`;\n","import { useEffect, useState } from 'react';\n\n// Hook\nexport default function useDebounce<T>(value: T, delay: number) {\n  // State and setters for debounced value\n  const [debouncedValue, setDebouncedValue] = useState(value);\n  useEffect(\n    () => {\n      // Update debounced value after delay\n      const handler = setTimeout(() => {\n        setDebouncedValue(value);\n      }, delay);\n      // Cancel the timeout if value changes (also on delay change or unmount)\n      // This is how we prevent debounced value from updating if value is changed ...\n      // .. within the delay period. Timeout gets cleared and restarted.\n      return () => {\n        clearTimeout(handler);\n      };\n    },\n    [value, delay], // Only re-call effect if value or delay changes\n  );\n  return debouncedValue;\n}\n","import styled from '@emotion/styled';\nimport { Search } from '@mui/icons-material';\nimport { Input } from 'Elements/Input';\nimport RemoteMicClient from 'RemoteMic/Network/Client';\nimport { MAX_NAME_LENGTH } from 'consts';\nimport useDebounce from 'hooks/useDebounce';\nimport { useEffect, useRef, useState } from 'react';\nimport { usePrevious, useUnmount } from 'react-use';\n\ninterface Props {\n  // children: (props: { onClick: () => void }) => ReactNode;\n  onSearchStateChange?: (isActive: boolean) => void;\n}\n\nfunction RemoteSongSearch({ onSearchStateChange }: Props) {\n  const [search, setSearch] = useState('');\n  const inputRef = useRef<HTMLInputElement | null>(null);\n\n  const debouncedSearch = useDebounce(search, 100);\n\n  const previousSearch = usePrevious(debouncedSearch);\n  useEffect(() => {\n    if (previousSearch !== debouncedSearch) {\n      RemoteMicClient.searchSong(debouncedSearch.trim());\n    }\n  }, [previousSearch, debouncedSearch]);\n\n  useUnmount(() => onSearchStateChange?.(false));\n\n  return (\n    <SearchInput\n      onFocus={() => onSearchStateChange?.(true)}\n      onBlur={() => onSearchStateChange?.(false)}\n      maxLength={MAX_NAME_LENGTH}\n      focused={false}\n      label={<Search />}\n      placeholder=\"Search for a song…\"\n      value={search}\n      onChange={setSearch}\n      ref={inputRef}\n      data-test=\"search-song-input\"\n    />\n  );\n}\n\nconst SearchInput = styled(Input)`\n  width: 100%;\n  margin-bottom: 1rem;\n`;\nexport default RemoteSongSearch;\n","import { css } from '@emotion/react';\nimport styled from '@emotion/styled';\nimport {\n  ArrowBack,\n  ArrowForward,\n  Games,\n  KeyboardArrowDown,\n  KeyboardArrowLeft,\n  KeyboardArrowRight,\n  KeyboardArrowUp,\n  Shuffle,\n} from '@mui/icons-material';\nimport events from 'GameEvents/GameEvents';\nimport { useEventListener } from 'GameEvents/hooks';\nimport RemoteMicClient from 'RemoteMic/Network/Client';\nimport { keyStrokes } from 'RemoteMic/Network/messages';\nimport RemoteSongSearch from 'Scenes/RemoteMic/Panels/Microphone/RemoteSongSearch';\n\ninterface Props {\n  onSearchStateChange?: (isActive: boolean) => void;\n}\n\nexport default function RemoteMicKeyboard({ onSearchStateChange }: Props) {\n  const [keyboard] = useEventListener(events.remoteKeyboardLayout, true) ?? [];\n\n  const isHorizontal = keyboard?.horizontal !== undefined || keyboard?.['horizontal-vertical'] !== undefined;\n  const isVertical = keyboard?.vertical !== undefined || keyboard?.['horizontal-vertical'] !== undefined;\n\n  const onPress = (key: keyStrokes) => () => {\n    // navigator?.vibrate?.(200);\n    RemoteMicClient.sendKeyStroke(key);\n  };\n\n  return keyboard !== undefined ? (\n    <Container data-test=\"remote-keyboard\">\n      {keyboard?.remote?.includes('search') && <RemoteSongSearch onSearchStateChange={onSearchStateChange} />}\n      {(isHorizontal || isVertical) && (\n        <ActionsContainer>\n          <ArrowsContainer>\n            <ArrowButton onClick={onPress('up')} disabled={!isVertical} data-test=\"arrow-up\">\n              <KeyboardArrowUp />\n            </ArrowButton>\n          </ArrowsContainer>\n          <ArrowsContainer>\n            <ArrowButton onClick={onPress('left')} disabled={!isHorizontal} data-test=\"arrow-left\">\n              <KeyboardArrowLeft />\n            </ArrowButton>\n            <ArrowButton disabled>\n              <Games />\n            </ArrowButton>\n            <ArrowButton onClick={onPress('right')} disabled={!isHorizontal} data-test=\"arrow-right\">\n              <KeyboardArrowRight />\n            </ArrowButton>\n          </ArrowsContainer>\n          <ArrowsContainer>\n            <ArrowButton onClick={onPress('down')} disabled={!isVertical} data-test=\"arrow-down\">\n              <KeyboardArrowDown />\n            </ArrowButton>\n          </ArrowsContainer>\n        </ActionsContainer>\n      )}\n      <ActionsContainer>\n        <ActionButton onClick={onPress('back')} disabled={keyboard?.back === undefined} data-test=\"keyboard-backspace\">\n          {keyboard?.back || (\n            <>\n              <ArrowBack /> Back\n            </>\n          )}\n        </ActionButton>\n        <ActionButton onClick={onPress('accept')} disabled={keyboard?.accept === undefined} data-test=\"keyboard-enter\">\n          {keyboard?.accept || (\n            <>\n              Enter <ArrowForward />\n            </>\n          )}\n        </ActionButton>\n      </ActionsContainer>\n      <Break />\n      <ActionsContainer disabled={keyboard?.shiftR === undefined} data-test=\"keyboard-shift-r\">\n        <ActionButton onClick={onPress('random')}>\n          <Shuffle /> {keyboard?.shiftR || 'Random Song'}\n        </ActionButton>\n      </ActionsContainer>\n    </Container>\n  ) : null;\n}\n\nconst Container = styled.div`\n  gap: 1rem;\n  display: flex;\n  flex-wrap: wrap;\n  margin-bottom: 2rem;\n`;\nconst ArrowsContainer = styled.div`\n  display: flex;\n  justify-content: center;\n  flex: 1;\n  color: white;\n  font-size: 2rem;\n`;\n\nconst ActionsContainer = styled.div<{ disabled?: boolean }>`\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n  justify-content: space-between;\n  opacity: ${(props) => (props.disabled ? 0 : 1)};\n`;\n\nconst Break = styled.div`\n  flex-basis: 100%;\n  height: 0;\n`;\n\nconst ButtonBase = styled.button<{ disabled?: boolean }>`\n  background: none;\n  border: none;\n  box-sizing: border-box;\n  margin: 0.25rem;\n  width: 4.5rem;\n  height: 4.5rem;\n\n  svg {\n    width: 2.5rem;\n    height: 2.5rem;\n  }\n\n  opacity: ${(props) => (props.disabled ? 0.25 : 1)};\n`;\n\nconst ArrowButton = styled(ButtonBase)<{ disabled?: boolean }>`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 0.3rem;\n  border: 0.3rem solid rgb(204, 204, 204);\n  border-bottom-color: rgb(130, 130, 130);\n  border-right-color: rgb(130, 130, 130);\n  gap: 0.5rem;\n\n  ${(props) =>\n    !props.disabled\n      ? css`\n          cursor: pointer;\n          &:active {\n            border: 0.3rem solid rgb(130, 130, 130);\n            border-bottom-color: rgb(204, 204, 204);\n            border-right-color: rgb(204, 204, 204);\n          }\n        `\n      : ''}\n\n  color: rgb(51, 51, 51);\n  font-weight: normal;\n  font-size: 2.5rem;\n  box-shadow: 0 0.1rem 0 rgba(0, 0, 0, 0.2), inset 0 0 0 0.2rem #ffffff;\n  background-color: rgb(247, 247, 247);\n  text-shadow: 0 0.1rem 0 #fff;\n`;\n\nconst ActionButton = styled(ArrowButton)<{ disabled?: boolean }>`\n  width: 100%;\n`;\n","import styled from '@emotion/styled';\nimport { MenuButton, MenuContainer } from 'Elements/Menu';\nimport Modal from 'Elements/Modal';\nimport RemoteMicClient from 'RemoteMic/Network/Client';\nimport styles from 'Scenes/Game/Singing/GameOverlay/Drawing/styles';\nimport React from 'react';\n\ninterface Props {\n  id: string;\n  playerNumber: number | null;\n  onModalClose: () => void;\n  header?: React.ReactNode;\n}\n\nexport default function PlayerChangeModal({ playerNumber, id, onModalClose, header }: Props) {\n  const selectPlayer = (player: number | null) => {\n    RemoteMicClient.requestPlayerChange(id, player);\n    onModalClose();\n  };\n\n  const joined = playerNumber !== null;\n\n  return (\n    <Modal onClose={onModalClose}>\n      <Menu>\n        {header && <h2>{header}</h2>}\n        <MenuButton\n          size=\"small\"\n          data-test=\"change-to-player-0\"\n          onClick={() => selectPlayer(0)}\n          disabled={0 === playerNumber}\n          style={{ color: styles.colors.players[0].perfect.fill }}>\n          Blue\n        </MenuButton>\n        <MenuButton\n          size=\"small\"\n          data-test=\"change-to-player-1\"\n          onClick={() => selectPlayer(1)}\n          disabled={1 === playerNumber}\n          style={{ color: styles.colors.players[1].perfect.fill }}>\n          Red\n        </MenuButton>\n        <MenuButton size=\"small\" onClick={() => selectPlayer(null)} disabled={!joined} data-test=\"change-to-unset\">\n          Unassign\n        </MenuButton>\n        <hr />\n        <MenuButton onClick={onModalClose} size=\"small\">\n          Close\n        </MenuButton>\n      </Menu>\n    </Modal>\n  );\n}\n\nconst Menu = styled(MenuContainer)`\n  gap: 0;\n`;\n","import styled from '@emotion/styled';\nimport styles from 'Scenes/Game/Singing/GameOverlay/Drawing/styles';\n\ninterface Props {\n  number: number | null;\n}\n\nexport default function PlayerNumberCircle({ number, ...restProps }: Props) {\n  return (\n    <PlayerColorCircle\n      style={{\n        background: number !== null ? styles.colors.players[number].perfect.fill : styles.colors.text.inactive,\n      }}\n      {...restProps}\n    />\n  );\n}\n\nconst PlayerColorCircle = styled.div`\n  display: inline-block;\n  width: 1em;\n  height: 1em;\n  aspect-ratio: 1;\n  border-radius: 1em;\n`;\n","import { css } from '@emotion/react';\nimport styled from '@emotion/styled';\nimport SwapHorizIcon from '@mui/icons-material/SwapHoriz';\nimport { buttonFocused } from 'Elements/Button';\nimport { focused, typography } from 'Elements/cssMixins';\nimport RemoteMicClient from 'RemoteMic/Network/Client';\nimport PlayerChangeModal from 'Scenes/RemoteMic/Components/PlayerChangeModal';\nimport PlayerNumberCircle from 'Scenes/RemoteMic/Components/PlayerNumberCircle';\nimport { memo, useState } from 'react';\n\ninterface Props {\n  playerNumber: number | null;\n}\n\nexport default memo(function PlayerChange({ playerNumber }: Props) {\n  const [isOpen, setIsOpen] = useState(false);\n\n  const closeModal = () => setIsOpen(false);\n\n  const joined = playerNumber !== null;\n\n  return (\n    <>\n      <PlayerChangeContainer onClick={() => setIsOpen(true)} data-test=\"change-player\" joined={joined}>\n        {!joined ? (\n          'Join game'\n        ) : (\n          <>\n            <PlayerNumberCircle number={playerNumber} /> Change\n          </>\n        )}{' '}\n        <SwapHorizIcon />\n      </PlayerChangeContainer>\n      {isOpen && (\n        <PlayerChangeModal id={RemoteMicClient.getClientId()!} playerNumber={playerNumber} onModalClose={closeModal} />\n      )}\n    </>\n  );\n});\n\nconst PlayerChangeContainer = styled.button<{ joined: boolean }>`\n  position: absolute;\n  z-index: 1;\n  color: white;\n  right: 1rem;\n  bottom: 1rem;\n  padding: 1rem;\n  font-size: 2rem;\n  text-transform: uppercase;\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  border: none;\n  ${typography};\n  background: rgba(0, 0, 0, 0.75);\n\n  ${(props) =>\n    !props.joined &&\n    css`\n      font-size: 3rem;\n      padding: 3rem;\n      ${focused}\n    `}\n\n  :hover {\n    ${focused};\n  }\n\n  :active {\n    ${buttonFocused};\n  }\n\n  svg {\n    width: 2rem;\n    height: 2rem;\n  }\n`;\n","import events from 'GameEvents/GameEvents';\nimport { useEventListener } from 'GameEvents/hooks';\n\nexport default function usePermissions() {\n  const [permissions] = useEventListener(events.remoteMicPermissionsSet, true) ?? ['write'];\n\n  return permissions;\n}\n","import styled from '@emotion/styled';\nimport styles from 'Scenes/Game/Singing/GameOverlay/Drawing/styles';\nimport PlayerChange from 'Scenes/RemoteMic/Panels/Microphone/PlayerChange';\nimport usePermissions from 'Scenes/RemoteMic/hooks/usePermissions';\nimport { useEffect, useState } from 'react';\n\ninterface Props {\n  volume: number;\n  playerNumber: number | null;\n  frequency: number | null;\n  isMicOn: boolean;\n  isConnected: boolean;\n}\n\nexport default function VolumeIndicator({ playerNumber, volume, frequency, isMicOn, isConnected }: Props) {\n  const [maxVolume, setMaxVolume] = useState(0.000001);\n  const permissions = usePermissions();\n\n  useEffect(() => {\n    setMaxVolume((current) => (volume > current ? volume : current * 0.99));\n  }, [volume]);\n\n  const backgroundColor =\n    playerNumber !== null ? styles.colors.players[playerNumber].miss.stroke : styles.colors.lines.normal.fill;\n  const indicatorColor =\n    playerNumber !== null ? styles.colors.players[playerNumber].perfect.fill : styles.colors.lines.normal.fill;\n\n  return (\n    <IndicatorContainer\n      isMicOn={isMicOn}\n      color={backgroundColor}\n      data-player-number={`${playerNumber ?? 'none'}`}\n      data-test=\"indicator\">\n      {isMicOn && (\n        <>\n          <Debug>\n            {frequency ? `${Math.round(frequency)}Hz` : ' '}\n            <br />\n            {String(volume * 100).slice(0, 5)}\n          </Debug>\n        </>\n      )}\n      {isConnected && permissions === 'write' && <PlayerChange playerNumber={playerNumber} />}\n      <Indicator\n        color={indicatorColor}\n        style={{ transform: `scaleY(${isMicOn ? 1 - Math.min(1, volume / maxVolume) : 1})` }}\n      />\n    </IndicatorContainer>\n  );\n}\n\nconst Debug = styled.span`\n  position: absolute;\n  color: white;\n  opacity: 0.125;\n`;\n\nconst Indicator = styled.div<{ color: string }>`\n  width: 100%;\n  height: 100%;\n  background-color: ${(props) => props.color};\n  transition: 200ms;\n  transform-origin: top;\n`;\n\nconst IndicatorContainer = styled.div<{ color: string; isMicOn: boolean }>`\n  position: relative;\n  border: 0.1rem solid white;\n  flex: 1;\n  min-height: 200px;\n  max-height: 100vw;\n  transition: 300ms;\n\n  background: ${(props) => props.color};\n`;\n","import events from 'GameEvents/GameEvents';\nimport { useEventListener } from 'GameEvents/hooks';\nimport SimplifiedMic from 'Scenes/Game/Singing/Input/SimplifiedMic';\nimport VolumeIndicator from 'Scenes/RemoteMic/Panels/Microphone/VolumeIndicator';\nimport { throttle } from 'lodash-es';\nimport { useCallback, useEffect, useState } from 'react';\n\ninterface Props {\n  isVisible: boolean;\n  isMicOn: boolean;\n  isConnected: boolean;\n}\n\nfunction MicPreview({ isVisible, isMicOn, isConnected }: Props) {\n  const [volume, setVolume] = useState(0);\n  const [frequency, setFrequency] = useState(0);\n  const [playerNumber] = useEventListener(events.remoteMicPlayerSet, true) ?? [null];\n\n  const updateVolumes = useCallback(\n    throttle((freq: number, volume: number) => {\n      setFrequency(freq);\n      setVolume(volume);\n    }, 150),\n    [setVolume, setFrequency],\n  );\n\n  useEffect(() => {\n    SimplifiedMic.startMonitoring(undefined);\n    return SimplifiedMic.addListener(updateVolumes);\n  }, [updateVolumes]);\n\n  return isVisible ? (\n    <>\n      <VolumeIndicator\n        volume={volume}\n        frequency={frequency}\n        playerNumber={playerNumber}\n        isMicOn={isMicOn}\n        isConnected={isConnected}\n      />\n    </>\n  ) : null;\n}\nexport default MicPreview;\n","import RemoteMicClient from 'RemoteMic/Network/Client';\nimport { getPingTime } from 'RemoteMic/Network/utils';\nimport { useEffect, useState } from 'react';\n\ninterface Props {}\n\nfunction Ping({}: Props) {\n  const [latency, setLatency] = useState(0);\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      const now = getPingTime();\n      if (RemoteMicClient.pinging && now - RemoteMicClient.pingStart > latency) {\n        setLatency(now - RemoteMicClient.pingStart);\n      } else {\n        setLatency(RemoteMicClient.latency);\n      }\n    }, 333);\n\n    return () => {\n      clearInterval(interval);\n    };\n  }, []);\n  return <>{latency}ms</>;\n}\nexport default Ping;\n","import userMediaService from 'UserMedia/userMediaService';\nimport { useEffect, useState } from 'react';\n\nexport const useMicrophoneStatus = () => {\n  const [status, setStatus] = useState(userMediaService.getStatus());\n\n  useEffect(() => userMediaService.addListener(setStatus), []);\n\n  return status;\n};\n","export default function isOpera() {\n  return navigator?.userAgent.includes('OPR');\n}\n","export default \"__VITE_ASSET__862d35ec__\"","export default \"__VITE_ASSET__abf3bdc2__\"","export default \"__VITE_ASSET__d22be881__\"","import styled from '@emotion/styled';\nimport { Warning } from '@mui/icons-material';\nimport styles from 'Scenes/Game/Singing/GameOverlay/Drawing/styles';\nimport { useMicrophoneStatus } from 'UserMedia/hooks';\nimport { PropsWithChildren, ReactNode } from 'react';\nimport isOpera from 'utils/isOpera';\nimport allowMic from './allow-mic.png';\nimport enableMicOpera from './enable-mic-opera.png';\nimport enableMic from './enable-mic.png';\n\nconst getProperEnableMicImage = () => (isOpera() ? enableMicOpera : enableMic);\n\ninterface Props extends PropsWithChildren {\n  fallback: ReactNode;\n  showImages?: boolean;\n}\nconst UserMediaEnabled = ({ children, fallback, showImages = true }: Props) => {\n  const status = useMicrophoneStatus();\n  return (\n    <>\n      {status === 'accepted' && children}\n      {status !== 'accepted' && (\n        <>\n          <WarningContainer>\n            <WarningIcon />\n          </WarningContainer>\n          {fallback}\n          <AdditionalInfo>\n            {status === 'requested' && showImages && <img src={allowMic} alt=\"how-to-allow\" />}\n            {status === 'declined' && (\n              <>\n                <h3>Access is blocked, you can unblock it here</h3>\n                {showImages && <img src={getProperEnableMicImage()} alt=\"how-to-enable\" />}\n              </>\n            )}\n            {isOpera() && (\n              <h4>\n                <strong>Opera</strong> is buggy regarding microphone access - if you encounter issue (e.g. this message\n                stays even after the access to microphone was granted), consider other browsers.\n              </h4>\n            )}\n          </AdditionalInfo>\n        </>\n      )}\n    </>\n  );\n};\n\nconst AdditionalInfo = styled.div`\n  text-align: center;\n\n  img {\n    margin: 1.5rem 0 0.5rem;\n    box-shadow: 0.5rem 0.5rem 0.5rem rgba(0, 0, 0, 0.5), inset 0 0 0.5rem 0.5rem rgba(255, 255, 255, 0.5);\n    border: 0.5rem solid white;\n    border-radius: 1rem;\n    box-sizing: border-box;\n    max-width: 100%;\n  }\n`;\n\nconst WarningContainer = styled.div`\n  width: 100%;\n  display: flex;\n  justify-content: center;\n`;\nconst WarningIcon = styled(Warning)`\n  color: ${styles.colors.text.active};\n  font-size: 3rem;\n`;\nexport default UserMediaEnabled;\n","import styled from '@emotion/styled';\nimport { MenuButton } from 'Elements/Menu';\nimport { typography } from 'Elements/cssMixins';\nimport { transportErrorReason } from 'RemoteMic/Network/Client/NetworkClient';\nimport styles from 'Scenes/Game/Singing/GameOverlay/Drawing/styles';\nimport SimplifiedMic from 'Scenes/Game/Singing/Input/SimplifiedMic';\nimport Connect from 'Scenes/RemoteMic/Panels/Microphone/Connect';\nimport RemoteMicKeyboard from 'Scenes/RemoteMic/Panels/Microphone/Keyboard';\nimport MicPreview from 'Scenes/RemoteMic/Panels/Microphone/MicPreview';\nimport Ping from 'Scenes/RemoteMic/Panels/Microphone/Ping';\nimport { ConnectionStatuses } from 'Scenes/RemoteMic/RemoteMic';\nimport usePermissions from 'Scenes/RemoteMic/hooks/usePermissions';\nimport UserMediaEnabled from 'UserMedia/UserMediaEnabled';\nimport { useState } from 'react';\nimport isDev from 'utils/isDev';\n\ninterface Props {\n  roomId: string;\n  connectionStatus: ConnectionStatuses;\n  connectionError?: transportErrorReason;\n  isKeepAwakeOn: boolean;\n  setIsKeepAwakeOn: (keepAwake: boolean) => void;\n  monitoringStarted: boolean;\n  setMonitoringStarted: (micMonitoring: boolean) => void;\n}\n\nfunction Microphone({\n  roomId,\n  monitoringStarted,\n  setMonitoringStarted,\n  isKeepAwakeOn,\n  setIsKeepAwakeOn,\n  connectionError,\n  connectionStatus,\n}: Props) {\n  const permissions = usePermissions();\n  const [searchActive, setSearchActive] = useState(false);\n\n  const onConnect = async () => {\n    setIsKeepAwakeOn(true);\n\n    try {\n      if (!isDev()) {\n        await document.body.requestFullscreen();\n        window.screen.orientation.unlock();\n        await window.screen.orientation.lock?.('portrait');\n      }\n    } catch (e) {\n      console.warn(e);\n    }\n  };\n\n  const isConnected = connectionStatus === 'connected';\n\n  const micPreview = <MicPreview isVisible isMicOn={monitoringStarted} isConnected={isConnected} />;\n\n  return (\n    <Container>\n      <UserMediaEnabled\n        showImages={false}\n        fallback={\n          <>\n            {micPreview}\n            <h2>Please allow access to the microphone.</h2>\n          </>\n        }>\n        <Panel collapse={searchActive}>\n          <MicPreview isVisible isMicOn={monitoringStarted} isConnected={isConnected} />\n          <Connect\n            roomId={roomId}\n            isVisible={true}\n            connectionStatus={connectionStatus}\n            onConnect={onConnect}\n            connectionError={connectionError}\n          />\n        </Panel>\n        <Panel>\n          {permissions === 'write' && <RemoteMicKeyboard onSearchStateChange={setSearchActive} />}\n          {permissions === 'read' && (\n            <NoPermissionsMsg data-test=\"no-permissions-message\">\n              No permission to control the game. Go to in-game <strong>Settings</strong> menu ➔{' '}\n              <strong>Remote Microphones Settings</strong> to manage them.\n            </NoPermissionsMsg>\n          )}\n          <KeepAwake onClick={() => setIsKeepAwakeOn(!isKeepAwakeOn)}>\n            WakeLock: <strong>{isKeepAwakeOn ? 'ON' : 'OFF'}</strong>\n          </KeepAwake>\n          <MicInputState\n            onClick={() =>\n              monitoringStarted ? SimplifiedMic.stopMonitoring() : SimplifiedMic.startMonitoring(undefined)\n            }>\n            Microphone: <strong data-test=\"monitoring-state\">{monitoringStarted ? 'ON' : 'OFF'}</strong>\n          </MicInputState>\n          {isConnected && (\n            <KeepAwake>\n              Ping: <Ping />\n            </KeepAwake>\n          )}\n        </Panel>\n      </UserMediaEnabled>\n    </Container>\n  );\n}\nexport default Microphone;\n\nconst Container = styled.div`\n  font-size: 2.6rem;\n  display: flex;\n  flex-direction: column;\n  gap: 2rem;\n  padding: 1.5rem;\n  box-sizing: border-box;\n\n  @media (max-height: 500px) and (min-aspect-ratio: 16/10) {\n    flex-direction: row;\n  }\n\n  ${MenuButton} {\n    padding: 0.5em;\n    height: 72px;\n\n    margin-bottom: 1em;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 0.5em;\n  }\n\n  h5 {\n    margin-top: 0.5em;\n\n    svg {\n      font-size: 0.9em;\n    }\n  }\n`;\n\nconst Panel = styled.div<{ collapse?: boolean }>`\n  flex: 1;\n  transition: 300ms ease-in-out;\n\n  margin-top: ${(props) => (props.collapse ? '-100%' : '0')};\n\n  @media (max-height: 500px) and (min-aspect-ratio: 16/10) {\n    margin-top: 0;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n  }\n`;\n\nconst MicInputState = styled.div`\n  ${typography}\n  strong {\n    color: ${styles.colors.text.active};\n  }\n  align-self: flex-end;\n`;\nconst KeepAwake = styled(MicInputState)``;\n\nconst NoPermissionsMsg = styled.h5`\n  padding-bottom: 5rem;\n`;\n","import styled from '@emotion/styled';\nimport { MenuButton, MenuContainer } from 'Elements/Menu';\nimport { focused } from 'Elements/cssMixins';\nimport events from 'GameEvents/GameEvents';\nimport { useEventEffect } from 'GameEvents/hooks';\nimport RemoteMicClient from 'RemoteMic/Network/Client';\nimport { useEffect, useState } from 'react';\n\ninterface Props {\n  onConfirm: () => void;\n}\n\nfunction ConfirmReadiness({ onConfirm }: Props) {\n  const [visible, setVisible] = useState(false);\n  const [isAfterReload, setIsAfterReload] = useState(false);\n\n  // Try to predict the readiness request from the game. If the refresh request happened and after reconnection\n  // The player number is set for the phone, it's likely that a readiness confirmation is needed so the button\n  // is displayed even before the event comes around\n  useEffect(() => {\n    if (window.sessionStorage.getItem('reload-mic-request') !== null) {\n      setIsAfterReload(true);\n    }\n  }, []);\n  useEventEffect(events.remoteMicPlayerSet, () => {\n    if (isAfterReload) {\n      setIsAfterReload(false);\n      setVisible(true);\n    }\n  });\n\n  useEventEffect(events.remoteReadinessRequested, () => {\n    setVisible(true);\n  });\n  const confirm = () => {\n    RemoteMicClient.confirmReadiness();\n    setVisible(false);\n    onConfirm();\n  };\n\n  return visible ? (\n    <Form>\n      <MenuContainer>\n        <ReadyButton data-test=\"ready-button\" onClick={confirm}>\n          Ready\n        </ReadyButton>\n      </MenuContainer>\n    </Form>\n  ) : null;\n}\nexport default ConfirmReadiness;\n\nconst Form = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  backdrop-filter: blur(10px);\n  z-index: 1000;\n`;\n\nconst ReadyButton = styled(MenuButton)`\n  aspect-ratio: 1;\n\n  ${focused};\n`;\n","import styled from '@emotion/styled';\nimport { typography } from 'Elements/cssMixins';\nimport RemoteMicClient from 'RemoteMic/Network/Client';\nimport { useEffect, useState } from 'react';\n\ninterface Props {}\n\nfunction RemoteInputLag({}: Props) {\n  const [currentValue, setCurrentValue] = useState(0);\n  const [isLoading, setIsLoading] = useState(false);\n\n  useEffect(() => {\n    setIsLoading(true);\n    RemoteMicClient.getInputLag()\n      .then(({ value }) => setCurrentValue(value))\n      .catch((e) => console.warn(e))\n      .finally(() => setIsLoading(false));\n  }, []);\n\n  const changeValue = (change: number) => {\n    setIsLoading(true);\n    RemoteMicClient.setInputLag(currentValue + change)\n      .then(({ value }) => setCurrentValue(value))\n      .finally(() => setIsLoading(false));\n  };\n\n  return (\n    <>\n      <h3>Adjust input lag</h3>\n      <Container>\n        <Button onClick={() => changeValue(-50)} disabled={isLoading}>\n          -\n        </Button>\n        <Value>\n          <strong>{currentValue}</strong>ms\n        </Value>\n        <Button onClick={() => changeValue(+50)} disabled={isLoading}>\n          +\n        </Button>\n      </Container>\n    </>\n  );\n}\nexport default RemoteInputLag;\n\nconst Button = styled.button`\n  background: black;\n  padding: 1rem 2rem;\n  border: none;\n  font-size: 3rem;\n  ${typography};\n  :disabled {\n    opacity: 0.5;\n  }\n`;\n\nconst Value = styled.div`\n  flex: 1;\n  text-align: center;\n`;\nconst Container = styled.div`\n  ${typography};\n  display: flex;\n  align-items: center;\n  justify-self: center;\n  background: black;\n`;\n","import styled from '@emotion/styled';\nimport { MenuButton } from 'Elements/Menu';\nimport events from 'GameEvents/GameEvents';\nimport { useEventListener } from 'GameEvents/hooks';\nimport RemoteMicClient from 'RemoteMic/Network/Client';\nimport { NetworkRemoteMicListMessage } from 'RemoteMic/Network/messages';\nimport RemoteMicManager from 'RemoteMic/RemoteMicManager';\nimport styles from 'Scenes/Game/Singing/GameOverlay/Drawing/styles';\nimport PlayerChangeModal from 'Scenes/RemoteMic/Components/PlayerChangeModal';\nimport PlayerNumberCircle from 'Scenes/RemoteMic/Components/PlayerNumberCircle';\nimport { useEffect, useState } from 'react';\nimport { ValuesType } from 'utility-types';\n\ninterface Props {}\n\nfunction ManagePlayers(props: Props) {\n  useEffect(() => {\n    RemoteMicClient.subscribe('remote-mics');\n\n    return () => {\n      RemoteMicClient.unsubscribe('remote-mics');\n    };\n  }, []);\n\n  const [list] = useEventListener(events.remoteMicListUpdated) ?? [[]];\n\n  return (\n    <>\n      <h3>Manage Players</h3>\n      {list.map((mic) => (\n        <Entry mic={mic} key={mic.id} />\n      ))}\n      {list.length === 0 && <h4>No remote microphones connected</h4>}\n    </>\n  );\n}\n\nconst Entry = ({ mic }: { mic: ValuesType<NetworkRemoteMicListMessage['list']> }) => {\n  const [open, setOpen] = useState(false);\n  const permission = RemoteMicManager.getPermission(mic.id);\n  return (\n    <Container data-test=\"manage-players\">\n      {open && (\n        <PlayerChangeModal\n          id={mic.id}\n          playerNumber={mic.number}\n          onModalClose={() => setOpen(false)}\n          header={\n            <>\n              Change <strong className=\"ph-no-capture\">{mic.name}</strong>:\n            </>\n          }\n        />\n      )}\n      <RemoteMicEntry\n        onClick={() => setOpen(true)}\n        data-test=\"remote-mic-entry\"\n        data-id={mic.id}\n        value={permission}\n        size=\"small\">\n        <PlayerNumberCircle number={mic.number} />\n        <RemoteMicId>{mic.id.slice(-4)}</RemoteMicId>\n        <RemoteMicName className=\"ph-no-capture\" isSelf={mic.id === RemoteMicClient.getClientId()}>\n          {mic.name}\n        </RemoteMicName>\n      </RemoteMicEntry>\n    </Container>\n  );\n};\n\nconst Container = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n`;\n\nconst RemoteMicEntry = styled(MenuButton)`\n  display: flex;\n  align-items: center;\n  padding: 0 2rem;\n`;\n\nconst RemoteMicName = styled.div<{ isSelf: boolean }>`\n  ${(props) => props.isSelf && `color: ${styles.colors.text.active};`}\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n`;\nconst RemoteMicId = styled.span`\n  font-size: 1.5rem;\n  padding: 0 1rem;\n`;\nexport default ManagePlayers;\n","import styled from '@emotion/styled';\nimport { MenuButton } from 'Elements/Menu';\nimport RemoteMicClient from 'RemoteMic/Network/Client';\nimport { MIC_ID_KEY, transportErrorReason } from 'RemoteMic/Network/Client/NetworkClient';\nimport RemoteInputLag from 'Scenes/RemoteMic/Panels/RemoteSettings/InputLag';\nimport ManagePlayers from 'Scenes/RemoteMic/Panels/RemoteSettings/ManagePlayers';\nimport { ConnectionStatuses } from 'Scenes/RemoteMic/RemoteMic';\nimport usePermissions from 'Scenes/RemoteMic/hooks/usePermissions';\n\ninterface Props {\n  roomId: string;\n  connectionStatus: ConnectionStatuses;\n  connectionError?: transportErrorReason;\n  isKeepAwakeOn: boolean;\n  setIsKeepAwakeOn: (keepAwake: boolean) => void;\n  monitoringStarted: boolean;\n  setMonitoringStarted: (micMonitoring: boolean) => void;\n}\n\nfunction RemoteSettings({\n  roomId,\n  monitoringStarted,\n  setMonitoringStarted,\n  isKeepAwakeOn,\n  setIsKeepAwakeOn,\n  connectionError,\n  connectionStatus,\n}: Props) {\n  const permissions = usePermissions();\n  const reset = () => {\n    RemoteMicClient.disconnect();\n    localStorage.removeItem('remote_mic_name');\n    localStorage.removeItem(MIC_ID_KEY);\n    window.location.reload();\n  };\n  return (\n    <Container>\n      <h3>\n        Remote mic ID:{' '}\n        <strong data-test=\"remote-mic-id\">{RemoteMicClient.getClientId()?.slice(-4).toUpperCase() ?? '----'}</strong>\n      </h3>\n      <MenuButton onClick={reset} size=\"small\" data-test=\"reset-microphone\">\n        Reset microphone\n      </MenuButton>\n      <h5>Removes all persisted microphone data.</h5>\n      <hr />\n      {permissions === 'write' && <ManagePlayers />}\n      {permissions === 'write' && <RemoteInputLag />}\n    </Container>\n  );\n}\nexport default RemoteSettings;\n\nconst Container = styled.div`\n  font-size: 2.6rem;\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  padding: 1.5rem;\n  box-sizing: border-box;\n  gap: 1rem;\n`;\n","function generateLangMap() {\n  const langNames = new Intl.DisplayNames(['en'], { type: 'language' });\n  const langMap: Record<string, string> = {};\n  for (let i = 0; i < 26; i++) {\n    for (let j = 0; j < 26; j++) {\n      let code = String.fromCharCode(97 + i) + String.fromCharCode(97 + j);\n      let name = langNames.of(code);\n      if (name !== code && name !== undefined) {\n        langMap[name] = code;\n      }\n    }\n  }\n  const langMap2: Record<string, string> = {\n    // Avoid using deprecated codes:\n    Akan: 'ak',\n    Hebrew: 'he',\n    Indonesian: 'id',\n    Javanese: 'jv',\n    Romanian: 'ro',\n    Yiddish: 'yi',\n    // Optional extras:\n    Tagalog: 'tl',\n    English: 'gb',\n    Korean: 'kr',\n    Swedish: 'se',\n    Latin: 'va',\n  };\n  return { ...langMap, ...langMap2 };\n}\n\n// Usage:\nconst langMap = generateLangMap();\n\nexport default function (language: string) {\n  return langMap[language];\n}\n","import { Song } from 'interfaces';\nimport languageNameToIsoCode from 'utils/languageNameToIsoCode';\n\ntype Props =\n  | {\n      language: Song['language'];\n    }\n  | {\n      isocode: string;\n    };\nexport const Flag = (props: Props) => {\n  const isoCode =\n    'isocode' in props\n      ? props.isocode?.toLowerCase()\n      : languageNameToIsoCode(Array.isArray(props.language) ? props.language[0] : props.language);\n\n  if (!isoCode) return null;\n\n  return <img src={`https://flagcdn.com/${isoCode}.svg`} alt={isoCode} {...props} />;\n};\n","import { SongPreview } from 'interfaces';\nimport { useEffect, useRef, useState } from 'react';\nimport SongDao from 'Songs/SongsService';\n\nexport default function useSongIndex(includeDeleted = false) {\n  const [songIndex, setSongIndex] = useState<SongPreview[] | null>(SongDao.getCurrentIndex());\n  // Prevent recreating of the array every render\n  const emptyList = useRef<SongPreview[]>([]);\n\n  const loadSongs = () => SongDao.getIndex(includeDeleted).then(setSongIndex);\n\n  useEffect(() => {\n    loadSongs();\n  }, []);\n\n  return {\n    data: songIndex ?? emptyList.current,\n    reload: loadSongs,\n    isLoading: songIndex === null,\n  };\n}\n","import styled from '@emotion/styled';\nimport { Flag } from 'Elements/Flag';\nimport RemoteMicClient from 'RemoteMic/Network/Client';\nimport { transportErrorReason } from 'RemoteMic/Network/Client/NetworkClient';\nimport { NetworkSongListMessage } from 'RemoteMic/Network/messages';\nimport styles from 'Scenes/Game/Singing/GameOverlay/Drawing/styles';\nimport { ConnectionStatuses } from 'Scenes/RemoteMic/RemoteMic';\nimport SongDao from 'Songs/SongsService';\nimport useSongIndex from 'Songs/hooks/useSongIndex';\nimport { uniqBy } from 'lodash-es';\nimport { useEffect, useMemo, useState } from 'react';\n\ninterface Props {\n  roomId: string;\n  connectionStatus: ConnectionStatuses;\n  connectionError?: transportErrorReason;\n  isKeepAwakeOn: boolean;\n  setIsKeepAwakeOn: (keepAwake: boolean) => void;\n  monitoringStarted: boolean;\n  setMonitoringStarted: (micMonitoring: boolean) => void;\n}\n\nfunction RemoteSongList({\n  roomId,\n  monitoringStarted,\n  setMonitoringStarted,\n  isKeepAwakeOn,\n  setIsKeepAwakeOn,\n  connectionError,\n  connectionStatus,\n}: Props) {\n  const originalSongList = useSongIndex();\n\n  const [overrides, setOverrides] = useState<NetworkSongListMessage | undefined>();\n  useEffect(() => {\n    if (connectionStatus === 'connected' && overrides === undefined) {\n      RemoteMicClient.getSongList().then(setOverrides).catch(console.warn);\n    }\n  }, [overrides, connectionStatus]);\n\n  const songList = useMemo(\n    () =>\n      uniqBy(\n        originalSongList.data\n          .map((song) => ({ ...song, id: SongDao.generateSongFile(song) }))\n          .filter((song) => !(overrides?.deleted ?? []).includes(song.id))\n          .map((song) => ({\n            id: song.id,\n            artist: song.artist,\n            title: song.title,\n            video: song.video,\n            language: song.language,\n          }))\n          .concat(...(overrides?.custom ?? []).map((song) => ({ ...song, id: SongDao.generateSongFile(song) }))),\n        (song) => song.id,\n      ),\n    [originalSongList.data, overrides],\n  );\n\n  return (\n    <Container>\n      {songList.map((song) => {\n        return (\n          <SongItemContainer key={`${song.artist}-${song.title}`} data-test={song.id}>\n            <Language>\n              <Flag language={song.language} />\n            </Language>\n            <ArtistTitle>\n              <Title>{song.title}</Title>\n              <Artist>{song.artist}</Artist>\n            </ArtistTitle>\n          </SongItemContainer>\n        );\n      })}\n    </Container>\n  );\n}\nexport default RemoteSongList;\n\nconst Container = styled.div`\n  display: flex;\n  flex-direction: column;\n  padding-bottom: 5rem;\n`;\n\nconst SongItemContainer = styled.div`\n  background: rgba(0, 0, 0, 0.25);\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1.5rem 1rem;\n  border-bottom: 1px solid black;\n`;\n\nconst Language = styled.div`\n  img {\n    height: 3rem;\n    width: 3rem;\n    object-fit: cover;\n    border-radius: 3rem;\n    border: 0.1rem black solid;\n    aspect-ratio: 1;\n  }\n`;\n\nconst ArtistTitle = styled.div`\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  gap: 1rem;\n`;\n\nconst Artist = styled.span`\n  color: ${styles.colors.text.default};\n  font-size: 1.25rem;\n  white-space: nowrap;\n  overflow: hidden;\n  font-weight: bold;\n  text-overflow: ellipsis;\n`;\nconst Title = styled.span`\n  color: ${styles.colors.text.active};\n\n  font-size: 1.5rem;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n`;\n","import styled from '@emotion/styled';\nimport NoSleep from '@uriopass/nosleep.js';\nimport { useBackground } from 'Elements/LayoutWithBackground';\nimport NormalizeFontSize from 'Elements/NormalizeFontSize';\nimport events from 'GameEvents/GameEvents';\nimport { useEventEffect, useEventListener } from 'GameEvents/hooks';\nimport BottomBar from 'Scenes/RemoteMic/BottomBar';\nimport ConfirmWifiModal from 'Scenes/RemoteMic/Components/ConfrimWifiModal';\nimport Microphone from 'Scenes/RemoteMic/Panels/Microphone';\nimport ConfirmReadiness from 'Scenes/RemoteMic/Panels/Microphone/ConfirmReadiness';\nimport RemoteSettings from 'Scenes/RemoteMic/Panels/RemoteSettings';\nimport RemoteSongList from 'Scenes/RemoteMic/Panels/RemoteSongList';\nimport { useState } from 'react';\n\ninterface Props {\n  roomId: string;\n}\n\nconst noSleep = new NoSleep();\n\nexport type ConnectionStatuses = Parameters<typeof events.karaokeConnectionStatusChange.dispatch>[0] | 'uninitialised';\n\nexport type PhoneTabs = 'microphone' | 'song-list' | 'settings';\n\nfunction RemoteMic({ roomId }: Props) {\n  useBackground(true);\n  const [activeTab, setActiveTab] = useState<PhoneTabs>('microphone');\n\n  const [connectionStatus, connectionError] = useEventListener(events.karaokeConnectionStatusChange) ?? [\n    'uninitialised',\n  ];\n\n  const [monitoringStarted, setMonitoringStarted] = useState(false);\n  useEventEffect(events.micMonitoringStarted, () => setMonitoringStarted(true));\n  useEventEffect(events.micMonitoringStopped, () => setMonitoringStarted(false));\n\n  const [isKeepAwakeOn, setIsKeepAwakeOn] = useState(false);\n\n  const setKeepAwake = async (turnOn: boolean) => {\n    try {\n      if (turnOn && !noSleep.isEnabled) {\n        await noSleep.enable();\n      } else if (!turnOn && noSleep.isEnabled) {\n        await noSleep.disable();\n      }\n      setIsKeepAwakeOn(turnOn);\n    } catch (e) {\n      console.warn('Couldnt set wakelock', e);\n    }\n  };\n\n  const onConfirm = () => {\n    setKeepAwake(true);\n  };\n\n  return (\n    <>\n      <ConfirmWifiModal />\n      <ConfirmReadiness onConfirm={onConfirm} />\n      <NormalizeFontSize size={10} />\n      <Container id=\"phone-ui-container\">\n        {activeTab === 'microphone' && (\n          <Microphone\n            roomId={roomId}\n            monitoringStarted={monitoringStarted}\n            setMonitoringStarted={setMonitoringStarted}\n            connectionStatus={connectionStatus}\n            setIsKeepAwakeOn={setIsKeepAwakeOn}\n            isKeepAwakeOn={isKeepAwakeOn}\n            connectionError={connectionError}\n          />\n        )}\n        {activeTab === 'song-list' && (\n          <RemoteSongList\n            roomId={roomId}\n            monitoringStarted={monitoringStarted}\n            setMonitoringStarted={setMonitoringStarted}\n            connectionStatus={connectionStatus}\n            setIsKeepAwakeOn={setIsKeepAwakeOn}\n            isKeepAwakeOn={isKeepAwakeOn}\n            connectionError={connectionError}\n          />\n        )}\n        {activeTab === 'settings' && (\n          <RemoteSettings\n            roomId={roomId}\n            monitoringStarted={monitoringStarted}\n            setMonitoringStarted={setMonitoringStarted}\n            connectionStatus={connectionStatus}\n            setIsKeepAwakeOn={setIsKeepAwakeOn}\n            isKeepAwakeOn={isKeepAwakeOn}\n            connectionError={connectionError}\n          />\n        )}\n        <BottomBarFiller />\n        <BottomBar setActiveTab={setActiveTab} active={activeTab} />\n      </Container>\n    </>\n  );\n}\nexport default RemoteMic;\n\nconst BottomBarFiller = styled.div`\n  height: 6rem;\n\n  @media (max-height: 500px) and (min-aspect-ratio: 16/10) {\n    height: 0;\n  }\n`;\n\nconst Container = styled.div`\n  margin: 0 auto;\n  width: 100%;\n  max-width: 400px;\n  box-sizing: border-box;\n  min-height: 100vh;\n  background: rgba(0, 0, 0, 0.5);\n\n  @media (max-height: 500px) and (min-aspect-ratio: 16/10) {\n    max-width: 960px;\n  }\n`;\n","export default \"data:image/gif;base64,R0lGODlhiQAzAOflAAABAAYAAAACAAcAAAkBAAoDAQsEAxAFABEHABIIABMKABgJAhQLAhsLABwNACANAR0OACEOAyMPACMQACcPACgQASgRAioSACsTACwTACwUAC8WAC4WAzAWADQVADUXATYYAjgYADkZADoaADobAD8aAzscAUEbAD4dAEMdAEUeAkAgAEYfAEUfA0ghAE4hAksjAU8iAFEjAFIkAFMlAFQmAVsmAFcoAFwnAF0oAF8qAmEqAGIrAGMsAGksAWUuAGotAmAwDWwuAGsuA20vAF0zDm4wAG8xAHEyAHIzAXgyAHM0AnU1AHo0AHY2AHw1AH43AIA5AoE6AIM7AIQ8AIk7AIU9AIs8AIc+AIw9AI0+AY4+ApFAAJJBAJNCAJRDAJpCAZVEAJtDAp1EAJxEA55FAKBHAKFIAKJJAKhIAaRKAKVLAKtKAKxLAI5RI5BRJK9NALBOALFPALJQALNRALlQBLtRALxSAL1TAL9UAMFWAMJXAMRYArlbCsZZAMVZA8xYAMhaAM9aANFcAdNdAtVfAMpiDddgAN1fANhhAN9hANljAOFiAeNkAOJkA91mAONlBN5nAdhoDeVmAOdoAO5mAOJqB+9nAOlpAPBpAfFqA654SvNrAOduDvRsAPZtAN5yGONxGvduANh0IPFwB/hvAOtxE+B0Gt90I/lwAOxyFPNxCu5zBud0EvRyANt2Is54Ndp2Krt8S+B1JM95L9V4Ked0HeF2G/txAO1zFvRyDOh1E9x3I895NtV4ML19Rsp7NcN8Qbx9TMl7O8J8R9Z5Kq6AW8h7QrZ/ULh/S7V/VsV9O75+R8t8NsR9QqmCYKeCZpqFcLGBVq+BXJGHe4+HgbeAUaOEZqGEbLaAV6CEcauDXKqDYZuGcZmGd42Ih5KIfJCIgpSId4iKh4uKgv///////////////////////////////////////////////////////////////////////////////////////////////////////////yH5BAEIAP8ALAAAAACJADMAAAj+AP8JHEiwoMGDCBMqXMiwocOHECMSHEexosWLGDNq3Mixo8ePIDtKHPhtGK6TKFOqXInrGcuXMGPKnEmzpspU40YKHBdryICfQIMKFVpHFq6hSJOWSMq0qdOnUH8S8PRN579v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\"","export default \"__VITE_ASSET__a63f4704__\"","export default \"__VITE_ASSET__898ca0f7__\"","import styled from '@emotion/styled';\nimport dotparty from 'Elements/dotparty.gif';\nimport logo from 'Elements/logo.gif';\nimport pride from 'Elements/pride.png';\nimport { MobilePhoneModeSetting, useSettingValue } from 'Scenes/Settings/SettingsState';\nimport { ComponentProps } from 'react';\n\nif (window.location.search.includes('pride')) {\n  sessionStorage.setItem('pride', 'true');\n}\n\nexport default function Logo(props: ComponentProps<typeof StyledLogo>) {\n  const [mobilePhoneMode] = useSettingValue(MobilePhoneModeSetting);\n\n  if (mobilePhoneMode) {\n    return null;\n  }\n  return (\n    <Container>\n      {sessionStorage.getItem('pride') === 'true' && <PrideLogo src={pride} alt=\"AllKaraoke Pride logo part 1\" />}\n      <StyledLogo src={logo} alt=\"AllKaraoke logo\" {...props} />\n      <DotParty src={dotparty} alt=\"AllKaraoke Pride logo part 2\" />\n    </Container>\n  );\n}\nconst StyledLogo = styled.img`\n  width: 66rem;\n  height: 16.4rem;\n`;\n\nconst Container = styled.div`\n  position: relative;\n  height: 16.4rem;\n  view-transition-name: logo;\n`;\n\nconst PrideLogo = styled(StyledLogo)`\n  position: absolute;\n`;\n\nconst DotParty = styled.img`\n  position: absolute;\n  width: 13.7rem;\n  height: 5.1rem;\n  bottom: -0.5rem;\n  right: -1rem;\n`;\n","export default function isChromium() {\n  return 'chrome' in window;\n}\n","import styled from '@emotion/styled';\nimport { typography } from 'Elements/cssMixins';\nimport styles from 'Scenes/Game/Singing/GameOverlay/Drawing/styles';\nimport isChromium from 'utils/isChromium';\n\nfunction RecommendedBrowsers() {\n  return (\n    <>\n      {!isChromium() && (\n        <RecommendChrome>\n          <h2>\n            This game is tested in <strong>Google Chrome</strong> and <strong>MS Edge</strong>.\n          </h2>\n          It's not guaranteed to work on other browsers (like the one you use now).\n        </RecommendChrome>\n      )}\n    </>\n  );\n}\n\nconst RecommendChrome = styled.div`\n  width: 100%;\n  ${typography};\n  text-align: center;\n  background: darkred;\n  padding: 3rem 0;\n  margin-top: 1rem;\n  h2 {\n    margin-top: 0;\n  }\n\n  strong {\n    color: ${styles.colors.text.active};\n  }\n`;\n\nexport default RecommendedBrowsers;\n","// https://tholman.com/github-corners/\nimport styled from '@emotion/styled';\n\nexport default function GithubRibbon() {\n  return (\n    <>\n      <Ribbon\n        href=\"https://github.com/Asvarox/allkaraoke\"\n        aria-label=\"View source on GitHub\"\n        target=\"_blank\"\n        rel=\"noreferrer\">\n        <svg\n          width=\"80\"\n          height=\"80\"\n          viewBox=\"0 0 250 250\"\n          style={{\n            fill: '#151513',\n            color: '#fff',\n            position: 'absolute',\n            top: 0,\n            border: 0,\n            left: 0,\n            transform: 'scale(-1, 1)',\n          }}\n          aria-hidden=\"true\">\n          <path d=\"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z\"></path>\n          <path\n            d=\"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2\"\n            fill=\"currentColor\"\n            style={{ transformOrigin: '13rem 10.6rem' }}\n            className=\"octo-arm\"></path>\n          <path\n            d=\"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z\"\n            fill=\"currentColor\"\n            className=\"octo-body\"></path>\n        </svg>\n      </Ribbon>\n    </>\n  );\n}\n\nconst Ribbon = styled.a`\n  &:hover .octo-arm {\n    animation: octocat-wave 560ms ease-in-out;\n  }\n  @keyframes octocat-wave {\n    0 %,\n    100% {\n      transform: rotate(0);\n    }\n    20%,\n    60% {\n      transform: rotate(-25deg);\n    }\n    40%,\n    80% {\n      transform: rotate(10deg);\n    }\n  }\n  @media (max-width: 500px) {\n    &:hover .octo-arm {\n      animation: none;\n    }\n    .octo-arm {\n      animation: octocat-wave 560ms ease-in-out;\n    }\n  }\n\n  view-transition-name: github-ribbon;\n`;\n","import styled from '@emotion/styled';\nimport { useBackground } from 'Elements/LayoutWithBackground';\nimport Logo from 'Elements/Logo';\nimport { MenuContainer } from 'Elements/Menu';\nimport RecommendedBrowsers from 'Elements/RecommendedBrowsers';\nimport GithubRibbon from 'Scenes/Welcome/GithubRibbon';\nimport { PropsWithChildren } from 'react';\n\ntype Props = PropsWithChildren<{\n  supportedBrowsers?: boolean;\n}>;\nfunction MenuWithLogo({ children, supportedBrowsers }: Props) {\n  useBackground(true);\n\n  return (\n    <>\n      <GithubRibbon />\n      <Container>\n        <Logo />\n        {supportedBrowsers && <RecommendedBrowsers />}\n        <MenuContainer>{children}</MenuContainer>\n      </Container>\n    </>\n  );\n}\n\nconst Container = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n`;\n\nexport default MenuWithLogo;\n","export default \"__VITE_ASSET__ba17dbac__\"","export default \"__VITE_ASSET__2ad5728e__\"","export default \"__VITE_ASSET__03b380f8__\"","export default \"__VITE_ASSET__4b5d4e94__\"","export default \"__VITE_ASSET__1483804b__\"","export default \"__VITE_ASSET__c276addd__\"","export default \"__VITE_ASSET__c41709e6__\"","import { Howl } from 'howler';\n\nimport waitFinishedSound from 'assets/376817__original_sound__impact-cinematic.wav';\nimport classicBackgroundMusicSound from 'assets/421888__b-sean__retro.mp3';\nimport wooshSound from 'assets/60013__qubodup__whoosh.mp3';\nimport backgroundMusicSound from 'assets/Funk Cool Groove (No Copyright Music) By Anwar Amr.mp3';\nimport menuBackSound from 'assets/menu_back.wav';\nimport menuEnterSound from 'assets/menu_enter.wav';\nimport menuNavigateSound from 'assets/menu_navigate.wav';\n\nconst menuNavigate = new Howl({\n  src: menuNavigateSound,\n});\n\nconst menuEnter = new Howl({\n  src: menuEnterSound,\n});\n\nconst menuBack = new Howl({\n  src: menuBackSound,\n});\n\nconst waitFinished = new Howl({\n  src: waitFinishedSound,\n  preload: true,\n});\n\nconst woosh = new Howl({\n  src: wooshSound,\n  preload: true,\n  volume: 0.5,\n});\n\nconst backgroundMusic = new Howl({\n  src: backgroundMusicSound,\n  volume: 0.3,\n  loop: true,\n});\nconst classicBackgroundMusic = new Howl({\n  src: classicBackgroundMusicSound,\n  volume: 0.4,\n  loop: true,\n});\n\nexport { backgroundMusic, classicBackgroundMusic, menuBack, menuEnter, menuNavigate, waitFinished, woosh };\n","import { BackgroundMusicSetting, useSettingValue } from 'Scenes/Settings/SettingsState';\nimport { backgroundMusic, classicBackgroundMusic } from 'SoundManager';\nimport { useEffect } from 'react';\n\nexport default function useBackgroundMusic(play: boolean) {\n  const [backgroundMusicSelection] = useSettingValue(BackgroundMusicSetting);\n\n  const music = backgroundMusicSelection === 'Classic' ? classicBackgroundMusic : backgroundMusic;\n\n  useEffect(() => {\n    if (play) {\n      if (!music.playing()) {\n        music.play();\n      }\n    } else {\n      music.stop();\n    }\n  }, [play]);\n}\n","import { useContext, useEffect, useRef } from 'react';\nimport { HelpEntry, KeyboardHelpContext } from 'Scenes/KeyboardHelp/Context';\n\nlet id = 0;\n\nexport default function useKeyboardHelp(help: HelpEntry, enabled: boolean) {\n  const name = useRef(`${String(Math.random())}-${id++}`);\n  const { setKeyboard, unsetKeyboard } = useContext(KeyboardHelpContext);\n\n  const setHelp = (help: HelpEntry) => {\n    setKeyboard(name.current, help);\n  };\n\n  const clearHelp = () => unsetKeyboard(name.current);\n\n  useEffect(() => {\n    if (enabled) {\n      setHelp(help);\n    }\n\n    return clearHelp;\n  }, [help, enabled]);\n\n  return { setHelp, clearHelp };\n}\n","import { HelpEntry } from 'Scenes/KeyboardHelp/Context';\nimport { menuBack, menuEnter, menuNavigate } from 'SoundManager';\nimport useKeyboard from 'hooks/useKeyboard';\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport useKeyboardHelp from './useKeyboardHelp';\n\n/**\n * todo: Bug: for some reason elementList is duplicated eg.\n * ['a', 'b', 'c', 'a', 'b', 'c']\n *\n * But still works even with dynamic elements :shrugs:\n */\ninterface Options {\n  enabled?: boolean;\n  onBackspace?: () => void;\n  backspaceHelp?: string | null;\n  direction?: 'horizontal' | 'vertical';\n  additionalHelp?: HelpEntry;\n}\n\ninterface KeyboardAction {\n  callback: () => void;\n  label?: string;\n  propName: string;\n}\n\nexport default function useKeyboardNav(options: Options = {}, debug = false) {\n  const { enabled = true, onBackspace, backspaceHelp = null, direction = 'vertical', additionalHelp = {} } = options;\n\n  const [currentlySelected, setCurrentlySelected] = useState<string | null>(null);\n  const elementList = useRef<string[]>([]);\n  const newElementList = useRef<string[]>([]);\n  const actions = useRef<Record<string, KeyboardAction>>({});\n\n  const currentlySelectedActionLabel = actions.current[currentlySelected!]?.label;\n  const help = useMemo(\n    () => ({\n      [direction]: null,\n      accept: currentlySelectedActionLabel ?? null,\n      back: onBackspace ? backspaceHelp : undefined,\n      ...additionalHelp,\n    }),\n    [currentlySelectedActionLabel, actions, backspaceHelp, direction],\n  );\n  useKeyboardHelp(help, enabled);\n\n  const handleEnter = () => {\n    actions.current[currentlySelected!]?.callback();\n    menuEnter.play();\n  };\n\n  const handleBackspace = () => {\n    if (onBackspace) {\n      menuBack.play();\n      onBackspace();\n    }\n  };\n\n  const handleNavigation = (direction: -1 | 1) => {\n    const currentIndex = currentlySelected ? elementList.current.indexOf(currentlySelected) : 0;\n    menuNavigate.play();\n\n    setCurrentlySelected(elementList.current.at((currentIndex + direction) % elementList.current.length) ?? null);\n  };\n\n  useKeyboard(\n    {\n      [direction === 'vertical' ? 'up' : 'left']: () => handleNavigation(-1),\n      [direction === 'vertical' ? 'down' : 'right']: () => handleNavigation(1),\n      accept: handleEnter,\n      back: handleBackspace,\n    },\n    enabled,\n    [currentlySelected, elementList.current],\n  );\n\n  let defaultSelection = '';\n\n  const register = (\n    name: string,\n    onActive: () => void,\n    help?: string,\n    isDefault = false,\n    { propName = 'onClick', disabled = false } = {},\n  ) => {\n    if (disabled) {\n      return { disabled, focused: false };\n    }\n    newElementList.current.push(name);\n    if (onActive) actions.current[name] = { callback: onActive, label: help, propName };\n\n    if (isDefault) {\n      defaultSelection = name;\n    }\n\n    const focused = enabled && currentlySelected === name;\n\n    return {\n      focused,\n      [propName]: onActive,\n      keyboardNavigationChangeFocus: handleNavigation,\n      'data-test': name,\n      ...(enabled ? { 'data-focused': focused } : {}),\n    };\n  };\n\n  useEffect(() => {\n    let newElements = newElementList.current.filter((e) => !elementList.current.includes(e));\n    debug && newElements.length && console.log('new elements', newElements);\n    elementList.current = [...newElementList.current];\n    newElementList.current.length = 0;\n\n    if (!elementList.current.length) return;\n    if (\n      currentlySelected === null ||\n      elementList.current.indexOf(currentlySelected) === -1 ||\n      newElements.includes(defaultSelection)\n    ) {\n      setCurrentlySelected(defaultSelection || elementList.current[0]);\n    }\n  });\n\n  const focusElement = (name: string) => {\n    if (elementList.current.includes(name)) setCurrentlySelected(name);\n  };\n\n  return {\n    focusElement,\n    focused: currentlySelected,\n    register,\n  };\n}\n","export default function startViewTransition(callback: () => void) {\n  // @ts-expect-error\n  if (!document.startViewTransition) {\n    callback();\n  } else {\n    // @ts-expect-error\n    document.startViewTransition(async () => {\n      await callback();\n    });\n  }\n}\n","import startViewTransition from 'utils/startViewTransition';\nimport { useLocation } from 'wouter';\n\ninterface Options {\n  replace?: boolean;\n  smooth?: boolean;\n}\n\nexport default function useSmoothNavigate() {\n  const [, baseNavigate] = useLocation();\n\n  return (to: string, { smooth = true, ...options }: Options = {}) => {\n    if (!smooth) {\n      baseNavigate(to, options);\n    } else {\n      startViewTransition(() => baseNavigate(to, options));\n    }\n  };\n}\n","import styled from '@emotion/styled';\nimport { Input } from 'Elements/Input';\nimport { forwardRef, useImperativeHandle, useRef } from 'react';\nimport { InputLagSetting, useSettingValue } from 'Scenes/Settings/SettingsState';\n\ninterface Props {\n  focused: boolean;\n}\n\nconst InputLag = forwardRef<HTMLInputElement, Props>(({ ...restProps }, forwardedRef) => {\n  const inputRef = useRef<HTMLInputElement>(null);\n  useImperativeHandle(forwardedRef, () => inputRef.current!);\n  const [inputLag, setInputLag] = useSettingValue(InputLagSetting);\n\n  return (\n    <InputLagField\n      ref={inputRef}\n      label=\"Input lag\"\n      value={String(inputLag)}\n      onChange={(val) => setInputLag(+val)}\n      type=\"number\"\n      step={50}\n      min={-2000}\n      max={2000}\n      adornment={'ms'}\n      onKeyDown={(e) => {\n        if (e.code === 'Enter') {\n          inputRef.current?.blur();\n        }\n      }}\n      info=\"If the sound is not synchorised with the lyrics, use this to compensate it.\"\n      {...restProps}\n    />\n  );\n});\n\nconst InputLagField = styled(Input)`\n  input {\n    text-align: right;\n  }\n`;\n\nexport default InputLag;\n","import { CircularProgress } from '@mui/material';\nimport CameraManager from 'Camera/CameraManager';\nimport { MenuButton } from 'Elements/Menu';\nimport MenuWithLogo from 'Elements/MenuWithLogo';\nimport { nextValue, Switcher } from 'Elements/Switcher';\nimport useBackgroundMusic from 'hooks/useBackgroundMusic';\nimport useKeyboardNav from 'hooks/useKeyboardNav';\nimport useSmoothNavigate from 'hooks/useSmoothNavigate';\nimport { ReactNode, useEffect, useRef, useState } from 'react';\nimport InputLag from 'Scenes/Settings/InputLag';\nimport {\n  BackgroundMusic,\n  BackgroundMusicSetting,\n  FpsCount,\n  FPSCountSetting,\n  GraphicSetting,\n  GraphicsLevel,\n  MobilePhoneModeSetting,\n  useSettingValue,\n} from 'Scenes/Settings/SettingsState';\n\ninterface Props {}\n\nfunction Settings(props: Props) {\n  useBackgroundMusic(false);\n  const navigate = useSmoothNavigate();\n  const goBack = () => navigate('/');\n\n  const { register } = useKeyboardNav({ onBackspace: goBack });\n\n  const [graphicLevel, setGraphicLevel] = useSettingValue(GraphicSetting);\n  const [fpsCount, setFpsCount] = useSettingValue(FPSCountSetting);\n  const [mobilePhoneMode, setMobilePhoneMode] = useSettingValue(MobilePhoneModeSetting);\n  const [backgroundMusic, setBackgroundMusic] = useSettingValue(BackgroundMusicSetting);\n  const inputLagRef = useRef<HTMLInputElement | null>(null);\n\n  const [camera, setCamera] = useState<null | boolean>(CameraManager.getPermissionStatus());\n  useEffect(() => {\n    return CameraManager.addListener((status) => {\n      setCamera(status);\n    });\n  }, []);\n\n  const [isRequestInProgress, setIsRequestInProgress] = useState(false);\n  const enableCamera = () => {\n    setIsRequestInProgress(true);\n    CameraManager.requestPermissions().then(() => setIsRequestInProgress(false));\n  };\n\n  let cameraValue: ReactNode = 'Disabled';\n  if (isRequestInProgress) cameraValue = <CircularProgress size=\"0.9em\" />;\n  else if (camera === null) cameraValue = 'Click to enable';\n  else if (camera) cameraValue = 'Enabled';\n\n  return (\n    <MenuWithLogo>\n      <h1>Settings</h1>\n      <Switcher\n        {...register('graphics-level', () => setGraphicLevel(nextValue(GraphicsLevel, graphicLevel)))}\n        label=\"Graphics\"\n        value={graphicLevel.toUpperCase()}\n      />\n      <Switcher\n        {...register('fps-count-level', () => setFpsCount(nextValue(FpsCount, fpsCount)))}\n        label=\"FPS Count\"\n        value={fpsCount}\n      />\n      <Switcher\n        {...register('background-music-selection', () =>\n          setBackgroundMusic(nextValue(BackgroundMusic, backgroundMusic)),\n        )}\n        label=\"Background Music\"\n        value={backgroundMusic}\n      />\n      <InputLag ref={inputLagRef} {...register('input-lag', () => inputLagRef.current?.focus())} />\n      <hr />\n      <Switcher\n        {...register('camera-access', () => (camera ? CameraManager.disable() : enableCamera()))}\n        label=\"Enable camera mode\"\n        value={cameraValue}\n        info=\"Record a timelapse video from singing. The recording is not sent nor stored anywhere.\"\n      />\n      <hr />\n      <Switcher\n        {...register('mobile-phone-mode', () => setMobilePhoneMode(!mobilePhoneMode))}\n        label=\"Mobile Phone Mode\"\n        value={mobilePhoneMode ? 'Yes' : 'No'}\n        info=\"Adjust the game to a smaller screen. Disables option to sing in duets.\"\n      />\n      <hr />\n      <MenuButton {...register('remote-mics-settings', () => navigate('/settings/remote-mics'))} size=\"small\">\n        Remote Microphones Settings\n      </MenuButton>\n      <MenuButton {...register('setup-mics-button', () => navigate('/select-input'))} size=\"small\">\n        Setup Microphones\n      </MenuButton>\n      <MenuButton {...register('manage-songs-button', () => navigate('/manage-songs'))} size=\"small\">\n        Manage Songs\n      </MenuButton>\n      <MenuButton {...register('back-button', goBack)}>Return To Main Menu</MenuButton>\n    </MenuWithLogo>\n  );\n}\n\nexport default Settings;\n","import styled from '@emotion/styled';\nimport { Search } from '@mui/icons-material';\nimport { Button, Tooltip } from '@mui/material';\nimport { ComponentProps } from 'react';\n\nexport const Pre = styled.span`\n  font-family: monospace;\n`;\n\nexport const inputAction = (action: ComponentProps<typeof Button>['onClick'], enabled: boolean, label = 'Lookup') => ({\n  InputProps: {\n    endAdornment: (\n      <Tooltip title={enabled ? 'Open search results for the song' : 'Artist or title of the song is unknown'}>\n        <span>\n          <Button\n            sx={{ mr: -1 }}\n            endIcon={<Search />}\n            color={'secondary'}\n            variant={'text'}\n            onClick={action}\n            disabled={!enabled}>\n            {label}\n          </Button>\n        </span>\n      </Tooltip>\n    ),\n  },\n});\n","import { Box, TextField } from '@mui/material';\nimport { inputAction } from 'Scenes/Convert/Elements';\nimport { getVideoId } from 'Songs/utils/convertTxtToSong';\nimport YouTube from 'react-youtube';\n\nexport interface AuthorAndVidEntity {\n  author: string;\n  authorUrl: string;\n  video: string;\n}\n\ninterface Props {\n  onChange: (data: AuthorAndVidEntity) => void;\n  data: AuthorAndVidEntity;\n  songTitle?: string;\n  songArtist?: string;\n}\n\nexport default function AuthorAndVid(props: Props) {\n  const searchForVideo = () => {\n    window.open(\n      `https://www.youtube.com/results?search_query=${encodeURIComponent(props?.songArtist + ' ' + props?.songTitle)}`,\n      '_blank',\n    );\n  };\n  const isSearchableForVideo = !!props.songTitle && !!props.songArtist;\n\n  const videoId = getVideoId(props.data.video);\n\n  return (\n    <Box sx={{ display: 'flex', flexWrap: 'wrap' }} data-test=\"author-and-vid\">\n      <TextField\n        data-test=\"author-name\"\n        sx={{ mt: 2 }}\n        value={props.data.author}\n        onChange={(e) => props.onChange({ ...props.data, author: e.target.value })}\n        label=\"Author name (optional)\"\n        fullWidth\n        size=\"small\"\n        helperText=\"Nickname of the person that created the .txt file.\"\n      />\n      <TextField\n        data-test=\"author-url\"\n        sx={{ mt: 2 }}\n        value={props.data.authorUrl}\n        onChange={(e) => props.onChange({ ...props.data, authorUrl: e.target.value })}\n        label=\"Author URL (optional)\"\n        helperText=\"Link to authors page/profile.\"\n        fullWidth\n        size=\"small\"\n      />\n      <Box sx={{ display: 'flex', flexDirection: 'row', mt: 2, alignItems: 'center', width: '100%' }}>\n        <TextField\n          data-test=\"video-url\"\n          required\n          value={props.data.video}\n          onChange={(e) => props.onChange({ ...props.data, video: e.target.value })}\n          label=\"YouTube Video URL\"\n          placeholder=\"https://www.youtube.com/watch?v=\"\n          fullWidth\n          size=\"small\"\n          helperText=\"Link to YouTube video, eg https://www.youtube.com/watch?v=xxxxxxxxx. Click the 'Lookup' button to look for it on YouTube\"\n          name=\"videoUrl\"\n          {...inputAction(searchForVideo, isSearchableForVideo)}\n        />\n      </Box>\n      {videoId && (\n        <Box>\n          <YouTube videoId={videoId} />\n        </Box>\n      )}\n    </Box>\n  );\n}\n","const accents = {\n  polish: {\n    È: 'é',\n    í: \"'\",\n    '¥': \"'\",\n    '¯': 'Ż',\n    '¹': 'ą',\n    π: 'ą',\n    ê: 'ę',\n    Í: 'ę',\n    Œ: 'Ś',\n    å: 'Ś',\n    œ: 'ś',\n    ú: 'ś',\n    æ: 'ć',\n    Ê: 'ć',\n    '¿': 'ż',\n    ø: 'ż',\n    Ø: 'Ż',\n    ñ: 'ń',\n    Ò: 'ń',\n    '³': 'ł',\n    '≥': 'ł',\n    '£': 'Ł',\n    Û: 'ó',\n    ü: 'ź',\n    Ÿ: 'ź',\n  },\n  spanish: {\n    ø: '¿',\n    È: 'é',\n    Ì: 'í',\n    Ò: 'ñ',\n    ń: 'ñ',\n    '·': 'á',\n    Û: 'ó',\n    '°': '!',\n    '˙': 'ú',\n    ś: 'ú',\n  },\n};\n\nexport function fixDiacritics(txt: string, language: string): string {\n  const accentSet = accents[language as any as keyof typeof accents];\n  if (accentSet === undefined) return txt;\n\n  let fixedTxt = txt;\n  for (const [accent, replacement] of Object.entries(accentSet)) {\n    fixedTxt = fixedTxt.replaceAll(accent, replacement);\n  }\n\n  return fixedTxt;\n}\n","export default function isValidUltrastarTxtFormat(songTxt: string) {\n  const lines = songTxt.split('\\n');\n  const requiredTags = ['#TITLE', '#ARTIST', '#BPM'];\n  let isValid = true;\n\n  requiredTags.forEach((tag) => {\n    if (!lines.some((line) => line.startsWith(tag))) {\n      isValid = false;\n    }\n  });\n\n  // Checking if there exist any song notes or not\n  if (!lines.some((line) => line.startsWith(':'))) {\n    isValid = false;\n  }\n\n  return isValid;\n}\n","import { AuthorAndVidEntity } from 'Scenes/Convert/Steps/AuthorAndVid';\n\nexport default async function importSongFromSource(url: string) {\n  const urlObj = new URL(url);\n\n  if (urlObj.host === 'usdb.animux.de') {\n    return importUsDbAnimuxSong(url, urlObj);\n  } else if (urlObj.host === 'ultrastar-es.org') {\n    return importUltrastarEsSong(url);\n  }\n}\n\nasync function importUltrastarEsSong(url: string): Promise<AuthorAndVidEntity> {\n  const response = await fetch(`${import.meta.env.VITE_APP_SONG_CONVERT_PROXY}?url=${encodeURIComponent(url)}`);\n  const text = await response.text();\n\n  const doc = new DOMParser().parseFromString(text, 'text/html');\n\n  const id = doc.querySelector('ul[data-id]')?.getAttribute('data-id');\n  const txtUrl = `https://ultrastar-es.org/pl/canciones/descargar/txt/${id}`;\n  window.location.href = txtUrl;\n\n  const authorPath = doc.querySelector('#listado > ul > li > dl > dd:nth-child(6) > a')?.getAttribute('href');\n  const videoId = doc.querySelector('#listado > ul > li')?.getAttribute('data-id');\n\n  return {\n    authorUrl: authorPath ? 'https://ultrastar-es.org' + authorPath : '',\n    author: doc.querySelector('#listado > ul > li > dl > dd:nth-child(6)')?.textContent ?? '',\n    video: videoId ? 'https://www.youtube.com/watch?v=' + videoId : '',\n  };\n}\n\nasync function importUsDbAnimuxSong(url: string, obj: URL): Promise<AuthorAndVidEntity> {\n  const response = await fetch(`${import.meta.env.VITE_APP_SONG_CONVERT_PROXY}?url=${encodeURIComponent(url)}`);\n  const text = await response.text();\n\n  const doc = new DOMParser().parseFromString(text, 'text/html');\n\n  const author = doc.querySelector('a[href^=\"?link=profil&id=\"]')?.textContent;\n  const authorPath = doc.querySelector('a[href^=\"?link=profil&id=\"]')?.getAttribute?.('href');\n\n  const artist = doc.querySelector(\n    '#tablebg > tbody > tr:nth-child(3) > td > table:nth-child(2) > tbody > tr.list_head > td:nth-child(1)',\n  )?.textContent;\n  const title = doc.querySelector(\n    '#tablebg > tbody > tr:nth-child(3) > td > table:nth-child(2) > tbody > tr.list_head > td:nth-child(2)',\n  )?.textContent;\n\n  window.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(artist + ' ' + title)}`, '_blank');\n  window.open(`http://usdb.animux.de/index.php?link=gettxt&id=${obj.searchParams.get('id')}`, '_blank');\n\n  return {\n    authorUrl: authorPath ? 'http://usdb.animux.de/index.php' + authorPath : '',\n    author: author ?? '',\n    video: '',\n  };\n}\n","import { Box, Button, TextField } from '@mui/material';\nimport { AuthorAndVidEntity } from 'Scenes/Convert/Steps/AuthorAndVid';\nimport { fixDiacritics } from 'Scenes/Convert/Steps/utils/fixDiacritics';\nimport isValidUltrastarTxtFormat from 'Scenes/Convert/Steps/utils/validateUltrastar';\nimport importUltrastarEsSong from 'Scenes/Convert/importUltrastarEsSong';\nimport isNotesSection from 'Songs/utils/isNotesSection';\nimport { Song } from 'interfaces';\nimport { ChangeEventHandler, useMemo } from 'react';\n\nexport interface BasicDataEntity {\n  sourceUrl: string;\n  txtInput: string;\n}\n\ninterface Props {\n  shouldAutoImport: boolean;\n  onAutoImport: (data: AuthorAndVidEntity) => void;\n  onChange: (data: BasicDataEntity) => void;\n  data: BasicDataEntity;\n  isTxtRequired: boolean;\n  finalSong: Song;\n}\n\nexport default function BasicData(props: Props) {\n  const onSourceUrlEdit: ChangeEventHandler<HTMLInputElement> = async (e) => {\n    props.onChange({ ...props.data, sourceUrl: e.target.value });\n    if (props.shouldAutoImport) {\n      const data = await importUltrastarEsSong(e.target.value);\n\n      if (data) props.onAutoImport(data);\n    }\n  };\n\n  const fixAccents = (language: string) => {\n    props.onChange({\n      ...props.data,\n      txtInput: fixDiacritics(props.data.txtInput, language),\n    });\n  };\n\n  const isValidTxt = useMemo(() => isValidUltrastarTxtFormat(props.data.txtInput), [props.data.txtInput]);\n\n  const isTxtInputValid = !isValidTxt && props.data.txtInput.length > 0;\n\n  return (\n    <Box sx={{ display: 'flex', flexWrap: 'wrap' }} data-test=\"basic-data\">\n      {props.isTxtRequired && (\n        <div>\n          <h4>Where to find songs?</h4>\n          <p>\n            Any UltraStar compatible .txt file will do. You can find many already made songs on{' '}\n            <a href=\"https://usdb.animux.de/\" target=\"_blank\" rel=\"noreferrer\">\n              usdb.animux.de\n            </a>\n            {' or '}\n            <a href=\"https://ultrastar-es.org/en\" target=\"_blank\" rel=\"noreferrer\">\n              ultrastar-es.org\n            </a>\n            .<br />\n            <br />\n          </p>\n          <p>\n            You don't need audio/video files, you'll be able to search for appropriate YouTube video and synchronise the\n            lyrics to it in subsequent steps.\n          </p>\n        </div>\n      )}\n      <TextField\n        sx={{ mt: 2 }}\n        value={props.data.sourceUrl}\n        onChange={onSourceUrlEdit}\n        label=\"Source URL (optional)\"\n        fullWidth\n        size=\"small\"\n        data-test=\"source-url\"\n        helperText=\"The link to the page from which the .TXT file was downloaded.\"\n      />\n      {props.isTxtRequired ? (\n        <>\n          <TextField\n            error={isTxtInputValid}\n            helperText={isTxtInputValid ? \"This doesn't look like a valid UltraStar .TXT format\" : ''}\n            required\n            sx={{ mt: 2 }}\n            fullWidth\n            size=\"small\"\n            multiline\n            label=\"Song's UltraStar .TXT file contents\"\n            onChange={(e) =>\n              props.onChange({\n                ...props.data,\n                txtInput: e.target.value,\n              })\n            }\n            value={props.data.txtInput}\n            maxRows={15}\n            minRows={15}\n            InputProps={{\n              inputProps: {\n                'data-test': 'input-txt',\n                sx: { fontFamily: 'monospace' },\n              },\n            }}\n          />\n          <Box sx={{ display: 'flex', gap: 1, mt: 1 }}>\n            <Button onClick={() => fixAccents('polish')}>Fix 🇵🇱 Polish accents</Button>\n            <Button onClick={() => fixAccents('spanish')}>Fix 🇪🇸 Spanish accents</Button>\n          </Box>\n        </>\n      ) : (\n        <Box sx={{ display: 'flex', width: '100%', height: 500, overflow: 'auto' }}>\n          {props.finalSong?.tracks?.map((track, index) => (\n            <Box key={index} sx={{ flex: 1 }}>\n              <h4>{track.name ?? `Track #${index + 1}`}</h4>\n              {track.sections.filter(isNotesSection).map((section) => (\n                <p key={section.start}>{section.notes.map((note) => note.lyrics).join('')}</p>\n              ))}\n            </Box>\n          ))}\n        </Box>\n      )}\n    </Box>\n  );\n}\n","import { Button, Tooltip } from '@mui/material';\nimport { Pre } from 'Scenes/Convert/Elements';\nimport GameState from 'Scenes/Game/Singing/GameState/GameState';\nimport { PlayerRef } from 'Scenes/Game/Singing/Player';\nimport { seconds } from 'interfaces';\nimport { YouTubePlayer } from 'react-youtube';\n\nconst formatMs = (msec: number) => {\n  const minutes = Math.floor(msec / 1000 / 60);\n  const seconds = Math.floor(msec / 1000) - minutes * 60;\n  const miliseconds = Math.floor(msec % 1000);\n\n  return (\n    <Pre>\n      {String(minutes).padStart(2, '0')}:{String(seconds).padStart(2, '0')}.{String(miliseconds).padStart(3, '0')}\n    </Pre>\n  );\n};\n\nconst ytPlayerAdapter = (player: PlayerRef | YouTubePlayer): PlayerRef => {\n  if ('playVideo' in player) {\n    return {\n      play: () => player.playVideo(),\n      pause: () => player.pauseVideo(),\n      seekTo: (timeSec: seconds) => player.seekTo(timeSec, true),\n      setPlaybackSpeed: (rate) => player.setPlaybackRate(rate),\n    };\n  }\n\n  return player;\n};\n\nexport const msec = (ms: number | undefined, player?: PlayerRef | YouTubePlayer | null) => (\n  <Tooltip title=\"Click to play the moment just before this time\" placement={'top'} arrow>\n    <Button\n      sx={{ py: 0.15, mb: 0.5 }}\n      variant={'contained'}\n      size=\"small\"\n      disabled={!player}\n      onClick={\n        player\n          ? () => {\n              GameState.resetPlayerNotes();\n              ytPlayerAdapter(player).seekTo((ms ?? 0) / 1000 - 0.7);\n            }\n          : undefined\n      }>\n      {formatMs(ms ?? 0)}\n    </Button>\n  </Tooltip>\n);\n\nexport default formatMs;\n","import { Box, Slider } from '@mui/material';\nimport { SongMetadataEntity } from 'Scenes/Convert/Steps/SongMetadata';\nimport { msec } from 'Scenes/Convert/Steps/SyncLyricsToVideo/Helpers/formatMs';\nimport backgroundMusic from 'assets/Funk Cool Groove (No Copyright Music) By Anwar Amr.mp3';\nimport { useEffect, useRef, useState } from 'react';\nimport YouTube from 'react-youtube';\n\ninterface Props {\n  onChange: (data: SongMetadataEntity) => void;\n  data: SongMetadataEntity;\n  videoId: string;\n  videoGap?: number;\n}\n\nconst MIN_PREVIEW_LENGTH = 10;\n\nexport default function PreviewAndVolumeAdjustment({ data, onChange, videoId, videoGap = 0 }: Props) {\n  const player = useRef<YouTube | null>(null);\n  const reference = useRef<HTMLAudioElement | null>(null);\n\n  const [initialised, setInitialised] = useState(false);\n  useEffect(() => {\n    (async () => {\n      if (data.volume === 0) {\n        onChange({ ...data, volume: 0.5 });\n        await player.current?.getInternalPlayer()?.setVolume(50);\n      } else {\n        await player.current?.getInternalPlayer()?.setVolume(data.volume * 100);\n      }\n      setInitialised(true);\n    })();\n  }, []);\n\n  useEffect(() => {\n    if (!initialised) {\n      return;\n    }\n    const interval = setInterval(async () => {\n      const currentVolume = await player.current?.getInternalPlayer()?.getVolume();\n      if (currentVolume !== undefined && currentVolume !== data.volume * 100) {\n        onChange({ ...data, volume: currentVolume / 100 });\n      }\n    }, 500);\n\n    return () => {\n      clearInterval(interval);\n    };\n  }, [initialised, data, onChange]);\n\n  const [isPlayerPlaying, setIsPlayerPlaying] = useState(false);\n  const [isReferencePlaying, setIsReferencePlaying] = useState(false);\n\n  const handleSliderChange = async (e: any, value: number | number[]) => {\n    await player.current?.getInternalPlayer()?.setVolume(+value * 100);\n    onChange({ ...data, volume: +value });\n  };\n\n  const previewStart = data.previewStart ?? videoGap + 60;\n  const previewEnd = data.previewEnd ?? previewStart + 30;\n  const [duration, setDuration] = useState<number | null>(null);\n  useEffect(() => {\n    player.current?.getInternalPlayer()?.getDuration().then(setDuration);\n  }, []);\n\n  const internalPlayer = player.current?.getInternalPlayer();\n\n  return (\n    <Box sx={{ display: 'flex', flexDirection: 'column', width: '100%' }}>\n      <h3>\n        Set song preview (start: {msec(previewStart * 1000, internalPlayer)}, end:{' '}\n        {msec(previewEnd * 1000, internalPlayer)})\n      </h3>\n      <Box sx={{ display: 'flex', gap: 5 }}>\n        <Slider\n          data-test=\"song-preview\"\n          disabled={duration === null}\n          step={1}\n          value={[previewStart, previewEnd]}\n          max={(duration ?? 500) - MIN_PREVIEW_LENGTH}\n          onChange={(e, value) => {\n            const [start, end] = value as number[];\n            if (end - start > MIN_PREVIEW_LENGTH) {\n              onChange({\n                ...data,\n                previewStart: start,\n                previewEnd: end,\n              });\n            }\n          }}\n        />\n      </Box>\n\n      <h3>Adjust volume</h3>\n      <Box sx={{ display: 'flex', gap: 5 }}>\n        <Box>\n          <h4>Song</h4>\n          <YouTube\n            videoId={videoId}\n            ref={player}\n            onPlay={() => {\n              setIsPlayerPlaying(true);\n\n              if (isReferencePlaying) {\n                reference.current?.pause();\n                setTimeout(() => setIsReferencePlaying(true), 200);\n              }\n            }}\n            onPause={() => {\n              setIsReferencePlaying(false);\n            }}\n          />\n        </Box>\n        <Box>\n          <h4>Reference sound</h4>\n          <p>Use the slider below to make the video volume roughly the same as this music.</p>\n          <br />\n          <audio\n            ref={reference}\n            controls\n            src={backgroundMusic}\n            loop\n            onPlay={(e) => {\n              e.currentTarget.volume = 0.5;\n              setIsReferencePlaying(true);\n              if (isPlayerPlaying) {\n                player.current?.getInternalPlayer()?.pauseVideo();\n                setTimeout(() => setIsPlayerPlaying(true), 200);\n              }\n            }}\n            onPause={() => {\n              setIsReferencePlaying(false);\n              if (isPlayerPlaying) {\n                player.current?.getInternalPlayer()?.playVideo();\n              }\n            }}\n          />\n        </Box>\n      </Box>\n      <h4>Final Song Volume ({data.volume * 100})</h4>\n      <Box>\n        <Slider\n          data-test=\"volume\"\n          min={0.1}\n          max={1}\n          step={0.01}\n          aria-label=\"Volume\"\n          value={data.volume}\n          onChange={handleSliderChange}\n        />\n      </Box>\n    </Box>\n  );\n}\n","import { Autocomplete, Grid, TextField } from '@mui/material';\nimport { inputAction } from 'Scenes/Convert/Elements';\nimport PreviewAndVolumeAdjustment from 'Scenes/Convert/Steps/PreviewAndVolumeAdjustment';\nimport useSongIndex from 'Songs/hooks/useSongIndex';\nimport { useMemo } from 'react';\n\nexport interface SongMetadataEntity {\n  artist: string;\n  title: string;\n  year: string;\n  realBpm: string;\n  language: string | string[];\n  volume: number;\n  previewStart: number | undefined;\n  previewEnd: number | undefined;\n  genre?: string;\n}\n\ninterface Props {\n  onChange: (data: SongMetadataEntity) => void;\n  data: SongMetadataEntity;\n  songTitle?: string;\n  songArtist?: string;\n  videoId: string;\n  videoGap?: number;\n}\n\nexport default function SongMetadata(props: Props) {\n  const songList = useSongIndex(true);\n\n  const definedLanguages = useMemo(\n    () => [\n      ...new Set(\n        songList.data\n          .map(({ language }) => (Array.isArray(language) ? language : [language]))\n          .flat()\n          .filter(Boolean),\n      ),\n    ],\n    [songList.data],\n  );\n  const definedGenres = useMemo(\n    () => [\n      ...new Set(\n        songList.data\n          .map((song) => song.genre)\n          .filter(Boolean)\n          .map((genre) => genre!.toLowerCase().replace(/\\b\\w/g, (l) => l.toUpperCase().trim())),\n      ),\n    ],\n    [songList.data],\n  );\n\n  const searchGoogle = (phrase: string) => {\n    window.open(\n      `https://www.google.com/search?q=${encodeURIComponent(`${props.songArtist} ${props.songTitle} ${phrase}`)}`,\n      '_blank',\n    );\n  };\n  const isSearchableForVideo = !!props.songTitle && !!props.songArtist;\n\n  return (\n    <Grid container spacing={2} sx={{ mt: 6 }}>\n      <Grid item xs={6}>\n        <TextField\n          value={props.data.artist}\n          onChange={(e) => props.onChange({ ...props.data, artist: e.target.value })}\n          label=\"Song artist\"\n          size=\"small\"\n          data-test=\"song-artist\"\n          required\n          fullWidth\n        />\n      </Grid>\n      <Grid item xs={6}>\n        <TextField\n          value={props.data.title}\n          onChange={(e) => props.onChange({ ...props.data, title: e.target.value })}\n          label=\"Song title\"\n          fullWidth\n          size=\"small\"\n          required\n          data-test=\"song-title\"\n        />\n      </Grid>\n      <Grid item xs={6}>\n        <Autocomplete\n          onKeyDown={(event) => {\n            if (event.key === 'Enter') {\n              event.preventDefault();\n            }\n          }}\n          freeSolo\n          disableClearable\n          options={definedGenres}\n          value={props.data.genre ?? ''}\n          onChange={(e, newValue) => props.onChange({ ...props.data, genre: newValue })}\n          renderInput={(params) => (\n            <TextField\n              {...params}\n              onBlur={(e) => props.onChange({ ...props.data, genre: e.target.value })}\n              label=\"Song genre (optional)\"\n              size=\"small\"\n              data-test=\"song-genre\"\n              fullWidth\n            />\n          )}\n        />\n      </Grid>\n      <Grid item xs={6}>\n        <Autocomplete\n          onKeyDown={(event) => {\n            if (event.key === 'Enter') {\n              event.preventDefault();\n            }\n          }}\n          multiple\n          freeSolo\n          disableClearable\n          options={definedLanguages}\n          value={typeof props.data.language === 'string' ? [props.data.language] : props.data.language}\n          onChange={(e, newValue) => {\n            props.onChange({\n              ...props.data,\n              language: newValue ? (newValue.filter(Boolean) as string[]) : props.data.language,\n            });\n          }}\n          renderInput={(params) => (\n            <TextField\n              {...params}\n              label=\"Song language\"\n              fullWidth\n              size=\"small\"\n              required={!props.data.language?.length}\n              data-test=\"song-language\"\n            />\n          )}\n        />\n      </Grid>\n      <Grid item xs={6}>\n        <TextField\n          data-test=\"release-year\"\n          value={props.data.year}\n          onChange={(e) => props.onChange({ ...props.data, year: e.target.value })}\n          label=\"Release year\"\n          helperText=\"The year the song was released. Click the 'Lookup' button to look for it on Google\"\n          fullWidth\n          size=\"small\"\n          required\n          {...inputAction(() => searchGoogle('release year'), isSearchableForVideo)}\n        />\n      </Grid>\n      <Grid item xs={6}>\n        <TextField\n          data-test=\"song-bpm\"\n          value={props.data.realBpm}\n          onChange={(e) => props.onChange({ ...props.data, realBpm: e.target.value })}\n          label=\"Song (real) BPM\"\n          helperText=\"The actual tempo of the song. Click the 'Lookup' button to look for it on Google\"\n          fullWidth\n          type=\"number\"\n          size=\"small\"\n          required\n          {...inputAction(() => searchGoogle('tempo'), isSearchableForVideo)}\n        />\n      </Grid>\n      <Grid item xs={12}></Grid>\n      <Grid item xs={12}>\n        <PreviewAndVolumeAdjustment {...props} />\n      </Grid>\n    </Grid>\n  );\n}\n","import { Box, Button, ButtonGroup, Divider, Typography } from '@mui/material';\nimport { useState } from 'react';\nimport { Pre } from 'Scenes/Convert/Elements';\nimport formatMs from 'Scenes/Convert/Steps/SyncLyricsToVideo/Helpers/formatMs';\nimport { PlayerRef } from 'Scenes/Game/Singing/Player';\n\ninterface Props {\n  player: PlayerRef;\n  currentTime: number;\n  effectsEnabled: boolean;\n  onEffectsToggle: () => void;\n}\n\nexport default function AdjustPlayback({ player, currentTime, effectsEnabled, onEffectsToggle }: Props) {\n  const seekBy = (bySec: number) => player.seekTo((currentTime + bySec) / 1000);\n  const [currentSpeed, setCurrentSpeed] = useState(1);\n\n  return (\n    <>\n      <Box sx={{ mb: 2 }}>\n        <Typography variant={'h6'} data-test=\"current-time\">\n          Current time: {formatMs(currentTime)} (<Pre>{Math.round(currentTime)}</Pre> ms)\n        </Typography>\n        <Box sx={{ display: 'flex', gap: 1 }}>\n          <ButtonGroup variant=\"contained\" sx={{ display: 'flex', mt: 1, flex: 1 }}>\n            <Button sx={{ flex: 1, px: 1 }} onClick={() => seekBy(-10_000)} data-test=\"seek-10s\">\n              -10\n            </Button>\n            <Button sx={{ flex: 1, px: 1 }} onClick={() => seekBy(-5_000)} data-test=\"seek-5s\">\n              -5\n            </Button>\n            <Button sx={{ flex: 1, px: 1 }} onClick={() => seekBy(-1_000)} data-test=\"seek-1s\">\n              -1\n            </Button>\n            <Button sx={{ flex: 1, px: 1 }} onClick={() => seekBy(-500)} data-test=\"seek-0.5s\">\n              -0.5\n            </Button>\n          </ButtonGroup>\n          <Divider />\n          <ButtonGroup variant=\"contained\" sx={{ display: 'flex', mt: 1, flex: 1 }}>\n            <Button sx={{ flex: 1, px: 1 }} onClick={() => seekBy(+500)} data-test=\"seek+0.5s\">\n              +0.5\n            </Button>\n            <Button sx={{ flex: 1, px: 1 }} onClick={() => seekBy(+1_000)} data-test=\"seek+1s\">\n              +1\n            </Button>\n            <Button sx={{ flex: 1, px: 1 }} onClick={() => seekBy(+5_000)} data-test=\"seek+5s\">\n              +5\n            </Button>\n            <Button sx={{ flex: 1, px: 1 }} onClick={() => seekBy(+10_000)} data-test=\"seek+10s\">\n              +10\n            </Button>\n          </ButtonGroup>\n        </Box>\n      </Box>\n      <Box sx={{ mb: 2 }}>\n        <Typography variant={'h6'}>\n          Playback speed: <Pre data-test=\"current-speed\">{currentSpeed * 100}%</Pre>\n        </Typography>\n        <ButtonGroup variant=\"contained\" sx={{ display: 'flex', mt: 1 }}>\n          {[0.25, 0.5, 0.75, 1, 1.25, 1.5, 2].map((speed) => (\n            <Button\n              data-test={`speed-${speed}`}\n              key={speed}\n              sx={{ flex: 1 }}\n              onClick={() => {\n                setCurrentSpeed(speed);\n                player.setPlaybackSpeed(speed);\n              }}\n              disabled={currentSpeed === speed}>\n              {speed * 100}%\n            </Button>\n          ))}\n        </ButtonGroup>\n      </Box>\n    </>\n  );\n}\n","import { Section } from 'interfaces';\nimport { useMemo } from 'react';\n\nexport default function useCurrentSectionIndex(sections: Section[], currentBeat: number) {\n  const wholeBeat = Math.floor(currentBeat);\n  return useMemo(\n    () =>\n      sections.findIndex((section, index) => {\n        if (wholeBeat < 0) return true;\n        if (wholeBeat < section.start) return false;\n        if (index === sections.length - 1) return true;\n        if (sections[index + 1].start > wholeBeat) {\n          return true;\n        }\n        return false;\n      }),\n    [wholeBeat, sections],\n  );\n}\n","import styled from '@emotion/styled';\nimport {\n  Box,\n  Button,\n  ButtonGroup,\n  List,\n  ListItem,\n  ListItemButton,\n  ListItemText,\n  Stack,\n  TextField,\n  Typography,\n} from '@mui/material';\nimport { msec } from 'Scenes/Convert/Steps/SyncLyricsToVideo/Helpers/formatMs';\nimport GameState from 'Scenes/Game/Singing/GameState/GameState';\nimport getCurrentBeat from 'Scenes/Game/Singing/GameState/Helpers/getCurrentBeat';\nimport useCurrentSectionIndex from 'Scenes/Game/Singing/Hooks/useCurrentSectionIndex';\nimport { PlayerRef } from 'Scenes/Game/Singing/Player';\nimport isNotesSection from 'Songs/utils/isNotesSection';\nimport { getFirstNoteStartFromSections } from 'Songs/utils/notesSelectors';\nimport { Song } from 'interfaces';\nimport { useEffect, useState } from 'react';\n\ninterface Props {\n  song: Song;\n  currentTime: number;\n  beatLength: number;\n  player: PlayerRef;\n  onRecordChange: (changeRecords: ChangeRecord[]) => void;\n  onTrackNameChange: (track: number, newName: string) => void;\n}\n\ninterface ChangeRecordBase {\n  track: number;\n  section: number;\n}\n\ninterface ChangeRecordShift extends ChangeRecordBase {\n  track: number;\n  section: number;\n  type: 'shift';\n  shift: number;\n}\n\ninterface ChangeRecordDelete extends ChangeRecordBase {\n  track: number;\n  section: number;\n  type: 'delete';\n}\n\nexport type ChangeRecord = ChangeRecordDelete | ChangeRecordShift;\n\nexport default function EditSection({\n  song,\n  currentTime,\n  beatLength,\n  player,\n  onRecordChange,\n  onTrackNameChange,\n}: Props) {\n  const [track, setTrack] = useState(0);\n  const [selectedSection, setSelectedSection] = useState(-1);\n  const [changeRecords, setChangeRecords] = useState<ChangeRecord[]>([]);\n  const currentBeat = getCurrentBeat(currentTime, beatLength, song.gap);\n\n  const sections = song.tracks[track].sections.filter(isNotesSection);\n\n  const currentSectionIndex = useCurrentSectionIndex(sections, currentBeat);\n\n  const onSectionClick = (index: number) => {\n    setSelectedSection(index);\n    GameState.resetPlayerNotes();\n    player.seekTo((sections[index].start * beatLength + song.gap) / 1000);\n  };\n\n  const deleteSection = () => {\n    setChangeRecords((records) => [...records, { type: 'delete', section: selectedSection, track }]);\n    if (selectedSection === sections.length - 1) {\n      setSelectedSection((selected) => selected - 1);\n    }\n  };\n\n  const shiftSection = (newStart: number) => {\n    setChangeRecords((records) => {\n      const lastRecord = records.at(-1);\n\n      if (\n        lastRecord &&\n        lastRecord.type === 'shift' &&\n        lastRecord.track === track &&\n        lastRecord.section === selectedSection\n      ) {\n        const newRecords = [...records];\n        (newRecords.at(-1)! as ChangeRecordShift).shift = newStart;\n\n        return newRecords;\n      }\n\n      return [...records, { type: 'shift', section: selectedSection, track, shift: newStart }];\n    });\n  };\n\n  useEffect(() => {\n    onRecordChange(changeRecords);\n  }, [onRecordChange, changeRecords]);\n\n  return (\n    <SectionEdtiorContainer>\n      <Stack direction=\"row\">\n        <Typography variant={'h6'} mb={0} sx={{ flex: 1 }}>\n          Edit verses\n          {song.tracks.length > 1 && (\n            <ButtonGroup variant={'contained'} sx={{ ml: 2 }} size={'small'}>\n              {song.tracks.map((_, index) => (\n                <Button\n                  key={index}\n                  onClick={() => setTrack(index)}\n                  disabled={track === index}\n                  data-test={`track-${index + 1}`}>\n                  Track {index + 1}\n                </Button>\n              ))}\n            </ButtonGroup>\n          )}\n        </Typography>\n        <TextField\n          placeholder=\"Set track name\"\n          sx={{ flex: 1 }}\n          size=\"small\"\n          value={song.tracks[track]?.name ?? ''}\n          onChange={(e) => onTrackNameChange(track, e.target.value)}\n          data-test=\"track-name\"\n        />\n      </Stack>\n      <Stack direction=\"row\" spacing={2} sx={{ height: '400px' }}>\n        <List sx={{ overflowY: 'auto' }}>\n          {sections.map((section, index) => (\n            <ListItem key={section.start} disablePadding data-test={`section-${index}`}>\n              <ListItemButton onClick={() => onSectionClick(index)} selected={selectedSection === index}>\n                <ListItemText\n                  primaryTypographyProps={{\n                    fontWeight: index === currentSectionIndex ? 'bold' : 'normal',\n                  }}\n                  primary={isNotesSection(section) ? section.notes.map((note) => note.lyrics).join('') : '[pause]'}\n                />\n              </ListItemButton>\n            </ListItem>\n          ))}\n        </List>\n        <SectionEditForm>\n          {selectedSection > -1 && (\n            <>\n              {selectedSection === 0 && (\n                <h3 data-test={`use-gap-info`}>Use gap shift to change when this section starts</h3>\n              )}\n              {selectedSection > 0 && (\n                <>\n                  <TextField\n                    data-test=\"change-start-beat\"\n                    size={'small'}\n                    type=\"number\"\n                    onChange={(e) => shiftSection(+e.target.value)}\n                    value={getFirstNoteStartFromSections([sections[selectedSection]])}\n                    label=\"Change start beat\"\n                    InputProps={{\n                      inputProps: {\n                        step: 1,\n                      },\n                    }}\n                    fullWidth\n                    sx={{ mb: 2 }}\n                    helperText={\n                      <>\n                        Timestamp:{' '}\n                        {msec(\n                          getFirstNoteStartFromSections([sections[selectedSection]]) * beatLength + song.gap,\n                          player,\n                        )}\n                      </>\n                    }\n                  />\n                </>\n              )}\n              <Button variant=\"contained\" color={'error'} onClick={deleteSection} fullWidth data-test=\"delete-section\">\n                Delete section\n              </Button>\n            </>\n          )}\n        </SectionEditForm>\n        <SectionChangeList>\n          <Box sx={{ overflowY: 'auto', maxHeight: '34rem' }} data-test=\"change-list\">\n            {changeRecords.map((change, index) => {\n              let message = '';\n              let Component = SectionChangeDelete;\n              if (change.type === 'delete') {\n                Component = SectionChangeDelete;\n                message = `Deleted`;\n              } else if (change.type === 'shift') {\n                Component = SectionChangeShift;\n                message = `Start -> ${change.shift}`;\n              }\n\n              return (\n                <Component key={index}>\n                  <strong>\n                    Track: {change.track + 1}, Section: {change.section + 1}, {message}\n                  </strong>\n                </Component>\n              );\n            })}\n          </Box>\n          {changeRecords.length > 0 && (\n            <Button\n              data-test=\"undo-change\"\n              variant=\"contained\"\n              color={'warning'}\n              onClick={() => setChangeRecords((records) => records.filter((_, index) => index !== records.length - 1))}\n              fullWidth>\n              Undo last change\n            </Button>\n          )}\n        </SectionChangeList>\n      </Stack>\n    </SectionEdtiorContainer>\n  );\n}\n\nconst SectionChangeList = styled.div`\n  flex: 1;\n`;\n\nconst ChangeEntry = styled.div`\n  padding: 0.5rem;\n`;\n\nconst SectionChangeDelete = styled(ChangeEntry)`\n  color: red;\n`;\n\nconst SectionChangeShift = styled(ChangeEntry)`\n  color: #0059ff;\n`;\n\nconst Editor = styled.div`\n  display: flex;\n  flex-direction: row;\n`;\n\nconst SectionEdtiorContainer = styled.div``;\n\nconst SectionEditForm = styled.div`\n  flex: 1;\n`;\n\nconst SectionList = styled.div`\n  flex: 1;\n  overflow-y: auto;\n`;\nconst SectionListEntry = styled.div<{ active: boolean; selected: boolean }>`\n  font-weight: ${(props) => (props.active ? 'bold' : 'normal')};\n\n  border: 0.1rem solid;\n  border-color: ${(props) => (props.selected ? 'black' : 'white')};\n\n  padding: 1rem;\n`;\n","import { Song } from 'interfaces';\nimport { PlayerRef } from 'Scenes/Game/Singing/Player';\n\ninterface Props {\n  player: PlayerRef;\n  song: Song;\n  beatLength: number;\n}\n\nexport default function ListTracks({ song, player, beatLength }: Props) {\n  return (\n    <>\n      {/*{song.tracks.map(({ sections }, index) => {*/}\n      {/*    const notesSections = sections.filter(isNotesSection);*/}\n      {/*    const firstNote = notesSections[0].notes[0];*/}\n\n      {/*    const lastNote = notesSections.at(-1)?.notes.at(-1);*/}\n\n      {/*    if (!firstNote || !lastNote || !beatLength) return null;*/}\n\n      {/*    return (*/}\n      {/*        <EditorRow key={index}>*/}\n      {/*            <strong>Track #{index + 1} - </strong>*/}\n      {/*            Start: {msec(firstNote.start * beatLength + song.gap, player)}, end:{' '}*/}\n      {/*            {msec(lastNote.start * beatLength + song.gap, player)}*/}\n      {/*        </EditorRow>*/}\n      {/*    );*/}\n      {/*})}*/}\n    </>\n  );\n}\n","import { Song } from 'interfaces';\nimport isNotesSection from 'Songs/utils/isNotesSection';\n\nexport default function calculateProperBPM(desiredEndMs: number, song: Song) {\n  const notesSections = song.tracks[0].sections.filter(isNotesSection);\n\n  const lastNote = notesSections.at(-1)?.notes.at(-1)!;\n\n  const desiredLengthMs = desiredEndMs - song.gap;\n  const bpmLength = lastNote.start + lastNote.length;\n\n  return Number((60_000 / ((desiredLengthMs / bpmLength) * song.bar)).toFixed(2));\n}\n","import { Song, SongPreview } from 'interfaces';\nimport getSongBeatLength from 'Songs/utils/getSongBeatLength';\n\nexport default function beatToMs(beat: number, song: Song | SongPreview): number {\n  return getSongBeatLength(song) * beat;\n}\n","import { Box, TextField } from '@mui/material';\nimport { Pre } from 'Scenes/Convert/Elements';\nimport calculateProperBPM from 'Scenes/Convert/calculateProperBpm';\nimport beatToMs from 'Scenes/Game/Singing/GameState/Helpers/beatToMs';\nimport { PlayerRef } from 'Scenes/Game/Singing/Player';\nimport { getLastNoteEndFromSections } from 'Songs/utils/notesSelectors';\nimport { Song } from 'interfaces';\nimport { useState } from 'react';\n\ninterface Props {\n  onChange: (bpm: number) => void;\n  current: number;\n  player: PlayerRef;\n  song: Song;\n}\n\nexport default function ManipulateBpm({ current, onChange, player, song }: Props) {\n  const lastNoteEndBeat = Math.max(...song.tracks.map((track) => getLastNoteEndFromSections(track.sections)));\n  const lastNoteEndMs = beatToMs(lastNoteEndBeat, song) + song.gap;\n  const [desiredLastNoteEnd, setDesiredLastNoteEnd] = useState<number>(Math.round(lastNoteEndMs));\n\n  return (\n    <Box sx={{ display: 'flex', gap: 2, mb: 2 }}>\n      <TextField\n        data-test=\"desired-end\"\n        size={'small'}\n        type=\"number\"\n        value={desiredLastNoteEnd}\n        onChange={(e) => setDesiredLastNoteEnd(+e.target.value)}\n        label=\"Desired last note end time (in milliseconds)\"\n        sx={{ flex: 1 }}\n        helperText={\n          !!desiredLastNoteEnd ? (\n            <>\n              Est. proper Tempo (BPM): <Pre data-test=\"desired-bpm\">{calculateProperBPM(desiredLastNoteEnd, song)}</Pre>\n            </>\n          ) : (\n            ' '\n          )\n        }\n      />\n      <TextField\n        data-test=\"change-bpm\"\n        size={'small'}\n        type=\"number\"\n        value={current}\n        onChange={(e) => onChange(+e.target.value)}\n        label=\"Tempo (BPM) of the lyrics\"\n        sx={{ flex: 0.5 }}\n        helperText={' '}\n        InputProps={{\n          inputProps: {\n            step: '0.1',\n          },\n        }}\n      />\n    </Box>\n  );\n}\n","import { Box, Button, ButtonGroup, TextField, Typography } from '@mui/material';\nimport { msec } from 'Scenes/Convert/Steps/SyncLyricsToVideo/Helpers/formatMs';\nimport { PlayerRef } from 'Scenes/Game/Singing/Player';\n\ninterface Props {\n  onChange: (shift: number) => void;\n  current: number;\n  player: PlayerRef;\n  finalGap: number;\n}\n\nexport default function ShiftGap({ current, onChange, player, finalGap }: Props) {\n  return (\n    <Box sx={{ flex: 1 }}>\n      <Typography variant={'h6'}>Gap shift (final: {msec(finalGap, player)})</Typography>\n      <Box sx={{ display: 'flex', gap: 1, mt: 1 }}>\n        <ButtonGroup sx={{ flex: 1 }}>\n          <Button sx={{ flex: 1, px: 1 }} onClick={() => onChange(current - 1000)} data-test=\"shift-gap-1s\">\n            -1000\n          </Button>\n          <Button sx={{ flex: 1, px: 1 }} onClick={() => onChange(current - 500)} data-test=\"shift-gap-0.5s\">\n            -500\n          </Button>\n          <Button sx={{ flex: 1, px: 1 }} onClick={() => onChange(current - 50)} data-test=\"shift-gap-0.05s\">\n            -50\n          </Button>\n        </ButtonGroup>\n        <TextField\n          sx={{ py: 0, flex: 1 }}\n          size={'small'}\n          type=\"text\"\n          value={current}\n          onChange={(e) => onChange(+e.target.value)}\n          label=\"Miliseconds\"\n          data-test=\"shift-gap\"\n        />\n        <ButtonGroup sx={{ flex: 1 }}>\n          <Button sx={{ flex: 1, px: 1 }} onClick={() => onChange(current + 50)} data-test=\"shift-gap+0.05s\">\n            +50\n          </Button>\n          <Button sx={{ flex: 1, px: 1 }} onClick={() => onChange(current + 500)} data-test=\"shift-gap+0.5s\">\n            +500\n          </Button>\n          <Button sx={{ flex: 1, px: 1 }} onClick={() => onChange(current + 1000)} data-test=\"shift-gap+1s\">\n            +1000\n          </Button>\n        </ButtonGroup>\n      </Box>\n    </Box>\n  );\n}\n","import { Box, Button, ButtonGroup, TextField, Typography } from '@mui/material';\nimport { msec } from 'Scenes/Convert/Steps/SyncLyricsToVideo/Helpers/formatMs';\nimport { PlayerRef } from 'Scenes/Game/Singing/Player';\nimport { seconds } from 'interfaces';\n\ninterface Props {\n  onChange: (shift: seconds) => void;\n  current: seconds;\n  player: PlayerRef;\n  finalGap: number | undefined;\n}\n\nexport default function ShiftVideoGap({ current, onChange, player, finalGap }: Props) {\n  return (\n    <Box sx={{ flex: 1 }}>\n      <Typography variant={'h6'}>Video Gap shift (final: {msec((finalGap ?? 0) * 1000, player)})</Typography>\n      <Box sx={{ display: 'flex', gap: 1, mt: 1 }}>\n        <ButtonGroup sx={{ flex: 1 }}>\n          <Button sx={{ flex: 1, px: 1.25 }} onClick={() => onChange(current - 10)} data-test=\"shift-video-gap-10s\">\n            -10\n          </Button>\n          <Button sx={{ flex: 1, px: 1.25 }} onClick={() => onChange(current - 5)} data-test=\"shift-video-gap-5s\">\n            -5\n          </Button>\n          <Button sx={{ flex: 1, px: 1.25 }} onClick={() => onChange(current - 1)} data-test=\"shift-video-gap-1s\">\n            -1\n          </Button>\n        </ButtonGroup>\n        <TextField\n          data-test=\"shift-video-gap\"\n          sx={{ py: 0, flex: 1 }}\n          size={'small'}\n          type=\"text\"\n          value={current}\n          onChange={(e) => onChange(+e.target.value)}\n          label=\"Seconds\"\n          // helperText={}\n        />\n        <ButtonGroup sx={{ flex: 1 }}>\n          <Button sx={{ flex: 1, px: 1.25 }} onClick={() => onChange(current + 1)} data-test=\"shift-video-gap+1s\">\n            +1\n          </Button>\n          <Button sx={{ flex: 1, px: 1.25 }} onClick={() => onChange(current + 5)} data-test=\"shift-video-gap+5s\">\n            +5\n          </Button>\n          <Button sx={{ flex: 1, px: 1.25 }} onClick={() => onChange(current + 10)} data-test=\"shift-video-gap+10s\">\n            +10\n          </Button>\n        </ButtonGroup>\n      </Box>\n    </Box>\n  );\n}\n","import { NotesSection, Section, Song } from 'interfaces';\nimport getSongBeatLength from 'Songs/utils/getSongBeatLength';\nimport isNotesSection from 'Songs/utils/isNotesSection';\n\nexport const HEADSTART_MS = 1000;\n\nconst shortenNoteSections = (sections: NotesSection[]): NotesSection[] =>\n  sections.map((section) => {\n    if (section.notes.length === 0) {\n      debugger;\n    }\n    return {\n      ...section,\n      start: section.notes[0].start,\n    };\n  });\n\nconst getSectionEnd = (section: NotesSection) => {\n  const lastNote = section.notes.at(-1)!;\n  return lastNote.start + lastNote.length;\n};\n\nconst addPauseSections = (sections: NotesSection[], padSizeBeats = 10): Section[] => {\n  let lastEnd = 0;\n  let sectionsWithPauses: Section[] = [];\n\n  sections.forEach((section) => {\n    const spaceBetweenSections = section.start - lastEnd;\n\n    if (spaceBetweenSections > padSizeBeats) {\n      sectionsWithPauses.push({ type: 'pause', start: lastEnd, end: section.start - padSizeBeats });\n      lastEnd = section.start - padSizeBeats;\n    }\n    sectionsWithPauses.push({ ...section, start: lastEnd });\n    lastEnd = getSectionEnd(section);\n  });\n\n  return sectionsWithPauses;\n};\n\n// Triest its best to add enough headstart to sections so the player can see the lyrics and notes\n// in advance. If possible, will also make the section a bit longer so it doesn't end abruptly\nexport default function normaliseSectionPaddings(song: Song): Song {\n  const beatLength = getSongBeatLength(song);\n  const desiredPadding = Math.round(HEADSTART_MS / beatLength);\n  // const minPadding = Math.round(MIN_HEADSTART_MS / beatLength);\n\n  return {\n    ...song,\n    tracks: song.tracks.map((track) => ({\n      ...track,\n      sections: addPauseSections(shortenNoteSections(track.sections.filter(isNotesSection)), desiredPadding),\n    })),\n  };\n}\n","import { Section, Song } from 'interfaces';\nimport { HEADSTART_MS } from 'Scenes/Convert/Steps/SyncLyricsToVideo/Helpers/normaliseSectionPaddings';\nimport getSongBeatLength from 'Songs/utils/getSongBeatLength';\nimport isNotesSection from 'Songs/utils/isNotesSection';\n\nconst shiftSections = (sections: Section[], shiftBeats: number): Section[] =>\n  sections.map((section, index) => {\n    if (isNotesSection(section)) {\n      return {\n        ...section,\n        start: index === 0 ? 0 : Math.max(0, section.start + shiftBeats), // first section might be 0\n        notes: section.notes.map((note) => ({ ...note, start: note.start + shiftBeats })),\n      };\n    } else {\n      return {\n        ...section,\n        start: Math.max(0, section.start + shiftBeats), // first section might be 0\n        end: Math.max(0, section.end + shiftBeats), // first section might be 0\n      };\n    }\n  });\n\nexport default function addHeadstart(song: Song): Song {\n  const beatLength = getSongBeatLength(song);\n  const desiredHeadstart = Math.round(HEADSTART_MS / beatLength);\n  const actualHeadstart = Math.floor(\n    (song.gap - desiredHeadstart * beatLength < 0 ? song.gap : desiredHeadstart * beatLength) / beatLength,\n  );\n\n  const gap = song.gap - actualHeadstart * beatLength;\n\n  return {\n    ...song,\n    gap,\n    tracks: song.tracks.map((track) => ({ ...track, sections: shiftSections(track.sections, actualHeadstart) })),\n  };\n}\n","import { Section, Song } from 'interfaces';\nimport getSongBeatLength from 'Songs/utils/getSongBeatLength';\nimport isNotesSection from 'Songs/utils/isNotesSection';\nimport { getFirstNoteStartFromSections } from 'Songs/utils/notesSelectors';\n\nconst shiftSections = (sections: Section[], shiftBeats: number): Section[] =>\n  sections\n    .map((section, index) => {\n      if (isNotesSection(section)) {\n        return {\n          ...section,\n          start: index === 0 ? 0 : Math.max(0, section.start - shiftBeats), // first section might be 0\n          notes: section.notes.map((note) => ({ ...note, start: note.start - shiftBeats })),\n        };\n      } else {\n        return {\n          ...section,\n          start: Math.max(0, section.start - shiftBeats), // first section might be 0\n          end: Math.max(0, section.end - shiftBeats), // first section might be 0\n        };\n      }\n    })\n    .filter((section) => isNotesSection(section) || section.start - section.end > 0); // clear empty pause sections\n\nexport default function normaliseGap(song: Song): Song {\n  const beatLength = getSongBeatLength(song);\n\n  const earliestTrack = song.tracks.reduce((current, track, index) => {\n    const currentNoteStart = getFirstNoteStartFromSections(song.tracks[current].sections);\n    const thisNoteStart = getFirstNoteStartFromSections(track.sections);\n    return currentNoteStart > thisNoteStart ? index : current;\n  }, 0);\n\n  const firstSection = song.tracks[earliestTrack].sections.find(isNotesSection);\n\n  if (!firstSection) {\n    console.error('There are no notes sections in the song, wat', song.tracks);\n    return song;\n  }\n\n  const shiftBeats = firstSection.start + (firstSection.notes[0].start - firstSection.start);\n\n  const gap = Math.floor(song.gap + shiftBeats * beatLength);\n\n  return {\n    ...song,\n    gap,\n    tracks: song.tracks.map((track) => ({ ...track, sections: shiftSections(track.sections, shiftBeats) })),\n  };\n}\n","import { Note, Song } from 'interfaces';\nimport isNotesSection from 'Songs/utils/isNotesSection';\n\nconst normaliseSpaces = (notes: Note[]): Note[] => {\n  notes.forEach((note, index) => {\n    if (note.lyrics.startsWith(' ')) {\n      note.lyrics = note.lyrics.trim();\n\n      if (index > 0) {\n        notes[index - 1].lyrics = notes[index - 1].lyrics + ' ';\n      }\n    }\n  });\n\n  return notes;\n};\n\nexport default function normaliseLyricSpaces(song: Song) {\n  return {\n    ...song,\n    tracks: song.tracks.map((track) => ({\n      ...track,\n      sections: track.sections.map((section) =>\n        isNotesSection(section)\n          ? {\n              ...section,\n              notes: normaliseSpaces(section.notes),\n            }\n          : section,\n      ),\n    })),\n  };\n}\n","import { MutableRefObject, useEffect } from 'react';\nimport YouTube from 'react-youtube';\n\nexport default function usePlayerVolume(playerRef: MutableRefObject<YouTube | null>, volume: number | undefined) {\n  useEffect(() => {\n    playerRef.current?.getInternalPlayer()?.setVolume(Math.round((volume ?? 0.5) * 100));\n  }, [playerRef, volume]);\n}\n","import { MutableRefObject, useEffect, useState } from 'react';\nimport YouTube from 'react-youtube';\n\n/**\n * For some reason YouTube player would start the song but not change the player state, making the game not\n * start.\n *\n * This hooks \"detects\" that and return the key prop value for <YouTube /> component - if it's UNSTARTED\n * for more than a timeout, a new key will be generated to reload the entire player (and try again).\n */\nfunction useUnstuckOnStartSong(currentStatus: number) {\n  const [playerKey, setPlayerKey] = useState(1);\n  useEffect(() => {\n    if (currentStatus === YouTube.PlayerState.UNSTARTED) {\n      const timeout = setTimeout(() => {\n        setPlayerKey((current) => current + 1);\n      }, 5000 + playerKey * 2500);\n\n      return () => {\n        clearTimeout(timeout);\n      };\n    }\n  });\n\n  return playerKey;\n}\n\n/**\n * For some reason once YouTube player enters BUFFERING state, it gets stuck even when internet is\n * back available. Seeking to some timestamp unstucks it.\n *\n * \"Fix\": If player enters BUFFERING status, wait until internet is available, then go back a couple\n * of seconds of the song to force the player to start playing\n */\nfunction useUnstuckOnBuffering(playerRef: MutableRefObject<YouTube | null>, currentStatus: number) {\n  useEffect(() => {\n    if (currentStatus === YouTube.PlayerState.BUFFERING) {\n      const interval = setInterval(async () => {\n        if (navigator.onLine) {\n          clearInterval(interval);\n\n          const seconds = await playerRef.current?.getInternalPlayer()!.getCurrentTime()!;\n          playerRef.current?.getInternalPlayer()?.seekTo(Math.max(seconds - 2, 0), true);\n        }\n      }, 500);\n\n      return () => {\n        clearInterval(interval);\n      };\n    }\n  });\n}\n\nexport default function useUnstuckYouTubePlayer(playerRef: MutableRefObject<YouTube | null>, currentStatus: number) {\n  useUnstuckOnBuffering(playerRef, currentStatus);\n\n  return useUnstuckOnStartSong(currentStatus);\n}\n","import usePlayerVolume from 'hooks/usePlayerVolume';\nimport useUnstuckYouTubePlayer from 'hooks/useUnstuckYouTubePlayer';\nimport { seconds } from 'interfaces';\nimport { ForwardedRef, forwardRef, useEffect, useImperativeHandle, useRef, useState } from 'react';\nimport YouTube from 'react-youtube';\n\nexport enum VideoState {\n  UNSTARTED = 'UNSTARTED',\n  ENDED = 'ENDED',\n  PLAYING = 'PLAYING',\n  PAUSED = 'PAUSED',\n  BUFFERING = 'BUFFERING',\n  CUED = 'CUED',\n}\n\nconst stateMap = {\n  [YouTube.PlayerState.UNSTARTED]: VideoState.UNSTARTED,\n  [YouTube.PlayerState.ENDED]: VideoState.ENDED,\n  [YouTube.PlayerState.PLAYING]: VideoState.PLAYING,\n  [YouTube.PlayerState.PAUSED]: VideoState.PAUSED,\n  [YouTube.PlayerState.BUFFERING]: VideoState.BUFFERING,\n  [YouTube.PlayerState.CUED]: VideoState.CUED,\n} as const;\n\ninterface Props {\n  video: string;\n  autoplay?: boolean;\n  controls?: boolean;\n  disablekb?: boolean;\n  volume?: number;\n  startAt?: number;\n  onStateChange: (state: VideoState) => void;\n  width: number;\n  height: number;\n}\n\nexport interface LoadVideByIdOpts {\n  videoId: string;\n  startSeconds: number;\n  endSeconds: number;\n}\n\nexport interface VideoPlayerRef {\n  seekTo: (time: seconds) => void;\n  setPlaybackSpeed: (speed: number) => void;\n  setVolume: (newVolume: number) => void;\n  getCurrentTime: () => Promise<number>;\n  loadVideoById: (opts: LoadVideByIdOpts) => void;\n  setSize: (w: number, h: number) => void;\n  playVideo: () => void;\n  pauseVideo: () => void;\n  getDuration: () => Promise<number>;\n}\n\nexport default forwardRef(function YoutubeVideoPlayer(\n  { video, autoplay, startAt, controls, disablekb, volume, width, height, onStateChange }: Props,\n  ref: ForwardedRef<VideoPlayerRef>,\n) {\n  const player = useRef<YouTube | null>(null);\n  const [currentStatus, setCurrentStatus] = useState(YouTube.PlayerState.UNSTARTED);\n\n  const playerKey = useUnstuckYouTubePlayer(player, currentStatus);\n  usePlayerVolume(player, volume);\n  useEffect(() => {\n    if (!player.current) {\n      return;\n    }\n\n    player.current.getInternalPlayer()!.setSize(width, height);\n  }, [player, width, height, video, playerKey]);\n\n  useImperativeHandle(ref, () => ({\n    setSize: (w, h) => player.current?.getInternalPlayer()!.setSize(w, h),\n    seekTo: (timeSec: seconds) => player.current?.getInternalPlayer()!.seekTo(timeSec, true),\n    setPlaybackSpeed: (speed: number) => player.current?.getInternalPlayer()!.setPlaybackRate(speed),\n    setVolume: (newVolume: number) => player.current?.getInternalPlayer()!.setVolume(newVolume),\n    getCurrentTime: () => player.current?.getInternalPlayer()!.getCurrentTime()!,\n    loadVideoById: (opts) => player.current?.getInternalPlayer()!.loadVideoById(opts),\n    playVideo: () => {\n      // console.log('play');\n      player.current?.getInternalPlayer()!.playVideo();\n    },\n    pauseVideo: () => {\n      // console.log('paused');\n      return player.current?.getInternalPlayer()!.pauseVideo();\n    },\n    getDuration: () => player.current?.getInternalPlayer()!.getDuration()!,\n  }));\n\n  return (\n    <YouTube\n      title=\" \"\n      key={`${video}-${playerKey}`}\n      ref={player}\n      videoId={video}\n      opts={{\n        width: '0',\n        height: '0',\n        playerVars: {\n          autoplay: autoplay ? 1 : 0,\n          rel: 0,\n          fs: 0,\n          controls: controls ? 1 : 0,\n          start: startAt ?? 0,\n          end: 0,\n          disablekb: disablekb ? 1 : 0,\n          modestbranding: 1,\n        },\n      }}\n      onStateChange={(e) => {\n        setCurrentStatus(e.data);\n        onStateChange?.(stateMap[e.data]);\n      }}\n    />\n  );\n});\n","import {\n  ComponentProps,\n  ForwardedRef,\n  forwardRef,\n  useEffect,\n  useImperativeHandle,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\n\nimport Youtube, { VideoPlayerRef, VideoState } from './Youtube';\n\ntype Props = ComponentProps<typeof Youtube>;\n\nexport default forwardRef(function DirectVideoPlayer(\n  { video, autoplay, startAt, controls, disablekb, volume, width, height, onStateChange }: Props,\n  ref: ForwardedRef<VideoPlayerRef>,\n) {\n  const player = useRef<HTMLVideoElement | null>(null);\n  const [size, setSize] = useState({ w: width, h: height });\n  const [status, setStatus] = useState(VideoState.UNSTARTED);\n\n  useEffect(() => {\n    const createCallback = (status: VideoState) => () => setStatus(status);\n    const playerRef = player.current;\n\n    const onPlay = createCallback(VideoState.PLAYING);\n    const onPause = createCallback(VideoState.PAUSED);\n    const onEnded = createCallback(VideoState.ENDED);\n    // const onLoadstart = createCallback(VideoState.BUFFERING);\n\n    playerRef?.addEventListener('playing', onPlay);\n    playerRef?.addEventListener('pause', onPause);\n    playerRef?.addEventListener('ended', onEnded);\n    // playerRef?.addEventListener('loadstart', onLoadstart);\n\n    return () => {\n      playerRef?.removeEventListener('playing', onPlay);\n      playerRef?.removeEventListener('pause', onPause);\n      playerRef?.removeEventListener('ended', onEnded);\n      // playerRef?.removeEventListener('loadstart', onLoadstart);\n    };\n  }, [player.current, setStatus]);\n\n  useEffect(() => {\n    onStateChange?.(status);\n  }, [status, onStateChange]);\n\n  const playerApi = useMemo<VideoPlayerRef>(\n    () => ({\n      setSize: (w, h) => setSize({ w, h }),\n      seekTo: (time: number) => {\n        player.current && (player.current.currentTime = time);\n\n        return time;\n      },\n      setPlaybackSpeed: () => undefined,\n      setVolume: () => undefined,\n      getCurrentTime: () => {\n        return Promise.resolve(player.current?.currentTime ?? 0);\n      },\n      loadVideoById: () => undefined,\n      playVideo: () => player.current?.play(),\n      pauseVideo: () => player.current?.pause(),\n      getDuration: () => Promise.resolve(player.current?.duration ?? 0),\n    }),\n    [player],\n  );\n\n  useEffect(() => {\n    playerApi.setSize(width, height);\n  }, [width, height, playerApi]);\n\n  useEffect(() => {\n    startAt !== undefined && playerApi.seekTo(startAt);\n  }, [startAt, playerApi]);\n\n  useImperativeHandle(ref, () => playerApi);\n\n  return (\n    <video width={size.w} height={size.h} autoPlay={autoplay ?? true} controls={controls} ref={player}>\n      <source src={video} />\n    </video>\n  );\n});\n","export default \"__VITE_ASSET__0d248451__\"","import { ComponentProps, ForwardedRef, forwardRef } from 'react';\n\nimport DirectVideo from 'Elements/VideoPlayer/DirectVideo';\nimport Youtube, { VideoPlayerRef } from './Youtube';\nimport dummyVideo from './dummy.mp4';\n\ntype Props = ComponentProps<typeof Youtube>;\n\nexport default forwardRef(function OfflineVideoPlayer(\n  { video, controls, ...restProps }: Props,\n  ref: ForwardedRef<VideoPlayerRef>,\n) {\n  return <DirectVideo ref={ref} video={dummyVideo} controls {...restProps} />;\n});\n","import 'core-js/es/array/at';\nimport { ComponentProps, ForwardedRef, forwardRef } from 'react';\nimport OfflineVideoPlayer from './Offline';\nimport YoutubeVideoPlayer, { VideoPlayerRef } from './Youtube';\n\nconst VideoPlayer = forwardRef(\n  (props: ComponentProps<typeof YoutubeVideoPlayer>, ref: ForwardedRef<VideoPlayerRef>) => {\n    if (import.meta.env.VITE_APP_OFFLINE) {\n      return <OfflineVideoPlayer {...props} ref={ref} />;\n    } else {\n      return <YoutubeVideoPlayer {...props} ref={ref} />;\n    }\n  },\n);\n\nexport default VideoPlayer;\n\nexport { VideoState } from './Youtube';\nexport type { VideoPlayerRef } from './Youtube';\n","import { useEffect, useRef, type MutableRefObject } from 'react';\n\n/**\n * a type-safe version of the `usePrevious` hook described here:\n * @see {@link https://reactjs.org/docs/hooks-faq.html#how-to-get-the-previous-props-or-state}\n */\nexport default function usePrevious<T>(value: T): MutableRefObject<T>['current'] {\n  const ref = useRef<T>(value);\n  useEffect(() => {\n    ref.current = value;\n  }, [value]);\n  return ref.current;\n}\n","import styled from '@emotion/styled';\nimport completedAnimation from 'Elements/Menu/completed-animation.json';\nimport Lottie from 'lottie-react';\nimport { ComponentProps } from 'react';\nimport tuple from 'utils/tuple';\n\nexport const Heading = styled.h1`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  position: relative;\n`;\n\nconst SCompletedAnim = styled(Lottie)`\n  display: inline-block;\n  width: 10rem;\n  height: 10rem;\n  margin: -3rem -2rem -3rem -3rem;\n`;\n\n// needs to be a \"stable\" array - reference can't change\nconst completedAnimationSegment = tuple([0, 50]);\n\nexport const CompletedAnim = (\n  props: Omit<ComponentProps<typeof SCompletedAnim>, 'initialSegment' | 'animationData' | 'loop'>,\n) => (\n  <SCompletedAnim\n    {...props}\n    initialSegment={completedAnimationSegment}\n    animationData={completedAnimation}\n    loop={false}\n  />\n);\n","import { css } from '@emotion/react';\nimport styled from '@emotion/styled';\nimport { Laptop, Person, PhoneAndroid, PhoneIphone, PhotoCamera, QrCode, Usb } from '@mui/icons-material';\nimport { MenuButton } from 'Elements/Menu';\nimport { MicIconBlue, MicIconRed } from 'Elements/MicIcon';\nimport { focused } from 'Elements/cssMixins';\nimport styles from 'Scenes/Game/Singing/GameOverlay/Drawing/styles';\nimport { MicSetupPreference, MobilePhoneModeSetting, useSettingValue } from 'Scenes/Settings/SettingsState';\nimport useKeyboardNav from 'hooks/useKeyboardNav';\n\ninterface Props {\n  onPreferenceSelected: (preference: (typeof MicSetupPreference)[number]) => void;\n  previouslySelected: string | null;\n  skipText?: string;\n  onBack?: () => void;\n}\n\nfunction SelectPreference({ onPreferenceSelected, previouslySelected, onBack, skipText }: Props) {\n  const [mobilePhoneMode] = useSettingValue(MobilePhoneModeSetting);\n\n  const { register } = useKeyboardNav({ onBackspace: onBack });\n  return (\n    <>\n      <Option\n        {...register(\n          'remote-mics',\n          () => onPreferenceSelected('remoteMics'),\n          undefined,\n          previouslySelected === 'remoteMics',\n        )}>\n        <OptionIconContainer>\n          <PhoneAndroid />\n          <PhoneIphone />\n        </OptionIconContainer>\n        <div>\n          {mobilePhoneMode ? 'Connect other phones' : 'Use Smartphones'}\n          <OptionDescription>\n            Use{' '}\n            <strong>\n              <PhotoCamera />\n              Camera app\n            </strong>{' '}\n            to scan a{' '}\n            <strong>\n              <QrCode /> QR code\n            </strong>{' '}\n            that will open Remote Mic website - no need to download an app!\n          </OptionDescription>\n        </div>\n      </Option>\n      <Option\n        {...register('built-in', () => onPreferenceSelected('built-in'), undefined, previouslySelected === 'built-in')}>\n        <OptionIconContainer>\n          <Person />\n          {mobilePhoneMode ? <PhoneIphone /> : <Laptop />}\n        </OptionIconContainer>\n        <div>\n          This {mobilePhoneMode ? \"device's\" : \"computer's\"} microphone\n          <OptionDescription>\n            Great to <strong>test</strong> the app, <strong>sing alone</strong> or don't care about the rivalry at the\n            party\n          </OptionDescription>\n        </div>\n      </Option>\n      <hr />\n      {!mobilePhoneMode && (\n        <Option {...register('mics', () => onPreferenceSelected('mics'), undefined, previouslySelected === 'mics')}>\n          <OptionIconContainer>\n            <MicIconBlue />\n            <MicIconRed />\n          </OptionIconContainer>\n          <div>\n            SingStar (-ish) microphones\n            <OptionDescription>\n              Select this option and <Usb /> connect your Mics to the computer. It should be selected{' '}\n              <strong>automatically</strong>.\n            </OptionDescription>\n          </div>\n        </Option>\n      )}\n      <Option\n        {...register('advanced', () => onPreferenceSelected('advanced'), undefined, previouslySelected === 'advanced')}>\n        <OptionIconContainer>\n          <MicIconBlue />\n          <PhoneIphone />\n        </OptionIconContainer>\n        <div>\n          Advanced (manual) setup\n          <OptionDescription>\n            Assign the specific device to a player manually, e.g. if you don't have regular SingStar microphones.\n          </OptionDescription>\n        </div>\n      </Option>\n      <hr />\n      <MenuButton {...register('skip', () => onPreferenceSelected('skip'), undefined, previouslySelected === 'skip')}>\n        {skipText || 'Skip'}\n      </MenuButton>\n    </>\n  );\n}\n\nconst OptionDescription = styled.div<{ focused?: boolean }>`\n  padding: 0 3rem 0 6rem;\n  font-size: 1.6rem;\n  max-height: 0;\n  overflow: clip;\n  transition: 300ms;\n\n  svg {\n    font-size: 1.4rem;\n  }\n  opacity: 0;\n`;\n\nconst OptionIconContainer = styled.div`\n  position: relative;\n  margin: 0rem 0.6rem 0 2.5rem;\n  transition: 300ms;\n\n  svg {\n    transition: 300ms;\n    width: 3.6rem;\n    height: 3.6rem;\n    color: rgba(${styles.colors.players[1].text});\n  }\n\n  svg:first-of-type {\n    top: 0.6rem;\n    left: 1.25rem;\n    position: absolute;\n    color: rgba(${styles.colors.players[0].text});\n    z-index: 100;\n    transform: scaleX(-1);\n  }\n`;\n\nconst moreInfoMixin = css`\n  height: 16.5rem;\n  background: black;\n  ${focused};\n\n  ${OptionDescription} {\n    padding-top: 1.6rem;\n    max-height: 10rem;\n    opacity: 1;\n  }\n\n  ${OptionIconContainer} {\n    transform: scale(1.75);\n  }\n`;\n\nconst Option = styled(MenuButton)<{ focused?: boolean }>`\n  display: flex;\n  align-items: center;\n\n  :hover {\n    ${moreInfoMixin};\n  }\n\n  ${(props) => (props.focused ? moreInfoMixin : '')};\n`;\n\nexport default SelectPreference;\n","import InputManager from 'Scenes/Game/Singing/Input/InputManager';\nimport { FPSCountSetting } from 'Scenes/Settings/SettingsState';\nimport { useEffect, useState } from 'react';\nimport tuple from 'utils/tuple';\n\nexport const usePlayerMicData = (\n  playerNumber: number,\n  onMeasure: ([volume, frequency]: [number, number]) => void,\n  enabled = true,\n  intervalMs = 1000 / FPSCountSetting.get(),\n) => {\n  useEffect(() => {\n    if (!enabled) return;\n\n    const interval = setInterval(() => {\n      const playerVolume = InputManager.getPlayerVolume(playerNumber) ?? 0;\n      const playerFrequency = InputManager.getPlayerFrequency(playerNumber) ?? 0;\n      onMeasure([playerVolume, Array.isArray(playerFrequency) ? playerFrequency[0] : playerFrequency]);\n    }, intervalMs);\n\n    return () => {\n      clearInterval(interval);\n    };\n  }, [playerNumber, intervalMs, onMeasure, enabled]);\n};\n\nconst usePlayerMic = (\n  playerNumber: number,\n  intervalMs = 1000 / FPSCountSetting.get(),\n  onMeasure?: ([volume, frequency]: [number, number]) => void,\n) => {\n  const [data, setData] = useState(tuple([0, 0]));\n\n  usePlayerMicData(playerNumber, setData, true, intervalMs);\n\n  useEffect(() => {\n    if (onMeasure) {\n      onMeasure(data);\n    }\n  }, [data, onMeasure]);\n\n  return data;\n};\n\nexport default usePlayerMic;\n","import styled from '@emotion/styled';\nimport PlayersManager from 'Players/PlayersManager';\nimport styles from 'Scenes/Game/Singing/GameOverlay/Drawing/styles';\nimport { usePlayerMicData } from 'hooks/players/usePlayerMic';\nimport { ForwardedRef, forwardRef, useCallback, useState } from 'react';\n\nconst VolumeIndicatorBase = styled.div<{ color: string }>`\n  background: linear-gradient(270deg, rgba(${(props) => props.color}, 1) 0%, rgba(${(props) => props.color}, 0) 100%);\n  height: 100%;\n  width: 100%;\n  position: absolute;\n  right: 0;\n  top: 0;\n  background-repeat: repeat-y;\n  transform-origin: right;\n  z-index: 1;\n  pointer-events: none;\n`;\n\nexport const VolumeIndicator = forwardRef(\n  (\n    { volume, playerNumber, ...rest }: { playerNumber: number; volume: number },\n    ref: ForwardedRef<HTMLDivElement | null>,\n  ) => {\n    const player = PlayersManager.getPlayer(playerNumber);\n    if (!player) return null;\n\n    const percent = `${Math.min(1, volume * 20)}`;\n    const color = styles.colors.players[player.number].text;\n\n    return <VolumeIndicatorBase color={color} {...rest} style={{ transform: `scaleX(${percent})` }} ref={ref} />;\n  },\n);\n\nexport const PlayerMicCheck = ({ playerNumber, ...props }: { playerNumber: number }) => {\n  const [elem, setElem] = useState<HTMLDivElement | null>();\n\n  const cb = useCallback(\n    ([volume]: [number, number]) => {\n      if (elem) {\n        const percent = `${Math.min(1, volume * 20)}`;\n\n        elem.style.transform = `scaleX(${percent})`;\n      }\n    },\n    [elem],\n  );\n\n  usePlayerMicData(playerNumber, cb);\n  const color = styles.colors.players[playerNumber].text;\n\n  return <VolumeIndicatorBase {...props} color={color} ref={setElem} />;\n};\n","import styled from '@emotion/styled';\nimport { typography } from 'Elements/cssMixins';\nimport RemoteMicServer, { isWebsockets } from 'RemoteMic/Network/Server';\nimport styles from 'Scenes/Game/Singing/GameOverlay/Drawing/styles';\nimport { QRCodeSVG } from 'qrcode.react';\nimport { useEffect } from 'react';\nimport { useRoute } from 'wouter';\n\nconst linkObject = new URL(window.location.href);\n\nif (isWebsockets) {\n  linkObject.searchParams.set('transport', 'websocket');\n}\n\nfunction ConnectRemoteMic() {\n  // Validate if the component is rendered in a remote mic or in the \"main\" game via the URL\n  const [match, params] = useRoute<{ roomId: string }>('/remote-mic/:roomId');\n  linkObject.pathname = `/remote-mic/${match ? params.roomId : RemoteMicServer.getRoomId()}`;\n  const link = linkObject.href;\n\n  useEffect(() => {\n    if (!match) {\n      RemoteMicServer.start();\n    }\n  }, [match]);\n\n  return (\n    <Container>\n      <QRCode>\n        <QRCodeSVG value={link} width=\"100%\" height=\"100%\" includeMargin />\n      </QRCode>\n      <Description>\n        <QRCodeInstruction>\n          <h3>Use your phone as a microphone</h3>\n          <ol>\n            <li>\n              Open <b>Camera App</b> on your phone\n            </li>\n            <li>\n              Point the camera to the <b>QR Code</b> on the left\n            </li>\n            <li>\n              Open <b>the link</b> that should appear\n            </li>\n            <li>Follow the instructions</li>\n          </ol>\n        </QRCodeInstruction>\n        <CopyLinkInstruction>\n          <h4>Or copy and send the link</h4>\n          <InputCopyContainer>\n            <InputCopy disabled value={link} data-test=\"server-link-input\" />\n            <CopyButton\n              onClick={() => {\n                navigator.clipboard.writeText(link);\n              }}>\n              Copy\n            </CopyButton>\n          </InputCopyContainer>\n        </CopyLinkInstruction>\n      </Description>\n    </Container>\n  );\n}\nconst QRCodeInstruction = styled.div`\n  flex: 1;\n`;\n\nconst CopyLinkInstruction = styled.div`\n  flex: 0;\n`;\n\nconst InputCopyContainer = styled.div`\n  position: relative;\n  margin-top: 0.5rem;\n`;\n\nconst CopyButton = styled.button`\n  cursor: pointer;\n  position: absolute;\n  padding: 0 2rem;\n  right: 0;\n  height: 100%;\n  box-sizing: border-box;\n\n  background: ${styles.colors.text.active};\n\n  ${typography};\n  font-weight: bold;\n  font-size: 2.2rem;\n  border: 0;\n\n  :active {\n    background-color: black;\n  }\n`;\n\nconst InputCopy = styled.input`\n  padding: 1rem;\n  box-sizing: border-box;\n  background: grey;\n  border: none;\n  width: 100%;\n  font-size: 1.3rem;\n`;\n\nconst Container = styled.div`\n  display: flex;\n  flex-direction: row;\n  flex-wrap: nowrap;\n  align-items: stretch;\n  flex: 1;\n  gap: 2%;\n\n  @media (max-width: 560px) {\n    flex-direction: column;\n  }\n`;\n\nconst QRCode = styled.div`\n  flex: 0.6;\n  @media (max-width: 560px) {\n    flex: 0;\n  }\n`;\n\nconst Description = styled.div`\n  @media (max-width: 560px) {\n    display: none;\n  }\n  flex: 1;\n\n  display: flex;\n  flex-direction: column;\n\n  b {\n    font-weight: bold;\n    ${typography};\n    color: ${styles.colors.text.active};\n  }\n\n  h3 {\n    margin-bottom: 1.9rem;\n  }\n  h4 {\n    margin: 1.25rem 0;\n  }\n\n  ol {\n    padding-left: 2.3rem;\n    margin: 1.25rem 0;\n    list-style: decimal inside;\n  }\n  li {\n    color: white;\n    font-size: 1.9rem;\n    line-height: 3.2rem;\n  }\n`;\n\nexport default ConnectRemoteMic;\n","import events from 'GameEvents/GameEvents';\nimport { useEventListenerSelector } from 'GameEvents/hooks';\nimport inputSourceListManager from 'Scenes/SelectInput/InputSources';\nimport { InputSource } from 'Scenes/SelectInput/InputSources/interfaces';\nimport { useEffect } from 'react';\n\nexport interface SourceInputDefault {\n  list: InputSource[];\n  getDefault: () => string | null;\n}\n\nexport type SourceMap = Record<string, SourceInputDefault>;\n\nexport function useMicrophoneList(load = false) {\n  const inputs = useEventListenerSelector(events.inputListChanged, () => inputSourceListManager.getInputList());\n\n  useEffect(() => {\n    if (load) {\n      inputSourceListManager.loadMics();\n    }\n  }, [load]);\n\n  return inputs;\n}\n","import { nextIndex, nextValue } from 'Elements/Switcher';\nimport events from 'GameEvents/GameEvents';\nimport { useEventListenerSelector } from 'GameEvents/hooks';\nimport PlayersManager from 'Players/PlayersManager';\nimport InputSources from 'Scenes/SelectInput/InputSources';\nimport { InputSourceList, InputSourceNames } from 'Scenes/SelectInput/InputSources/interfaces';\nimport { useEffect } from 'react';\nimport tuple from 'utils/tuple';\n\nexport function usePlayerInput(playerNumber: number, sources: Record<InputSourceNames, InputSourceList>) {\n  const sourceList = Object.keys(sources) as Array<InputSourceNames>;\n  const [selectedPlayerInput, playerInputData] = useEventListenerSelector(\n    [events.playerInputChanged, events.inputListChanged],\n    () => {\n      const playerInput = PlayersManager.getPlayer(playerNumber)?.input;\n\n      if (!playerInput) return tuple([null, null]);\n      return tuple([playerInput, InputSources.getInputForPlayerSelected(playerInput)]);\n    },\n  );\n\n  useEffect(() => {\n    if (playerInputData === null) {\n      const source = sourceList[0];\n      const input = sources[source].getDefault();\n      if (input) {\n        PlayersManager.getPlayer(playerNumber)?.changeInput(sourceList[0], input.channel, input.deviceId);\n      }\n    }\n  });\n\n  const cycleSource = (startingIndex?: number) => {\n    const nextSource = nextValue(sourceList, selectedPlayerInput?.source ?? sourceList[0]);\n\n    const input = startingIndex ? sources[nextSource].list[startingIndex] : sources[nextSource].getDefault();\n\n    PlayersManager.getPlayer(playerNumber)?.changeInput(nextSource, input?.channel, input?.deviceId);\n  };\n  const cycleInput = () => {\n    if (!selectedPlayerInput) return;\n    const list = sources[selectedPlayerInput.source].list;\n    const currentIndex = playerInputData ? list.findIndex((item) => item.id === playerInputData.id) : 0;\n    const newIndex = nextIndex(list, currentIndex);\n    if (newIndex === 0) {\n      cycleSource(0);\n    } else {\n      const input = list[newIndex];\n\n      PlayersManager.getPlayer(playerNumber)?.changeInput(selectedPlayerInput.source, input?.channel, input?.deviceId);\n    }\n  };\n\n  return tuple([selectedPlayerInput?.source ?? null, cycleSource, playerInputData, cycleInput]);\n}\n","import PlayersManager from 'Players/PlayersManager';\nimport { useEffect } from 'react';\n\nexport default function usePlayerNumberPreset(targetPlayerCount: number) {\n  useEffect(() => {\n    PlayersManager.setMinPlayerNumber(targetPlayerCount);\n    const playerCount = PlayersManager.getPlayers().length;\n    if (playerCount > targetPlayerCount) {\n      for (let i = playerCount; i > 1; i--) {\n        PlayersManager.removePlayer(i - 1);\n      }\n    } else if (playerCount < targetPlayerCount) {\n      const takenNumbers = PlayersManager.getPlayers().map((player) => player.number);\n      const availableNumbers = Array.from(Array(PlayersManager.MAX_PLAYERS).keys()).filter(\n        (number) => !takenNumbers.includes(number),\n      );\n\n      for (let i = playerCount; i < targetPlayerCount; i++) {\n        PlayersManager.addPlayer(availableNumbers.shift()!);\n      }\n    }\n  }, []);\n}\n","import events from 'GameEvents/GameEvents';\nimport { useEventEffect } from 'GameEvents/hooks';\nimport PlayersManager from 'Players/PlayersManager';\nimport { RemoteMicrophoneInputSource } from 'Scenes/SelectInput/InputSources/Remote';\nimport { useRef } from 'react';\n\nexport function useRemoteMicAutoselect() {\n  const nextPlayerToAutoSwitch = useRef(0);\n\n  useEventEffect(events.remoteMicConnected, ({ id }) => {\n    console.log('useRemoteMicAutoselect', id);\n    PlayersManager.getPlayer(nextPlayerToAutoSwitch.current)?.changeInput(RemoteMicrophoneInputSource.inputName, 0, id);\n    nextPlayerToAutoSwitch.current = (nextPlayerToAutoSwitch.current + 1) % PlayersManager.getPlayers().length;\n  });\n}\n","export default function isWindows() {\n  return navigator?.userAgent?.includes?.('Win') ?? false;\n}\n","import styled from '@emotion/styled';\nimport { MenuButton } from 'Elements/Menu';\nimport { Switcher } from 'Elements/Switcher';\nimport { PlayerMicCheck } from 'Elements/VolumeIndicator';\nimport events from 'GameEvents/GameEvents';\nimport { useEventListenerSelector } from 'GameEvents/hooks';\nimport PlayersManager, { PlayerEntity } from 'Players/PlayersManager';\nimport ConnectRemoteMic from 'Scenes/ConnectRemoteMic/ConnectRemoteMic';\nimport { MicrophoneInputSource } from 'Scenes/SelectInput/InputSources/Microphone';\nimport { useMicrophoneList } from 'Scenes/SelectInput/hooks/useMicrophoneList';\nimport { usePlayerInput } from 'Scenes/SelectInput/hooks/usePlayerInput';\nimport usePlayerNumberPreset from 'Scenes/SelectInput/hooks/usePlayerNumberPreset';\nimport { useRemoteMicAutoselect } from 'Scenes/SelectInput/hooks/useRemoteMicAutoselect';\nimport { MicSetupPreference } from 'Scenes/Settings/SettingsState';\nimport UserMediaEnabled from 'UserMedia/UserMediaEnabled';\nimport { useMicrophoneStatus } from 'UserMedia/hooks';\nimport useKeyboardNav from 'hooks/useKeyboardNav';\nimport { useEffect } from 'react';\nimport { ValuesType } from 'utility-types';\nimport isChromium from 'utils/isChromium';\nimport isWindows from 'utils/isWindows';\n\ninterface Props {\n  onSetupComplete: (complete: boolean) => void;\n  onBack: () => void;\n  onSave: () => void;\n  closeButtonText: string;\n  changePreference: (pref: ValuesType<typeof MicSetupPreference>) => void;\n}\n\nconst PlayerSelector = (props: {\n  player: PlayerEntity;\n  inputs: ReturnType<typeof useMicrophoneList>;\n  register: ReturnType<typeof useKeyboardNav>['register'];\n}) => {\n  usePlayerNumberPreset(2);\n  const player = props.player;\n  const [source, cycleSource, input, cycleInput] = usePlayerInput(player.number, props.inputs);\n  return (\n    <>\n      <SwitcherWithPlayerHeader\n        {...props.register(`player-${player.number}-source`, cycleSource)}\n        label={<span className=\"ph-no-capture\">{player.getName()} Source</span>}\n        value={source}\n      />\n      <SwitcherWithMicCheck\n        {...props.register(`player-${player.number}-input`, cycleInput)}\n        label=\"Input\"\n        value={input?.label}>\n        <MicCheck playerNumber={player.number} />\n      </SwitcherWithMicCheck>\n    </>\n  );\n};\n\nfunction Advanced(props: Props) {\n  const inputs = useMicrophoneList(true);\n  const status = useMicrophoneStatus();\n\n  useEffect(() => {\n    props.onSetupComplete(status === 'accepted');\n  }, [status]);\n\n  useRemoteMicAutoselect();\n\n  const { register } = useKeyboardNav({ onBackspace: props.onBack });\n\n  const selectedInputs = useEventListenerSelector(events.playerInputChanged, () => PlayersManager.getInputs());\n\n  const micInputs = selectedInputs.filter((input) => input.source === MicrophoneInputSource.inputName);\n  const isDifferentMics = new Set(micInputs.map((input) => input.deviceId)).size > 1;\n\n  const players = PlayersManager.getPlayers();\n\n  return (\n    <>\n      <UserMediaEnabled fallback={<h2>Please allow access to the microphone so we can show them.</h2>}>\n        <ConnectRemoteMic />\n        {players.map((player) => (\n          <PlayerSelector inputs={inputs} player={player} key={player.number} register={register} />\n        ))}\n        <hr />\n        {micInputs.length > 1 && isDifferentMics && (\n          <h3 data-test=\"mic-mismatch-warning\">Using different microphone devices is not yet supported</h3>\n        )}\n        {micInputs.length > 1 && isChromium() && isWindows() && (\n          <h3>\n            <strong>Chrome</strong> is known for not handling SingStar mics well. If you notice any problems, try using\n            an alternative browser (eg. <strong>MS Edge</strong> or <strong>Firefox</strong>)\n          </h3>\n        )}\n      </UserMediaEnabled>\n      <MenuButton {...register('back-button', props.onBack)}>Change Input Type</MenuButton>\n      <MenuButton {...register('save-button', props.onSave)}>{props.closeButtonText}</MenuButton>\n    </>\n  );\n}\n\nconst MicCheck = styled(PlayerMicCheck)`\n  opacity: 0.75;\n  width: 50%;\n  height: calc(100% - 0.5rem);\n  margin: 0.25rem;\n`;\n\nconst SwitcherWithMicCheck = styled(Switcher)`\n  position: relative;\n`;\n\nconst SwitcherWithPlayerHeader = styled(Switcher)`\n  background: none;\n`;\n\nexport default Advanced;\n","import styled from '@emotion/styled';\nimport { PlayerMicCheck } from 'Elements/VolumeIndicator';\nimport PlayersManager from 'Players/PlayersManager';\n\ninterface Props {\n  names?: string[];\n}\n\nfunction MicCheck({ names }: Props) {\n  return (\n    <MicCheckContainer>\n      {PlayersManager.getPlayers().map((player) => (\n        <Indicator data-test={`mic-check-p${player.number}`} key={player.number}>\n          <PlayerMicCheck playerNumber={player.number} />\n          <span className=\"ph-no-capture\">{names?.[player.number] ?? player.getName()}</span>\n        </Indicator>\n      ))}\n    </MicCheckContainer>\n  );\n}\n\nconst MicCheckContainer = styled.div`\n  display: flex;\n  gap: 1.25rem;\n\n  div {\n    flex: 1;\n  }\n`;\n\nconst Indicator = styled.div`\n  position: relative;\n  border: 0.1rem solid white;\n  padding: 1rem 3rem;\n  background: black;\n\n  text-align: center;\n  gap: 1.25rem;\n  font-size: 2.3rem;\n  color: white;\n`;\n\nexport default MicCheck;\n","import styled from '@emotion/styled';\nimport { Check, Error } from '@mui/icons-material';\nimport { CircularProgress } from '@mui/material';\nimport { MenuButton } from 'Elements/Menu';\nimport { Switcher, nextIndex } from 'Elements/Switcher';\nimport events from 'GameEvents/GameEvents';\nimport { useEventEffect, useEventListenerSelector } from 'GameEvents/hooks';\nimport PlayersManager from 'Players/PlayersManager';\nimport { getInputId } from 'Players/utils';\nimport inputSourceListManager from 'Scenes/SelectInput/InputSources';\nimport { MicrophoneInputSource } from 'Scenes/SelectInput/InputSources/Microphone';\nimport MicCheck from 'Scenes/SelectInput/MicCheck';\nimport { useMicrophoneList } from 'Scenes/SelectInput/hooks/useMicrophoneList';\nimport usePlayerNumberPreset from 'Scenes/SelectInput/hooks/usePlayerNumberPreset';\nimport { MicSetupPreference } from 'Scenes/Settings/SettingsState';\nimport UserMediaEnabled from 'UserMedia/UserMediaEnabled';\nimport { usePlayerMicData } from 'hooks/players/usePlayerMic';\nimport useKeyboardNav from 'hooks/useKeyboardNav';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport { ValuesType } from 'utility-types';\nimport { InputSource } from '../InputSources/interfaces';\n\ninterface Props {\n  onSetupComplete: (complete: boolean) => void;\n  onBack: () => void;\n  onSave: () => void;\n  changePreference: (pref: ValuesType<typeof MicSetupPreference>) => void;\n  closeButtonText: string;\n}\n\nfunction useIsPlayerMicAudible(inputLabel: string) {\n  const [isAudible, setIsAudible] = useState<boolean | null>(null);\n\n  const previousMeasurements = useRef<number[]>([]);\n  const attempts = useRef(0);\n  const onMeasure = useCallback(\n    ([volume]: [number, number]) => {\n      previousMeasurements.current.push(volume);\n      if (previousMeasurements.current.length > 35) {\n        const medianMeasurement =\n          previousMeasurements.current.sort()[Math.floor(previousMeasurements.current.length / 2)];\n\n        const audible = medianMeasurement > 0;\n\n        if (audible || attempts.current > 7) {\n          setIsAudible(audible);\n        } else {\n          attempts.current++;\n        }\n\n        previousMeasurements.current.length = 0;\n      }\n    },\n    [inputLabel],\n  );\n\n  usePlayerMicData(0, onMeasure, isAudible !== true);\n\n  useEffect(() => {\n    previousMeasurements.current.length = 0;\n    attempts.current = 0;\n    setIsAudible(null);\n  }, [inputLabel]);\n\n  return isAudible;\n}\n\nfunction BuiltIn(props: Props) {\n  usePlayerNumberPreset(1);\n  const { register } = useKeyboardNav({ onBackspace: props.onBack });\n\n  const { Microphone } = useMicrophoneList(true);\n\n  const selectedMic = useEventListenerSelector([events.playerInputChanged, events.inputListChanged], () => {\n    const selected = PlayersManager.getInputs().find((input) => input.source === 'Microphone');\n    const Mics = inputSourceListManager.getInputList().Microphone.list; // get \"fresh\" list from\n\n    if (selected) {\n      return Mics.find((mic) => mic.id === getInputId(selected))?.label ?? '';\n    }\n    return '';\n  });\n\n  const setMic = (input: InputSource) => {\n    PlayersManager.getPlayers().forEach((player) =>\n      player.changeInput(MicrophoneInputSource.inputName, input.channel, input.deviceId),\n    );\n  };\n\n  const autoselect = () => {\n    if (selectedMic === '') {\n      const defaultDevice = Microphone.getDefault();\n      if (defaultDevice) {\n        setMic(defaultDevice);\n      }\n    }\n  };\n\n  useEffect(autoselect, []);\n  useEventEffect(events.inputListChanged, autoselect);\n\n  const cycleMic = () => {\n    const currentIndex = Microphone.list.findIndex((mic) => mic.label === selectedMic);\n\n    if (currentIndex > -1) {\n      const input = Microphone.list[nextIndex(Microphone.list, currentIndex)];\n      setMic(input);\n    }\n  };\n  const isAudible = useIsPlayerMicAudible(selectedMic);\n\n  useEffect(() => {\n    props.onSetupComplete(!!selectedMic && !!isAudible);\n  }, [selectedMic, isAudible]);\n\n  return (\n    <>\n      <UserMediaEnabled fallback={<h2>Please allow access to the microphone so the default one can be selected.</h2>}>\n        {!selectedMic && <h3>The default device is being selected.</h3>}\n        {selectedMic && (\n          <>\n            <Header>\n              <h3>You'll sing using</h3>\n              <h4>(click to change)</h4>\n            </Header>\n            <Switcher {...register('selected-mic', cycleMic)} label=\"Mic\" value={selectedMic} />\n            <AudibleStatus>\n              {isAudible === true && (\n                <>\n                  <h3>Microphone is audible</h3>\n                  <AudibleIconContainer>\n                    <SuccessIcon />\n                  </AudibleIconContainer>\n                </>\n              )}\n              {isAudible === false && (\n                <>\n                  <h3>Microphone is not audible</h3>\n                  <AudibleIconContainer>\n                    <ErrorIcon />\n                  </AudibleIconContainer>\n                </>\n              )}\n              {isAudible === null && (\n                <>\n                  <h3>Make some noise to the microphone</h3>\n                  <AudibleIconContainer>\n                    <CircularProgress size=\"1em\" />\n                  </AudibleIconContainer>\n                </>\n              )}\n            </AudibleStatus>\n            {isAudible === false && (\n              <h4>Make some noise to the microphone. If that doesn't work, try using another microphone.</h4>\n            )}\n          </>\n        )}\n        <MicCheck />\n\n        {isAudible === true && (\n          <h4>\n            Built-in microphones can pick up music from the game. For more accurate scores, try using your{' '}\n            <button onClick={() => props.changePreference('remoteMics')}>smartphone as a microphone</button>.\n          </h4>\n        )}\n      </UserMediaEnabled>\n      <MenuButton {...register('back-button', props.onBack)}>Change Input Type</MenuButton>\n      <MenuButton\n        {...register('save-button', props.onSave, undefined, true, { disabled: !selectedMic })}\n        disabled={!selectedMic}>\n        {props.closeButtonText}\n      </MenuButton>\n    </>\n  );\n}\n\nconst Header = styled.div`\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-end;\n`;\n\nconst AudibleStatus = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n`;\n\nconst AudibleIconContainer = styled.div`\n  width: 4rem;\n  height: 3rem;\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n`;\n\nconst ErrorIcon = styled(Error)`\n  width: 2em;\n  height: 2em;\n  color: red;\n`;\nconst SuccessIcon = styled(Check)`\n  width: 2em;\n  height: 2em;\n  color: white;\n`;\n\nexport default BuiltIn;\n","import { MenuButton } from 'Elements/Menu';\nimport events from 'GameEvents/GameEvents';\nimport { useEventListenerSelector } from 'GameEvents/hooks';\nimport PlayersManager from 'Players/PlayersManager';\nimport ConnectRemoteMic from 'Scenes/ConnectRemoteMic/ConnectRemoteMic';\nimport InputSources from 'Scenes/SelectInput/InputSources';\nimport MicCheck from 'Scenes/SelectInput/MicCheck';\nimport usePlayerNumberPreset from 'Scenes/SelectInput/hooks/usePlayerNumberPreset';\nimport { useRemoteMicAutoselect } from 'Scenes/SelectInput/hooks/useRemoteMicAutoselect';\nimport { MicSetupPreference } from 'Scenes/Settings/SettingsState';\nimport useKeyboardNav from 'hooks/useKeyboardNav';\nimport { useEffect } from 'react';\nimport { ValuesType } from 'utility-types';\n\ninterface Props {\n  onSetupComplete: (complete: boolean) => void;\n  onBack: () => void;\n  onSave: () => void;\n  closeButtonText: string;\n  changePreference: (pref: ValuesType<typeof MicSetupPreference>) => void;\n}\n\nfunction RemoteMics(props: Props) {\n  usePlayerNumberPreset(2);\n  const { register } = useKeyboardNav({ onBackspace: props.onBack });\n\n  useRemoteMicAutoselect();\n\n  const players = useEventListenerSelector(\n    // Subscribing to inputListChanged otherwise as it's InputManager.getInputs returns dummy input as the input\n    // list is not yet updated with the connected remote mic.\n    // The event sequence is wrongly remoteMicConnected -> playerInputChanged -> inputListChanged - needs to be fixed\n    // e.g. remove remoteMicConnected event?\n    [events.inputListChanged, events.playerInputChanged],\n    () => {\n      return PlayersManager.getInputs()\n        .map((input) => (input.source === 'Remote Microphone' ? input : null))\n        .map((input) => (input ? InputSources.getInputForPlayerSelected(input) : null));\n    },\n  );\n\n  const onContinue = () => {\n    props.onSave();\n  };\n\n  const isComplete = !!players[0]?.label && !!players[1]?.label;\n\n  useEffect(() => {\n    props.onSetupComplete(isComplete);\n  }, [isComplete]);\n\n  return (\n    <>\n      <ConnectRemoteMic />\n      <h4>You can connect multiple phones in advance.</h4>\n      <h4>You will be able to connect phones later.</h4>\n      <MicCheck />\n      <MenuButton {...register('back-button', props.onBack)}>Change Input Type</MenuButton>\n      <MenuButton {...register('save-button', onContinue, undefined, true)}>{props.closeButtonText}</MenuButton>\n    </>\n  );\n}\n\nexport default RemoteMics;\n","import styled from '@emotion/styled';\nimport { CircularProgress } from '@mui/material';\nimport { MenuButton } from 'Elements/Menu';\nimport events from 'GameEvents/GameEvents';\nimport { useEventEffect, useEventListenerSelector } from 'GameEvents/hooks';\nimport PlayersManager from 'Players/PlayersManager';\nimport InputManager from 'Scenes/Game/Singing/Input/InputManager';\nimport InputSources from 'Scenes/SelectInput/InputSources';\nimport { MicrophoneInputSource } from 'Scenes/SelectInput/InputSources/Microphone';\nimport MicCheck from 'Scenes/SelectInput/MicCheck';\nimport { useMicrophoneList } from 'Scenes/SelectInput/hooks/useMicrophoneList';\nimport usePlayerNumberPreset from 'Scenes/SelectInput/hooks/usePlayerNumberPreset';\nimport { MicSetupPreference } from 'Scenes/Settings/SettingsState';\nimport UserMediaEnabled from 'UserMedia/UserMediaEnabled';\nimport useKeyboardNav from 'hooks/useKeyboardNav';\nimport { useEffect, useState } from 'react';\nimport { ValuesType } from 'utility-types';\nimport isChromium from 'utils/isChromium';\nimport isWindows from 'utils/isWindows';\n\ninterface Props {\n  onSetupComplete: (complete: boolean) => void;\n  onBack: () => void;\n  onSave: () => void;\n  closeButtonText: string;\n  changePreference: (pref: ValuesType<typeof MicSetupPreference>) => void;\n}\n\nfunction SingStarMics(props: Props) {\n  usePlayerNumberPreset(2);\n  const { register } = useKeyboardNav({ onBackspace: props.onBack });\n  const { Microphone } = useMicrophoneList(true);\n  const [showAdvancedTip, setShowAdvancedTip] = useState(false);\n\n  const isSetup = useEventListenerSelector([events.playerInputChanged, events.inputListChanged], () => {\n    const inputs = PlayersManager.getInputs();\n\n    const isSameDeviceId = [...new Set(inputs.map((input) => input.deviceId))].length === 1;\n    const isMicInput = !inputs.find((input) => input.source !== 'Microphone');\n    const areAllPreferred = !inputs.find(\n      (input) => InputSources.getInputForPlayerSelected(input)?.preferred === undefined,\n    );\n\n    return isSameDeviceId && isMicInput && areAllPreferred;\n  });\n\n  useEffect(() => {\n    if (isSetup) {\n      InputManager.startMonitoring();\n    }\n    return () => {\n      InputManager.stopMonitoring();\n    };\n  }, [isSetup]);\n\n  const onContinue = () => {\n    props.onSave();\n  };\n\n  // Look for proper microphones in the list when the list changes\n  const [listChanged, setListChanged] = useState(false);\n  useEventEffect(events.inputListChanged, (initial) => {\n    const preferred = Microphone.list.filter((input) => input.preferred !== undefined);\n    if (preferred.length === 2 && preferred[0].deviceId === preferred[1].deviceId) {\n      preferred.forEach((input) => {\n        PlayersManager.getPlayer(input.preferred!)?.changeInput(\n          MicrophoneInputSource.inputName,\n          input.channel,\n          input.deviceId,\n        );\n      });\n    }\n    if (!initial) {\n      setListChanged(true);\n    }\n  });\n\n  useEffect(() => {\n    props.onSetupComplete(isSetup);\n  }, [isSetup]);\n\n  useEffect(() => {\n    if (isSetup) {\n      setShowAdvancedTip(false);\n    } else {\n      const timeout = setTimeout(() => setShowAdvancedTip(true), 2500);\n\n      return () => clearTimeout(timeout);\n    }\n  }, [isSetup]);\n\n  return (\n    <>\n      <UserMediaEnabled fallback={<h2>Please allow access to the microphone so we can find SingStar ones.</h2>}>\n        {!isSetup && (\n          <>\n            <h3>\n              <CircularProgress size=\"0.85em\" /> Connect your SingStar microphones.\n            </h3>\n            <h4 data-test=\"setup-not-completed\">It can take a couple of seconds to detect after you connect them.</h4>\n            {listChanged && (\n              <h4>\n                <h4 data-test=\"list-change-info\">\n                  Available microphones list has changed, but no SingStar mics were found. Try{' '}\n                  <button onClick={() => props.changePreference('advanced')}>Advanced</button> setup.\n                </h4>\n              </h4>\n            )}\n            {showAdvancedTip && (\n              <>\n                {!listChanged && (\n                  <ChromeIssue data-test=\"advanced-tip\">\n                    If they don't get detected, try{' '}\n                    <button onClick={() => props.changePreference('advanced')}>Advanced</button> section in the previous\n                    menu.\n                  </ChromeIssue>\n                )}\n                {isChromium() && isWindows() && (\n                  <ChromeIssue>\n                    <strong>Chrome</strong> is known for not handling SingStar mics well. If you notice any problems,\n                    try using an alternative browser (eg. <strong>MS Edge</strong> or <strong>Firefox</strong>)\n                  </ChromeIssue>\n                )}\n              </>\n            )}\n          </>\n        )}\n        {isSetup && (\n          <>\n            <h2 data-test=\"setup-completed\">\n              <strong>SingStar</strong> microphone connected!\n            </h2>\n\n            <MicCheck names={['Blue', 'Red']} />\n          </>\n        )}\n      </UserMediaEnabled>\n\n      <MenuButton {...register('back-button', props.onBack)}>Change Input Type</MenuButton>\n      <MenuButton\n        {...register('save-button', onContinue, undefined, true, { disabled: !isSetup })}\n        data-test=\"save-button\">\n        {props.closeButtonText}\n      </MenuButton>\n    </>\n  );\n}\n\nconst ChromeIssue = styled.h4`\n  background: darkred;\n  padding: 1rem;\n`;\n\nexport default SingStarMics;\n","import { useEffect } from 'react';\nimport { MicSetupPreference } from 'Scenes/Settings/SettingsState';\nimport { ValuesType } from 'utility-types';\n\ninterface Props {\n  onSetupComplete: (complete: boolean) => void;\n  onBack: () => void;\n  onSave: () => void;\n  closeButtonText: string;\n  changePreference: (pref: ValuesType<typeof MicSetupPreference>) => void;\n}\n\nfunction Skip(props: Props) {\n  useEffect(() => {\n    props.onSave();\n  }, []);\n\n  return null;\n}\n\nexport default Skip;\n","import { CompletedAnim, Heading } from 'Elements/Menu/Heading';\nimport InputManager from 'Scenes/Game/Singing/Input/InputManager';\nimport SelectPreference from 'Scenes/SelectInput/SelectPreference';\nimport Advanced from 'Scenes/SelectInput/Variants/Advanced';\nimport BuiltIn from 'Scenes/SelectInput/Variants/BuiltIn';\nimport RemoteMics from 'Scenes/SelectInput/Variants/RemoteMics';\nimport SingStarMics from 'Scenes/SelectInput/Variants/SingStarMics';\nimport Skip from 'Scenes/SelectInput/Variants/Skip';\nimport { MicSetupPreference, MicSetupPreferenceSetting, useSettingValue } from 'Scenes/Settings/SettingsState';\nimport posthog from 'posthog-js';\nimport { useEffect, useState } from 'react';\nimport { flushSync } from 'react-dom';\nimport { ValuesType } from 'utility-types';\nimport startViewTransition from 'utils/startViewTransition';\n\ninterface Props {\n  onFinish?: (pref: ValuesType<typeof MicSetupPreference>) => void;\n  onBack?: () => void;\n  smooth?: boolean;\n  closeButtonText: string;\n  skipText?: string;\n  playerNames?: string[];\n}\n\nconst LAST_SELECTED_KEY = 'Previously selected input type';\n\nconst previouslySelected = localStorage.getItem(LAST_SELECTED_KEY);\n\nfunction SelectInputView({ onFinish, closeButtonText, playerNames, onBack, skipText, smooth = true }: Props) {\n  const [preference, setPreference] = useState<ValuesType<typeof MicSetupPreference>>(null);\n  const [isComplete, setIsComplete] = useState(false);\n\n  useEffect(() => {\n    const wasMonitoring = InputManager.monitoringStarted();\n    InputManager.startMonitoring();\n    return () => {\n      !wasMonitoring && InputManager.stopMonitoring();\n    };\n  }, []);\n\n  const [storedPreference, setStoredPreference] = useSettingValue(MicSetupPreferenceSetting);\n\n  const storePreference = (...args: Parameters<typeof setPreference>) => {\n    if (smooth) {\n      startViewTransition(() => {\n        flushSync(() => {\n          setPreference(...args);\n        });\n      });\n    } else {\n      setPreference(...args);\n    }\n  };\n\n  const onSave = (pref: ValuesType<typeof MicSetupPreference>) => () => {\n    // Keep currently selected preference unless nothing (null) is selected - then store `skip` directly\n    // skip is needed to mark that user explicitly didn't select anything\n    setStoredPreference(pref === 'skip' ? storedPreference ?? 'skip' : pref);\n\n    if (pref) {\n      localStorage.setItem(LAST_SELECTED_KEY, pref);\n      posthog.capture('sourcePreferenceSet', { source: pref });\n    }\n\n    onFinish?.(pref);\n  };\n  const back = () => {\n    startViewTransition(() => {\n      setPreference(null);\n      setIsComplete(false);\n    });\n  };\n\n  return (\n    <>\n      <Heading>\n        {isComplete ? (\n          <>\n            <CompletedAnim /> Setup completed!\n          </>\n        ) : (\n          'How do you want to sing?'\n        )}\n      </Heading>\n      {(preference === null || preference === 'skip') && (\n        <SelectPreference\n          onPreferenceSelected={storePreference}\n          previouslySelected={previouslySelected}\n          onBack={onBack}\n          skipText={skipText}\n        />\n      )}\n      {preference === 'remoteMics' && (\n        <RemoteMics\n          onSetupComplete={setIsComplete}\n          onBack={back}\n          onSave={onSave('remoteMics')}\n          closeButtonText={closeButtonText}\n          changePreference={setPreference}\n        />\n      )}\n      {preference === 'mics' && (\n        <SingStarMics\n          onSetupComplete={setIsComplete}\n          onBack={back}\n          onSave={onSave('mics')}\n          closeButtonText={closeButtonText}\n          changePreference={setPreference}\n        />\n      )}\n      {preference === 'built-in' && (\n        <BuiltIn\n          onSetupComplete={setIsComplete}\n          onBack={back}\n          onSave={onSave('built-in')}\n          closeButtonText={closeButtonText}\n          changePreference={setPreference}\n        />\n      )}\n      {preference === 'advanced' && (\n        <Advanced\n          onSave={onSave('advanced')}\n          onSetupComplete={setIsComplete}\n          onBack={back}\n          closeButtonText={closeButtonText}\n          changePreference={setPreference}\n        />\n      )}\n      {preference === 'skip' && (\n        <Skip\n          onSetupComplete={setIsComplete}\n          onBack={back}\n          onSave={onSave('skip')}\n          closeButtonText={closeButtonText}\n          changePreference={setPreference}\n        />\n      )}\n    </>\n  );\n}\n\nexport default SelectInputView;\n","import { MenuContainer } from 'Elements/Menu';\nimport Modal from 'Elements/Modal';\nimport SelectInputView from 'Scenes/SelectInput/SelectInputView';\n\ninterface Props {\n  onClose: () => void;\n  closeButtonText: string;\n}\n\nexport default function SelectInputModal({ onClose, closeButtonText }: Props) {\n  return (\n    <Modal onClose={onClose}>\n      <MenuContainer>\n        <SelectInputView\n          smooth={false}\n          onBack={onClose}\n          onFinish={onClose}\n          closeButtonText={closeButtonText}\n          skipText={'Back'}\n        />\n      </MenuContainer>\n    </Modal>\n  );\n}\n","import styled from '@emotion/styled';\nimport { MenuButton, MenuContainer } from 'Elements/Menu';\nimport Modal from 'Elements/Modal';\nimport SelectInputModal from 'Scenes/SelectInput/SelectInputModal';\nimport InputLag from 'Scenes/Settings/InputLag';\nimport useKeyboardNav from 'hooks/useKeyboardNav';\nimport { useEffect, useRef, useState } from 'react';\n\ninterface Props {\n  onResume: () => void;\n  onExit: () => void;\n  onRestart: () => void;\n}\n\nexport default function PauseMenu({ onResume, onExit, onRestart }: Props) {\n  const menuRef = useRef<null | HTMLButtonElement>(null);\n  const inputLagRef = useRef<HTMLInputElement | null>(null);\n\n  useEffect(() => {\n    menuRef.current?.focus();\n  }, [menuRef]);\n\n  const [isInputModalOpen, setIsInputModalOpen] = useState(false);\n\n  const { register } = useKeyboardNav({ enabled: !isInputModalOpen });\n\n  return (\n    <Modal onClose={onResume}>\n      <MenuContainer>\n        <MenuButton {...register('button-resume-song', onResume)} ref={menuRef}>\n          Resume song\n        </MenuButton>\n        <MenuButton {...register('button-restart-song', onRestart)}>Restart song</MenuButton>\n        <MenuButton {...register('button-exit-song', onExit)}>Exit song</MenuButton>\n        <MenuButton {...register('input-settings', () => setIsInputModalOpen(true))}>Microphones settings</MenuButton>\n        <hr />\n        <InputLag ref={inputLagRef} {...register('input-lag', () => inputLagRef.current?.focus())} />\n      </MenuContainer>\n      {isInputModalOpen && (\n        <SelectInputModal onClose={() => setIsInputModalOpen(false)} closeButtonText={'Back to Pause Menu'} />\n      )}\n    </Modal>\n  );\n}\n\nconst Container = styled.div`\n  position: absolute;\n  z-index: 10;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n\n  display: flex;\n\n  align-items: center;\n  justify-content: center;\n`;\n","import { Song, SongPreview } from 'interfaces';\nimport beatToMs from 'Scenes/Game/Singing/GameState/Helpers/beatToMs';\nimport { getFirstNoteStartFromSections } from 'Songs/utils/notesSelectors';\n\nexport default function getSongFirstNoteMs(song: Song | SongPreview): number {\n  const firstNote = Math.min(\n    ...song.tracks.map((track) => ('sections' in track ? getFirstNoteStartFromSections(track.sections) : track.start)),\n  );\n  return beatToMs(firstNote, song) + song.gap;\n}\n","import { seconds, Song, SongPreview } from 'interfaces';\nimport getSongFirstNoteMs from 'Songs/utils/getSongFirstNoteMs';\nimport isDev from 'utils/isDev';\nimport isE2E from 'utils/isE2E';\n\nexport const SKIP_INTRO_MS = isDev() || isE2E() ? 1_000 : 8_000;\n\nexport default function getSkipIntroTime(song: Song | SongPreview): seconds {\n  return Math.floor((getSongFirstNoteMs(song) - SKIP_INTRO_MS) / 1000);\n}\n","import { Song, SongPreview } from 'interfaces';\nimport getSongFirstNoteMs from 'Songs/utils/getSongFirstNoteMs';\n\nconst SKIP_INTRO_THRESHOLD_MS = 20_000;\n\nexport default function songHasLongIntro(song: Song | SongPreview) {\n  const lyricStartMs = getSongFirstNoteMs(song);\n\n  return lyricStartMs - (song.videoGap ?? 0) * 1000 > SKIP_INTRO_THRESHOLD_MS;\n}\n","import styled from '@emotion/styled';\nimport { VideoPlayerRef } from 'Elements/VideoPlayer';\nimport { typography } from 'Elements/cssMixins';\nimport GameState from 'Scenes/Game/Singing/GameState/GameState';\nimport { MobilePhoneModeSetting, useSettingValue } from 'Scenes/Settings/SettingsState';\nimport getSkipIntroTime, { SKIP_INTRO_MS } from 'Songs/utils/getSkipIntroTime';\nimport getSongFirstNoteMs from 'Songs/utils/getSongFirstNoteMs';\nimport useKeyboard from 'hooks/useKeyboard';\nimport useKeyboardHelp from 'hooks/useKeyboardHelp';\nimport posthog from 'posthog-js';\nimport { useMemo } from 'react';\nimport songHasLongIntro from 'utils/songHasLongIntro';\n\ninterface Props {\n  playerRef: VideoPlayerRef | null;\n  isEnabled: boolean;\n}\n\nfunction SkipIntro({ playerRef, isEnabled }: Props) {\n  const [mobilePhoneMode] = useSettingValue(MobilePhoneModeSetting);\n  const song = GameState.getSong()!;\n  const hasLongIntro = useMemo(() => songHasLongIntro(song), [song]);\n  const songFirstNoteMs = useMemo(() => getSongFirstNoteMs(song), [song]);\n  const shouldBeVisible = GameState.getCurrentTime(false) < songFirstNoteMs - SKIP_INTRO_MS * 1.2;\n\n  const canSkip = isEnabled && shouldBeVisible && hasLongIntro;\n\n  const skipIntro = () => {\n    playerRef?.seekTo(getSkipIntroTime(song));\n\n    const { artist, title } = GameState.getSong()!;\n    posthog.capture('introSkipped', { name: `${artist} - ${title}`, artist, title });\n  };\n  useKeyboard({ accept: skipIntro }, canSkip);\n\n  const help = useMemo(\n    () => ({\n      accept: 'Skip Intro',\n      back: 'Pause Menu',\n    }),\n    [],\n  );\n  useKeyboardHelp(help, canSkip);\n\n  return !mobilePhoneMode && canSkip ? (\n    <Container visible={canSkip} data-test=\"skip-intro-info\">\n      Press <Kbd>Enter</Kbd> to skip the intro\n    </Container>\n  ) : null;\n}\n\nconst Container = styled.div<{ visible: boolean }>`\n  ${typography};\n  pointer-events: none;\n  position: fixed;\n  bottom: 29rem;\n  transform: scale(${(props) => (props.visible ? 1 : 0)});\n  opacity: ${(props) => (props.visible ? 1 : 0)};\n  text-align: center;\n  font-size: 5rem;\n  text-shadow: 0 0 3.5rem black;\n  width: 100%;\n  z-index: 4;\n  padding: 0.5rem;\n  transition: ease 500ms;\n`;\n\nconst Kbd = styled.kbd<{ disabled?: boolean }>`\n  margin: 0.2rem;\n  padding: 0.2rem 2rem;\n  border-radius: 1.3rem;\n  border: 0.5rem solid rgb(204, 204, 204);\n  border-bottom-color: rgb(150, 150, 150);\n  border-right-color: rgb(150, 150, 150);\n  line-height: 1.4;\n  display: inline-block;\n  background-color: rgb(247, 247, 247);\n  text-shadow: 0 1rem 0 #fff;\n\n  opacity: ${(props) => (props.disabled ? 0.25 : 1)};\n`;\n\nexport default SkipIntro;\n","import styled from '@emotion/styled';\nimport { typography } from 'Elements/cssMixins';\nimport GameState from 'Scenes/Game/Singing/GameState/GameState';\nimport beatToMs from 'Scenes/Game/Singing/GameState/Helpers/beatToMs';\nimport { MobilePhoneModeSetting, useSettingValue } from 'Scenes/Settings/SettingsState';\nimport { getLastNoteEnd } from 'Songs/utils/notesSelectors';\nimport useDebounce from 'hooks/useDebounce';\nimport useKeyboard from 'hooks/useKeyboard';\nimport useKeyboardHelp from 'hooks/useKeyboardHelp';\nimport posthog from 'posthog-js';\nimport React, { useMemo, useState } from 'react';\nimport { useInterval } from 'react-use';\n\ninterface Props {\n  onSongEnd: () => void;\n  isEnabled: boolean;\n}\n\nconst SHOW_OUTRO_THRESHOLD_MS = 15_000;\n\nfunction SkipOutro({ onSongEnd, isEnabled }: Props) {\n  const [mobilePhoneMode] = useSettingValue(MobilePhoneModeSetting);\n  const duration = GameState.getDuration();\n\n  const singingEndBeat = useMemo(\n    () => Math.max(...GameState.getPlayers().map((player) => getLastNoteEnd(player.getLastNotesSection()))),\n    [],\n  );\n\n  const canSkip = useMemo(() => {\n    const singingEndTime = beatToMs(singingEndBeat, GameState.getSong()!);\n\n    return isEnabled && duration * 1000 > singingEndTime + SHOW_OUTRO_THRESHOLD_MS;\n  }, [duration, singingEndBeat, isEnabled]);\n\n  const [currentBeat, setCurrentBeat] = useState(0);\n  const [skipping, setSkipping] = useState(false);\n\n  useInterval(() => setCurrentBeat(GameState.getCurrentBeat()), 1_000);\n\n  const shouldBeVisible = useDebounce(canSkip && currentBeat > singingEndBeat, 5_000) && !skipping;\n\n  const skipOutro = () => {\n    setSkipping(true);\n    setTimeout(onSongEnd, 700);\n\n    const { artist, title } = GameState.getSong()!;\n    posthog.capture('outroSkipped', { name: `${artist} - ${title}`, artist, title });\n  };\n  useKeyboard({ accept: skipOutro }, shouldBeVisible);\n\n  const help = useMemo(\n    () => ({\n      accept: 'Skip Outro',\n      back: 'Pause Menu',\n    }),\n    [],\n  );\n  useKeyboardHelp(help, shouldBeVisible);\n\n  return !mobilePhoneMode && canSkip ? (\n    <Container visible={shouldBeVisible}>\n      Press <Kbd>Enter</Kbd> to skip the outro\n    </Container>\n  ) : null;\n}\n\nconst Container = styled.div<{ visible: boolean }>`\n  ${typography};\n  pointer-events: none;\n  position: fixed;\n  bottom: 29rem;\n  transform: scale(${(props) => (props.visible ? 1 : 0)});\n  opacity: ${(props) => (props.visible ? 1 : 0)};\n  text-align: center;\n  font-size: 5rem;\n  text-shadow: 0 0 3.5rem black;\n  width: 100%;\n  z-index: 4;\n  padding: 0.5rem;\n  transition: ease 500ms;\n`;\n\nconst Kbd = styled.kbd<{ disabled?: boolean }>`\n  margin: 0.2rem;\n  padding: 0.2rem 2rem;\n  border-radius: 1.3rem;\n  border: 0.5rem solid rgb(204, 204, 204);\n  border-bottom-color: rgb(150, 150, 150);\n  border-right-color: rgb(150, 150, 150);\n  line-height: 1.4;\n  display: inline-block;\n  background-color: rgb(247, 247, 247);\n  text-shadow: 0 1rem 0 #fff;\n\n  opacity: ${(props) => (props.disabled ? 0.25 : 1)};\n`;\n\nexport default React.memo(SkipOutro);\n","import styled from '@emotion/styled';\nimport { getFirstNoteStartFromSections, getLastNoteEndFromSections } from 'Songs/utils/notesSelectors';\nimport { PlayerSetup } from 'interfaces';\nimport { uniq } from 'lodash-es';\nimport { useMemo } from 'react';\nimport GameState from '../../GameState/GameState';\nimport styles from '../Drawing/styles';\n\ninterface Props {\n  players: PlayerSetup[];\n}\n\nfunction DurationBar({ players }: Props) {\n  const currentTime = GameState.getCurrentTime(false);\n  const beatLength = GameState.getSongBeatLength();\n  const duration = GameState.getDuration();\n  const song = GameState.getSong()!;\n\n  const firstNotes = useMemo(\n    () =>\n      uniq(\n        song.tracks\n          .filter((v, index) => players.find((player) => player.track === index))\n          .map(({ sections }) => getFirstNoteStartFromSections(sections) * beatLength + song.gap),\n      ),\n    [song, beatLength, players],\n  );\n  const lastNotes = useMemo(\n    () =>\n      uniq(\n        song.tracks\n          .filter((v, index) => players.find((player) => player.track === index))\n          .map(({ sections }) => getLastNoteEndFromSections(sections) * beatLength + song.gap),\n      ),\n    [song, beatLength, players],\n  );\n\n  const durationMs = duration * 1000;\n\n  if (!currentTime || !duration) return null;\n\n  return (\n    <Bar>\n      {firstNotes.map((note) => (\n        <Marker key={note} position={note / durationMs} />\n      ))}\n      {lastNotes.map((note) => (\n        <Marker key={note} position={note / durationMs} />\n      ))}\n      <BarFill fill={currentTime / durationMs} />\n    </Bar>\n  );\n}\n\nconst Bar = styled.div`\n  position: absolute;\n  height: 0.6rem;\n  width: 100%;\n  background: rgba(0, 0, 0, 0.5);\n  left: 0;\n  top: calc(50% - 0.3rem);\n`;\n\nconst BaseMarker = styled(Bar)`\n  top: 0;\n  margin-left: -0.25rem;\n  width: 0.5rem;\n  background: ${styles.colors.text.active};\n  opacity: 75%;\n`;\n\nconst Marker = (props: { position: number }) => (\n  <BaseMarker style={{ left: `${Math.min(props.position * 100, 100)}%` }} />\n);\n\nconst BaseBarFill = styled(Bar)`\n  top: 0;\n  background: white;\n  opacity: 50%;\n`;\n\nconst BarFill = (props: { fill: number }) => (\n  <BaseBarFill style={{ width: `${Math.round(props.fill * 10_000) / 100}%` }} />\n);\n\nexport default DurationBar;\n","import styled from '@emotion/styled';\nimport PlayersManager from 'Players/PlayersManager';\nimport RemoteMicManager from 'RemoteMic/RemoteMicManager';\nimport { useEffect, useState } from 'react';\n\ninterface Props {\n  playerNumber: number;\n}\n\nexport const useDevicePing = (deviceId?: string) => {\n  const [latency, setLatency] = useState<number | null>(null);\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      const remoteMic = RemoteMicManager.getRemoteMicById(deviceId ?? '');\n\n      setLatency(remoteMic ? remoteMic.getLatency() : null);\n    }, 1000);\n\n    return () => {\n      clearInterval(interval);\n    };\n  }, [deviceId]);\n\n  return latency;\n};\n\nfunction Ping({ playerNumber, ...restProps }: Props) {\n  const latency = useDevicePing(PlayersManager.getPlayer(playerNumber)?.input?.deviceId);\n\n  return <>{latency !== null ? <PingContainer {...restProps}>{latency}ms</PingContainer> : ''}</>;\n}\nexport default Ping;\n\nconst PingContainer = styled.span`\n  position: absolute;\n  right: 4rem;\n  bottom: 0.5rem;\n  font-size: 1.75rem;\n`;\n","import styled from '@emotion/styled';\nimport { ThumbUpAlt } from '@mui/icons-material';\nimport ErrorIcon from '@mui/icons-material/Error';\nimport SignalCellularAltIcon from '@mui/icons-material/SignalCellularAlt';\nimport WarningIcon from '@mui/icons-material/Warning';\nimport { typography } from 'Elements/cssMixins';\nimport { inputStatus } from 'Scenes/Game/Singing/Input/Interface';\n\ninterface Props {\n  status: inputStatus;\n  tooltipPosition?: 'start' | 'end';\n}\n\nfunction PlayerStatus({ status, tooltipPosition = 'end', ...restProps }: Props) {\n  return (\n    <StatusContainer {...restProps}>\n      {status === 'ok' ? (\n        <ThumbUpAlt data-test=\"status-ok\" />\n      ) : status === 'unavailable' ? (\n        <UnavailableIcon data-test=\"status-unavailable\" />\n      ) : (\n        <UnstableIcon data-test=\"status-unstable\" />\n      )}\n      {status === 'unavailable' ? (\n        <StatusDescription position={tooltipPosition}>\n          <span>\n            The device is <strong>disconnected</strong>. Reconnect it, please.\n          </span>\n        </StatusDescription>\n      ) : status === 'unstable' ? (\n        <StatusDescription position={tooltipPosition}>\n          <span>\n            The connection seems <strong>unstable</strong>. Connect to the same Wifi.\n          </span>\n        </StatusDescription>\n      ) : null}\n    </StatusContainer>\n  );\n}\nexport default PlayerStatus;\n\nconst StatusContainer = styled.span`\n  position: absolute;\n  right: 0.5rem;\n  top: 0.5rem;\n  font-size: 3rem;\n  z-index: 10;\n  svg {\n    width: 3rem;\n    height: 3rem;\n    text-shadow: black;\n  }\n`;\n\nconst OkIcon = styled(SignalCellularAltIcon)`\n  fill: #ffffff;\n  stroke: black;\n  stroke-width: 1px;\n`;\n\nconst UnavailableIcon = styled(ErrorIcon)`\n  fill: #ff0000;\n`;\n\nconst UnstableIcon = styled(WarningIcon)`\n  fill: #f89400;\n  stroke: black;\n`;\n\nconst StatusDescription = styled.div<{ position: Props['tooltipPosition'] }>`\n  ${typography};\n  position: absolute;\n  ${(props) => (props.position === 'end' ? 'left: 100%' : 'right: 150%')};\n  top: -0.5rem;\n  font-size: 1.5rem;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  width: 25rem;\n  background: rgba(0, 0, 0, 0.75);\n  padding: 0.5rem;\n  margin-left: 2rem;\n`;\n","import { useEffect, useState } from 'react';\nimport InputManager from 'Scenes/Game/Singing/Input/InputManager';\nimport { inputStatus } from 'Scenes/Game/Singing/Input/Interface';\n\nconst usePlayerMicStatus = (\n  playerNumber: number,\n  intervalMs = 333,\n  onMeasure?: ([volume, frequency]: [number, number]) => void,\n) => {\n  const [data, setData] = useState<inputStatus>('ok');\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setData(InputManager.getInputStatus(playerNumber));\n    }, intervalMs);\n\n    return () => {\n      clearInterval(interval);\n    };\n  }, [playerNumber, intervalMs, onMeasure]);\n\n  return data;\n};\n\nexport default usePlayerMicStatus;\n","import styled from '@emotion/styled';\nimport { VolumeIndicator } from 'Elements/VolumeIndicator';\nimport { PlayerEntity } from 'Players/PlayersManager';\nimport InputManager from 'Scenes/Game/Singing/Input/InputManager';\nimport Ping from 'Scenes/SingASong/SongSelection/SongSettings/MicCheck/Ping';\nimport PlayerStatus from 'Scenes/SingASong/SongSelection/SongSettings/MicCheck/Status';\nimport usePlayerMicStatus from 'hooks/players/usePlayerMicStatus';\n\ninterface Props {\n  player: PlayerEntity;\n  bottom?: boolean;\n}\n\nfunction LyricsVolumeIndicator({ player, bottom = false }: Props) {\n  const playerVolume = InputManager.getPlayerVolume(player.number);\n  const status = usePlayerMicStatus(player.number);\n\n  return (\n    <Container>\n      {status !== 'unavailable' && <VolumeIndicator playerNumber={player.number} volume={playerVolume} />}\n      <StyledPlayerStatus status={status} tooltipPosition=\"start\" />\n      <StyledPing playerNumber={player.number} />\n    </Container>\n  );\n}\n\nconst Container = styled.div`\n  position: absolute;\n  width: 20rem;\n  right: 0;\n  top: 0;\n  height: 100%;\n`;\n\nconst StyledPlayerStatus = styled(PlayerStatus)`\n  top: auto;\n  right: 1rem;\n  bottom: 1rem;\n`;\nconst StyledPing = styled(Ping)`\n  z-index: 2;\n  font-size: 2rem;\n  margin-right: 1rem;\n  -webkit-text-stroke: 0.1rem black;\n  bottom: 1.5rem;\n`;\n\nexport default LyricsVolumeIndicator;\n","import styled from '@emotion/styled';\nimport SwapHorizIcon from '@mui/icons-material/SwapHoriz';\nimport { PlayerEntity } from 'Players/PlayersManager';\nimport LyricsVolumeIndicator from 'Scenes/Game/Singing/GameOverlay/Components/LyricsVolumeIndicator';\nimport { MobilePhoneModeSetting, useSettingValue } from 'Scenes/Settings/SettingsState';\nimport isNotesSection from 'Songs/utils/isNotesSection';\nimport { getFirstNoteStartFromSections } from 'Songs/utils/notesSelectors';\nimport { Note } from 'interfaces';\nimport { ComponentProps, Fragment, PropsWithChildren } from 'react';\nimport GameState from '../../GameState/GameState';\nimport styles from '../Drawing/styles';\n\ninterface Props {\n  player: PlayerEntity;\n  bottom?: boolean;\n  playerChanges: number[][];\n  effectsEnabled: boolean;\n}\n\nfunction Lyrics({ player, playerChanges, bottom = false, effectsEnabled }: Props) {\n  const playerState = GameState.getPlayer(player.number)!;\n  const [mobilePhoneMode] = useSettingValue(MobilePhoneModeSetting);\n  const playerColor = styles.colors.players[player.number].text;\n  const thisPlayerChanges = playerChanges[playerState.getTrackIndex()] ?? [];\n  const section = playerState.getCurrentSection();\n  const nextSection = playerState.getNextSection();\n  const subsequentSection = playerState.getNextSection(2);\n  const currentBeat = GameState.getCurrentBeat();\n  const beatLength = GameState.getSongBeatLength();\n\n  const previousChange = Math.max(0, ...thisPlayerChanges.filter((beat) => beat <= section?.start ?? -Infinity));\n  const nextChange = thisPlayerChanges.find((beat) => beat > section?.start ?? Infinity) ?? Infinity;\n  const timeToNextChange = (nextChange - currentBeat) * beatLength;\n\n  const passTheMicProgress = (nextChange - currentBeat) / (nextChange - previousChange);\n\n  const shouldBlink = timeToNextChange < 2500;\n\n  const hasNotes = isNotesSection(section);\n\n  const beatsBetweenSectionAndNote = hasNotes ? getFirstNoteStartFromSections([section]) - section.start : 0;\n\n  return (\n    <LyricsContainer shouldBlink={shouldBlink} bottom={bottom}>\n      {!mobilePhoneMode && effectsEnabled && <LyricsVolumeIndicator player={player} />}\n      {timeToNextChange < Infinity && (\n        <PassTheMicProgress color={playerColor} progress={passTheMicProgress <= 1 ? passTheMicProgress * 100 : 0} />\n      )}\n      {hasNotes ? (\n        <>\n          <LyricsLine data-test={`lyrics-current-player-${player.number}`} effectsEnabled={effectsEnabled}>\n            <HeadstartContainer>\n              <Headstart\n                color={playerColor}\n                percent={Math.min(2, (currentBeat - section.start) / beatsBetweenSectionAndNote)}\n              />\n            </HeadstartContainer>\n            {section?.notes.map((note) => {\n              const fill = effectsEnabled\n                ? Math.max(0, Math.min(2, (currentBeat - note.start) / note.length))\n                : currentBeat >= note.start\n                ? 1\n                : 0;\n              return (\n                <LyricContainer type={note.type} key={note.start}>\n                  <LyricActiveContainer>\n                    <LyricActive fill={fill} color={playerColor}>\n                      {note.lyrics.trim()}\n                    </LyricActive>\n                    {note.lyrics.endsWith(' ') && ' '}\n                  </LyricActiveContainer>\n                  {note.lyrics}\n                </LyricContainer>\n              );\n            })}\n            {nextSection?.start === nextChange && <PassTheMicSymbol shouldShake />}\n          </LyricsLine>\n        </>\n      ) : (\n        <LyricsLine effectsEnabled={effectsEnabled}>&nbsp;</LyricsLine>\n      )}\n      {isNotesSection(nextSection) ? (\n        <LyricsLine nextLine data-test={`lyrics-next-player-${player.number}`} effectsEnabled={effectsEnabled}>\n          {nextSection.notes.map((note) => (\n            <Fragment key={note.start}>{note.lyrics}</Fragment>\n          ))}\n          {subsequentSection?.start === nextChange && <PassTheMicSymbol />}\n        </LyricsLine>\n      ) : (\n        <LyricsLine effectsEnabled={effectsEnabled} nextLine>\n          &nbsp;\n        </LyricsLine>\n      )}\n    </LyricsContainer>\n  );\n}\n\nconst HeadstartContainer = styled.span`\n  position: relative;\n  height: 0;\n`;\n\nconst BaseHeadstart = styled.span`\n  position: absolute;\n  width: 15rem;\n  height: 3.1rem;\n  margin: 0.7rem 0;\n  right: 10rem;\n`;\n\nconst Headstart = ({ percent, color }: { percent: number; color: string }) => (\n  <BaseHeadstart\n    style={{\n      transformOrigin: 'right',\n      transform: `scaleX(${Math.min(1, 2 - percent)})`,\n      right: `${Math.max(0, 1 - percent) * 15}rem`,\n      background: `linear-gradient(270deg, rgba(${color}, 1) 0%, rgba(${color}, 0.5) 25%, rgba(${color}, 0) 100%)`,\n    }}\n  />\n);\n\nconst LyricsContainer = styled.div<{ shouldBlink: boolean; bottom: boolean }>`\n  @keyframes blink {\n    100% {\n      background-color: rgba(0, 0, 0, ${(props) => (props.bottom ? '0.85' : '0.5')});\n    }\n    30% {\n      background-color: rgba(0, 0, 0, ${(props) => (props.bottom ? '0.85' : '0.5')});\n    }\n    50% {\n      background-color: rgba(200, 200, 200, ${(props) => (props.bottom ? '0.85' : '0.5')});\n    }\n    30% {\n      background-color: rgba(0, 0, 0, ${(props) => (props.bottom ? '0.85' : '0.5')});\n    }\n    0% {\n      background-color: rgba(0, 0, 0, ${(props) => (props.bottom ? '0.85' : '0.5')});\n    }\n  }\n\n  box-sizing: border-box;\n\n  padding: 1rem;\n  background: rgba(0, 0, 0, ${(props) => (props.bottom ? '0.9' : '0.5')});\n  width: 100%;\n  text-align: center;\n  line-height: 1;\n  margin: 2rem 0;\n  position: relative;\n  ${(props) => (props.shouldBlink ? `animation: blink 350ms ease-in-out infinite both;` : ``)}\n`;\n\nconst LyricContainer = styled.span<{ type: Note['type'] }>`\n  font-style: ${(props) => (props.type === 'freestyle' ? 'italic' : 'normal')};\n`;\n\nconst LyricActiveContainer = styled.span`\n  position: absolute;\n  z-index: 1;\n`;\nconst BaseLyricActive = styled.span``;\n\nconst LyricActive = ({ fill, color, children }: PropsWithChildren<{ fill: number; color: string }>) => (\n  <BaseLyricActive\n    style={{\n      clipPath: `inset(0 ${(1 - (fill === 0 ? 0 : fill + 0.05)) * 100}% -5rem 0)`,\n      color: `rgb(${color})`,\n    }}>\n    {children}\n  </BaseLyricActive>\n);\n\nconst BasePassTheMicProgress = styled.div<{ color: string }>`\n  position: absolute;\n  height: 1rem;\n  background: rgb(${(props) => props.color});\n  width: 100%;\n`;\n\nconst PassTheMicProgress = (props: { progress: number } & ComponentProps<typeof BasePassTheMicProgress>) => (\n  <BasePassTheMicProgress\n    style={{\n      transformOrigin: 'left',\n      transform: `scaleX(${props.progress / 100})`,\n    }}\n    color={props.color}\n  />\n);\n\nconst PassTheMicSymbol = styled(SwapHorizIcon, { shouldForwardProp: (prop) => prop !== 'shouldShake' })<{\n  shouldShake?: boolean;\n}>`\n  @keyframes shake {\n    10%,\n    90% {\n      transform: translate3d(-0.1rem, 0, 0);\n    }\n\n    20%,\n    80% {\n      transform: translate3d(0.2rem, 0, 0);\n    }\n\n    30%,\n    50%,\n    70% {\n      transform: translate3d(-0.4rem, 0, 0);\n    }\n\n    40%,\n    60% {\n      transform: translate3d(0.4rem, 0, 0);\n    }\n  }\n\n  ${(props) => props.shouldShake && 'animation: shake 0.92s cubic-bezier(0.36, 0.07, 0.19, 0.97) both infinite;'}\n  margin-left: 2rem;\n  ${(props) => (props.shouldShake ? `fill: ${styles.colors.text.active};` : '')}\n  font-size: ${(props) => (props.shouldShake ? 4 : 3)}rem;\n`;\nconst LyricsLine = styled.div<{ nextLine?: boolean; effectsEnabled: boolean }>`\n  font-size: ${({ nextLine, effectsEnabled }) => (effectsEnabled ? 3.5 + (nextLine ? 0 : 1) : 2)}rem;\n  height: ${({ effectsEnabled }) => (effectsEnabled ? 4.5 : 2)}rem;\n  ${({ effectsEnabled }) => (!effectsEnabled ? '-webkit-text-stroke-width: 2px' : '')};\n\n  color: ${({ nextLine }) => (nextLine ? styles.colors.text.inactive : styles.colors.text.default)};\n\n  font-family: 'Comic Sans MS', 'Comic Sans', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans',\n    'Helvetica Neue', sans-serif;\n  z-index: 10;\n`;\n\nexport default Lyrics;\n","interface Props {\n  score: number;\n}\n\nexport const formatter = new Intl.NumberFormat(undefined, { maximumFractionDigits: 0 });\n\nexport default function ScoreText({ score }: Props) {\n  return <>{formatter.format(score)}</>;\n}\n","import { PlayerNote } from 'interfaces';\nimport styles from '../../styles';\n\nexport function getColor(\n  ctx: CanvasRenderingContext2D,\n  playerNumber: number,\n  isStar: boolean,\n  isHit: boolean,\n  isPerfect: boolean,\n) {\n  if (isPerfect && isStar) {\n    return styles.colors.players[playerNumber].starPerfect;\n  } else if (isPerfect) {\n    return styles.colors.players[playerNumber].perfect;\n  } else if (isStar && isHit) {\n    return styles.colors.players[playerNumber].star;\n  } else if (isHit) {\n    return styles.colors.players[playerNumber].hit;\n  } else {\n    return styles.colors.players[playerNumber].miss;\n  }\n}\n\nexport default function getNoteColor(\n  ctx: CanvasRenderingContext2D,\n  playerNumber: number,\n  isHit: boolean,\n  playerNote: PlayerNote,\n) {\n  return getColor(ctx, playerNumber, playerNote.note.type === 'star', isHit, playerNote.isPerfect);\n}\n","export const randomFloat = (from: number, to: number) => {\n  return from + Math.random() * (to - from);\n};\n\nexport const randomInt = (from: number, to: number) => Math.round(randomFloat(from, to));\n","import tinycolor from 'tinycolor2';\nimport { randomInt } from 'utils/randomValue';\n\nconst cachedColors: Record<string, [string[], string[], string[]]> = {};\n\nconst getColors = (color: string) => {\n  if (!cachedColors[color]) {\n    const c = tinycolor(color);\n    cachedColors[color] = [\n      [c.setAlpha(0.8).toRgbString(), c.setAlpha(0.9).toRgbString(), c.setAlpha(1).toRgbString()],\n      [c.setAlpha(0).toRgbString()],\n      [c.setAlpha(0.1).toRgbString(), c.setAlpha(0.3).toRgbString(), c.setAlpha(0.2).toRgbString()],\n    ];\n  }\n\n  return cachedColors[color];\n};\n\nexport default function ray(\n  canvas: HTMLCanvasElement,\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  color: string | any,\n  alpha: number = 1,\n) {\n  if (width <= 0) return;\n\n  ctx.globalAlpha = 1;\n  const gradient = ctx.createRadialGradient(x, y, 0, x, y, width / 2);\n  const [cFirst, cLast, c0] = getColors(color);\n  gradient.addColorStop(0, cFirst[randomInt(0, cFirst.length - 1)]);\n  gradient.addColorStop(0.05, cFirst[randomInt(0, cFirst.length - 1)]);\n  gradient.addColorStop(0.15, c0[randomInt(0, c0.length - 1)]);\n  gradient.addColorStop(1, cLast[randomInt(0, cLast.length - 1)]);\n  ctx.beginPath();\n  ctx.arc(x, y, width / 2, 0, 2 * Math.PI);\n  ctx.closePath();\n  ctx.fillStyle = gradient;\n  ctx.fill();\n  ctx.fillStyle = color;\n  ctx.globalAlpha = 1;\n}\n","import ray from './ray';\n\nexport default function debris(\n  canvas: HTMLCanvasElement,\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  angle: number,\n  color: string | CanvasGradient | CanvasPattern,\n  alpha: number = 1,\n) {\n  if (width > 0) {\n    ray(canvas, ctx, x, y, width, height, color, alpha);\n  }\n}\n\nfunction triangle(\n  canvas: HTMLCanvasElement,\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  angle: number,\n  color: string | CanvasGradient | CanvasPattern,\n  alpha: number = 1,\n) {\n  ctx.save();\n\n  // move to the center of the canvas\n  const finalX = x - width / 2;\n  const finalY = y - height / 2;\n\n  ctx.translate(finalX, finalY);\n\n  // rotate the canvas to the specified degrees\n  ctx.rotate((angle * Math.PI) / 180);\n\n  ctx.globalAlpha = alpha;\n  ctx.fillStyle = color;\n  ctx.beginPath();\n  ctx.moveTo(0 - width / 2, height / 2);\n  ctx.lineTo(width / 2, height / 2);\n  ctx.lineTo(width / 2, 0);\n  ctx.lineTo(width / 2, 0 - height / 2);\n  ctx.fill();\n  ctx.globalAlpha = 1;\n  ctx.restore();\n}\n","const spreadValue = (initial: number, spread: number) => initial - spread + Math.random() * spread * 2;\n\nexport default spreadValue;\n\nexport const randomSign = (weight = 0) => Math.sign(weight + Math.random() - 0.5);\n","import debris from 'Scenes/Game/Singing/GameOverlay/Drawing/Elements/debris';\nimport spreadValue from 'Scenes/Game/Singing/GameOverlay/Drawing/Particles/utils';\nimport Particle from '../interfaces';\n\nconst baseTtlMs = 300;\nconst ttlSpreadMs = 50;\n\nconst velocityModifier = 1.3;\n\nexport default class SungTriangle implements Particle {\n  public finished = false;\n\n  private ttl;\n  private startingTtl;\n  private velocityX;\n  private velocityY;\n  private width;\n  private initialAngle;\n  private heightModifier;\n\n  constructor(private x: number, private y: number, private color: string) {\n    this.startingTtl = this.ttl = spreadValue(baseTtlMs, ttlSpreadMs);\n    this.velocityX = velocityModifier * Math.random() - velocityModifier / 2;\n    this.velocityY = velocityModifier * Math.random() - velocityModifier / 2;\n    this.width = 25;\n    this.initialAngle = 180 - Math.random() * 360;\n    this.heightModifier = 0.5 + Math.random() / 2;\n  }\n  public tick = (ctx: CanvasRenderingContext2D, canvas: HTMLCanvasElement, delta: number) => {\n    const percentage = 1 - this.ttl / this.startingTtl;\n    const ticksLeft = this.ttl;\n\n    const width = this.width * percentage;\n    const height = this.width * this.heightModifier * percentage;\n\n    const x = this.x - width / 2 + ticksLeft * this.velocityX;\n    const y = this.y + height / 2 + ticksLeft * this.velocityY;\n\n    debris(canvas, ctx, x, y, width, height, this.initialAngle + ticksLeft, this.color, 0.7 * percentage);\n\n    this.ttl = this.ttl - delta;\n    this.finished = this.ttl <= 0;\n  };\n}\n","import GameState from 'Scenes/Game/Singing/GameState/GameState';\nimport { Curtains, Plane, PlaneParams } from 'curtainsjs';\n\nexport class Shaders {\n  private curtains: Curtains;\n  private plane: Plane | null = null;\n  public constructor(private canvas: HTMLCanvasElement) {\n    this.curtains = new Curtains({\n      pixelRatio: 1,\n      premultipliedAlpha: false,\n      container: 'canvas',\n    });\n    const { gl } = this.curtains;\n    // https://stackoverflow.com/a/39354174\n    if (!gl) {\n      console.info('WebGL not supported');\n      return;\n    }\n    gl.enable(gl.BLEND);\n    gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n\n    const planeElement = document.getElementById('plane')!;\n    const planeDimensions = planeElement.getBoundingClientRect();\n\n    const playerUniforms: Record<string, any> = GameState.getPlayers().reduce(\n      (uniforms, player) => ({\n        ...uniforms,\n        [`p${player.getNumber()}center`]: {\n          name: `uP${player.getNumber()}center`,\n          type: '2f',\n          value: [0, 0],\n        },\n        [`p${player.getNumber()}force`]: {\n          name: `uP${player.getNumber()}force`,\n          type: '1f',\n          value: 0,\n        },\n      }),\n      {\n        resolution: {\n          // resolution of our plane\n          name: 'uResolution',\n          type: '2f',\n          value: [planeDimensions.width, planeDimensions.height],\n        },\n        time: {\n          name: 'uTime', // uniform name that will be passed to our shaders\n          type: '1f', // this means our uniform is a float\n          value: 0,\n        },\n      },\n    );\n\n    // set our initial parameters (basic uniforms)\n    const params: PlaneParams = {\n      vertexShaderID: 'plane-vs', // our vertex shader ID\n      fragmentShaderID: 'plane-fs', // our fragment shader ID\n      uniforms: playerUniforms,\n    };\n\n    // create our plane using our curtains object, the HTML element and the parameters\n    this.plane = new Plane(this.curtains, planeElement, params);\n\n    this.plane.loadCanvas(this.canvas);\n\n    this.plane.onRender(() => {\n      // @ts-expect-error\n      this.plane!.uniforms.time.value++;\n      // console.log(this.plane!.uniforms.p0force.value);\n    });\n\n    this.canvas.style.visibility = 'hidden';\n  }\n\n  public updatePlayerCenter = (playerNumber: number, x: number, y: number) => {\n    if (!this.plane) return;\n    this.plane.uniforms[`p${playerNumber}center`].value = [x / this.canvas.width, 1 - y / this.canvas.height];\n  };\n\n  public updatePlayerForce = (playerNumber: number, force: number) => {\n    if (!this.plane) return;\n    this.plane.uniforms[`p${playerNumber}force`].value = force;\n  };\n\n  public getPlayerForce = (playerNumber: number) => {\n    if (!this.plane) return;\n    return this.plane.uniforms[`p${playerNumber}force`].value as number;\n  };\n\n  public cleanup = () => {\n    try {\n      this.plane?.remove();\n      this.curtains?.dispose();\n    } catch (e) {\n      console.warn(e);\n    }\n  };\n}\n","import { FrequencyRecord, PlayerNote, Section, Song } from 'interfaces';\nimport isNotesSection from 'Songs/utils/isNotesSection';\n\nexport const pitchPadding = 6;\n\nexport const NOTE_HEIGHT = 30;\nexport const BIG_NOTE_HEIGHT = NOTE_HEIGHT + 6;\n\nconst getPlayerCanvas = (\n  drawingData: Pick<DrawingData, 'canvas' | 'playerCount' | 'playerIndex' | 'paddingVertical'>,\n) => {\n  const width = drawingData.canvas.width;\n  const height = drawingData.canvas.height;\n\n  // If the ratio is higher than 16/9 (e.g. 21/9), pad the excess horizontal space\n  // so in the end the notes are drawn over the same area as it would be on 16/9\n  const pixelsOverRatio = Math.max(0, (width - height * (16 / 9)) / 2);\n\n  const paddingHorizontal = 10 + (width - 2 * pixelsOverRatio) * 0.15 + pixelsOverRatio;\n\n  const paddedHeight = height - drawingData.paddingVertical * 2;\n\n  return {\n    width: width - paddingHorizontal * 2,\n    height: paddedHeight / drawingData.playerCount,\n    baseX: paddingHorizontal,\n    baseY: drawingData.paddingVertical + (drawingData.playerIndex * paddedHeight) / drawingData.playerCount,\n  };\n};\n\nexport default function calculateData({\n  canvas,\n  currentSectionIndex,\n  song,\n  songBeatLength,\n  minPitch,\n  maxPitch,\n  track,\n  playerIndex,\n  playerCount,\n  paddingVertical,\n}: DrawingData) {\n  const sections = song.tracks[track].sections;\n  const currentSection = sections[currentSectionIndex];\n  const nextSection = sections[currentSectionIndex + 1];\n\n  const playerCanvas = getPlayerCanvas({ canvas, playerCount, playerIndex, paddingVertical });\n\n  const lastNote = isNotesSection(currentSection) ? currentSection?.notes?.at(-1) : undefined;\n  const sectionEndBeat = isNotesSection(currentSection)\n    ? nextSection?.start ?? lastNote!.start + lastNote!.length\n    : currentSection.end;\n  const timeSectionGap = currentSection.start * songBeatLength;\n  const maxTime = (sectionEndBeat - currentSection.start) * songBeatLength;\n\n  const pitchStepHeight = (playerCanvas.height - 20 - NOTE_HEIGHT) / (maxPitch - minPitch + pitchPadding * 2);\n\n  return {\n    playerCanvas,\n    currentSection,\n    sectionEndBeat,\n    timeSectionGap,\n    maxTime,\n    pitchStepHeight,\n  };\n}\n\nexport interface DrawingData {\n  playerNumber: number;\n  playerIndex: number;\n  playerCount: number;\n  song: Song;\n  songBeatLength: number;\n  minPitch: number;\n  maxPitch: number;\n  canvas: HTMLCanvasElement;\n  currentTime: number;\n  currentSectionIndex: number;\n  frequencies: FrequencyRecord[];\n  playerNotes: PlayerNote[];\n  currentPlayerNotes: PlayerNote[];\n  track: number;\n\n  currentBeat: number;\n  paddingVertical: number;\n  currentSection: Section | undefined; // `undefined` can happen with `sectionShift` parameter\n}\n","function simpleRoundRect(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  radius: number,\n  fill: boolean,\n  stroke: boolean,\n) {\n  const actualWidth = Math.max(width, height / 2);\n  const actualRadius = Math.min(actualWidth / 2, height / 2, radius);\n\n  ctx.beginPath();\n  ctx.moveTo(x + actualRadius, y);\n  ctx.lineTo(x + actualWidth - actualRadius, y);\n  ctx.quadraticCurveTo(x + actualWidth, y, x + actualWidth, y + actualRadius);\n  ctx.lineTo(x + actualWidth, y + height - actualRadius);\n  ctx.quadraticCurveTo(x + actualWidth, y + height, x + actualWidth - actualRadius, y + height);\n  ctx.lineTo(x + actualRadius, y + height);\n  ctx.quadraticCurveTo(x, y + height, x, y + height - actualRadius);\n  ctx.lineTo(x, y + actualRadius);\n  ctx.quadraticCurveTo(x, y, x + actualRadius, y);\n  ctx.closePath();\n  if (fill) {\n    ctx.fill();\n  }\n  if (stroke) {\n    ctx.stroke();\n  }\n}\n\nexport default function roundRect(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  radius: number,\n  fill: boolean,\n  stroke: boolean,\n  glass = 0.1,\n) {\n  simpleRoundRect(ctx, x, y, width, height, radius, fill, stroke);\n\n  if (fill && glass > 0) {\n    ctx.save();\n    simpleRoundRect(ctx, x, y, width, height, radius, false, false);\n    ctx.clip();\n\n    ctx.fillStyle = `rgba(255,255,255,${glass})`;\n    ctx.fillRect(x, y, width, height / 2.2);\n\n    ctx.restore();\n  }\n}\n","export default function applyColor(\n  ctx: CanvasRenderingContext2D,\n  style: { fill: string; stroke: string; lineWidth: number },\n) {\n  ctx.fillStyle = style.fill;\n  ctx.strokeStyle = style.stroke;\n  ctx.lineWidth = style.lineWidth;\n}\n","import roundRect from 'Scenes/Game/Singing/GameOverlay/Drawing/Elements/roundRect';\nimport applyColor from 'Scenes/Game/Singing/GameOverlay/Drawing/applyColor';\nimport { Note } from 'interfaces';\nimport styles from '../../../styles';\n\nexport default function drawRawNote(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  noteType: Note['type'],\n) {\n  if (noteType === 'star') {\n    applyColor(ctx, styles.colors.lines.star);\n  } else if (noteType === 'freestyle' || noteType === 'rap') {\n    applyColor(ctx, styles.colors.lines.freestyle);\n  } else {\n    applyColor(ctx, styles.colors.lines.normal);\n  }\n\n  ctx.shadowBlur = 10;\n  ctx.shadowColor = 'rgb(31,31,31)';\n  ctx.shadowOffsetX = 0;\n  ctx.shadowOffsetY = 0;\n  roundRect(ctx!, x, y, width, height, 100, true, true, 0.075);\n\n  ctx.shadowBlur = 0;\n  ctx.shadowOffsetX = 0;\n  ctx.shadowOffsetY = 0;\n}\n","import applyColor from 'Scenes/Game/Singing/GameOverlay/Drawing/applyColor';\nimport roundRect from 'Scenes/Game/Singing/GameOverlay/Drawing/Elements/roundRect';\nimport * as test from 'Scenes/Game/Singing/GameOverlay/Drawing/Elements/utils/getNoteColor';\n\nexport default function drawRawPlayerNote(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  playerNumber: number,\n  isHit: boolean,\n  isPerfect: boolean,\n  isStar: boolean,\n) {\n  applyColor(ctx, test.getColor(ctx, playerNumber, isStar, isHit, isPerfect));\n\n  ctx.shadowBlur = 5;\n  ctx.shadowColor = 'rgba(31,31,31, .7)';\n  ctx.shadowOffsetX = 1;\n  ctx.shadowOffsetY = 1;\n  roundRect(ctx!, x, y, width, height, 100, true, true, isHit ? 0.15 : 0);\n  ctx.shadowBlur = 0;\n  ctx.shadowOffsetX = 0;\n  ctx.shadowOffsetY = 0;\n}\n","import { BIG_NOTE_HEIGHT, NOTE_HEIGHT } from 'Scenes/Game/Singing/GameOverlay/Drawing/calculateData';\nimport drawRawNote from 'Scenes/Game/Singing/GameOverlay/Drawing/Elements/Cache/Elements/note';\nimport drawRawPlayerNote from 'Scenes/Game/Singing/GameOverlay/Drawing/Elements/Cache/Elements/playerNote';\n\nconst SHADOW_PAD = 10;\n\nexport const smallNoteFragments = {\n  start: { x: 0, y: 0, w: NOTE_HEIGHT / 2 + SHADOW_PAD, h: NOTE_HEIGHT + SHADOW_PAD * 2 },\n  middle: { x: NOTE_HEIGHT / 2 + SHADOW_PAD, y: 0, w: 1, h: NOTE_HEIGHT + SHADOW_PAD * 2 },\n  end: {\n    x: NOTE_HEIGHT / 2 + 1 + SHADOW_PAD,\n    y: 0,\n    w: NOTE_HEIGHT / 2 + SHADOW_PAD,\n    h: NOTE_HEIGHT + SHADOW_PAD * 2,\n  },\n};\nexport const bigNoteFragments = {\n  start: { x: 0, y: 0, w: BIG_NOTE_HEIGHT / 2 + SHADOW_PAD, h: BIG_NOTE_HEIGHT + SHADOW_PAD * 2 },\n  middle: { x: BIG_NOTE_HEIGHT / 2 + SHADOW_PAD, y: 0, w: 1, h: BIG_NOTE_HEIGHT + SHADOW_PAD * 2 },\n  end: {\n    x: BIG_NOTE_HEIGHT / 2 + 1 + SHADOW_PAD,\n    y: 0,\n    w: BIG_NOTE_HEIGHT / 2 + SHADOW_PAD,\n    h: BIG_NOTE_HEIGHT + SHADOW_PAD * 2,\n  },\n};\n\nconst spriteMap = {\n  blueMiss: {\n    draw: (ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number) =>\n      drawRawPlayerNote(ctx, x, y, w, h, 0, false, false, false),\n    width: NOTE_HEIGHT + 1,\n    height: NOTE_HEIGHT,\n    padding: SHADOW_PAD,\n    fragments: smallNoteFragments,\n  },\n  blueHit: {\n    draw: (ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number) =>\n      drawRawPlayerNote(ctx, x, y, w, h, 0, true, false, false),\n    width: BIG_NOTE_HEIGHT + 1,\n    height: BIG_NOTE_HEIGHT,\n    padding: SHADOW_PAD,\n    fragments: bigNoteFragments,\n  },\n  bluePerfect: {\n    draw: (ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number) =>\n      drawRawPlayerNote(ctx, x, y, w, h, 0, true, true, false),\n    width: BIG_NOTE_HEIGHT + 1,\n    height: BIG_NOTE_HEIGHT,\n    padding: SHADOW_PAD,\n    fragments: bigNoteFragments,\n  },\n  blueStarMiss: {\n    draw: (ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number) =>\n      drawRawPlayerNote(ctx, x, y, w, h, 0, false, false, true),\n    width: NOTE_HEIGHT + 1,\n    height: NOTE_HEIGHT,\n    padding: SHADOW_PAD,\n    fragments: smallNoteFragments,\n  },\n  blueStarHit: {\n    draw: (ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number) =>\n      drawRawPlayerNote(ctx, x, y, w, h, 0, true, false, true),\n    width: BIG_NOTE_HEIGHT + 1,\n    height: BIG_NOTE_HEIGHT,\n    padding: SHADOW_PAD,\n    fragments: bigNoteFragments,\n  },\n  blueStarPerfect: {\n    draw: (ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number) =>\n      drawRawPlayerNote(ctx, x, y, w, h, 0, true, true, true),\n    width: BIG_NOTE_HEIGHT + 1,\n    height: BIG_NOTE_HEIGHT,\n    padding: SHADOW_PAD,\n    fragments: bigNoteFragments,\n  },\n  redMiss: {\n    draw: (ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number) =>\n      drawRawPlayerNote(ctx, x, y, w, h, 1, false, false, false),\n    width: NOTE_HEIGHT + 1,\n    height: NOTE_HEIGHT,\n    padding: SHADOW_PAD,\n    fragments: smallNoteFragments,\n  },\n  redHit: {\n    draw: (ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number) =>\n      drawRawPlayerNote(ctx, x, y, w, h, 1, true, false, false),\n    width: BIG_NOTE_HEIGHT + 1,\n    height: BIG_NOTE_HEIGHT,\n    padding: SHADOW_PAD,\n    fragments: bigNoteFragments,\n  },\n  redPerfect: {\n    draw: (ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number) =>\n      drawRawPlayerNote(ctx, x, y, w, h, 1, true, true, false),\n    width: BIG_NOTE_HEIGHT + 1,\n    height: BIG_NOTE_HEIGHT,\n    padding: SHADOW_PAD,\n    fragments: bigNoteFragments,\n  },\n  redStarMiss: {\n    draw: (ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number) =>\n      drawRawPlayerNote(ctx, x, y, w, h, 1, false, false, true),\n    width: NOTE_HEIGHT + 1,\n    height: NOTE_HEIGHT,\n    padding: SHADOW_PAD,\n    fragments: smallNoteFragments,\n  },\n  redStarHit: {\n    draw: (ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number) =>\n      drawRawPlayerNote(ctx, x, y, w, h, 1, true, false, true),\n    width: BIG_NOTE_HEIGHT + 1,\n    height: BIG_NOTE_HEIGHT,\n    padding: SHADOW_PAD,\n    fragments: bigNoteFragments,\n  },\n  redStarPerfect: {\n    draw: (ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number) =>\n      drawRawPlayerNote(ctx, x, y, w, h, 1, true, true, true),\n    width: BIG_NOTE_HEIGHT + 1,\n    height: BIG_NOTE_HEIGHT,\n    padding: SHADOW_PAD,\n    fragments: bigNoteFragments,\n  },\n  noteNormal: {\n    draw: (ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number) =>\n      drawRawNote(ctx, x, y, w, h, 'normal'),\n    width: BIG_NOTE_HEIGHT + 1,\n    height: BIG_NOTE_HEIGHT,\n    padding: SHADOW_PAD,\n    fragments: bigNoteFragments,\n  },\n  noteStar: {\n    draw: (ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number) =>\n      drawRawNote(ctx, x, y, w, h, 'star'),\n    width: BIG_NOTE_HEIGHT + 1,\n    height: BIG_NOTE_HEIGHT,\n    padding: SHADOW_PAD,\n    fragments: bigNoteFragments,\n  },\n  noteFreestyle: {\n    draw: (ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number) =>\n      drawRawNote(ctx, x, y, w, h, 'freestyle'),\n    width: BIG_NOTE_HEIGHT + 1,\n    height: BIG_NOTE_HEIGHT,\n    padding: SHADOW_PAD,\n    fragments: bigNoteFragments,\n  },\n  noteRap: {\n    draw: (ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number) =>\n      drawRawNote(ctx, x, y, w, h, 'rap'),\n    width: BIG_NOTE_HEIGHT + 1,\n    height: BIG_NOTE_HEIGHT,\n    padding: SHADOW_PAD,\n    fragments: bigNoteFragments,\n  },\n};\n\nexport type SpriteNames = keyof typeof spriteMap;\n\nexport default spriteMap;\n","// In tests this function is mocked so it creates node-canvas object\nexport default function createCanvas(w: number, h: number) {\n  const canvas = document.createElement('canvas');\n  canvas.width = w;\n  canvas.height = h;\n\n  return canvas;\n}\n","import { add } from 'lodash-es';\nimport spriteMap, {\n  smallNoteFragments,\n  SpriteNames,\n} from 'Scenes/Game/Singing/GameOverlay/Drawing/Elements/Cache/spriteMap';\nimport createCanvas from 'Scenes/Game/Singing/GameOverlay/Drawing/Elements/Cache/utils/createCanvas';\n\nconst maxWidth = Math.max(...Object.values(spriteMap).map((sprite) => sprite.padding * 2 + sprite.width));\nconst height = Object.values(spriteMap)\n  .map((sprite) => sprite.padding * 2 + sprite.height)\n  .reduce(add, 0);\n\nconst cachedCanvas = createCanvas(maxWidth, height);\nconst ctx = cachedCanvas.getContext('2d')!;\n\nlet currentHeight = 0;\nconst positions = Object.entries(spriteMap)\n  .map(([name, sprite]) => {\n    const pads = sprite.padding * 2;\n    const position = { name, x: 0, y: currentHeight, w: sprite.width + pads, h: sprite.height + pads };\n    currentHeight = currentHeight + sprite.height + pads;\n\n    return position;\n  })\n  .reduce(\n    (acc, position) => ({ ...acc, [position.name]: position }),\n    {} as Record<SpriteNames, { x: number; y: number; w: number; h: number }>,\n  );\n\ncurrentHeight = 0;\nObject.entries(spriteMap).forEach(([key, entry]) => {\n  entry.draw(ctx, entry.padding, currentHeight + entry.padding, entry.width, entry.height);\n  currentHeight = currentHeight + entry.padding * 2 + entry.height;\n});\n\nexport const getSprite = (sprite: SpriteNames, fragment: keyof typeof smallNoteFragments) => {\n  return {\n    canvas: cachedCanvas,\n    ctx,\n    x: positions[sprite].x + spriteMap[sprite].fragments[fragment].x,\n    y: positions[sprite].y + spriteMap[sprite].fragments[fragment].y,\n    w: spriteMap[sprite].fragments[fragment].w,\n    h: spriteMap[sprite].fragments[fragment].h,\n    padding: spriteMap[sprite].padding,\n  };\n};\n\nexport const drawSprite = (\n  destCtx: CanvasRenderingContext2D,\n  sprite: SpriteNames,\n  fragment: keyof typeof smallNoteFragments,\n  destX: number,\n  destY: number,\n  destW?: number,\n  destH?: number,\n  paddingWScale = 1,\n  paddingHScale = 1,\n) => {\n  const spriteData = getSprite(sprite, fragment);\n  const { canvas, w, h, y, x, padding } = spriteData;\n  const finalWPadding = padding * paddingWScale;\n  const finalHPadding = padding * paddingHScale;\n\n  destCtx.imageSmoothingEnabled = false;\n  destCtx.drawImage(canvas, x, y, w, h, destX - finalWPadding, destY - finalHPadding, destW ?? w, destH ?? h);\n  destCtx.imageSmoothingEnabled = true;\n\n  return spriteData;\n};\n","import { drawSprite, getSprite } from 'Scenes/Game/Singing/GameOverlay/Drawing/Elements/Cache/cachedSprites';\nimport { SpriteNames } from 'Scenes/Game/Singing/GameOverlay/Drawing/Elements/Cache/spriteMap';\n\nexport default function drawSpriteWithStartAndEnd(\n  ctx: CanvasRenderingContext2D,\n  spriteName: SpriteNames,\n  x: number,\n  y: number,\n  width: number,\n) {\n  const startData = getSprite(spriteName, 'start');\n\n  const actualWidth = Math.max(width, (startData.h - startData.padding * 2) / 2);\n\n  const widthScale = Math.min(1, actualWidth / 2 / (startData.w - startData.padding));\n  const endingsWidth = widthScale * startData.w;\n  const endingsSize = endingsWidth - startData.padding * widthScale;\n\n  const middleSize = actualWidth - 2 * endingsSize;\n\n  drawSprite(ctx, spriteName, 'start', x, y, endingsWidth, undefined, widthScale);\n  if (middleSize > 0) {\n    drawSprite(ctx, spriteName, 'middle', x + endingsWidth, y, middleSize, undefined, widthScale);\n  }\n  drawSprite(ctx, spriteName, 'end', x + middleSize + endingsWidth, y, endingsWidth, undefined, widthScale);\n}\n","import { Note } from 'interfaces';\nimport { capitalize } from 'lodash-es';\nimport { SpriteNames } from 'Scenes/Game/Singing/GameOverlay/Drawing/Elements/Cache/spriteMap';\nimport drawSpriteWithStartAndEnd from 'Scenes/Game/Singing/GameOverlay/Drawing/Elements/spriteWithStartAndEnd';\n\nconst getSpriteName = (noteType: Note['type']) => {\n  return `note${capitalize(noteType)}` as SpriteNames;\n};\n\nexport default function drawNote(ctx: CanvasRenderingContext2D, x: number, y: number, width: number, note: Note) {\n  const spriteName = getSpriteName(note.type);\n\n  drawSpriteWithStartAndEnd(ctx, spriteName, x, y, width);\n}\n","import { PlayerNote } from 'interfaces';\nimport roundRect from './roundRect';\n\nexport default function drawPlayerFrequencyTrace(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  playerNote: PlayerNote,\n) {\n  ctx.save();\n  roundRect(ctx, x, y, width, height, 100, false, false);\n  ctx.clip();\n\n  ctx.beginPath();\n  ctx.strokeStyle = 'rgba(255,255,255, .35)';\n  ctx.lineWidth = 3;\n  ctx.lineJoin = 'round';\n\n  ctx.moveTo(x, y + height / 2 - (playerNote.frequencyRecords[0].preciseDistance * height) / 3);\n  for (let i = 1; i < playerNote.frequencyRecords.length; i++) {\n    ctx.lineTo(\n      x + i * (width / (playerNote.frequencyRecords.length - 1)),\n      y + height / 2 - (playerNote.frequencyRecords[i].preciseDistance * height) / 3,\n    );\n  }\n  ctx.stroke();\n  ctx.closePath();\n\n  ctx.restore();\n  ctx.lineJoin = 'miter';\n}\n","import { PlayerNote } from 'interfaces';\nimport { SpriteNames } from 'Scenes/Game/Singing/GameOverlay/Drawing/Elements/Cache/spriteMap';\nimport drawSpriteWithStartAndEnd from 'Scenes/Game/Singing/GameOverlay/Drawing/Elements/spriteWithStartAndEnd';\n\nconst getSpriteName = (playerNumber: number, isHit: boolean, isPerfect: boolean, isStar: boolean) => {\n  let spriteName = playerNumber === 0 ? 'blue' : 'red';\n  if (isPerfect && isStar) {\n    spriteName = `${spriteName}StarPerfect`;\n  } else if (isPerfect) {\n    spriteName = `${spriteName}Perfect`;\n  } else if (isStar && isHit) {\n    spriteName = `${spriteName}StarHit`;\n  } else if (isHit) {\n    spriteName = `${spriteName}Hit`;\n  } else if (isStar && !isHit) {\n    spriteName = `${spriteName}StarMiss`;\n  } else {\n    spriteName = `${spriteName}Miss`;\n  }\n\n  return spriteName as SpriteNames;\n};\n\nexport default function drawPlayerNote(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  playerNumber: number,\n  isHit: boolean,\n  playerNote: PlayerNote,\n) {\n  const spriteName = getSpriteName(playerNumber, isHit, playerNote.isPerfect, playerNote.note.type === 'star');\n\n  drawSpriteWithStartAndEnd(ctx, spriteName, x, y, width);\n}\n","import Particle from './interfaces';\n\nclass ParticleManager {\n  private particles: Particle[] = [];\n  private lastTick = Date.now();\n\n  private getTimeDelta = (timeShift: number) => {\n    const currentTick = Date.now() - timeShift;\n    const delta = currentTick - this.lastTick;\n    this.lastTick = currentTick;\n\n    return delta;\n  };\n\n  public tick = (ctx: CanvasRenderingContext2D, canvas: HTMLCanvasElement, timeShift = 0) => {\n    const delta = this.getTimeDelta(timeShift);\n\n    this.particles.forEach((particle) => particle.tick(ctx, canvas, delta));\n\n    this.particles = this.particles.filter((particle) => !particle.finished);\n  };\n\n  public add = (particle: Particle) => this.particles.push(particle);\n}\n\nexport default new ParticleManager();\n","import debris from 'Scenes/Game/Singing/GameOverlay/Drawing/Elements/debris';\nimport spreadValue, { randomSign } from 'Scenes/Game/Singing/GameOverlay/Drawing/Particles/utils';\nimport Particle from '../interfaces';\n\nconst baseTtl = (50 / 60) * 1000;\nconst ttlSpread = (25 / 60) * 1000;\n\nconst initialWidth = 60;\n\nconst velocityModifier = 0.3;\n\nexport default class TriangleParticle implements Particle {\n  public finished = false;\n\n  private ttl;\n  private startingTtl;\n  private velocityX;\n  private velocityY;\n  private width;\n  private initialAngle;\n  private heightModifier;\n\n  constructor(private x: number, private y: number, private color: string, private delay: number) {\n    this.startingTtl = this.ttl = spreadValue(baseTtl, ttlSpread);\n    this.velocityX = spreadValue(0.5, velocityModifier) * randomSign(0.2);\n    this.velocityY = spreadValue(0.4, velocityModifier) * randomSign();\n    this.width = initialWidth;\n    this.initialAngle = 180 - Math.random() * 360;\n    this.heightModifier = 0.5 + Math.random() / 2;\n  }\n  public tick = (ctx: CanvasRenderingContext2D, canvas: HTMLCanvasElement, delta: number) => {\n    if (this.delay-- > 0) return;\n\n    const percentage = this.ttl / this.startingTtl;\n    const elapsedTicks = this.startingTtl - this.ttl;\n\n    const width = this.width * percentage;\n    const height = this.width * this.heightModifier * percentage;\n\n    const x = this.x - width / 2 + elapsedTicks * this.velocityX;\n    const y = this.y - height / 2 + elapsedTicks * this.velocityY;\n\n    debris(canvas, ctx, x, y, width, height, this.initialAngle + elapsedTicks, this.color, 0.8 * percentage);\n\n    this.velocityX = this.velocityX - 0.009;\n    this.velocityY = this.velocityY * 1.0075;\n    this.ttl = this.ttl - delta;\n    this.finished = this.ttl <= 0;\n  };\n}\n","import { Note } from 'interfaces';\nimport tinycolor from 'tinycolor2';\nimport ParticleManager from '../ParticleManager';\nimport Particle from '../interfaces';\nimport styles from '../styles';\nimport TriangleParticle from './Triangle';\n\nexport default class ExplodingNoteParticle implements Particle {\n  public finished = true;\n\n  constructor(\n    x: number,\n    y: number,\n    width: number,\n    playerNumber: number,\n    note: Note,\n    particleManager: typeof ParticleManager,\n  ) {\n    const color =\n      note.type === 'star'\n        ? styles.colors.players[playerNumber].star.fill\n        : styles.colors.players[playerNumber].perfect.fill;\n\n    const lightColor = tinycolor(color).lighten(15).toRgbString();\n    const darkColor = tinycolor(color).darken(15).toRgbString();\n\n    const density = width / 8;\n    for (let i = 0; i < density; i++) {\n      const rand = Math.random();\n      let finalColor = color;\n      if (rand > 0.66) finalColor = lightColor;\n      else if (rand > 0.33) finalColor = darkColor;\n\n      const finalY = y + 20 * (Math.random() - 0.5);\n\n      particleManager.add(new TriangleParticle(x + i * 5, finalY, finalColor, (density - i) / 10));\n    }\n  }\n  public tick = (ctx: CanvasRenderingContext2D, canvas: HTMLCanvasElement) => {};\n}\n","import { BIG_NOTE_HEIGHT } from 'Scenes/Game/Singing/GameOverlay/Drawing/calculateData';\nimport { Note } from 'interfaces';\nimport drawNote from '../Elements/note';\nimport Particle from '../interfaces';\n\nconst initialTtl = 200;\n\nexport default class FadeoutNote implements Particle {\n  public finished = false;\n  public ttl = initialTtl;\n\n  constructor(private x: number, private y: number, private width: number, private note: Note) {}\n\n  public tick = (ctx: CanvasRenderingContext2D, canvas: HTMLCanvasElement, delta: number) => {\n    const percentage = this.ttl / initialTtl;\n\n    ctx.save();\n    ctx.globalAlpha = percentage;\n    ctx.translate(0, BIG_NOTE_HEIGHT * (1 - percentage));\n\n    drawNote(ctx, this.x, this.y, this.width, this.note);\n\n    ctx.globalAlpha = 1;\n    ctx.restore();\n\n    this.ttl = this.ttl - delta;\n    this.finished = this.ttl <= 0;\n  };\n}\n","import ray from 'Scenes/Game/Singing/GameOverlay/Drawing/Elements/ray';\nimport Particle from '../interfaces';\n\nconst initialTtl = (50 / 60) * 1000;\nconst velocity = 0.05;\n\nconst WIDTH = 200;\nconst WIDTH_SPREAD = 4;\n\nconst pow = Math.pow;\n\nfunction easeOutQuart(x: number): number {\n  return 1 - pow(1 - x, 2);\n}\n\nexport default class RayParticle implements Particle {\n  public finished = false;\n\n  private ttl;\n  private velocityX;\n  private velocityY;\n  private maxWidth;\n\n  constructor(private x: number, private y: number, seed: number, widthModifier: number) {\n    this.ttl = initialTtl;\n    this.velocityX = velocity * Math.random() - velocity / 2;\n    this.velocityY = velocity * Math.random() - velocity / 2;\n    this.maxWidth = Math.min(0.1 + widthModifier, 1) * (Math.sin(seed / 70) * WIDTH_SPREAD + (WIDTH - WIDTH_SPREAD));\n  }\n  public tick = (ctx: CanvasRenderingContext2D, canvas: HTMLCanvasElement, delta: number) => {\n    const percentage = this.ttl / initialTtl;\n    let easing = easeOutQuart(1 - Math.min(1, (1 - percentage) * 6));\n\n    const mainRayWidth = (this.maxWidth * easing * 3) / 4;\n    const mainRayHeight = this.maxWidth * easing;\n\n    ray(canvas, ctx, this.x, this.y, mainRayWidth, mainRayHeight, 'white', easing * 0.35);\n\n    easing = easeOutQuart(percentage);\n\n    const width = (easing * this.maxWidth) / 4;\n    const height = (easing * this.maxWidth) / 4;\n\n    const x = this.x;\n    const y = this.y;\n\n    const elapsedTicks = initialTtl - this.ttl;\n\n    ctx.globalAlpha = easing * 0.2;\n    ray(\n      canvas,\n      ctx,\n      x + elapsedTicks * this.velocityX,\n      y + elapsedTicks * this.velocityY,\n      width,\n      height,\n      'white',\n      easing * 0.2,\n    );\n\n    this.ttl = this.ttl - delta;\n    this.finished = this.ttl <= 0;\n  };\n}\n","import Particle from '../interfaces';\n\nconst INTERVAL_PX = 20;\n\nexport default class VibratoParticle implements Particle {\n  public finished = false;\n  public ttl = (2 / 60) * 1000;\n\n  constructor(private x: number, private y: number, private w: number, private h: number, private seed: number) {}\n  public tick = (ctx: CanvasRenderingContext2D, canvas: HTMLCanvasElement, delta: number) => {\n    ctx.strokeStyle = 'rgba(255,255,255,.25)';\n    ctx.lineWidth = 2;\n\n    ctx.beginPath();\n\n    for (let i = 0; i < this.w; i++) {\n      const x = this.x + this.w - i;\n      const deltaY = (this.h / 2 + 2) * Math.sin(x / INTERVAL_PX + this.seed / 250);\n      ctx.lineTo(x, this.y + this.h / 2 + deltaY);\n    }\n\n    ctx.stroke();\n\n    ctx.beginPath();\n\n    for (let i = 0; i < this.w; i++) {\n      const x = this.x + this.w - i;\n      const deltaY = -1 * (this.h / 2 + 2) * Math.sin(x / INTERVAL_PX + this.seed / 250);\n      ctx.lineTo(x, this.y + this.h / 2 + deltaY);\n    }\n\n    ctx.stroke();\n\n    this.ttl = this.ttl - delta;\n    this.finished = this.ttl <= 0;\n  };\n}\n","import { captureException } from '@sentry/react';\nimport events from 'GameEvents/GameEvents';\nimport PlayersManager from 'Players/PlayersManager';\nimport getNoteColor from 'Scenes/Game/Singing/GameOverlay/Drawing/Elements/utils/getNoteColor';\nimport SungTriangle from 'Scenes/Game/Singing/GameOverlay/Drawing/Particles/SungTriangle';\nimport { Shaders } from 'Scenes/Game/Singing/GameOverlay/Drawing/Shaders/Shaders';\nimport { FPSCountSetting, GraphicSetting } from 'Scenes/Settings/SettingsState';\nimport isNotesSection from 'Songs/utils/isNotesSection';\nimport { noDistanceNoteTypes } from 'consts';\nimport { Note, NotesSection, PlayerNote } from 'interfaces';\nimport { randomFloat } from 'utils/randomValue';\nimport GameState from '../../GameState/GameState';\nimport getPlayerNoteDistance from '../../Helpers/getPlayerNoteDistance';\nimport debugPitches from './Elements/debugPitches';\nimport drawNote from './Elements/note';\nimport drawPlayerFrequencyTrace from './Elements/playerFrequencyTrace';\nimport drawPlayerNote from './Elements/playerNote';\nimport ParticleManager from './ParticleManager';\nimport ExplodingNoteParticle from './Particles/ExplodingNote';\nimport FadeoutNote from './Particles/FadeoutNote';\nimport RayParticle from './Particles/Ray';\nimport VibratoParticle from './Particles/Vibrato';\nimport calculateData, { BIG_NOTE_HEIGHT, DrawingData, NOTE_HEIGHT, pitchPadding } from './calculateData';\n\nconst MAX_LOOKUP_RANGE = 20;\nfunction getPlayerNoteAtBeat(playerNotes: PlayerNote[], beat: number) {\n  return playerNotes.find((note) => note.start <= beat && note.start + note.length >= beat);\n}\n\nexport default class CanvasDrawing {\n  private loop = false;\n  private pauseTime = 0;\n  private pausedOn = 0;\n\n  public constructor(\n    private canvas: HTMLCanvasElement,\n    private verticalMargin: number = 0,\n    private scaleFactor: number = 1,\n  ) {}\n\n  private shaders: Shaders | null = null;\n  public start = () => {\n    events.sectionChange.subscribe(this.onSectionEnd);\n    this.loop = true;\n\n    this.drawFrame();\n\n    if (GraphicSetting.get() === 'high') {\n      try {\n        this.shaders = new Shaders(this.canvas);\n      } catch (e) {\n        captureException(e);\n      }\n    }\n  };\n\n  public pause = () => {\n    this.end();\n    this.pausedOn = Date.now();\n  };\n\n  public resume = () => {\n    this.pauseTime += Date.now() - this.pausedOn;\n    this.start();\n  };\n\n  public end = () => {\n    this.loop = false;\n\n    this.shaders?.cleanup();\n    events.sectionChange.unsubscribe(this.onSectionEnd);\n  };\n\n  public isPlaying = () => this.loop;\n\n  public drawFrame = () => {\n    const startTime = Date.now();\n    const ctx = this.canvas.getContext('2d');\n    if (!ctx) return;\n\n    if (GameState.isPlaying()) {\n      ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n\n      const players = PlayersManager.getPlayers();\n      players.forEach((player, index) => {\n        this.drawPlayer(player.number, ctx);\n      });\n\n      ParticleManager.tick(ctx, this.canvas, this.pauseTime);\n    }\n\n    if (FPSCountSetting.get() === 30) {\n      const endTime = Date.now();\n      const baseTimeout = 1000 / 30;\n      const finalTimeout = endTime - startTime > baseTimeout ? baseTimeout : baseTimeout - (endTime - startTime);\n      if (this.loop) setTimeout(this.drawFrame, finalTimeout, FPSCountSetting.get());\n    }\n    if (FPSCountSetting.get() !== 30) {\n      if (this.loop) window.requestAnimationFrame(this.drawFrame);\n    }\n  };\n\n  private drawPlayer = (playerNumber: number, ctx: CanvasRenderingContext2D) => {\n    const drawingData = this.getDrawingData(playerNumber);\n    const { currentSection } = calculateData(drawingData);\n\n    if (GraphicSetting.get() === 'high') {\n      this.setDistortionForce(drawingData);\n    }\n\n    if (!isNotesSection(currentSection)) return;\n\n    const displacements = this.calculateDisplacements(currentSection, drawingData);\n\n    this.drawNotesToSing(ctx, drawingData, displacements);\n    this.drawSungNotes(ctx, drawingData, displacements);\n\n    if (GraphicSetting.get() === 'high') {\n      this.drawFlare(ctx, drawingData, displacements);\n    }\n\n    false && debugPitches(ctx!, drawingData);\n  };\n\n  private setDistortionForce = (drawingData: DrawingData) => {\n    const currentSection = drawingData.currentSection;\n\n    if (!isNotesSection(currentSection)) {\n      this.shaders?.updatePlayerForce(\n        drawingData.playerNumber,\n        (this.shaders?.getPlayerForce(drawingData.playerNumber) ?? 0) * 0.99,\n      );\n    } else {\n      const max = Math.max(0, drawingData.currentBeat - MAX_LOOKUP_RANGE);\n\n      const sungNotes = drawingData.currentPlayerNotes\n        .filter((note) => note.note.start + note.note.length >= max)\n        .filter((note) => getPlayerNoteDistance(note) === 0)\n        .reduce((curr, note) => curr + note.length - Math.max(0, max - note.start), 0);\n\n      const lastPlayerNote = drawingData.currentPlayerNotes.at(-1);\n      const lastPlayerNoteEnd = (lastPlayerNote?.start ?? 0) + (lastPlayerNote?.length ?? 0);\n      const beatsSinceLastHit = drawingData.currentBeat - lastPlayerNoteEnd;\n\n      const forcePercent = Math.max(\n        Math.min(Math.pow((sungNotes - beatsSinceLastHit / 1.5) / MAX_LOOKUP_RANGE, 3), 0.98),\n        0,\n      );\n      this.shaders?.updatePlayerForce(drawingData.playerNumber, forcePercent);\n    }\n  };\n\n  private drawNotesToSing = (\n    ctx: CanvasRenderingContext2D,\n    drawingData: DrawingData,\n    displacements: Record<number, [number, number]>,\n  ) => {\n    if (!isNotesSection(drawingData.currentSection)) return;\n\n    drawingData.currentSection.notes.forEach((note) => {\n      const { x, y, w, h } = this.getNoteCoords(drawingData, note, note.pitch, true, displacements[note.start]);\n\n      drawNote(ctx, x, y, w, note);\n    });\n  };\n\n  private drawSungNotes = (\n    ctx: CanvasRenderingContext2D,\n    drawingData: DrawingData,\n    displacements: Record<number, [number, number]>,\n  ) => {\n    if (!isNotesSection(drawingData.currentSection)) return;\n\n    drawingData.currentPlayerNotes.forEach((playerNote) => {\n      const distance = getPlayerNoteDistance(playerNote);\n\n      const { x, y, w, h } = this.getNoteCoords(\n        drawingData,\n        playerNote,\n        playerNote.note.pitch + distance,\n        distance === 0,\n        displacements[playerNote.note.start],\n      );\n      if (distance > 0 || w > h / 2.5) {\n        drawPlayerNote(ctx, x, y, w, drawingData.playerNumber, distance === 0, playerNote);\n\n        if (playerNote.vibrato) {\n          ParticleManager.add(new VibratoParticle(x, y, w, h, drawingData.currentTime));\n        }\n\n        if (\n          distance === 0 &&\n          playerNote.frequencyRecords.length > 3 &&\n          !noDistanceNoteTypes.includes(playerNote.note.type)\n        ) {\n          drawPlayerFrequencyTrace(ctx, x, y, w, h, playerNote);\n        }\n      }\n    });\n  };\n\n  private drawFlare = (\n    ctx: CanvasRenderingContext2D,\n    drawingData: DrawingData,\n    displacements: Record<number, [number, number]>,\n  ) => {\n    if (!isNotesSection(drawingData.currentSection)) return;\n\n    const lastNote = getPlayerNoteAtBeat(\n      drawingData.currentPlayerNotes,\n      drawingData.currentBeat - 185 / drawingData.songBeatLength,\n    );\n\n    if (lastNote && lastNote.distance === 0) {\n      const displacement = displacements[lastNote.note.start] || [0, 0];\n\n      const { x, y, w, h } = this.getNoteCoords(drawingData, lastNote, lastNote.note.pitch, true, displacement);\n      const preciseDistance = noDistanceNoteTypes.includes(lastNote.note.type)\n        ? 0\n        : lastNote.frequencyRecords.at(-1)!.preciseDistance;\n\n      const finalX = x + w;\n      const finalY = this.getPreciseY(y, h, preciseDistance);\n\n      ParticleManager.add(new RayParticle(finalX, finalY, drawingData.currentTime, 1));\n\n      ParticleManager.add(\n        new SungTriangle(\n          randomFloat(Math.max(x, finalX - 50), finalX),\n          finalY,\n          getNoteColor(ctx, drawingData.playerNumber, true, lastNote).fill,\n        ),\n      );\n\n      this.shaders?.updatePlayerCenter(drawingData.playerNumber, finalX, finalY);\n    }\n  };\n\n  private onSectionEnd = (playerNumber: number) => {\n    if (GameState.isPlaying()) {\n      const drawingData = this.getDrawingData(playerNumber, -1);\n      if (!isNotesSection(drawingData.currentSection)) return;\n\n      this.fadeoutNotes(drawingData.currentSection, drawingData);\n      this.explodeNotes(drawingData.currentSection, drawingData);\n    }\n  };\n\n  private fadeoutNotes = (section: NotesSection, drawingData: DrawingData) => {\n    if (GraphicSetting.get() === 'high') {\n      section.notes.forEach((note) => {\n        const { x, y, w, h } = this.getNoteCoords(drawingData, note, note.pitch, true);\n\n        ParticleManager.add(new FadeoutNote(x, y, w, note));\n      });\n    }\n  };\n\n  private explodeNotes = (section: NotesSection, drawingData: DrawingData) => {\n    if (GraphicSetting.get() === 'high') {\n      const notesToExplode = drawingData.playerNotes.filter(\n        (note) =>\n          (note.distance === 0 || noDistanceNoteTypes.includes(note.note.type)) && section.notes.includes(note.note),\n      );\n\n      notesToExplode.forEach((note) => {\n        const { x, y, w, h } = this.getNoteCoords(drawingData, note, note.note.pitch, true);\n        ParticleManager.add(\n          new ExplodingNoteParticle(x, y + h / 2, w, drawingData.playerNumber, note.note, ParticleManager),\n        );\n      });\n    }\n  };\n\n  private calculateDisplacements = (currentSection: NotesSection, drawingData: DrawingData) => {\n    const displacements: Record<number, [number, number]> = {};\n\n    if (GraphicSetting.get() === 'high') {\n      currentSection.notes.forEach((note) => {\n        const sungNotesStreak = drawingData.playerNotes\n          .filter((sungNote) => sungNote.note.start === note.start)\n          .filter(\n            (sungNote) =>\n              sungNote.note.start + sungNote.note.length + 30 >= drawingData.currentBeat && sungNote.distance === 0,\n          )\n          .map((sungNote) =>\n            sungNote.start + 30 < drawingData.currentBeat\n              ? sungNote.length - (drawingData.currentBeat - 30 - sungNote.start)\n              : sungNote.length,\n          )\n          .reduce((currLength, sungNoteLength) => Math.min(currLength + sungNoteLength, 30), 0);\n\n        const displacementRange = Math.max(0, (sungNotesStreak - 5) / (note.type === 'star' ? 3 : 5));\n        const displacementX = (Math.random() - 0.5) * displacementRange;\n        const displacementY = (Math.random() - 0.5) * displacementRange;\n\n        displacements[note.start] = [displacementX, displacementY];\n      });\n    } else {\n      currentSection.notes.forEach((note) => {\n        displacements[note.start] = [0, 0];\n      });\n    }\n\n    return displacements;\n  };\n\n  private getDrawingData = (playerNumber: number, sectionShift = 0): DrawingData => {\n    const players = PlayersManager.getPlayers();\n    const playerIndex = players.findIndex((player) => player.number === playerNumber);\n    const playerCount = players.length;\n\n    const playerState = GameState.getPlayer(playerNumber)!;\n    const currentSectionIndex = playerState.getCurrentSectionIndex() + sectionShift ?? 0;\n    const song = GameState.getSong()!;\n    const track = playerState.getTrackIndex();\n    const currentSection = song.tracks[track].sections[currentSectionIndex];\n    const playerNotes = playerState.getPlayerNotes();\n\n    return {\n      playerNumber,\n      playerIndex,\n      playerCount,\n      song,\n      songBeatLength: GameState.getSongBeatLength(),\n      minPitch: playerState.getMinPitch(),\n      maxPitch: playerState.getMaxPitch(),\n      canvas: this.canvas,\n      currentTime: GameState.getCurrentTime(),\n      frequencies: playerState.getPlayerFrequencies(),\n      playerNotes,\n      currentPlayerNotes: playerNotes.filter((note) => note.note.start >= (currentSection?.start ?? Infinity)),\n      track: playerState.getTrackIndex(),\n      currentBeat: GameState.getCurrentBeat(),\n      currentSectionIndex,\n      currentSection,\n      paddingVertical: this.verticalMargin,\n    };\n  };\n\n  private getNoteCoords = (\n    drawingData: DrawingData,\n    { start, length }: Pick<Note, 'start' | 'length'>,\n    pitch: number,\n    big: boolean,\n    displacement: [number, number] = [0, 0],\n  ) => {\n    const { sectionEndBeat, currentSection, playerCanvas, pitchStepHeight } = calculateData(drawingData);\n\n    const sectionStart = isNotesSection(currentSection) ? currentSection.notes[0].start : 1;\n\n    const beatLength = playerCanvas.width / (sectionEndBeat - sectionStart);\n\n    const [dx, dy] = big ? displacement : [0, 0];\n    const pitchY = pitchStepHeight * (drawingData.maxPitch - pitch + pitchPadding);\n\n    return {\n      x: Math.floor(playerCanvas.baseX + beatLength * (start - sectionStart) + dx),\n      y: Math.floor(playerCanvas.baseY + 10 + pitchY + dy - (big ? 3 : 0)),\n      w: Math.floor(beatLength * length),\n      h: big ? BIG_NOTE_HEIGHT : NOTE_HEIGHT,\n    };\n  };\n\n  private getPreciseY = (y: number, h: number, preciseDistance: number) => y + h / 2 - (preciseDistance * h) / 3;\n}\n","export default \"precision mediump float;\\n\\nconst float MAX_FORCE = 300.0;\\nconst int SAMPLE_COUNT = 8; // 2^x\\nconst float INTENSITY = 0.051;\\n// get our varyings\\nvarying vec3 vVertexPosition;\\nvarying vec2 vTextureCoord;\\n// the uniform we declared inside our javascript\\nuniform float uTime;\\nuniform sampler2D planeTexture;\\nuniform vec2 uResolution;\\n\\nuniform vec2 uP0center;\\nuniform float uP0force;\\n\\nuniform vec2 uP1center;\\nuniform float uP1force;\\n\\nfloat rnd(float n) {\\n    return fract(sin(n) * 43758.5453);\\n}\\nfloat random (vec2 st) {\\n    return rnd(dot(st.xy, vec2(12.9898, 78.233)));\\n}\\n\\nvec4 directionalBlur(in vec2 uv, in vec2 direction, in float intensity)\\n{\\n    vec4 color = vec4(0.0);\\n\\n    for (int i=1; i<=SAMPLE_COUNT; i++)\\n    {\\n        color += texture2D(planeTexture,uv+float(i)*intensity/float(SAMPLE_COUNT)*direction);\\n    }\\n\\n    return color/float(SAMPLE_COUNT);\\n}\\n\\nfloat distort(vec2 center, float force, float comparedIntensity) {\\n    float actualForce = force * MAX_FORCE;\\n    vec2 centerAbs = center * uResolution;\\n\\n    vec2 direction = gl_FragCoord.xy - centerAbs.xy;\\n    float dist = length(direction) / length(uResolution);\\n\\n\\n    float intensity = max(0.0, 0.50 - dist) * INTENSITY * pow(force, 1.5);\\n    if (intensity > comparedIntensity) {\\n        vec4 newColor = directionalBlur(gl_FragCoord.xy / uResolution, normalize(direction), intensity);\\n        gl_FragColor = newColor;\\n    }\\n    return intensity;\\n}\\n\\nvoid main() {\\n    gl_FragColor = texture2D(planeTexture, vTextureCoord);\\n    float p1intensity = distort(uP0center, uP0force, 0.0);\\n    float p2intensity = distort(uP1center, uP1force, p1intensity);\\n}\"","export default \"\\nprecision mediump float;\\n\\n// default mandatory variables\\nattribute vec3 aVertexPosition;\\nattribute vec2 aTextureCoord;\\n\\nuniform mat4 uMVMatrix;\\nuniform mat4 uPMatrix;\\n\\nuniform mat4 planeTextureMatrix;\\n\\n// custom varyings\\nvarying vec3 vVertexPosition;\\nvarying vec2 vTextureCoord;\\n\\nvoid main() {\\n    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\\n\\n    // varyings\\n    vVertexPosition = aVertexPosition;\\n    vTextureCoord = (planeTextureMatrix * vec4(aTextureCoord, 0.0, 1.0)).xy;\\n}\"","import styled from '@emotion/styled';\nimport { VideoPlayerRef, VideoState } from 'Elements/VideoPlayer';\nimport PlayersManager from 'Players/PlayersManager';\nimport SkipIntro from 'Scenes/Game/Singing/GameOverlay/Components/SkipIntro';\nimport SkipOutro from 'Scenes/Game/Singing/GameOverlay/Components/SkipOutro';\nimport { GraphicSetting, MobilePhoneModeSetting, useSettingValue } from 'Scenes/Settings/SettingsState';\nimport { GAME_MODE, PlayerSetup, Song } from 'interfaces';\nimport { useEffect, useRef } from 'react';\nimport GameState from '../GameState/GameState';\nimport DurationBar from './Components/DurationBar';\nimport Lyrics from './Components/Lyrics';\nimport ScoreText from './Components/ScoreText';\nimport CanvasDrawing from './Drawing';\n\nimport fragShader from 'Scenes/Game/Singing/GameOverlay/Drawing/Shaders/shader.frag?raw';\nimport vertShader from 'Scenes/Game/Singing/GameOverlay/Drawing/Shaders/shader.vert?raw';\n\ninterface Props {\n  song: Song;\n  currentStatus: VideoState;\n  width: number;\n  height: number;\n  onSongEnd: () => void;\n  playerSetups: PlayerSetup[];\n  duration: number;\n  effectsEnabled: boolean;\n  playerChanges: number[][];\n  videoPlayerRef: VideoPlayerRef | null;\n  isPauseMenuVisible: boolean;\n}\n\nconst MAX_RENDER_RESOLUTION_W = 1920;\n\nfunction GameOverlay({\n  currentStatus,\n  width,\n  height,\n  playerSetups,\n  onSongEnd,\n  playerChanges,\n  effectsEnabled,\n  videoPlayerRef,\n  isPauseMenuVisible,\n}: Props) {\n  const [graphicLevel] = useSettingValue(GraphicSetting);\n  const [mobilePhoneMode] = useSettingValue(MobilePhoneModeSetting);\n  const canvas = useRef<HTMLCanvasElement | null>(null);\n  const drawer = useRef<CanvasDrawing | null>(null);\n  const lyrics = useRef<HTMLDivElement | null>(null);\n\n  useEffect(() => {\n    GameState.startInputMonitoring();\n\n    return () => {\n      GameState.stopInputMonitoring();\n    };\n  }, []);\n\n  const overlayWidth = MAX_RENDER_RESOLUTION_W;\n  const overlayHeight = overlayWidth * (height / width);\n\n  const overlayScaleFactor = overlayHeight / height;\n  // const resolutionScaleFactor = overlayWidth / MAX_RENDER_RESOLUTION_W;\n\n  useEffect(() => {\n    if (!canvas.current || !lyrics.current) return;\n\n    drawer.current = new CanvasDrawing(\n      canvas.current,\n      lyrics.current.offsetHeight * overlayScaleFactor,\n      // resolutionScaleFactor,\n    );\n    drawer.current.start();\n\n    return () => {\n      drawer.current?.end();\n    };\n  }, [canvas.current, lyrics.current?.offsetHeight, overlayScaleFactor]);\n\n  useEffect(() => {\n    if (isPauseMenuVisible && drawer.current?.isPlaying()) {\n      drawer.current?.pause();\n    } else if (!isPauseMenuVisible && !drawer.current?.isPlaying()) {\n      drawer.current?.resume();\n    }\n  }, [isPauseMenuVisible]);\n\n  useEffect(() => {\n    if (currentStatus === VideoState.ENDED && onSongEnd) {\n      onSongEnd();\n    }\n  }, [currentStatus, onSongEnd]);\n\n  const players = PlayersManager.getPlayers();\n  const showMultipleLines = !mobilePhoneMode && players.length === 2;\n\n  return (\n    <Screen>\n      {graphicLevel === 'high' && (\n        <>\n          <script type={'x-shader/x-fragment'} id={'plane-fs'}>\n            {fragShader}\n          </script>\n          <script id=\"plane-vs\" type=\"x-shader/x-vertex\">\n            {vertShader}\n          </script>\n          <Curtains id=\"canvas\" style={{ zIndex: 10000 }} />\n        </>\n      )}\n      <GameCanvas id=\"plane\">\n        <canvas ref={canvas} width={overlayWidth} height={overlayHeight} data-sampler=\"planeTexture\" />\n      </GameCanvas>\n      {effectsEnabled && (\n        <>\n          <SkipIntro playerRef={videoPlayerRef} isEnabled={!isPauseMenuVisible} />\n          <SkipOutro onSongEnd={onSongEnd} isEnabled={!isPauseMenuVisible} />\n        </>\n      )}\n      <DurationBar players={playerSetups} />\n      {showMultipleLines && (\n        <Lyrics player={players[0]} playerChanges={playerChanges} effectsEnabled={effectsEnabled} />\n      )}\n      <Scores>\n        {effectsEnabled && (\n          <>\n            {GameState.getSingSetup()?.mode === GAME_MODE.CO_OP ? (\n              <span data-test=\"players-score\" data-score={GameState.getPlayerScore(0)}>\n                <ScoreText score={GameState.getPlayerScore(0)} />\n              </span>\n            ) : (\n              PlayersManager.getPlayers().map((player) => (\n                <span\n                  key={player.number}\n                  data-test={`player-${player.number}-score`}\n                  data-score={GameState.getPlayerScore(player.number)}>\n                  <ScoreText score={GameState.getPlayerScore(player.number)} />\n                </span>\n              ))\n            )}\n          </>\n        )}\n      </Scores>\n      <div ref={lyrics}>\n        <Lyrics\n          player={players[showMultipleLines ? 1 : 0]}\n          playerChanges={playerChanges}\n          bottom\n          effectsEnabled={effectsEnabled}\n        />\n      </div>\n    </Screen>\n  );\n}\n\nexport default GameOverlay;\n\nconst Screen = styled.div`\n  height: 100%;\n  color: white;\n  -webkit-text-stroke: 0.2rem black;\n  font-weight: bold;\n  position: relative;\n  display: flex;\n  flex-direction: column;\n`;\n\nconst GameCanvas = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n\n  canvas {\n    width: 100%;\n    height: 100%;\n  }\n`;\n\nconst Curtains = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n`;\n\nconst Scores = styled.div`\n  flex: 1;\n  height: 100%;\n  box-sizing: border-box;\n  font-size: 5.5rem;\n  display: flex;\n  justify-content: center;\n  gap: 4rem;\n  padding-right: 4rem;\n  flex-direction: column;\n  text-align: right;\n  z-index: 1;\n`;\n","import { PlayerSetup, seconds, SingSetup, Song } from 'interfaces';\nimport {\n  ComponentProps,\n  ForwardedRef,\n  forwardRef,\n  MutableRefObject,\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\n\nimport styled from '@emotion/styled';\nimport VideoPlayer, { VideoPlayerRef, VideoState } from 'Elements/VideoPlayer';\nimport useKeyboard from 'hooks/useKeyboard';\nimport useKeyboardHelp from 'hooks/useKeyboardHelp';\nimport usePrevious from 'hooks/usePrevious';\nimport { FPSCountSetting, InputLagSetting, useSettingValue } from 'Scenes/Settings/SettingsState';\nimport PauseMenu from './GameOverlay/Components/PauseMenu';\nimport GameOverlay from './GameOverlay/GameOverlay';\nimport GameState from './GameState/GameState';\n\ninterface Props extends ComponentProps<typeof Container> {\n  singSetup: SingSetup;\n  song: Song;\n  width: number;\n  height: number;\n  autoplay?: boolean;\n  showControls?: boolean;\n  onCurrentTimeUpdate?: (newTime: number) => void;\n  onSongEnd: () => void;\n  onStatusChange?: (status: VideoState) => void;\n  players: PlayerSetup[];\n  playerChanges?: number[][];\n\n  effectsEnabled?: boolean;\n  restartSong?: () => void;\n}\n\nexport interface PlayerRef {\n  play: () => void;\n  pause: () => void;\n  seekTo: (time: number) => void;\n  setPlaybackSpeed: (speed: number) => void;\n}\n\nfunction usePlayerSetDuration(playerRef: MutableRefObject<VideoPlayerRef | null>, currentStatus: VideoState) {\n  const [duration, setDuration] = useState(0);\n  useEffect(() => {\n    if (playerRef.current && currentStatus === VideoState.PLAYING && duration === 0) {\n      playerRef.current.getDuration().then((dur: number) => {\n        setDuration(dur);\n        GameState.setDuration(dur);\n      });\n    }\n  }, [duration, playerRef, currentStatus]);\n\n  return duration;\n}\n\nfunction Player(\n  {\n    song,\n    width,\n    height,\n    autoplay = true,\n    showControls = false,\n    onCurrentTimeUpdate,\n    onSongEnd,\n    onStatusChange,\n    players,\n    playerChanges = [[], []],\n    effectsEnabled = true,\n    singSetup,\n    restartSong,\n    ...restProps\n  }: Props,\n  ref: ForwardedRef<PlayerRef>,\n) {\n  const player = useRef<VideoPlayerRef | null>(null);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [currentStatus, setCurrentStatus] = useState(VideoState.UNSTARTED);\n  const [inputLag] = useSettingValue(InputLagSetting);\n  const [pauseMenu, setPauseMenu] = useState(false);\n\n  useEffect(() => {\n    GameState.setSong(song);\n    GameState.setSingSetup(singSetup);\n\n    return () => {\n      GameState.resetSingSetup();\n    };\n  }, [song, singSetup]);\n\n  useEffect(() => {\n    if (!player.current) {\n      return;\n    }\n    if (currentStatus === VideoState.PLAYING) {\n      const interval = setInterval(async () => {\n        if (!player.current) return;\n\n        const time = Math.max(0, (await player.current.getCurrentTime()) * 1000 - inputLag);\n        setCurrentTime(time);\n        onCurrentTimeUpdate?.(time);\n        GameState.setCurrentTime(time);\n        GameState.update();\n      }, 1000 / FPSCountSetting.get());\n\n      return () => clearInterval(interval);\n    }\n  }, [player, onCurrentTimeUpdate, currentStatus, inputLag]);\n\n  const duration = usePlayerSetDuration(player, currentStatus);\n\n  useImperativeHandle(ref, () => ({\n    seekTo: (time: seconds) => player.current!.seekTo(time),\n    setPlaybackSpeed: (speed: number) => player.current!.setPlaybackSpeed(speed),\n    play: () => player.current!.playVideo(),\n    pause: () => player.current!.pauseVideo(),\n  }));\n\n  const onStateChangeCallback = useCallback(\n    (state: VideoState) => {\n      setCurrentStatus(state);\n      onStatusChange?.(state);\n    },\n    [setCurrentStatus, onStatusChange],\n  );\n\n  const isPauseMenuAvailable = effectsEnabled && onSongEnd !== undefined;\n\n  const openPauseMenu = () => {\n    setPauseMenu(true);\n    player.current?.pauseVideo();\n  };\n\n  const closePauseMenu = () => {\n    setPauseMenu(false);\n    player.current?.playVideo();\n  };\n\n  const togglePauseMenu = () => {\n    if (pauseMenu) {\n      closePauseMenu();\n    } else {\n      openPauseMenu();\n    }\n  };\n  const previousStatus = usePrevious(currentStatus);\n  useEffect(() => {\n    if (!isPauseMenuAvailable) return;\n\n    const wasJustPaused =\n      previousStatus !== VideoState.PAUSED &&\n      previousStatus !== VideoState.BUFFERING &&\n      currentStatus === VideoState.PAUSED;\n\n    if (currentStatus === VideoState.PLAYING && pauseMenu) {\n      player.current?.pauseVideo();\n    } else if (wasJustPaused && !pauseMenu) {\n      // Someone clicked on the video\n      setPauseMenu(true);\n    }\n  }, [pauseMenu, currentStatus, previousStatus, isPauseMenuAvailable]);\n\n  useKeyboard(\n    {\n      back: togglePauseMenu,\n    },\n    isPauseMenuAvailable,\n    [pauseMenu],\n  );\n\n  const help = useMemo(\n    () => ({\n      back: 'Pause Menu',\n    }),\n    [],\n  );\n  useKeyboardHelp(help, effectsEnabled);\n  return (\n    <Container {...restProps}>\n      {pauseMenu && <PauseMenu onExit={onSongEnd} onResume={closePauseMenu} onRestart={restartSong!} />}\n      {currentStatus !== VideoState.UNSTARTED && (\n        <Overlay\n          style={{\n            width: `${width}px`,\n            height: `${height}px`,\n          }}>\n          <GameOverlay\n            isPauseMenuVisible={pauseMenu}\n            effectsEnabled={effectsEnabled}\n            playerChanges={playerChanges}\n            duration={duration}\n            currentStatus={currentStatus}\n            song={song}\n            width={width}\n            height={height}\n            onSongEnd={onSongEnd}\n            playerSetups={players}\n            videoPlayerRef={player.current}\n          />\n        </Overlay>\n      )}\n      <PlayerContainer>\n        <VideoPlayer\n          ref={player}\n          video={song.video}\n          width={width}\n          height={height}\n          controls={showControls}\n          autoplay={autoplay}\n          disablekb={process.env.NODE_ENV !== 'development'}\n          volume={song.volume}\n          startAt={song.videoGap ?? 0}\n          onStateChange={onStateChangeCallback}\n        />\n      </PlayerContainer>\n    </Container>\n  );\n}\n\nconst Container = styled.div`\n  position: relative;\n`;\n\nconst Overlay = styled.div`\n  position: absolute;\n  z-index: 1;\n  background-color: rgba(0, 0, 0, 0.2);\n  pointer-events: none;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n`;\n\nconst PlayerContainer = styled.div`\n  overflow: hidden;\n  height: 100%;\n`;\n\nexport default forwardRef(Player);\n","import styled from '@emotion/styled';\nimport { Box, Grid, Typography } from '@mui/material';\nimport AdjustPlayback from 'Scenes/Convert/Steps/SyncLyricsToVideo/Components/AdjustPlayback';\nimport EditSection, { ChangeRecord } from 'Scenes/Convert/Steps/SyncLyricsToVideo/Components/EditSection';\nimport ListTracks from 'Scenes/Convert/Steps/SyncLyricsToVideo/Components/ListTracks';\nimport ManipulateBpm from 'Scenes/Convert/Steps/SyncLyricsToVideo/Components/ManipulateBpm';\nimport ShiftGap from 'Scenes/Convert/Steps/SyncLyricsToVideo/Components/ShiftGap';\nimport ShiftVideoGap from 'Scenes/Convert/Steps/SyncLyricsToVideo/Components/ShiftVideoGap';\nimport addHeadstart from 'Scenes/Convert/Steps/SyncLyricsToVideo/Helpers/addHeadstart';\nimport normaliseGap from 'Scenes/Convert/Steps/SyncLyricsToVideo/Helpers/normaliseGap';\nimport normaliseLyricSpaces from 'Scenes/Convert/Steps/SyncLyricsToVideo/Helpers/normaliseLyricSpaces';\nimport normaliseSectionPaddings from 'Scenes/Convert/Steps/SyncLyricsToVideo/Helpers/normaliseSectionPaddings';\nimport Player, { PlayerRef } from 'Scenes/Game/Singing/Player';\nimport getSongBeatLength from 'Songs/utils/getSongBeatLength';\nimport isNotesSection from 'Songs/utils/isNotesSection';\nimport { getFirstNoteStartFromSections } from 'Songs/utils/notesSelectors';\nimport { GAME_MODE, SingSetup, Song } from 'interfaces';\nimport { cloneDeep } from 'lodash-es';\nimport { useEffect, useMemo, useRef, useState } from 'react';\n\ninterface Props {\n  song: Song;\n  onUpdate?: (song: Song) => void;\n  visible: boolean;\n}\n\nconst shiftGap = (song: Song, gapShift: number): Song => ({ ...song, gap: song.gap + gapShift });\nconst shiftVideoGap = (song: Song, gapShift: number): Song => ({ ...song, videoGap: (song.videoGap ?? 0) + gapShift });\nconst setBpm = (song: Song, bpm: number): Song => ({ ...song, bpm });\n\nconst applyChanges = (song: Song, changes: ChangeRecord[]) => ({\n  ...song,\n  tracks: song.tracks.map((track, trackIndex) => {\n    const changeList = changes.filter((change) => change.track === trackIndex);\n\n    let sections = [...track.sections].filter(isNotesSection);\n\n    changeList.forEach((change) => {\n      if (change.type === 'delete') {\n        sections = sections.filter((_, index) => index !== change.section);\n      } else if (change.type === 'shift') {\n        const shift = change.shift - getFirstNoteStartFromSections([sections[change.section]]);\n        sections = sections.map((section, index) => {\n          if (index < change.section) return section;\n\n          return { ...section, notes: section.notes.map((note) => ({ ...note, start: note.start + shift })) };\n        });\n      }\n    });\n\n    return { ...track, sections };\n  }),\n});\n\nconst applyTrackNames = (song: Song, trackNames: (string | undefined)[]): Song => ({\n  ...song,\n  tracks: song.tracks.map((track, index) => ({\n    ...track,\n    name: trackNames[index] ?? track.name,\n  })),\n});\n\nconst playerWidth = 800;\nconst playerHeight = (playerWidth / 16) * 9;\n\nexport default function EditSong({ song, onUpdate, visible }: Props) {\n  const player = useRef<PlayerRef | null>(null);\n  const [currentTime, setCurrentTime] = useState<number>(0);\n\n  const [gapShift, setGapShift] = useState<number>(0);\n  const [videoGapShift, setVideoGapShift] = useState<number>(0);\n  const [overrideBpm, setOverrideBpm] = useState<number>(song.bpm);\n  const [playerKey, setPlayerKey] = useState(0);\n  const [changeRecords, setChangeRecords] = useState<ChangeRecord[]>([]);\n  const [effectsEnabled, setEffectsEnabled] = useState<boolean>(false);\n  const [trackNames, setTrackNames] = useState(song.tracks.map((track) => track.name ?? undefined));\n\n  const newSong = useMemo(() => {\n    let processed = cloneDeep(song);\n\n    processed = normaliseGap(processed);\n    processed = addHeadstart(processed);\n    processed = normaliseSectionPaddings(processed);\n    processed = shiftGap(processed, gapShift);\n    processed = shiftVideoGap(processed, videoGapShift);\n    processed = setBpm(processed, overrideBpm);\n    processed = applyChanges(processed, changeRecords);\n    processed = applyTrackNames(processed, trackNames);\n    processed = normaliseSectionPaddings(processed);\n    processed = normaliseLyricSpaces(processed);\n\n    return processed;\n  }, [gapShift, videoGapShift, song, overrideBpm, changeRecords, trackNames]);\n\n  useEffect(() => {\n    onUpdate?.(newSong);\n  }, [onUpdate, newSong]);\n\n  const singSetup = useMemo<SingSetup>(\n    () => ({\n      id: 'test',\n      mode: GAME_MODE.DUEL,\n      players: [\n        { number: 0, track: 0 },\n        { number: 1, track: song.tracks.length - 1 },\n      ],\n      tolerance: 6,\n    }),\n    [song],\n  );\n\n  let beatLength: number | undefined;\n  beatLength = getSongBeatLength(newSong);\n\n  useEffect(() => {\n    if (!visible) {\n      player.current?.pause();\n    }\n  }, [visible]);\n\n  return (\n    <Grid container spacing={2} sx={{ display: visible ? undefined : 'none' }}>\n      <Grid item xs={8} data-test=\"player-container\">\n        <Box sx={{ width: playerWidth, height: playerHeight }}>\n          <Player\n            key={playerKey}\n            song={newSong}\n            showControls\n            autoplay={false}\n            width={playerWidth}\n            height={playerHeight}\n            ref={player}\n            onCurrentTimeUpdate={setCurrentTime}\n            players={singSetup.players}\n            effectsEnabled={effectsEnabled}\n            singSetup={singSetup}\n            onSongEnd={() => undefined}\n          />\n        </Box>\n      </Grid>\n      <Grid item xs={4}>\n        <Typography variant={'h5'} mb={2}>\n          Playback controls\n        </Typography>\n        {player.current && (\n          <AdjustPlayback\n            player={player.current}\n            currentTime={currentTime}\n            effectsEnabled={effectsEnabled}\n            onEffectsToggle={() => setEffectsEnabled((current) => !current)}\n          />\n        )}\n        {!player.current && <h2>Start the song to see the manipulation form</h2>}\n      </Grid>\n      {player.current && (\n        <>\n          <Grid item xs={8}>\n            {/*<Typography variant={'h5'} mb={2}>*/}\n            {/*    Basic adjustments*/}\n            {/*</Typography>*/}\n            <Box sx={{ display: 'flex', gap: 5, flex: 1 }}>\n              <ShiftVideoGap\n                player={player.current}\n                onChange={(newShift) => {\n                  const delta = newShift - videoGapShift;\n                  setVideoGapShift(newShift);\n                  // video gap is not automatically added to gap, need to adjust it here directly\n                  setGapShift((current) => current + delta * 1000);\n                }}\n                current={videoGapShift}\n                finalGap={newSong.videoGap}\n              />\n              <ShiftGap player={player.current} onChange={setGapShift} current={gapShift} finalGap={newSong.gap} />\n            </Box>\n          </Grid>\n          <Grid item xs={4}>\n            <HelpText>\n              Use <strong>Video shift gap</strong> to crop the beginning of the video if it starts with an intro.\n            </HelpText>\n            <HelpText>\n              Use <strong>Shift gap</strong> to sync the start of the lyrics to the video. You can lower the{' '}\n              <strong>Playback speed</strong> above to make sure you got it just right.\n            </HelpText>\n          </Grid>\n          <Grid item xs={8}>\n            <Typography variant={'h5'} mb={2}>\n              Advanced\n            </Typography>\n            <ManipulateBpm\n              player={player.current}\n              onChange={setOverrideBpm}\n              current={overrideBpm}\n              song={newSong}\n              key={newSong.gap}\n            />\n            <ListTracks player={player.current} song={newSong} beatLength={beatLength} />\n          </Grid>\n          <Grid item xs={4}>\n            <HelpText>If the lyrics desynchronise over time, probably the tempo (BPM) of the lyrics is wrong.</HelpText>\n            <HelpText>\n              You can either use <strong>Last note end time</strong> - enter the millisecond when the last note should\n              end (seek through the video for the moment as <strong>Current time</strong> panel show the exact\n              millisecond) and a suggested BPM value will appear below.\n            </HelpText>\n            <HelpText>\n              <strong>Tempo (BPM)</strong> field allows to fine-tune the tempo.\n            </HelpText>\n          </Grid>\n          <Grid item xs={8}>\n            <EditSection\n              song={newSong}\n              currentTime={currentTime}\n              beatLength={beatLength}\n              player={player.current}\n              onRecordChange={setChangeRecords}\n              onTrackNameChange={(track, newName) =>\n                setTrackNames((current) => {\n                  const newNames = [...current];\n                  newNames[track] = newName === '' ? undefined : newName;\n\n                  return newNames;\n                })\n              }\n            />\n          </Grid>\n          <Grid item xs={4}>\n            <HelpText>\n              If the lyrics there are more lyrics than in the video or there are longer/shorter interludes between\n              verses, you can <strong>Edit verses</strong>.\n            </HelpText>\n            <HelpText>Select a verse by clicking on it.</HelpText>\n            <HelpText>\n              You can either <strong>Change its start beat</strong> (which will \"move in time\" the verse and all\n              subsequent ones) or <strong>Delete it</strong> (it won't affect the timing of other verses).\n            </HelpText>\n            <HelpText>\n              <strong>List of changes</strong> on the right allows you to see and undo the actions one by one.\n            </HelpText>\n          </Grid>\n        </>\n      )}\n    </Grid>\n  );\n}\n\nconst HelpText = styled.p`\n  font-size: 0.85rem;\n  margin-bottom: 1rem;\n  line-height: 1.25rem;\n  strong {\n    font-weight: bold;\n  }\n`;\n","import { Box } from '@mui/material';\nimport { Song } from 'interfaces';\nimport EditSong from 'Scenes/Convert/Steps/SyncLyricsToVideo/EditSong';\n\ninterface Props {\n  onChange: (data: Song) => void;\n  data?: Song;\n  visible: boolean;\n}\n\nexport default function SyncLyricsToVideo(props: Props) {\n  return (\n    <Box data-test=\"sync-lyrics\">\n      {props.data && props.data.video.length < 15 && !!props.data.tracks?.[0]?.sections?.length && (\n        <EditSong song={props.data} onUpdate={props.onChange} visible={props.visible} />\n      )}\n    </Box>\n  );\n}\n","import { Button, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle } from '@mui/material';\nimport SongDao from 'Songs/SongsService';\nimport convertSongToTxt from 'Songs/utils/convertSongToTxt';\nimport posthog from 'posthog-js';\nimport { useState } from 'react';\nimport createPersistedState from 'use-persisted-state';\nimport storage from 'utils/storage';\n\ninterface Props {\n  id?: string | null;\n}\n\nconst SHARE_SONGS_KEY = 'share-songs';\nexport const useShareSongs = createPersistedState<boolean | null>(SHARE_SONGS_KEY);\n\nexport const shareSong = async (id: string) => {\n  const isShareEnabled = storage.getValue(SHARE_SONGS_KEY);\n\n  if (!isShareEnabled) return;\n\n  const songData = await SongDao.get(id);\n  if (songData) {\n    posthog.capture('share-song', { song: convertSongToTxt(songData) });\n  }\n};\n\nexport default function ShareSongsModal(props: Props) {\n  const [shareSongs, setShareSongs] = useShareSongs(null);\n  const [open, setOpen] = useState(!!props.id && shareSongs === null);\n\n  const handleClose = () => {\n    setOpen(false);\n  };\n\n  const handleAgree = (agreed: boolean) => {\n    setShareSongs(agreed);\n    if (agreed && props.id) {\n      shareSong(props.id);\n    }\n    handleClose();\n  };\n\n  return (\n    <Dialog open={open} onClose={() => setOpen(false)} fullWidth>\n      <DialogTitle>Share songs</DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          Can you share songs you add? This would help tremendously as I will be able to add it for everyone to play 🥺\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => handleAgree(false)} data-test=\"share-songs-disagree\">\n          Disagree\n        </Button>\n        <Button onClick={() => handleAgree(true)} autoFocus variant=\"contained\" data-test=\"share-songs-agree\">\n          Agree\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n","import styled from '@emotion/styled';\nimport { Alert, AlertTitle, Box, Button, Step, StepButton, StyledEngineProvider } from '@mui/material';\nimport Stepper from '@mui/material/Stepper';\nimport { useBackground } from 'Elements/LayoutWithBackground';\nimport NormalizeFontSize from 'Elements/NormalizeFontSize';\nimport AuthorAndVid, { AuthorAndVidEntity } from 'Scenes/Convert/Steps/AuthorAndVid';\nimport BasicData, { BasicDataEntity } from 'Scenes/Convert/Steps/BasicData';\nimport SongMetadata, { SongMetadataEntity } from 'Scenes/Convert/Steps/SongMetadata';\nimport SyncLyricsToVideo from 'Scenes/Convert/Steps/SyncLyricsToVideo';\nimport { shareSong } from 'Scenes/Edit/ShareSongsModal';\nimport SongDao from 'Songs/SongsService';\nimport useSongIndex from 'Songs/hooks/useSongIndex';\nimport convertTxtToSong, { getVideoId } from 'Songs/utils/convertTxtToSong';\nimport getSongId from 'Songs/utils/getSongId';\nimport useBackgroundMusic from 'hooks/useBackgroundMusic';\nimport useSmoothNavigate from 'hooks/useSmoothNavigate';\nimport { Song } from 'interfaces';\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport { Link } from 'wouter';\n\ninterface Props {\n  song?: Song;\n}\n\nconst steps = ['basic-data', 'author-and-video', 'sync', 'metadata'] as const;\nexport default function Convert({ song }: Props) {\n  const isEdit = !!song;\n  const { data: songs } = useSongIndex(true);\n  useBackground(false);\n  const navigate = useSmoothNavigate();\n  useBackgroundMusic(false);\n  const [currentStep, setCurrentStep] = useState(0);\n\n  const [basicData, setBasicData] = useState<BasicDataEntity>({ sourceUrl: song?.sourceUrl ?? '', txtInput: '' });\n  const [authorAndVid, setAuthorAndVid] = useState<AuthorAndVidEntity>({\n    author: song?.author ?? '',\n    authorUrl: song?.authorUrl ?? '',\n    video: song?.video ? `https://www.youtube.com/watch?v=${song.video}` : '',\n  });\n  const [metadataEntity, setMetadataEntity] = useState<SongMetadataEntity>({\n    artist: song?.artist ?? '',\n    title: song?.title ?? '',\n    realBpm: song?.realBpm ? String(song.realBpm) : '',\n    year: song?.year ?? '',\n    language: song?.language ?? '',\n    volume: song?.volume ?? 0,\n    previewStart: song?.previewStart ?? undefined,\n    previewEnd: song?.previewEnd ?? undefined,\n    genre: song?.genre,\n  });\n\n  const [editedSong, setEditedSong] = useState<Song | undefined>(song);\n\n  const error = useRef<string>('');\n  const conversionResult: Song | undefined = useMemo(() => {\n    try {\n      if (isEdit)\n        return {\n          ...song,\n          video: getVideoId(authorAndVid.video) || song.video,\n          author: authorAndVid.author,\n          authorUrl: authorAndVid.authorUrl,\n          sourceUrl: basicData.sourceUrl,\n        };\n      if (!basicData.txtInput) return undefined;\n      return convertTxtToSong(\n        basicData.txtInput,\n        authorAndVid.video,\n        authorAndVid.author,\n        authorAndVid.authorUrl,\n        basicData.sourceUrl,\n      );\n    } catch (e: any) {\n      error.current = e.message;\n      console.error(e);\n    }\n    return undefined;\n  }, [\n    basicData.txtInput,\n    authorAndVid.video,\n    authorAndVid.author,\n    authorAndVid.authorUrl,\n    basicData.sourceUrl,\n    song,\n    isEdit,\n  ]);\n\n  const possibleDuplicate = useMemo(\n    () =>\n      !isEdit &&\n      conversionResult &&\n      songs?.find((addedSong) => SongDao.generateSongFile(addedSong) === SongDao.generateSongFile(conversionResult)),\n    [songs, conversionResult, isEdit],\n  );\n\n  useEffect(() => {\n    if (conversionResult) {\n      if (!!conversionResult.video && !authorAndVid.video) {\n        setAuthorAndVid((current) => ({\n          ...current,\n          video: `https://www.youtube.com/watch?v=${conversionResult.video}`,\n        }));\n      }\n      if (!!conversionResult.author && !authorAndVid.author) {\n        setAuthorAndVid((current) => ({\n          ...current,\n          author: current.author || conversionResult?.author || '',\n          authorUrl: current.authorUrl || conversionResult?.authorUrl || '',\n        }));\n      }\n      if (!!conversionResult.sourceUrl && !basicData.sourceUrl) {\n        setBasicData((current) => ({\n          ...current,\n          sourceUrl: conversionResult.sourceUrl!,\n        }));\n      }\n      (\n        ['year', 'language', 'realBpm', 'genre', 'artist', 'title', 'volume', 'previewStart', 'previewEnd'] as const\n      ).forEach((property) => {\n        if (!!conversionResult[property] && !metadataEntity[property]) {\n          setMetadataEntity((current) => ({\n            ...current,\n            [property]: conversionResult[property],\n          }));\n        }\n      });\n    }\n  }, [\n    conversionResult,\n    metadataEntity.year,\n    metadataEntity.language,\n    metadataEntity.realBpm,\n    metadataEntity.genre,\n    metadataEntity.artist,\n    metadataEntity.volume,\n    metadataEntity.title,\n    metadataEntity.previewStart,\n    metadataEntity.previewEnd,\n    basicData.sourceUrl,\n    authorAndVid.video,\n  ]);\n\n  const isBasicInfoCompleted = !!basicData.txtInput || isEdit;\n  const isAuthorAndVidCompleted = !!authorAndVid.video;\n\n  const isNextStepAvailable = steps[currentStep] === 'author-and-video' ? isAuthorAndVidCompleted : true;\n\n  const finalSong: Song = {\n    ...editedSong!,\n    ...metadataEntity,\n    author: authorAndVid.author,\n    authorUrl: authorAndVid.authorUrl,\n    realBpm: +metadataEntity.realBpm,\n    sourceUrl: basicData.sourceUrl,\n    id: getSongId(metadataEntity),\n  };\n\n  return (\n    <StyledEngineProvider injectFirst>\n      <NormalizeFontSize />\n      <Container>\n        {!isEdit && (\n          <div style={{ marginBottom: '1rem' }}>\n            <Link to=\"/\">\n              <a>Return to the main menu</a>\n            </Link>\n          </div>\n        )}\n        <Stepper activeStep={currentStep} sx={{ mb: 2 }} nonLinear={isEdit}>\n          <Step key={0} completed={isBasicInfoCompleted}>\n            <StepButton color=\"inherit\" onClick={() => setCurrentStep(0)}>\n              Basic Info\n            </StepButton>\n          </Step>\n          <Step key={1} completed={isAuthorAndVidCompleted}>\n            <StepButton color=\"inherit\" onClick={() => setCurrentStep(1)}>\n              Author and video data\n            </StepButton>\n          </Step>\n          <Step key={2}>\n            <StepButton color=\"inherit\" onClick={() => setCurrentStep(2)}>\n              Sync lyrics to video\n            </StepButton>\n          </Step>\n          <Step key={3}>\n            <StepButton color=\"inherit\" onClick={() => setCurrentStep(3)}>\n              Fill song metadata\n            </StepButton>\n          </Step>\n        </Stepper>\n        <form\n          onSubmit={async (e) => {\n            e.preventDefault();\n            if (currentStep < steps.length - 1) setCurrentStep((current) => current + 1);\n            else if (steps.at(currentStep) === 'metadata') {\n              await SongDao.store(finalSong!);\n              if (!isEdit) {\n                shareSong(finalSong!.id);\n              }\n              navigate(`/edit?search=${encodeURIComponent(finalSong!.title)}${!isEdit ? `&id=${finalSong!.id}` : ''}`);\n            }\n          }}>\n          {steps.at(currentStep) === 'basic-data' && (\n            <BasicData\n              shouldAutoImport={!isAuthorAndVidCompleted}\n              isTxtRequired={!song}\n              onAutoImport={setAuthorAndVid}\n              onChange={setBasicData}\n              data={basicData}\n              finalSong={finalSong}\n            />\n          )}\n\n          {steps.at(currentStep) === 'author-and-video' && (\n            <AuthorAndVid\n              songArtist={conversionResult?.artist}\n              songTitle={conversionResult?.title}\n              onChange={setAuthorAndVid}\n              data={authorAndVid}\n            />\n          )}\n\n          {conversionResult && ( // Keep the component even if in different step so it preserves the state\n            <SyncLyricsToVideo\n              onChange={setEditedSong}\n              data={conversionResult}\n              visible={steps.at(currentStep) === 'sync'}\n            />\n          )}\n\n          {steps.at(currentStep) === 'metadata' && (\n            <SongMetadata\n              videoGap={editedSong?.videoGap}\n              onChange={setMetadataEntity}\n              data={metadataEntity}\n              songArtist={conversionResult?.artist}\n              songTitle={conversionResult?.title}\n              videoId={conversionResult!.video}\n            />\n          )}\n\n          {possibleDuplicate && (\n            <Alert severity=\"warning\" data-test=\"possible-duplicate\">\n              <AlertTitle>Possible duplicate</AlertTitle>\n              There is already a song with similar artist and/or name:{' '}\n              <b>\n                {possibleDuplicate.artist} - {possibleDuplicate.title}\n              </b>\n            </Alert>\n          )}\n          <Box sx={{ display: 'flex', justifyContent: 'flex-end' }}>\n            <Button\n              data-test=\"previous-button\"\n              sx={{ mt: 2, align: 'right' }}\n              onClick={() => setCurrentStep((current) => current - 1)}\n              disabled={currentStep === 0}>\n              Previous\n            </Button>\n            {steps.at(currentStep) === 'metadata' ? (\n              <Button data-test=\"save-button\" sx={{ mt: 2, align: 'right' }} type=\"submit\" variant={'contained'}>\n                Save\n              </Button>\n            ) : (\n              <Button\n                data-test=\"next-button\"\n                sx={{ mt: 2, align: 'right' }}\n                variant={'contained'}\n                type=\"submit\"\n                disabled={!isNextStepAvailable || currentStep === steps.length - 1}>\n                Next\n              </Button>\n            )}\n          </Box>\n        </form>\n      </Container>\n    </StyledEngineProvider>\n  );\n}\n\nconst Container = styled.div`\n  background: white;\n  margin: 30px auto 0;\n  width: 1260px;\n  height: 100%;\n`;\n","import { Song } from 'interfaces';\nimport getSongFirstNoteMs from 'Songs/utils/getSongFirstNoteMs';\n\nexport default function fixVideoGap(song: Song) {\n  const firstNote = getSongFirstNoteMs(song);\n\n  return {\n    ...song,\n    videoGap: Math.round(Math.max(0, Math.min(song.videoGap ?? 0, firstNote / 1000 - 15))),\n  };\n}\n","import addHeadstart from 'Scenes/Convert/Steps/SyncLyricsToVideo/Helpers/addHeadstart';\nimport fixVideoGap from 'Scenes/Convert/Steps/SyncLyricsToVideo/Helpers/fixVideoGap';\nimport normaliseGap from 'Scenes/Convert/Steps/SyncLyricsToVideo/Helpers/normaliseGap';\nimport normaliseLyricSpaces from 'Scenes/Convert/Steps/SyncLyricsToVideo/Helpers/normaliseLyricSpaces';\nimport normaliseSectionPaddings from 'Scenes/Convert/Steps/SyncLyricsToVideo/Helpers/normaliseSectionPaddings';\nimport SongDao from 'Songs/SongsService';\nimport { Song } from 'interfaces';\nimport { useEffect, useState } from 'react';\n\nexport const processSong = (song: Song) => {\n  let processed = normaliseGap(song);\n  processed = addHeadstart(processed);\n  processed = normaliseSectionPaddings(processed);\n  processed = normaliseLyricSpaces(processed);\n  processed = fixVideoGap(processed);\n\n  return processed;\n};\n\nexport default function useSong(songId: string) {\n  const [song, setSong] = useState<Song | null>(null);\n\n  useEffect(() => {\n    SongDao.get(songId).then((loadedSong) => setSong(loadedSong ? processSong(loadedSong) : loadedSong));\n  }, [songId]);\n\n  return {\n    data: song,\n  };\n}\n","import styled from '@emotion/styled';\nimport Convert from 'Scenes/Convert/Convert';\nimport useSong from 'Songs/hooks/useSong';\nimport useBackgroundMusic from 'hooks/useBackgroundMusic';\nimport { Link } from 'wouter';\n\ninterface Props {\n  songId: string;\n}\n\nexport default function Edit(props: Props) {\n  useBackgroundMusic(false);\n  const song = useSong(props.songId);\n\n  if (!song.data) return <>Loading</>;\n\n  console.log(song.data);\n  return (\n    <Container>\n      <div>\n        <Link to=\"/edit\">\n          <a>Return to the song list</a>\n        </Link>\n      </div>\n      <Convert song={song.data} />\n    </Container>\n  );\n}\n\nconst Container = styled.div`\n  margin: 30px auto 0 auto;\n  width: 1260px;\n  height: 100%;\n  background: white;\n`;\n","import { css } from '@emotion/react';\nimport styled from '@emotion/styled';\nimport { CheckBox, CheckBoxOutlineBlank, Warning } from '@mui/icons-material';\nimport { Flag } from 'Elements/Flag';\nimport { MenuButton } from 'Elements/Menu';\nimport MenuWithLogo from 'Elements/MenuWithLogo';\nimport { typography } from 'Elements/cssMixins';\nimport { ExcludedLanguagesSetting, useSettingValue } from 'Scenes/Settings/SettingsState';\nimport useSongIndex from 'Songs/hooks/useSongIndex';\nimport useKeyboardNav from 'hooks/useKeyboardNav';\nimport { SongPreview } from 'interfaces';\nimport { useEffect, useMemo } from 'react';\nimport CountUp from 'react-countup';\nimport isE2E from 'utils/isE2E';\nimport languageNameToIsoCode from 'utils/languageNameToIsoCode';\n\nexport const useLanguageList = (list: SongPreview[]) => {\n  return useMemo(() => {\n    const langs: Record<string, { name: string; count: number }> = {};\n\n    list.forEach((song) => {\n      if (!song.language) return;\n      const songLangs = Array.isArray(song.language) ? song.language : [song.language];\n\n      songLangs.forEach((lang) => {\n        const langId = lang.toLowerCase();\n        if (!langs[langId]) {\n          langs[langId] = { name: lang, count: 0 };\n        }\n        langs[langId].count = langs[langId].count + 1;\n      });\n    });\n\n    const languages = Object.values(langs);\n    languages.sort((a, b) => b.count - a.count);\n\n    return languages;\n  }, [list]);\n};\n\ninterface Props {\n  onClose: () => void;\n  closeText: string;\n}\n\nconst MIN_SONGS_COUNT = isE2E() ? 0 : 3;\n\nfunction ExcludeLanguagesView({ onClose, closeText }: Props) {\n  const { register } = useKeyboardNav({ onBackspace: onClose });\n\n  const [excludedLanguages, setExcludedLanguages] = useSettingValue(ExcludedLanguagesSetting);\n  const { data } = useSongIndex();\n  const availableLanguages = useLanguageList(data);\n  const languageList = useMemo(\n    () => availableLanguages.filter(({ name, count }) => languageNameToIsoCode(name) && count >= MIN_SONGS_COUNT),\n    [availableLanguages],\n  );\n  const otherSongCount = useMemo(\n    () =>\n      availableLanguages\n        .filter(({ name }) => !languageList.find((lang) => lang.name === name))\n        .reduce((acc, { count }) => acc + count, 0),\n    [availableLanguages, languageList],\n  );\n\n  const songCount = languageList\n    .filter(({ name }) => !excludedLanguages?.includes(name))\n    .reduce((acc, { count }) => acc + count, 0);\n\n  const toggleLanguage = (language: string) => {\n    if (excludedLanguages === null) setExcludedLanguages([language]);\n    else if (!excludedLanguages.includes(language)) setExcludedLanguages([...excludedLanguages, language]);\n    else setExcludedLanguages(excludedLanguages.filter((lang) => lang !== language));\n  };\n\n  useEffect(() => {\n    if (excludedLanguages === null && navigator?.languages) {\n      let languageNames = new Intl.DisplayNames(['en'], { type: 'language' });\n      const preferredLanguages = navigator?.languages\n        .map((lang) => languageNames.of(lang)?.toLowerCase()!)\n        .filter(Boolean);\n\n      const toExclude = languageList\n        .map((lang) => lang.name)\n        .filter((lang) => !preferredLanguages.some((preferred) => preferred.includes(lang.toLowerCase())))\n        .filter((lang) => lang !== 'English'); // Always have English selected as default\n\n      if (toExclude.length) {\n        setExcludedLanguages(toExclude);\n      }\n    }\n  }, [excludedLanguages, languageList]);\n\n  const areAllLanguagesExcluded = excludedLanguages?.length === languageList.length;\n\n  return (\n    <MenuWithLogo>\n      <h1>Select Song Languages</h1>\n      <LanguageListContainer>\n        {languageList.map(({ name, count }) => {\n          const excluded = excludedLanguages?.includes(name) ?? false;\n          return (\n            <LanguageEntry key={name} excluded={excluded} {...register(`lang-${name}`, () => toggleLanguage(name))}>\n              <Check>{excluded ? <CheckBoxOutlineBlank /> : <CheckBox />}</Check>\n              <span>\n                <LanguageName>{name}</LanguageName> ({count} songs)\n              </span>\n              <LanguageFlagBackground excluded={excluded}>\n                <Flag language={name} />\n              </LanguageFlagBackground>\n            </LanguageEntry>\n          );\n        })}\n        {otherSongCount > 0 && (\n          <Disclaimer>\n            …and <strong>{otherSongCount} songs</strong> in other languages\n          </Disclaimer>\n        )}\n      </LanguageListContainer>\n      <h3>\n        You can always update the selection in <strong>Manage Songs</strong> menu\n      </h3>\n      <NextButtonContainer>\n        <MenuButton\n          {...register('close-exclude-languages', onClose, undefined, true, {\n            disabled: areAllLanguagesExcluded,\n          })}>\n          {closeText}\n        </MenuButton>\n        <Disclaimer>\n          The list will contain{' '}\n          <strong>\n            <CountUp duration={1} preserveValue end={songCount + otherSongCount} />\n          </strong>{' '}\n          songs\n        </Disclaimer>\n        {areAllLanguagesExcluded && (\n          <Disclaimer data-test=\"all-languages-excluded-warning\">\n            <strong>\n              <Warning />\n            </strong>{' '}\n            You excluded all the languages, pick at least one\n          </Disclaimer>\n        )}\n      </NextButtonContainer>\n    </MenuWithLogo>\n  );\n}\n\nconst NextButtonContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n`;\n\nconst Disclaimer = styled.h4`\n  text-align: right;\n`;\n\nconst Check = styled.div`\n  svg {\n    width: 4rem;\n    height: 4rem;\n  }\n`;\n\nconst LanguageListContainer = styled.div`\n  margin-top: 2rem;\n`;\nconst LanguageName = styled.span`\n  transition: 300ms;\n`;\n\nconst LanguageFlagBackground = styled.div<{ excluded: boolean }>`\n  transition: 300ms;\n  opacity: 0.95;\n  ${(props) =>\n    props.excluded\n      ? css`\n          filter: grayscale(0.6);\n          opacity: 0.5;\n        `\n      : ''}\n\n  position: absolute;\n  bottom: 0;\n  right: 0;\n  img {\n    width: 17rem;\n    height: 10rem;\n    object-fit: cover;\n  }\n  overflow: hidden;\n  width: 17rem;\n  height: 10rem;\n`;\n\nconst LanguageEntry = styled(MenuButton)<{ excluded: boolean; focused: boolean }>`\n  ${(props) =>\n    props.excluded\n      ? css`\n          ${props.focused ? '' : 'background: rgba(0, 0, 0, 0.55)'};\n          text-decoration: line-through white;\n          opacity: 0.5;\n        `\n      : ''}\n  ${typography};\n  display: flex;\n  align-items: center;\n  gap: 2rem;\n  font-size: 3rem;\n  padding-left: 3rem;\n\n  position: relative;\n\n  width: 100%;\n`;\n\nexport default ExcludeLanguagesView;\n","import { captureException } from '@sentry/react';\nimport { ExcludedLanguagesSetting, useSettingValue } from 'Scenes/Settings/SettingsState';\nimport useSongIndex from 'Songs/hooks/useSongIndex';\nimport { isAfter } from 'date-fns';\nimport { SongPreview } from 'interfaces';\nimport { uniq } from 'lodash-es';\nimport { useDeferredValue, useMemo, useState } from 'react';\nimport clearString from 'utils/clearString';\n\nexport interface SongGroup {\n  letter: string;\n  songs: Array<{ index: number; song: SongPreview }>;\n  isNew?: boolean;\n}\n\nexport interface AppliedFilters {\n  yearBefore?: number;\n  yearAfter?: number;\n  language?: string;\n  excludeLanguages?: string[];\n  search?: string;\n  updatedAfter?: string;\n  duet?: boolean | null;\n}\n\nexport function isEmptyFilters(filters: AppliedFilters) {\n  return (\n    (!filters.language || filters.language === '') &&\n    (!filters.search || filters.search === '') &&\n    (filters.duet === undefined || filters.duet === null) &&\n    !filters.yearBefore &&\n    !filters.yearAfter\n  );\n}\n\nexport interface FiltersData {\n  language: {\n    current: string;\n    available: string[];\n  };\n  status: {\n    allSongs: number;\n    visible: number;\n  };\n}\n\ntype FilterFunc = (songList: SongPreview[], ...args: any) => SongPreview[];\n\nconst filteringFunctions: Record<keyof AppliedFilters, FilterFunc> = {\n  language: (songList, language: string) => {\n    if (language === '') return songList;\n\n    return songList.filter((song) => {\n      const songLangs = Array.isArray(song.language) ? song.language : [song.language!];\n\n      return songLangs.includes(language);\n    });\n  },\n  excludeLanguages: (songList, languages: string[] = []) => {\n    if (languages.length === 0) return songList;\n\n    return songList.filter((song) => {\n      const songLangs = Array.isArray(song.language) ? song.language : [song.language!];\n\n      return !songLangs.every((songLang) => languages.includes(songLang!));\n    });\n  },\n  search: (songList, search: string) => {\n    const cleanSearch = clearString(search);\n\n    return cleanSearch.length ? songList.filter((song) => song.search.includes(cleanSearch)) : songList;\n  },\n  duet: (songList, duet: boolean | null) => {\n    if (duet === null) return songList;\n\n    return songList.filter((song) => (duet ? song.tracksCount > 1 : song.tracksCount === 1));\n  },\n  yearBefore: (songList, yearBefore: number) => {\n    if (!yearBefore) return songList;\n\n    return songList.filter((song) => Number(song.year) < yearBefore);\n  },\n  yearAfter: (songList, yearAfter: number) => {\n    if (!yearAfter) return songList;\n\n    return songList.filter((song) => Number(song.year) >= yearAfter);\n  },\n  updatedAfter: (songList, after: string) => {\n    if (!after) return songList;\n    const dateAfter = new Date(after);\n\n    return songList.filter((song) => song.lastUpdate && isAfter(new Date(song.lastUpdate), dateAfter));\n  },\n};\n\nconst applyFilters = (list: SongPreview[], appliedFilters: AppliedFilters): SongPreview[] => {\n  if (clearString(appliedFilters?.search ?? '').length) {\n    return filteringFunctions.search(list, appliedFilters.search);\n  }\n  return Object.entries(appliedFilters)\n    .filter((filters): filters is [keyof AppliedFilters, FilterFunc] => filters[0] in filteringFunctions)\n    .reduce((songList, [name, value]) => filteringFunctions[name](songList, value), list);\n};\n\nexport const useLanguageFilter = (list: SongPreview[]) => {\n  return useMemo(() => uniq(['', ...list.map((song) => song.language ?? 'Unknown')].flat()), [list]);\n};\n\nexport const useSongListFilter = (list: SongPreview[]) => {\n  const availableLanguages = useLanguageFilter(list);\n  const [excludedLanguages] = useSettingValue(ExcludedLanguagesSetting);\n\n  const [filters, setFilters] = useState<AppliedFilters>({ excludeLanguages: excludedLanguages ?? [] });\n  const deferredFilters = useDeferredValue(filters);\n\n  const prefilteredList = useMemo(\n    () => applyFilters(list, { excludeLanguages: excludedLanguages ?? [] }),\n    [list, excludedLanguages],\n  );\n  const filteredList = useMemo(\n    () =>\n      applyFilters(list, {\n        ...deferredFilters,\n        excludeLanguages: excludedLanguages ?? [],\n      }),\n    [list, deferredFilters, excludedLanguages],\n  );\n\n  const filtersData: FiltersData = {\n    language: {\n      current: filters.language ?? '',\n      available: availableLanguages,\n    },\n    status: {\n      allSongs: list.length,\n      visible: filteredList.length,\n    },\n  };\n\n  return { filters, filteredList, filtersData, prefilteredList, setFilters };\n};\n\nexport default function useSongList() {\n  const songList = useSongIndex();\n\n  const { filters, filtersData, filteredList, prefilteredList, setFilters } = useSongListFilter(songList.data);\n\n  const groupedSongList = useMemo(() => {\n    if (filteredList.length === 0) return [];\n\n    const groups: SongGroup[] = [];\n\n    if (!filters.search) {\n      const newSongs = filteredList.filter((song) => song.isNew);\n\n      if (newSongs.length) {\n        groups.push({\n          letter: 'New',\n          isNew: true,\n          songs: newSongs.map((song) => ({ song, index: filteredList.indexOf(song) })),\n        });\n      }\n    }\n\n    filteredList.forEach((song, index) => {\n      try {\n        const firstCharacter = isFinite(+song.artist[0]) ? '0-9' : song.artist[0].toUpperCase();\n        let group = groups.find((group) => group.letter === firstCharacter);\n        if (!group) {\n          group = { letter: firstCharacter, songs: [] };\n          groups.push(group);\n        }\n\n        group.songs.push({ index: index, song });\n      } catch (e) {\n        console.error(e);\n        captureException(e);\n      }\n    });\n\n    return groups;\n  }, [filteredList, filters.search]);\n\n  return {\n    prefilteredList,\n    groupedSongList,\n    songList: filteredList,\n    filtersData,\n    filters,\n    setFilters,\n    isLoading: songList.isLoading,\n  };\n}\n","import { randomInt } from 'utils/randomValue';\n\nconst MAX_REMEMBERED_SONGS_COUNT = 30;\nexport default function selectRandomSong(\n  songCount: number,\n  previouslySelectedSongs: number[],\n  maxRememberedCount = MAX_REMEMBERED_SONGS_COUNT,\n) {\n  let newIndex;\n  if (previouslySelectedSongs.length < songCount) {\n    const possibleOptions = [...Array(songCount).keys()].filter((id) => !previouslySelectedSongs.includes(id));\n\n    newIndex = possibleOptions[randomInt(0, possibleOptions.length - 1)];\n  } else {\n    newIndex = randomInt(0, songCount - 1);\n\n    previouslySelectedSongs.length = 0;\n  }\n\n  if (previouslySelectedSongs.length >= maxRememberedCount) {\n    previouslySelectedSongs.shift();\n  }\n  previouslySelectedSongs.push(newIndex);\n\n  return newIndex;\n}\n","import { HelpEntry } from 'Scenes/KeyboardHelp/Context';\nimport selectRandomSong from 'Scenes/SingASong/SongSelection/Hooks/selectRandomSong';\nimport { AppliedFilters, SongGroup } from 'Scenes/SingASong/SongSelection/Hooks/useSongList';\nimport { menuBack, menuEnter, menuNavigate } from 'SoundManager';\nimport useKeyboard from 'hooks/useKeyboard';\nimport useKeyboardHelp from 'hooks/useKeyboardHelp';\nimport usePrevious from 'hooks/usePrevious';\nimport useSmoothNavigate from 'hooks/useSmoothNavigate';\nimport { chunk, throttle } from 'lodash-es';\nimport posthog from 'posthog-js';\nimport { useCallback, useEffect, useLayoutEffect, useMemo, useRef, useState } from 'react';\nimport tuple from 'utils/tuple';\n\nconst useTwoDimensionalNavigation = (groups: SongGroup[] = [], itemsPerRow: number) => {\n  const [cursorPosition, setCursorPosition] = useState<[number, number]>([0, 0]);\n  const songIndexMatrix = useMemo(\n    () =>\n      groups\n        .map(({ songs }) =>\n          chunk(\n            songs.map((song) => song.index),\n            itemsPerRow,\n          ),\n        )\n        .flat(),\n    [groups],\n  );\n  const songGroupMatrix = useMemo(\n    () =>\n      groups\n        .map(({ songs, letter }) =>\n          chunk(\n            songs.map(() => letter),\n            itemsPerRow,\n          ),\n        )\n        .flat(),\n    [groups],\n  );\n  const previousMatrix = usePrevious(songIndexMatrix ?? []);\n\n  const isAtLastColumn = cursorPosition[0] === songIndexMatrix[cursorPosition[1]]?.length - 1;\n\n  const moveToSong = useCallback(\n    (songIndex: number) => {\n      const y = songIndexMatrix.findIndex((columns) => columns.includes(songIndex));\n      const x = songIndexMatrix[y]?.indexOf(songIndex);\n      if (x >= 0 && y >= 0) {\n        setCursorPosition([x ?? 0, y ?? 0]);\n      } else {\n        setCursorPosition([0, 0]);\n      }\n    },\n    [songIndexMatrix],\n  );\n\n  const positionToValue = <T>([x, y]: [number, number], matrix: T[][], def: T) => {\n    if (groups.length === 0) return def;\n    const row = matrix[y];\n    return row?.[x] ?? row?.at(-1) ?? matrix?.[0]?.[0] ?? def;\n  };\n  const positionToSongIndex = ([x, y]: [number, number], matrix: number[][] = songIndexMatrix) => {\n    return positionToValue([x, y], matrix, 0);\n  };\n  const positionToGroup = ([x, y]: [number, number], matrix: string[][] = songGroupMatrix) => {\n    return positionToValue([x, y], matrix, 'A');\n  };\n\n  useEffect(() => {\n    const previousFocusedSong = positionToSongIndex(cursorPosition, previousMatrix);\n    const currentFocusedSong = positionToSongIndex(cursorPosition, songIndexMatrix);\n    if (previousMatrix.length && previousFocusedSong !== currentFocusedSong) {\n      moveToSong(previousFocusedSong);\n    }\n  }, [cursorPosition, songIndexMatrix, previousMatrix, isAtLastColumn]);\n\n  const moveCursor = (plane: 'x' | 'y', delta: number) => {\n    menuNavigate.play();\n    setCursorPosition(([x, y]) => {\n      let newX = x;\n      let newY = y;\n      if (plane === 'y') {\n        newY = y + delta;\n      } else {\n        if (songIndexMatrix[y] === undefined) {\n          debugger;\n        }\n        const maxXInRow = songIndexMatrix[y].length - 1;\n        newX = Math.min(x, maxXInRow) + delta;\n        if (newX < 0) {\n          newY = (songIndexMatrix.length + y - 1) % songIndexMatrix.length;\n          newX = songIndexMatrix[newY].length - 1;\n        } else if (newX > maxXInRow) {\n          newY = y + 1;\n          newX = 0;\n        }\n      }\n      return [newX % itemsPerRow, (songIndexMatrix.length + newY) % songIndexMatrix.length];\n    });\n  };\n\n  const focusedSong = positionToSongIndex(cursorPosition);\n  const focusedGroup = positionToGroup(cursorPosition);\n\n  return tuple([focusedSong, focusedGroup, cursorPosition, moveCursor, moveToSong, isAtLastColumn]);\n};\n\nexport const useSongSelectionKeyboardNavigation = (\n  enabled: boolean,\n  groupedSongs: SongGroup[] = [],\n  onEnter: () => void,\n  songCount: number,\n  appliedFilters: AppliedFilters,\n  songsPerRow: number,\n) => {\n  const navigate = useSmoothNavigate();\n  // We need to record how user entered (from which \"side\") and how left and based on that update the selection.\n  // Eg if user was at the last column, entered playlists, and returned to the last column (by clicking left)\n  // then effectively the selection shouldn't change\n  const [showPlaylistsState, setShowPlaylistsState] = useState<[boolean, 'left' | 'right' | null]>([false, null]);\n  const previousPlaylistsState = usePrevious(showPlaylistsState);\n  const [arePlaylistsVisible, leavingKey] = showPlaylistsState;\n\n  const [focusedSong, focusedGroup, cursorPosition, moveCursor, moveToSong, isAtLastColumn] =\n    useTwoDimensionalNavigation(groupedSongs, songsPerRow);\n  const isAtFirstColumn = cursorPosition[0] === 0;\n\n  const handleEnter = () => {\n    menuEnter.play();\n    onEnter();\n  };\n\n  const [blockBack, setBlockBack] = useState(false);\n  const previousSearch = usePrevious(appliedFilters.search);\n  useLayoutEffect(() => {\n    if (previousSearch && !appliedFilters.search) {\n      setBlockBack(true);\n      const timeout = setTimeout(() => setBlockBack(false), 2_000);\n\n      return () => {\n        clearTimeout(timeout);\n        setBlockBack(false);\n      };\n    }\n  }, [appliedFilters.search]);\n\n  const handleBackspace = () => {\n    if (!blockBack && !appliedFilters.search) {\n      menuBack.play();\n      navigate('/');\n    }\n  };\n\n  const navigateToGroup = useCallback(\n    throttle(\n      (direction: 1 | -1, currentGroup: number) => {\n        const nextGroupIndex = (groupedSongs.length + currentGroup + direction) % groupedSongs.length;\n\n        moveToSong(groupedSongs[nextGroupIndex].songs[0].index);\n        menuNavigate.play();\n      },\n      700,\n      { trailing: false },\n    ),\n    [groupedSongs],\n  );\n\n  const navigateVertically = (e: KeyboardEvent | undefined, direction: 1 | -1) => {\n    if (!e?.repeat) {\n      moveCursor('y', direction);\n    } else {\n      const currentlySelectedGroupIndex = groupedSongs.findIndex(\n        (group) => !!group.songs.find((song) => song.index === focusedSong),\n      );\n      navigateToGroup(direction, currentlySelectedGroupIndex);\n    }\n  };\n\n  const navigateHorizontally = (direction: 1 | -1, ignoreFilters = false) => {\n    if (!ignoreFilters && direction === 1 && isAtLastColumn && !arePlaylistsVisible) {\n      setShowPlaylistsState([true, 'right']);\n    } else if (!ignoreFilters && direction === -1 && isAtFirstColumn && !arePlaylistsVisible) {\n      setShowPlaylistsState([true, 'left']);\n    } else {\n      moveCursor('x', direction);\n    }\n  };\n\n  const randomlySelectedSongs = useRef<number[]>([]);\n  const randomSong = () => {\n    const newIndex = selectRandomSong(songCount, randomlySelectedSongs.current);\n    moveToSong(newIndex);\n  };\n\n  useKeyboard(\n    {\n      accept: handleEnter,\n      down: (e) => navigateVertically(e, 1),\n      up: (e) => navigateVertically(e, -1),\n      left: () => navigateHorizontally(-1),\n      right: () => navigateHorizontally(1),\n      back: handleBackspace,\n      random: () => {\n        randomSong();\n        posthog.capture('selectRandom');\n      },\n    },\n    enabled && !arePlaylistsVisible,\n    [groupedSongs, cursorPosition, arePlaylistsVisible, appliedFilters, blockBack],\n  );\n\n  const help = useMemo<HelpEntry>(\n    () => ({\n      'horizontal-vertical': null,\n      accept: null,\n      back: null,\n      shiftR: null,\n      remote: ['search'],\n    }),\n    [],\n  );\n  useKeyboardHelp(help, enabled);\n\n  const closePlaylist = useCallback(\n    (leavingKey: 'left' | 'right') => {\n      setShowPlaylistsState([false, leavingKey]);\n      // if (leavingKey === 'right') navigateHorizontally(1);\n    },\n    [setShowPlaylistsState, navigateHorizontally, groupedSongs, cursorPosition],\n  );\n\n  useLayoutEffect(() => {\n    const [previousShowFilters, enteringKey] = previousPlaylistsState;\n    if (previousShowFilters && !arePlaylistsVisible) {\n      if (enteringKey === leavingKey) navigateHorizontally(leavingKey === 'right' ? 1 : -1, true);\n    }\n  }, [arePlaylistsVisible, leavingKey, isAtFirstColumn, isAtLastColumn, ...cursorPosition]);\n\n  return tuple([focusedSong, focusedGroup, moveToSong, arePlaylistsVisible, closePlaylist]);\n};\n","import useSongList from 'Scenes/SingASong/SongSelection/Hooks/useSongList';\nimport { useSongSelectionKeyboardNavigation } from 'Scenes/SingASong/SongSelection/Hooks/useSongSelectionKeyboardNavigation';\nimport { woosh } from 'SoundManager';\nimport useSmoothNavigate from 'hooks/useSmoothNavigate';\nimport { useEffect, useState } from 'react';\nimport { flushSync } from 'react-dom';\nimport { randomInt } from 'utils/randomValue';\nimport startViewTransition from 'utils/startViewTransition';\n\nexport default function useSongSelection(preselectedSong: string | null, songsPerRow: number) {\n  const { songList, prefilteredList, groupedSongList, filtersData, setFilters, filters, isLoading } = useSongList();\n  const navigate = useSmoothNavigate();\n  const [keyboardControl, setKeyboardControl] = useState(true);\n\n  const handleKeyboardControl = (value: boolean) => {\n    startViewTransition(() => {\n      flushSync(() => {\n        setKeyboardControl(value);\n      });\n    });\n    woosh.play();\n  };\n\n  const [focusedSong, focusedGroup, moveToSong, showFilters, setShowFilters] = useSongSelectionKeyboardNavigation(\n    keyboardControl,\n    groupedSongList,\n    () => handleKeyboardControl(false),\n    songList.length,\n    filters,\n    songsPerRow,\n  );\n\n  const [preselected, setPreselected] = useState(false);\n  useEffect(() => {\n    if (!preselected && songList.length) {\n      const preselectedSongIndex = songList.findIndex((song) => song.id === preselectedSong);\n      const firstNewSongIndex = songList.findIndex((song) => song.isNew);\n\n      let songIndex = randomInt(0, songList.length - 1);\n      if (preselectedSongIndex > -1) songIndex = preselectedSongIndex;\n      else if (firstNewSongIndex > -1) songIndex = preselectedSongIndex;\n\n      moveToSong(songIndex);\n      setPreselected(true);\n    }\n  }, [songList, moveToSong, preselectedSong]);\n\n  useEffect(() => {\n    if (preselected && songList.length && songList[focusedSong]) {\n      navigate(`/game/${encodeURIComponent(songList[focusedSong].id)}`, { replace: true, smooth: false });\n    }\n  }, [preselected, focusedSong, songList]);\n\n  const songPreview = songList?.[focusedSong];\n  return {\n    prefilteredList,\n    groupedSongList,\n    focusedSong,\n    focusedGroup,\n    moveToSong,\n    setKeyboardControl: handleKeyboardControl,\n    keyboardControl,\n    songPreview,\n    songList: songList ?? [],\n    filtersData,\n    filters,\n    setFilters,\n    showFilters,\n    setShowFilters,\n    isLoading,\n  };\n}\n","import styled from '@emotion/styled';\nimport { Button } from 'Elements/Button';\nimport { typography } from 'Elements/cssMixins';\nimport { useLanguageList } from 'Scenes/ExcludeLanguages/ExcludeLanguagesView';\nimport { AppliedFilters } from 'Scenes/SingASong/SongSelection/Hooks/useSongList';\nimport { addDays } from 'date-fns';\nimport useKeyboard from 'hooks/useKeyboard';\nimport useKeyboardNav from 'hooks/useKeyboardNav';\nimport { SongPreview } from 'interfaces';\nimport { useEffect, useMemo } from 'react';\n\ninterface PlaylistEntry {\n  name: string;\n  filters: AppliedFilters;\n}\n\nconst usePlaylists = (songs: SongPreview[]): PlaylistEntry[] => {\n  const songLanguages = useLanguageList(songs);\n  return useMemo(\n    () =>\n      [\n        { name: 'All', filters: {} },\n        { name: songLanguages[0].name, filters: { language: songLanguages[0].name } } as PlaylistEntry,\n        songLanguages[1] ? { name: songLanguages[1].name, filters: { language: songLanguages[1].name } } : null,\n        { name: 'Classics', filters: { yearBefore: 1995 } },\n        { name: 'Modern', filters: { yearAfter: 1995 } },\n        { name: 'Duets', filters: { duet: true } },\n        { name: 'New', filters: { updatedAfter: addDays(new Date(), -31).toISOString() } },\n      ].filter((playlist): playlist is PlaylistEntry => playlist !== null),\n    [songLanguages],\n  );\n};\n\ninterface Props {\n  prefilteredList: SongPreview[];\n  setFilters: (filters: AppliedFilters) => void;\n  closePlaylist: (leavingKey: 'left' | 'right') => void;\n  active: boolean;\n}\n\nexport default function Playlists({ setFilters, active, closePlaylist, prefilteredList }: Props) {\n  const playlists = usePlaylists(prefilteredList);\n\n  const { register, focused, focusElement } = useKeyboardNav({\n    enabled: active,\n    additionalHelp: {\n      // It's possible to leave the playlists with left/right\n      vertical: undefined,\n      'horizontal-vertical': null,\n    },\n  });\n\n  useEffect(() => {\n    if (focused) {\n      const playlist = playlists.find((list) => `playlist-${list.name}` === focused);\n      playlist && setFilters(playlist.filters);\n    }\n  }, [focused, playlists]);\n\n  useKeyboard(\n    {\n      left: () => closePlaylist('left'),\n      right: () => closePlaylist('right'),\n    },\n    active,\n  );\n\n  return (\n    <Container data-test=\"song-list-playlists\">\n      {playlists.map((playlist) => (\n        <Playlist\n          key={playlist.name}\n          {...register(`playlist-${playlist.name}`, () => focusElement(`playlist-${playlist.name}`))}\n          {...(!active ? { focused: false, active: `playlist-${playlist.name}` === focused } : {})}>\n          {playlist.name}\n        </Playlist>\n      ))}\n    </Container>\n  );\n}\n\nconst Container = styled.div`\n  background: rgba(0, 0, 0, 0.7);\n  width: 100vh;\n  transform-origin: top right;\n  transform: rotate(-90deg);\n  position: absolute;\n  left: -100vh;\n  top: 0;\n  font-size: 3.6rem;\n  box-sizing: border-box;\n  display: flex;\n  flex-direction: row-reverse;\n\n  h2 {\n    ${typography};\n    margin: 0;\n  }\n`;\n\nconst Playlist = styled(Button)<{ active?: boolean }>`\n  font-size: 3rem;\n  flex: 1;\n  padding: 1.5rem;\n  ${(props) => props.active === false && `opacity: .5;`}\n`;\n","import styled from '@emotion/styled';\nimport { Input } from 'Elements/Input';\nimport { REGULAR_ALPHA_CHARS } from 'hooks/useKeyboard';\nimport { useEffect, useRef, useState } from 'react';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { AppliedFilters } from 'Scenes/SingASong/SongSelection/Hooks/useSongList';\n\ninterface Props {\n  onSongFiltered: (filters: AppliedFilters) => void;\n  filters: AppliedFilters;\n  showFilters: boolean;\n}\nexport default function QuickSearch({ onSongFiltered, filters }: Props) {\n  const searchInput = useRef<HTMLInputElement | null>(null);\n  const [isFocused, setIsFocused] = useState(false);\n\n  const onLeave = () => {\n    searchInput.current?.blur();\n  };\n\n  useHotkeys('down', onLeave, { enabled: isFocused, enableOnTags: ['INPUT'] });\n\n  const focusSearch = (key?: string) => {\n    const searchLength = filters.search?.length ?? 0;\n    if (searchLength > 1) {\n      onSongFiltered({\n        ...filters,\n        search: ' ',\n      });\n    } else if (searchLength === 0 && key) {\n      onSongFiltered({\n        ...filters,\n        search: key,\n      });\n    }\n\n    searchInput.current?.focus();\n  };\n\n  useHotkeys(\n    REGULAR_ALPHA_CHARS,\n    (e) => {\n      focusSearch(e.key);\n    },\n    { enabled: !isFocused },\n  );\n\n  useHotkeys(\n    'Backspace',\n    (e) => {\n      focusSearch();\n    },\n    { enabled: !isFocused },\n  );\n  const setSearch = (value: string) => {\n    onSongFiltered({\n      ...filters,\n      search: value.trim(),\n    });\n  };\n\n  useEffect(() => {\n    searchInput.current?.focus();\n  }, [searchInput]);\n\n  return (\n    <Container data-test=\"song-list-search\">\n      <FilterItem large>\n        <form\n          data-test=\"filters-search-form\"\n          onSubmit={(e) => {\n            e.preventDefault();\n            searchInput.current?.blur();\n          }}>\n          <Input\n            onFocus={() => setIsFocused(true)}\n            onBlur={() => setIsFocused(false)}\n            focused={isFocused}\n            label=\"Search\"\n            value={filters.search ?? ''}\n            onChange={setSearch}\n            ref={searchInput}\n            data-test=\"filters-search\"\n          />\n        </form>\n      </FilterItem>\n    </Container>\n  );\n}\n\nconst Container = styled.div`\n  background: rgba(0, 0, 0, 0.7);\n  padding: 2rem;\n  font-size: 3rem;\n  box-sizing: border-box;\n  display: flex;\n  flex-direction: row;\n  gap: 2rem;\n  position: fixed;\n  z-index: 200;\n  top: 4.5rem;\n  left: 30rem;\n  right: 30rem;\n`;\n\nconst FilterItem = styled.div<{ large?: boolean }>`\n  flex: ${(props) => (props.large ? 1.5 : 1)};\n`;\n","import styled from '@emotion/styled';\nimport { typography } from 'Elements/cssMixins';\nimport { useEffect, useState } from 'react';\nimport { MobilePhoneModeSetting, useSettingValue } from 'Scenes/Settings/SettingsState';\n\ninterface Props {\n  keyboardControl: boolean;\n}\n\nconst SHOW_TIP_TIMEOUT_MS = 10_000;\n\nexport default function SelectRandomTip({ keyboardControl }: Props) {\n  const [isVisible, setIsVisible] = useState(false);\n  useEffect(() => {\n    if (!keyboardControl) {\n      setIsVisible(false);\n    } else {\n      const timeout = setTimeout(() => setIsVisible(true), SHOW_TIP_TIMEOUT_MS);\n\n      return () => clearTimeout(timeout);\n    }\n  }, [keyboardControl]);\n\n  const [mobilePhoneMode] = useSettingValue(MobilePhoneModeSetting);\n\n  if (mobilePhoneMode) {\n    return null;\n  }\n\n  return (\n    <Container visible={isVisible}>\n      Can't decide? Click <Kbd>Shift</Kbd> + <Kbd>R</Kbd> to pick random song\n    </Container>\n  );\n}\n\nconst Container = styled.div<{ visible: boolean }>`\n  @keyframes shake {\n    2.5%,\n    22.5% {\n      transform: translate3d(-0.1rem, 0, 0);\n    }\n\n    5%,\n    20% {\n      transform: translate3d(0.2rem, 0, 0);\n    }\n\n    7.5%,\n    12.5%,\n    17.5% {\n      transform: translate3d(-0.4rem, 0, 0);\n    }\n\n    10%,\n    15% {\n      transform: translate3d(0.4rem, 0, 0);\n    }\n  }\n  animation: shake 5s both infinite;\n  ${typography};\n  pointer-events: none;\n  position: fixed;\n  transform: scale(${(props) => (props.visible ? 1 : 0)});\n  opacity: ${(props) => (props.visible ? 1 : 0)};\n  text-align: center;\n  font-size: 4.8rem;\n  text-shadow: 0 0 3.5rem black, 0 0 3.5rem black, 0 0 3.5rem black, 0 0 3.5rem black, 0 0 3.5rem black,\n    0 0 3.5rem black, 0 0 3.5rem black;\n  width: 100%;\n  z-index: 4;\n  padding: 2.5rem;\n  transition: ease 500ms;\n`;\n\nconst Kbd = styled.kbd<{ disabled?: boolean }>`\n  margin: 0.1rem;\n  padding: 0.2rem 2rem;\n  border-radius: 1.5rem;\n  border: 0.6rem solid rgb(204, 204, 204);\n  border-bottom-color: rgb(150, 150, 150);\n  border-right-color: rgb(150, 150, 150);\n  line-height: 1.4;\n  display: inline-block;\n  background-color: rgb(247, 247, 247);\n  text-shadow: 0 0.5rem 0 #fff;\n\n  opacity: ${(props) => (props.disabled ? 0.25 : 1)};\n`;\n","/**\n * https://en.wikipedia.org/wiki/List_of_official_languages_by_country_and_territory\n const data = {};\n\n (() => {\n let countryCodes = (() => {\n const langNames = new Intl.DisplayNames(['en'], { type: 'region' });\n const langMap = {};\n for (let i = 0; i < 26; i++) {\n for (let j = 0; j < 26; j++) {\n let code = String.fromCharCode(97 + i) + String.fromCharCode(97 + j);\n let name = langNames.of(code.toUpperCase());\n if (name !== code && name !== undefined) {\n langMap[name] = code;\n }\n }\n }\n const langMap2 = {\n // Avoid using deprecated codes:\n Akan: 'ak',\n Hebrew: 'he',\n Indonesian: 'id',\n Javanese: 'jv',\n Romanian: 'ro',\n Yiddish: 'yi',\n // Optional extras:\n Tagalog: 'tl',\n English: 'gb',\n Korean: 'kr',\n Swedish: 'se',\n Latin: 'va',\n 'Czech Republic': 'cz',\n 'Antigua and Barbuda': 'ag',\n 'Bosnia and Herzegovina': 'ba',\n 'Trinidad and Tobago': 'tt',\n Transnistria: 'md',\n 'South Ossetia': 'ge',\n Somaliland: 'so',\n 'São Tomé and Príncipe': 'st',\n Turkey: 'tr',\n\n 'Saint Vincent and the Grenadines': 'vc',\n 'Saint Lucia': 'lc',\n 'Saint Kitts and Nevis': 'kn',\n 'Sahrawi Arab Democratic Republic': 'eh',\n 'Northern Cyprus': 'cy',\n 'Myanmar': 'mm',\n 'Federated States of Micronesia': 'fm',\n 'Sovereign Military Order of Malta': 'mt',\n 'Ivory Coast': 'ci',\n 'East Timor': 'tl',\n 'Republic of the Congo': 'cg',\n 'Democratic Republic of the Congo': 'cd',\n\n\n\n };\n return { ...langMap, ...langMap2 };\n })();\n\n document.querySelector('table.wikitable > tbody').querySelectorAll('tr').forEach((tr) => {\n /// get first two td elements from tr\n const [first, second] = tr.querySelectorAll('td');\n\n function getValues(td) {\n let values = td.innerText.split('\\n').map((s) => s.trim());\n /// clean the values from all non alphan characters\n return values.map((s) => s.replace(/[^a-zA-Z ]/g, '')).filter(Boolean);\n }\n\n const country = first.querySelector('a')?.innerText ?? getValues(first)[0];\n const languages = getValues(second);\n /// country is a name of the country - convert it to ISO 3166-1 alpha-2 code\n if (countryCodes[country]) {\n data[countryCodes[country]] = languages;\n } else {\n console.log(`No country code for ${country}`);\n }\n });\n\n console.log(JSON.stringify(data, null, 2));\n })();\n */\n// const langMap = {\nconst langMap: Record<string, string[]> = JSON.parse(`{\n  \"af\": [\n    \"Persian Dari\",\n    \"Pashto\"\n  ],\n  \"al\": [\n    \"Albanian\"\n  ],\n  \"dz\": [\n    \"Arabic\",\n    \"Berber\"\n  ],\n  \"ad\": [\n    \"Catalan\"\n  ],\n  \"ao\": [\n    \"Portuguese\"\n  ],\n  \"ag\": [\n    \"English\"\n  ],\n  \"ar\": [\n    \"Spanish\"\n  ],\n  \"am\": [\n    \"Armenian\"\n  ],\n  \"au\": [\n    \"English\"\n  ],\n  \"at\": [\n    \"German\"\n  ],\n  \"az\": [\n    \"Azerbaijani\"\n  ],\n  \"bs\": [\n    \"English\"\n  ],\n  \"bh\": [\n    \"Arabic\"\n  ],\n  \"bd\": [\n    \"Bengali\"\n  ],\n  \"bb\": [\n    \"English\"\n  ],\n  \"by\": [\n    \"Belarusian\",\n    \"Russian\"\n  ],\n  \"be\": [\n    \"Dutch\",\n    \"French\",\n    \"German\"\n  ],\n  \"bz\": [\n    \"English\"\n  ],\n  \"dy\": [\n    \"French\"\n  ],\n  \"bt\": [\n    \"Dzongkha\"\n  ],\n  \"bo\": [\n    \"Spanish\",\n    \"Aymara\",\n    \"Araona\",\n    \"Baure\",\n    \"Bsiro Chiquitano\",\n    \"Canichana\",\n    \"Cavinea\",\n    \"Cayubaba\",\n    \"Chcobo\",\n    \"Chimn\",\n    \"Ese Ejja\",\n    \"Guaran\",\n    \"Guarasuwe\",\n    \"Guarayu\",\n    \"Itonama\",\n    \"Leco\",\n    \"Machajuyai\",\n    \"Machineri\",\n    \"Maropa\",\n    \"Mojeo\",\n    \"Mojeo\",\n    \"Mor\",\n    \"Mosetn\",\n    \"Movima\",\n    \"Pacawara\",\n    \"Puquina\",\n    \"Quechua\",\n    \"Sirion\",\n    \"Tacana\",\n    \"Tapiet\",\n    \"Toromona\",\n    \"Uru-Chipaya\",\n    \"Weenhayek\",\n    \"Yaminawa\",\n    \"Yuki\",\n    \"Yuracar\",\n    \"Zamuco\"\n  ],\n  \"ba\": [\n    \"Bosnian\",\n      \"Croatian\",\n      \"Serbian\"\n  ],\n  \"bw\": [\n    \"English\"\n  ],\n  \"br\": [\n    \"Portuguese\"\n  ],\n  \"bn\": [\n    \"Malay\"\n  ],\n  \"bg\": [\n    \"Bulgarian\"\n  ],\n  \"hv\": [\n    \"French\"\n  ],\n  \"bi\": [\n    \"French\",\n    \"Kirundi\",\n    \"English\"\n  ],\n  \"kh\": [\n    \"Khmer\"\n  ],\n  \"cm\": [\n    \"English\",\n    \"French\"\n  ],\n  \"ca\": [\n    \"English\",\n    \"French\"\n  ],\n  \"cv\": [\n    \"Portuguese\"\n  ],\n  \"cf\": [\n    \"French\",\n    \"Sango\"\n  ],\n  \"td\": [\n    \"Arabic\",\n    \"French\"\n  ],\n  \"cl\": [\n    \"Spanish\"\n  ],\n  \"cn\": [\n    \"Chinese\"\n  ],\n  \"cx\": [\n    \"English\",\n    \"Chinese\",\n    \"Malay\"\n  ],\n  \"cc\": [\n    \"English\",\n    \"Cocos Malay\"\n  ],\n  \"co\": [\n    \"Spanish\"\n  ],\n  \"km\": [\n    \"Arabic\",\n    \"Comorian\",\n    \"French\"\n  ],\n  \"cd\": [\n    \"French\"\n  ],\n  \"cg\": [\n    \"French\"\n  ],\n  \"ck\": [\n    \"English\",\n    \"Cook Islands Mori\"\n  ],\n  \"cr\": [\n    \"Spanish\"\n  ],\n  \"hr\": [\n    \"Croatian\"\n  ],\n  \"cu\": [\n    \"Spanish\"\n  ],\n  \"cy\": [\n    \"Turkish\"\n  ],\n  \"cz\": [\n    \"Czech\",\n    \"Slovak\"\n  ],\n  \"dk\": [\n    \"Danish\"\n  ],\n  \"dj\": [\n    \"Arabic\",\n    \"French\"\n  ],\n  \"dm\": [\n    \"English\"\n  ],\n  \"do\": [\n    \"Spanish\"\n  ],\n  \"tl\": [\n    \"Portuguese\",\n    \"Tetum\"\n  ],\n  \"ec\": [\n    \"Spanish\",\n    \"Quechua\"\n  ],\n  \"eg\": [\n    \"Arabic\"\n  ],\n  \"sv\": [\n    \"Spanish\"\n  ],\n  \"gq\": [\n    \"French\",\n    \"Portuguese\",\n    \"Spanish\"\n  ],\n  \"er\": [\n    \"Tigrinya\"\n  ],\n  \"ee\": [\n    \"Estonian\"\n  ],\n  \"sz\": [\n    \"English\",\n    \"Swazi\"\n  ],\n  \"et\": [\n    \"Afar\",\n    \"Amharic\",\n    \"Oromo\",\n    \"Somali\",\n    \"Tigrinya\"\n  ],\n  \"fj\": [\n    \"English\",\n    \"Fijian\",\n    \"Fiji Hindi\"\n  ],\n  \"fi\": [\n    \"Finnish\",\n    \"Swedish\"\n  ],\n  \"fx\": [\n    \"French\"\n  ],\n  \"ga\": [\n    \"French\"\n  ],\n  \"gm\": [\n    \"English\"\n  ],\n  \"ge\": [\n    \"Ossetian\",\n    \"Russian\"\n  ],\n  \"de\": [\n    \"German\"\n  ],\n  \"gh\": [\n    \"English\"\n  ],\n  \"gr\": [\n    \"Greek\"\n  ],\n  \"gd\": [\n    \"English\"\n  ],\n  \"gt\": [\n    \"Spanish\"\n  ],\n  \"gn\": [\n    \"French\"\n  ],\n  \"gw\": [\n    \"Portuguese\"\n  ],\n  \"gy\": [\n    \"English\"\n  ],\n  \"ht\": [\n    \"French\",\n    \"Creole\"\n  ],\n  \"hn\": [\n    \"Spanish\"\n  ],\n  \"hu\": [\n    \"Hungarian\"\n  ],\n  \"is\": [\n    \"Icelandic\"\n  ],\n  \"in\": [\n    \"Hindi\",\n    \"English\"\n  ],\n  \"id\": [\n    \"Indonesian\"\n  ],\n  \"ir\": [\n    \"Persian\"\n  ],\n  \"iq\": [\n    \"Arabic\",\n    \"Kurdish\"\n  ],\n  \"ie\": [\n    \"Irish\",\n    \"English\"\n  ],\n  \"il\": [\n    \"Hebrew\"\n  ],\n  \"it\": [\n    \"Italian\"\n  ],\n  \"ci\": [\n    \"French\"\n  ],\n  \"jm\": [\n    \"English\"\n  ],\n  \"jp\": [\n    \"Japanese\"\n  ],\n  \"jo\": [\n    \"Arabic\"\n  ],\n  \"kz\": [\n    \"Kazakh\",\n    \"Russian\"\n  ],\n  \"ke\": [\n    \"English\",\n    \"Swahili\"\n  ],\n  \"ki\": [\n    \"English\",\n    \"Gilbertese\"\n  ],\n  \"kp\": [\n    \"Korean\"\n  ],\n  \"kr\": [\n    \"Korean\"\n  ],\n  \"xk\": [\n    \"Albanian\",\n    \"Serbian\"\n  ],\n  \"kw\": [\n    \"Arabic\"\n  ],\n  \"kg\": [\n    \"Kyrgyz\",\n    \"Russian\"\n  ],\n  \"la\": [\n    \"Lao\"\n  ],\n  \"lv\": [\n    \"Latvian\"\n  ],\n  \"lb\": [\n    \"Arabic\"\n  ],\n  \"ls\": [\n    \"Sotho\",\n    \"English\"\n  ],\n  \"lr\": [\n    \"English\"\n  ],\n  \"ly\": [\n    \"Arabic\"\n  ],\n  \"li\": [\n    \"German\"\n  ],\n  \"lt\": [\n    \"Lithuanian\"\n  ],\n  \"lu\": [\n    \"French\",\n    \"German\",\n    \"Luxembourgish\"\n  ],\n  \"mg\": [\n    \"French\",\n    \"Malagasy\"\n  ],\n  \"mw\": [\n    \"English\",\n    \"Chichewa\"\n  ],\n  \"my\": [\n    \"Malay\"\n  ],\n  \"mv\": [\n    \"Dhivehi\"\n  ],\n  \"ml\": [\n    \"Bambara\",\n    \"Bobo\",\n    \"Bozo\",\n    \"Dogon\",\n    \"Fula\",\n    \"Hassaniya\",\n    \"Kassonke\",\n    \"Maninke\",\n    \"Minyanka\",\n    \"Senufo\",\n    \"Songhay\",\n    \"Soninke\",\n    \"Tamasheq\"\n  ],\n  \"mt\": [\n    \"Italian\"\n  ],\n  \"mh\": [\n    \"English\",\n    \"Marshallese\"\n  ],\n  \"mr\": [\n    \"Arabic\"\n  ],\n  \"mu\": [\n    \"English\",\n    \"Morisien\"\n  ],\n  \"mx\": [\n    \"Spanish\"\n  ],\n  \"fm\": [\n    \"English\"\n  ],\n  \"md\": [\n    \"Moldovan\",\n    \"Russian\",\n    \"Ukrainian\"\n  ],\n  \"mc\": [\n    \"French\"\n  ],\n  \"mn\": [\n    \"Mongolian\"\n  ],\n  \"me\": [\n    \"Montenegrin\"\n  ],\n  \"ma\": [\n    \"Arabic\",\n    \"Berber\"\n  ],\n  \"mz\": [\n    \"Portuguese\"\n  ],\n  \"mm\": [\n    \"Burmese\"\n  ],\n  \"na\": [\n    \"English\"\n  ],\n  \"nr\": [\n    \"English\",\n    \"Nauruan\"\n  ],\n  \"np\": [\n    \"Nepali\"\n  ],\n  \"nl\": [\n    \"Dutch\"\n  ],\n  \"nz\": [\n    \"English\",\n    \"Maori\"\n  ],\n  \"ni\": [\n    \"Spanish\"\n  ],\n  \"ne\": [\n    \"French\"\n  ],\n  \"ng\": [\n    \"English\"\n  ],\n  \"nu\": [\n    \"English\",\n    \"Niuean\"\n  ],\n  \"nf\": [\n    \"English\",\n    \"Norfuk\"\n  ],\n  \"mk\": [\n    \"Macedonian\",\n    \"Albanian\"\n  ],\n  \"no\": [\n    \"Norwegian\",\n    \"Sami\"\n  ],\n  \"om\": [\n    \"Arabic\"\n  ],\n  \"pk\": [\n    \"Urdu\",\n    \"English\"\n  ],\n  \"pw\": [\n    \"English\",\n    \"Palauan\"\n  ],\n  \"ps\": [\n    \"Arabic\"\n  ],\n  \"pa\": [\n    \"Spanish\"\n  ],\n  \"pg\": [\n    \"English\",\n    \"Hiri Motu\",\n    \"Tok Pisin\"\n  ],\n  \"py\": [\n    \"Spanish\",\n    \"Guaran\"\n  ],\n  \"pe\": [\n    \"Spanish\",\n    \"Quechua\",\n    \"Aymara\",\n    \"Ashninka\"\n  ],\n  \"ph\": [\n    \"Filipino\",\n    \"English\"\n  ],\n  \"pl\": [\n    \"Polish\"\n  ],\n  \"pt\": [\n    \"Portuguese\"\n  ],\n  \"qa\": [\n    \"Arabic\"\n  ],\n  \"ro\": [\n    \"Romanian\"\n  ],\n  \"su\": [\n    \"Russian\"\n  ],\n  \"rw\": [\n    \"English\",\n    \"French\",\n    \"Kinyarwanda\",\n    \"Swahili\"\n  ],\n  \"eh\": [\n    \"Arabic\"\n  ],\n  \"kn\": [\n    \"English\"\n  ],\n  \"lc\": [\n    \"English\"\n  ],\n  \"vc\": [\n    \"English\"\n  ],\n  \"ws\": [\n    \"English\",\n    \"Samoan\"\n  ],\n  \"sm\": [\n    \"Italian\"\n  ],\n  \"st\": [\n    \"Portuguese\"\n  ],\n  \"sa\": [\n    \"Arabic\"\n  ],\n  \"sn\": [\n    \"French\"\n  ],\n  \"yu\": [\n    \"Serbian\"\n  ],\n  \"sc\": [\n    \"English\",\n    \"French\",\n    \"Creole\"\n  ],\n  \"sl\": [\n    \"English\"\n  ],\n  \"sg\": [\n    \"English\",\n    \"Malay\",\n    \"Chinese\",\n    \"Tamil\"\n  ],\n  \"sk\": [\n    \"Slovak\"\n  ],\n  \"si\": [\n    \"Slovene\"\n  ],\n  \"sb\": [\n    \"English\"\n  ],\n  \"so\": [\n    \"Arabic\",\n    \"English\",\n    \"Somali\"\n  ],\n  \"za\": [\n    \"Afrikaans\",\n    \"English\",\n    \"Ndebele\",\n    \"Sotho\",\n    \"Swazi\",\n    \"Tsonga\",\n    \"Tswana\",\n    \"Venda\",\n    \"Xhosa\",\n    \"Zulu\"\n  ],\n  \"ss\": [\n    \"English\"\n  ],\n  \"es\": [\n    \"Spanish\"\n  ],\n  \"lk\": [\n    \"Sinhala\",\n    \"Tamil\"\n  ],\n  \"sd\": [\n    \"Arabic\",\n    \"English\"\n  ],\n  \"sr\": [\n    \"Dutch\"\n  ],\n  \"se\": [\n    \"Swedish\"\n  ],\n  \"ch\": [\n    \"French\",\n    \"German\",\n    \"Italian\",\n    \"Romansh\"\n  ],\n  \"sy\": [\n    \"Arabic\"\n  ],\n  \"tw\": [\n    \"Chinese\"\n  ],\n  \"tj\": [\n    \"Tajik\"\n  ],\n  \"tz\": [\n    \"Swahili\",\n    \"English\"\n  ],\n  \"th\": [\n    \"Thai\"\n  ],\n  \"tg\": [\n    \"French\"\n  ],\n  \"tk\": [\n    \"English\",\n    \"Tokelauan\"\n  ],\n  \"to\": [\n    \"English\",\n    \"Tongan\"\n  ],\n  \"tt\": [\n    \"English\"\n  ],\n  \"tn\": [\n    \"Arabic\"\n  ],\n  \"tr\": [\n    \"Turkish\"\n  ],\n  \"tm\": [\n    \"Turkmen\"\n  ],\n  \"tv\": [\n    \"Tuvaluan\",\n    \"English\"\n  ],\n  \"ug\": [\n    \"English\",\n    \"Swahili\"\n  ],\n  \"ua\": [\n    \"Ukrainian\"\n  ],\n  \"ae\": [\n    \"Arabic\"\n  ],\n  \"uk\": [\n    \"English\"\n  ],\n  \"us\": [\n    \"English\"\n  ],\n  \"uy\": [\n    \"Spanish\"\n  ],\n  \"uz\": [\n    \"Uzbek\"\n  ],\n  \"vu\": [\n    \"English\",\n    \"French\",\n    \"Bislama\"\n  ],\n  \"va\": [\n    \"Italian\"\n  ],\n  \"ve\": [\n    \"Spanish\"\n  ],\n  \"vn\": [\n    \"Vietnamese\"\n  ],\n  \"ye\": [\n    \"Arabic\"\n  ],\n  \"zm\": [\n    \"English\"\n  ],\n  \"zw\": [\n    \"Chewa\",\n    \"Chibarwe\",\n    \"English\",\n    \"Kalanga\",\n    \"Khoisan\",\n    \"Nambya\",\n    \"Ndau\",\n    \"Ndebele\",\n    \"Shangani\",\n    \"Shona\",\n    \"Sotho\",\n    \"Tonga\",\n    \"Tswana\",\n    \"Venda\",\n    \"Xhosa\"\n  ]\n}`);\n// };\n\nexport default langMap;\n","import { Flag } from 'Elements/Flag';\nimport langMap from 'Elements/Flag/mapping';\nimport { SongPreview } from 'interfaces';\nimport { useMemo } from 'react';\n\n// skipping US and GB songs as there are a lot of them making the list look messy\nconst SKIPPED_ORIGINS = ['US', 'GB'];\n\ninterface Props {\n  song: Pick<SongPreview, 'language' | 'artistOrigin'>;\n}\nexport default function SongFlag({ song, ...props }: Props) {\n  const lang = Array.isArray(song.language) ? song.language[0] : song.language;\n\n  const isLangArtistOrigin = useMemo(() => {\n    if (!song.artistOrigin) return false;\n    return langMap[song.artistOrigin.toLowerCase()]?.includes(lang) ?? false;\n  }, [song.artistOrigin, lang]);\n\n  return (\n    <>\n      {isLangArtistOrigin && !SKIPPED_ORIGINS.includes(song.artistOrigin!) ? (\n        <Flag isocode={song.artistOrigin!} {...props} />\n      ) : song.language !== 'English' ? (\n        <Flag language={song.language} {...props} />\n      ) : null}\n    </>\n  );\n}\n","import events from 'GameEvents/GameEvents';\nimport { useEventEffect } from 'GameEvents/hooks';\nimport { SongStats, fetchSongStats, getSongKey, storeSongStats } from 'Songs/stats/common';\nimport { SongPreview } from 'interfaces';\nimport { useEffect, useState } from 'react';\n\nexport const useSongStats = (song: Pick<SongPreview, 'artist' | 'title'>) => {\n  const [stats, setStats] = useState<SongStats | null>(null);\n\n  const storageKey = getSongKey(song);\n\n  const setSongStats = async () => {\n    setStats(await fetchSongStats(song));\n  };\n\n  useEffect(() => {\n    setSongStats();\n  }, [storageKey]);\n\n  useEventEffect(events.songStatStored, setSongStats);\n\n  return stats;\n};\n\nexport const useEditScore = (song: Pick<SongPreview, 'artist' | 'title'>) => {\n  return async (singId: string, score: number, oldName: string, newName: string) => {\n    const storageKey = getSongKey(song);\n    const data = await fetchSongStats(song);\n\n    const newScores = data.scores.map((record) => {\n      if (record.setup.id !== singId) return record;\n\n      const newScores = record.scores.map((previousScore) => {\n        if (previousScore.name !== oldName || previousScore.score !== score) return previousScore;\n\n        return { name: newName.trim(), score };\n      });\n\n      return { ...record, scores: newScores };\n    });\n\n    const newData = { ...data, scores: newScores };\n\n    await storeSongStats(song, newData);\n    events.songScoreUpdated.dispatch(storageKey, newData, newName.trim());\n  };\n};\n","import { css } from '@emotion/react';\nimport styled from '@emotion/styled';\nimport PeopleAltIcon from '@mui/icons-material/PeopleAlt';\nimport { typography } from 'Elements/cssMixins';\nimport styles from 'Scenes/Game/Singing/GameOverlay/Drawing/styles';\nimport SongFlag from 'Scenes/SingASong/SongSelection/SongCard/SongFlag';\nimport { useSongStats } from 'Songs/stats/hooks';\nimport { addDays, isAfter } from 'date-fns';\nimport { SongPreview } from 'interfaces';\nimport { ComponentProps, ReactNode, useCallback } from 'react';\n\ninterface Props extends ComponentProps<typeof SongCardContainer> {\n  song: SongPreview;\n  focused: boolean;\n  index?: number;\n  expanded?: boolean;\n  background?: boolean;\n  handleClick?: (index: number) => void;\n  video?: ReactNode;\n}\n\nexport const FinalSongCard = ({\n  song,\n  focused,\n  video,\n  children,\n  index,\n  handleClick,\n  background = true,\n  expanded = false,\n  ...restProps\n}: Props) => {\n  const onClickCallback = useCallback(() => (handleClick ? handleClick(index!) : undefined), [handleClick, index]);\n\n  return (\n    <SongCardContainer {...restProps} onClick={handleClick ? onClickCallback : undefined}>\n      {background && (\n        <SongCardBackground\n          style={{\n            backgroundImage: `url('https://i3.ytimg.com/vi/${song.video}/hqdefault.jpg')`,\n          }}\n          focused={focused}\n          expanded={expanded}\n        />\n      )}\n      <SongInfo expanded={expanded}>\n        {!expanded && <SongCardStatsIndicator song={song} />}\n        {song.tracksCount > 1 && !expanded && (\n          <MultiTrackIndicator data-test=\"multitrack-indicator\">\n            <PeopleAltIcon />\n            &nbsp; Duet\n          </MultiTrackIndicator>\n        )}\n        <SongListEntryDetailsArtist expanded={expanded}>{song.artist}</SongListEntryDetailsArtist>\n        <SongListEntryDetailsTitle expanded={expanded}>{song.title}</SongListEntryDetailsTitle>\n        <ExpandedData expanded={expanded}>\n          {expanded && (\n            <>\n              {song.author && (\n                <SongAuthor expanded={expanded}>\n                  by&nbsp;\n                  {song.authorUrl ? (\n                    <a href={song.authorUrl} target=\"_blank\" rel=\"noreferrer\">\n                      {song.author}\n                    </a>\n                  ) : (\n                    song.author\n                  )}\n                </SongAuthor>\n              )}\n              <SongListEntryStats song={song} />\n            </>\n          )}\n          {!expanded && <Language song={song} />}\n        </ExpandedData>\n      </SongInfo>\n      {children}\n      {video}\n    </SongCardContainer>\n  );\n};\n\nexport const Language = styled(SongFlag)`\n  height: 2.75rem;\n  object-fit: cover;\n  border-top-right-radius: 1rem;\n  position: absolute;\n  z-index: -1;\n  left: 0rem;\n  bottom: 0rem;\n  opacity: 0.95;\n`;\n\nexport const ExpandedData = styled.div<{ expanded: boolean }>`\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  justify-content: flex-start;\n`;\n\nconst SongInfo = styled.div<{ expanded: boolean }>`\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: flex-end;\n  justify-content: flex-end;\n  z-index: 1;\n  box-sizing: border-box;\n\n  flex-direction: column;\n\n  ${(props) =>\n    props.expanded &&\n    css`\n      align-items: flex-start;\n      justify-content: flex-start;\n    `}\n`;\n\nexport const SongCardContainer = styled.div`\n  font-size: 4.5rem;\n\n  display: flex;\n  align-items: flex-end;\n  justify-content: flex-end;\n  flex-direction: column;\n  box-sizing: border-box;\n  position: relative;\n  padding: 0.5rem;\n\n  border: 0.1rem black solid;\n  border-radius: 1rem;\n`;\n\nexport const SongCardBackground = styled.div<{ focused: boolean; expanded: boolean }>`\n  position: absolute;\n  z-index: -1;\n  inset: 0;\n  ${(props) =>\n    props.theme.graphicSetting === 'high'\n      ? css`\n          background-size: ${props.focused ? 100 : 110}%;\n          ${!props.focused ? 'filter: grayscale(90%);' : ''}\n          ${props.expanded ? 'filter: blur(10px);' : ''}\n                  transition: 300ms;\n          opacity: ${props.focused ? 1 : 0.8};\n        `\n      : css`\n          background-size: 100%;\n          opacity: ${props.focused ? 1 : 0.6};\n        `}\n  background-position: center center;\n`;\n\nexport const SongListEntryDetails = styled.span<{ expanded?: boolean }>`\n  background: rgba(0, 0, 0, 0.7);\n\n  width: auto;\n  display: inline-block;\n  padding: 0.5rem;\n  ${typography};\n\n  text-align: right;\n  font-size: ${({ expanded }) => (expanded ? '6rem' : '2.7rem')};\n`;\n\nexport const SongListEntryDetailsArtist = styled(SongListEntryDetails)`\n  color: ${styles.colors.text.active};\n`;\n\nexport const SongListEntryDetailsTitle = styled(SongListEntryDetails)`\n  margin-top: ${(props) => (props.expanded ? '1.5rem' : '0.5rem')};\n  color: white;\n`;\n\nexport const SongAuthor = styled(SongListEntryDetailsTitle)`\n  font-size: 3rem;\n  margin-top: 3rem;\n`;\n\nexport const SongCardStatsIndicator = ({ song }: { song: SongPreview }) => {\n  const stats = useSongStats(song);\n  const lastPlayed = stats?.scores?.at(-1)?.date ?? false;\n\n  const playedToday = lastPlayed && isAfter(new Date(lastPlayed), addDays(new Date(), -1));\n\n  return stats?.plays ? (\n    <SongStatIndicator data-test=\"song-stat-indicator\">{playedToday ? 'Played today' : stats.plays}</SongStatIndicator>\n  ) : null;\n};\n\nconst SongStatIndicator = styled.div`\n  position: absolute;\n  top: 0.5rem;\n  right: 0.5rem;\n  padding: 0 1rem;\n  height: 2.75rem;\n  min-width: 2.75rem;\n  box-sizing: border-box;\n  border-radius: 5rem;\n  color: white;\n  background: rgba(0, 0, 0, 0.75);\n  font-size: 1.4rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  text-transform: uppercase;\n`;\nconst MultiTrackIndicator = styled(SongStatIndicator)`\n  left: 0.5rem;\n  right: auto;\n\n  svg {\n    width: 1.75rem;\n    height: 1.75rem;\n  }\n`;\n\nexport const SongListEntryStats = ({ song }: { song: SongPreview }) => {\n  const stats = useSongStats(song);\n\n  return (\n    <SongAuthor>\n      {stats?.plays ? `Played ${stats.plays} time${stats.plays > 1 ? 's' : ''}` : 'Never played yet'}\n    </SongAuthor>\n  );\n};\n","import styled from '@emotion/styled';\nimport SwapHorizIcon from '@mui/icons-material/SwapHoriz';\nimport { Button } from 'Elements/Button';\nimport { nextIndex, nextValue, Switcher } from 'Elements/Switcher';\nimport useKeyboardNav from 'hooks/useKeyboardNav';\nimport { GAME_MODE, SingSetup, SongPreview } from 'interfaces';\nimport createPersistedState from 'use-persisted-state';\nimport { ValuesType } from 'utility-types';\nimport isDev from 'utils/isDev';\nimport { v4 } from 'uuid';\n\ninterface Props {\n  songPreview: SongPreview;\n  onNextStep: (setup: SingSetup) => void;\n  keyboardControl: boolean;\n  onExitKeyboardControl: () => void;\n}\n\nconst gameModeNames = {\n  [GAME_MODE.DUEL]: 'Duel',\n  [GAME_MODE.PASS_THE_MIC]: 'Pass The Mic',\n  [GAME_MODE.CO_OP]: 'Cooperation',\n};\n\nconst difficultyNames = ['Hard', 'Medium', 'Easy'];\n\nif (isDev()) {\n  difficultyNames.push('Debug 4');\n  difficultyNames.push('Debug 5');\n  difficultyNames.push('Debug 6');\n}\n\n// added -v3 to the key as the value to handle default selection if it wasnt changed\nconst useSetGameMode = createPersistedState<ValuesType<typeof GAME_MODE> | null>('song_settings-game_mode-v3');\nconst useSetTolerance = createPersistedState<number>('song_settings-tolerance-v2');\n\nexport default function GameSettings({ songPreview, onNextStep, keyboardControl, onExitKeyboardControl }: Props) {\n  const [rememberedMode, setMode] = useSetGameMode(null);\n  const mode = rememberedMode ?? (songPreview.tracksCount > 1 ? GAME_MODE.CO_OP : GAME_MODE.DUEL);\n  const [tolerance, setTolerance] = useSetTolerance(1);\n\n  const handleNextButton = () => {\n    const singSetup = {\n      id: v4(),\n      players: [],\n      mode,\n      tolerance: tolerance + 1,\n    };\n    onNextStep(singSetup);\n  };\n\n  const changeMode = () => {\n    setMode(nextValue(Object.values(GAME_MODE), mode));\n  };\n\n  const changeTolerance = () => setTolerance((current) => nextIndex(difficultyNames, current, -1));\n\n  const { register } = useKeyboardNav({ enabled: keyboardControl, onBackspace: onExitKeyboardControl });\n\n  return (\n    <>\n      <GSSwitcher\n        {...register('difficulty-setting', changeTolerance, 'Change difficulty')}\n        label=\"Difficulty\"\n        value={difficultyNames[tolerance]}\n        data-test-value={difficultyNames[tolerance]}\n      />\n      <GSSwitcher\n        {...register('game-mode-setting', changeMode, 'Change mode')}\n        label=\"Mode\"\n        value={gameModeNames[mode]}\n        data-test-value={gameModeNames[mode]}\n      />\n      <ModeDescription>\n        {mode === GAME_MODE.DUEL && 'Face off against each other - person that earns more points wins.'}\n        {mode === GAME_MODE.CO_OP && 'Join forces and sing together - your points will be added up to a single pool.'}\n        {mode === GAME_MODE.PASS_THE_MIC && (\n          <>\n            For more than 2 players - split into groups and pass the microphone within the group when prompted with{' '}\n            <SwapHorizIcon /> symbol.\n          </>\n        )}\n      </ModeDescription>\n      <PlayButton {...register('next-step-button', handleNextButton, undefined, true)}>Next ➤</PlayButton>\n    </>\n  );\n}\n\nconst PlayButton = styled(Button)`\n  padding: 0.5rem 9rem;\n  font-size: 4.3rem;\n  width: 50rem;\n`;\n\nconst ModeDescription = styled.h3`\n  max-width: 50rem;\n  margin: -1rem 0 1rem !important;\n  padding: 1.5rem;\n  background: rgba(0, 0, 0, 0.7);\n  box-sizing: border-box;\n`;\n\nconst GSSwitcher = styled(Switcher)`\n  font-size: 4.3rem;\n  padding: 1rem;\n  min-width: 50rem;\n  box-sizing: border-box;\n`;\n","import styled from '@emotion/styled';\nimport { Warning } from '@mui/icons-material';\nimport events from 'GameEvents/GameEvents';\nimport { useEventListenerSelector } from 'GameEvents/hooks';\nimport PlayersManager from 'Players/PlayersManager';\nimport usePlayerMic from 'hooks/players/usePlayerMic';\nimport { useCallback, useEffect, useRef, useState } from 'react';\n\nexport default function NoiseDetection() {\n  const inputs = useEventListenerSelector(events.playerInputChanged, () => PlayersManager.getInputs());\n  const isBuiltIn = inputs.some((input) => input.source === 'Microphone');\n\n  const measures = useRef<Array<[number, number]>>([]);\n  const handleMeasure = useCallback((data: [number, number]) => {\n    measures.current.push(data);\n  }, []);\n\n  usePlayerMic(0, 50, handleMeasure);\n\n  const [noiseDetected, setNoiseDetected] = useState(false);\n  useEffect(() => {\n    const interval = setInterval(\n      () => {\n        const noDetection = measures.current.filter(([, freq]) => freq === 0);\n        const detection = measures.current.filter(([, freq]) => freq > 0);\n        const avgNoDetectionVolume = noDetection.reduce((acc, [volume]) => acc + volume, 0) / (noDetection.length + 1);\n        const avgDetectionVolume = detection.reduce((acc, [volume]) => acc + volume, 0) / (detection.length + 1);\n\n        // The logic is that if the singing measures and non-singing measures have similar volume, then there's\n        // something playing in the background that is picked up as singing. If someone is singing into the mic\n        // the non-singing measures are usually quiet compared to singing measures.\n        const isNoisy =\n          detection.length > noDetection.length * 0.1 &&\n          avgDetectionVolume > 0.01 &&\n          avgNoDetectionVolume > 0.01 &&\n          avgDetectionVolume - avgNoDetectionVolume < avgNoDetectionVolume / 2;\n\n        setNoiseDetected(isNoisy);\n        measures.current.length = 0;\n      },\n      noiseDetected ? 5000 : 2500,\n    );\n\n    return () => clearInterval(interval);\n  }, [noiseDetected]);\n\n  return (\n    <NoiseWarningContainer visible={noiseDetected}>\n      <h2>\n        <strong>\n          <Warning />\n        </strong>{' '}\n        Noise detected\n      </h2>\n      <hr />\n      <h4>\n        This might make singing inaccurate. Make sure your microphone doesn't pick up the music.{' '}\n        {isBuiltIn && (\n          <>\n            Alternatively, use your <strong>smartphone as a microphone</strong> instead.\n          </>\n        )}\n      </h4>\n    </NoiseWarningContainer>\n  );\n}\n\nconst NoiseWarningContainer = styled.div<{ visible: boolean }>`\n  opacity: ${(props) => (props.visible ? 1 : 0)};\n  transition: 300ms;\n  background: rgba(0, 0, 0, 0.75);\n  padding: 1rem;\n  max-width: 50rem;\n  position: relative;\n  top: -1rem;\n  left: -0.5rem;\n`;\n","import styled from '@emotion/styled';\nimport { PlayerMicCheck } from 'Elements/VolumeIndicator';\nimport { PlayerEntity } from 'Players/PlayersManager';\nimport Ping from 'Scenes/SingASong/SongSelection/SongSettings/MicCheck/Ping';\nimport PlayerStatus from 'Scenes/SingASong/SongSelection/SongSettings/MicCheck/Status';\nimport usePlayerMicStatus from 'hooks/players/usePlayerMicStatus';\n\ninterface Props {\n  player: PlayerEntity;\n}\nexport default function SinglePlayer({ player }: Props) {\n  const status = usePlayerMicStatus(player.number);\n\n  return (\n    <Indicator key={player.number} data-test={`indicator-player-${player.number}`}>\n      <Ping playerNumber={player.number} />\n      <PlayerStatus status={status} />\n      {status !== 'unavailable' && <PlayerMicCheck playerNumber={player.number} />}\n      <PlayerName className=\"ph-no-capture\">{player.getName()}</PlayerName>\n    </Indicator>\n  );\n}\n\nconst Indicator = styled.div`\n  position: relative;\n  border: 0.1rem solid white;\n  padding: 1rem 3rem;\n  background: black;\n  width: 80%;\n\n  text-align: center;\n  gap: 1.25rem;\n  font-size: 2.3rem;\n  color: white;\n\n  -webkit-text-stroke: 1px black;\n`;\n\nconst PlayerName = styled.span`\n  position: relative;\n  z-index: 1;\n`;\n","import styled from '@emotion/styled';\nimport { typography } from 'Elements/cssMixins';\nimport events from 'GameEvents/GameEvents';\nimport { useEventListener, useEventListenerSelector } from 'GameEvents/hooks';\nimport PlayersManager from 'Players/PlayersManager';\nimport InputManager from 'Scenes/Game/Singing/Input/InputManager';\nimport NoiseDetection from 'Scenes/SingASong/SongSelection/SongSettings/MicCheck/NoiseDetection';\nimport SinglePlayer from 'Scenes/SingASong/SongSelection/SongSettings/MicCheck/SinglePlayer';\nimport { ComponentProps, useEffect } from 'react';\n\nexport default function MicCheck(props: ComponentProps<typeof Container>) {\n  // Force update when the name changes\n  useEventListener(events.playerNameChanged);\n\n  useEffect(() => {\n    InputManager.startMonitoring();\n  }, []);\n\n  const inputs = useEventListenerSelector(events.playerInputChanged, () => PlayersManager.getInputs());\n  const isSetup = inputs.some((input) => input.source !== 'Dummy');\n\n  return (\n    <Container {...props}>\n      <MicChecksContainer>\n        Microphone Check\n        {isSetup ? (\n          PlayersManager.getPlayers().map((player) => <SinglePlayer key={player.number} player={player} />)\n        ) : (\n          <>\n            <Indicator>Mic not setup</Indicator>\n            <h4>Singing will be emulated</h4>\n            <h5>You can setup in the Next step</h5>\n          </>\n        )}\n      </MicChecksContainer>\n      <NoiseDetection />\n    </Container>\n  );\n}\n\nconst Container = styled.div`\n  display: flex;\n  font-size: 3rem;\n  ${typography};\n  margin-bottom: 8.6rem;\n  gap: 3.5rem;\n`;\n\nconst MicChecksContainer = styled.div`\n  gap: 1.25rem;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n`;\n\nconst Indicator = styled.div`\n  position: relative;\n  border: 0.1rem solid white;\n  padding: 1rem 3rem;\n  background: black;\n  width: 80%;\n\n  text-align: center;\n  gap: 1.25rem;\n  font-size: 2.3rem;\n  color: white;\n`;\n","import styled from '@emotion/styled';\nimport { typography } from 'Elements/cssMixins';\nimport { Input } from 'Elements/Input';\nimport { nextIndex } from 'Elements/Switcher';\nimport {\n  ComponentProps,\n  ForwardedRef,\n  forwardRef,\n  KeyboardEventHandler,\n  ReactNode,\n  useImperativeHandle,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport styles from 'Scenes/Game/Singing/GameOverlay/Drawing/styles';\n\ninterface Props extends ComponentProps<typeof Input> {\n  label: ReactNode;\n  value: string;\n  onChange: (value: string) => void;\n  disabled?: boolean;\n  options: string[];\n  placeholder?: string;\n  keyboardNavigationChangeFocus?: (direction: -1 | 1) => void;\n  onBlur?: () => void;\n  className?: string;\n}\n\nexport const Autocomplete = forwardRef(\n  (\n    {\n      options,\n      focused,\n      label,\n      value,\n      onChange,\n      disabled,\n      placeholder,\n      keyboardNavigationChangeFocus,\n      onBlur,\n      className,\n      ...restProps\n    }: Props,\n    forwardedRef: ForwardedRef<HTMLInputElement | null>,\n  ) => {\n    const inputRef = useRef<HTMLInputElement>(null);\n    useImperativeHandle(forwardedRef, () => inputRef.current!);\n\n    const autocompleteMenu = useRef<HTMLDivElement>(null);\n\n    const [isInputFocused, setIsInputFocused] = useState(false);\n    const [focusedOption, setFocusedOption] = useState(-1);\n\n    const filteredOptions = useMemo(\n      () =>\n        options.filter(\n          (option) => option.toLowerCase().trim().includes(value.toLowerCase().trim()) && option !== value,\n        ),\n      [options, value],\n    );\n\n    const handleKeyDown: KeyboardEventHandler<HTMLInputElement> = (e) => {\n      if (e.code === 'ArrowUp' || e.code === 'ArrowDown') {\n        if (filteredOptions.length) {\n          e.preventDefault();\n          const newIndex = nextIndex(filteredOptions, focusedOption, e.code === 'ArrowUp' ? -1 : 1);\n          setFocusedOption(newIndex);\n\n          const option = autocompleteMenu.current?.querySelector(`[data-index=\"${newIndex}\"]`) as HTMLDivElement;\n\n          option?.scrollIntoView({ behavior: 'smooth', block: 'center' });\n        } else {\n          inputRef.current?.blur();\n          keyboardNavigationChangeFocus?.(e.code === 'ArrowUp' ? -1 : 1);\n        }\n      } else if (e.code === 'Enter') {\n        const option = filteredOptions[focusedOption];\n        if (option) {\n          setFocusedOption(-1);\n          onChange(option);\n        } else {\n          inputRef.current?.blur();\n        }\n      }\n    };\n\n    const handleBlur = () => {\n      setTimeout(() => {\n        setIsInputFocused(false);\n        onBlur?.();\n      }, 300);\n    };\n\n    return (\n      <Container className={className}>\n        <Input\n          onFocus={() => setIsInputFocused(true)}\n          onBlur={handleBlur}\n          onKeyDown={handleKeyDown}\n          onChange={onChange}\n          value={value}\n          focused={focused}\n          label={label}\n          disabled={disabled}\n          ref={inputRef}\n          placeholder={placeholder}\n          {...restProps}\n        />\n        {isInputFocused && !!filteredOptions.length && (\n          <AutocompleteMenu ref={autocompleteMenu} role=\"listbox\">\n            {filteredOptions.map((option, index) => (\n              <AutocompleteMenuitem\n                role=\"listitem\"\n                data-index={index}\n                data-focused={index === focusedOption}\n                key={option}\n                focused={index === focusedOption}\n                onClick={() => {\n                  onChange(option);\n                  setFocusedOption(-1);\n                  inputRef.current?.blur();\n                }}>\n                {option}\n              </AutocompleteMenuitem>\n            ))}\n          </AutocompleteMenu>\n        )}\n      </Container>\n    );\n  },\n);\n\nconst Container = styled.div`\n  position: relative;\n`;\n\nconst AutocompleteMenu = styled.div`\n  margin-top: 0.1em;\n  position: absolute;\n  width: 100%;\n  background: black;\n  max-height: ${(1 + 2 * 0.3) * 4}em;\n  overflow-y: auto;\n  z-index: 2;\n`;\n\nconst AutocompleteMenuitem = styled.div<{ focused: boolean }>`\n  ${typography};\n  padding: 0.3em;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  color: ${(props) => (props.focused ? styles.colors.text.active : 'white')};\n  cursor: pointer;\n`;\n\ninterface TestWrapperProps {\n  label: string;\n  options: string[];\n  focused: boolean;\n}\n\nexport const AutocompleteTestWrapper = ({ label, options, focused }: TestWrapperProps) => {\n  const [value, setValue] = useState('');\n  return <Autocomplete value={value} onChange={setValue} label={label} options={options} focused={focused} />;\n};\n","import styled from '@emotion/styled';\nimport { Autocomplete } from 'Elements/Autocomplete';\nimport { Switcher } from 'Elements/Switcher';\nimport events from 'GameEvents/GameEvents';\nimport { useEventListener } from 'GameEvents/hooks';\nimport { PlayerEntity } from 'Players/PlayersManager';\nimport { MAX_NAME_LENGTH } from 'consts';\nimport useKeyboardNav from 'hooks/useKeyboardNav';\nimport { PlayerSetup, SongPreview } from 'interfaces';\nimport { useRef, useState } from 'react';\n\ninterface Props {\n  multipleTracks: boolean;\n  player: PlayerEntity | undefined;\n  songPreview: SongPreview;\n  onChange: (setup: PlayerSetup) => void;\n  setup: PlayerSetup;\n  playerNames: string[];\n  register: ReturnType<typeof useKeyboardNav>['register'];\n}\n\nconst getTrackName = (tracks: SongPreview['tracks'], index: number) => tracks[index]?.name ?? `Track ${index + 1}`;\n\nexport default function SinglePlayer({\n  multipleTracks,\n  player,\n  songPreview,\n  playerNames,\n  register,\n  onChange,\n  setup,\n}: Props) {\n  const [inputTouched, setInputTouched] = useState(false);\n  const nameRef = useRef<HTMLInputElement | null>(null);\n  // Force update when the name changes\n  useEventListener(events.playerNameChanged);\n\n  if (player === undefined) {\n    return null;\n  }\n\n  const togglePlayerTrack = () =>\n    onChange({ number: player.number, track: (setup.track + 1) % songPreview.tracksCount });\n\n  const onNameChange = (newName: string) => {\n    setInputTouched(true);\n    player.setName(newName);\n  };\n\n  const isDefaultName = !inputTouched;\n  const currentName = player.getName();\n\n  return (\n    <>\n      <PlayerName\n        maxLength={MAX_NAME_LENGTH}\n        className=\"ph-no-capture\"\n        value={isDefaultName ? '' : currentName}\n        placeholder={isDefaultName ? currentName : undefined}\n        options={playerNames}\n        onChange={onNameChange}\n        label=\"Name:\"\n        ref={nameRef}\n        {...register(`player-${player.number}-name`, () => nameRef.current?.focus())}\n      />\n      {multipleTracks && (\n        <Track\n          {...register(`player-${player.number}-track-setting`, togglePlayerTrack, 'Change track')}\n          label=\"Track\"\n          value={getTrackName(songPreview.tracks, setup.track)}\n          data-test-value={setup.track + 1}\n        />\n      )}\n    </>\n  );\n}\n\nconst PlayerName = styled(Autocomplete)`\n  input {\n    font-size: 4.5rem;\n  }\n\n  [role='listbox'] {\n    max-height: ${6 * (4.5 + 0.3)}rem;\n  }\n`;\nconst Track = styled(Switcher)`\n  font-size: 4.5rem;\n  padding: 1.1rem;\n`;\n","import styled from '@emotion/styled';\nimport { Button } from 'Elements/Button';\nimport { typography } from 'Elements/cssMixins';\nimport gameEvents from 'GameEvents/GameEvents';\nimport { useEventEffect } from 'GameEvents/hooks';\nimport PlayersManager from 'Players/PlayersManager';\nimport InputManager from 'Scenes/Game/Singing/Input/InputManager';\nimport SelectInputModal from 'Scenes/SelectInput/SelectInputModal';\nimport { MicSetupPreferenceSetting, MobilePhoneModeSetting, useSettingValue } from 'Scenes/Settings/SettingsState';\nimport SinglePlayer from 'Scenes/SingASong/SongSelection/SongSettings/PlayerSettings/SinglePlayer';\nimport { PLAYER_NAMES_SESSION_STORAGE_KEY } from 'hooks/players/consts';\nimport useKeyboardNav from 'hooks/useKeyboardNav';\nimport { PlayerSetup, SongPreview } from 'interfaces';\nimport { useEffect, useMemo, useState } from 'react';\n\ninterface Props {\n  songPreview: SongPreview;\n  onNextStep: (players: PlayerSetup[]) => void;\n  keyboardControl: boolean;\n  onExitKeyboardControl: () => void;\n}\n\nexport default function PlayerSettings({ songPreview, onNextStep, keyboardControl, onExitKeyboardControl }: Props) {\n  const [mobilePhoneMode] = useSettingValue(MobilePhoneModeSetting);\n  const [storedPreference] = useSettingValue(MicSetupPreferenceSetting);\n\n  const players = PlayersManager.getPlayers();\n  const multipleTracks = !mobilePhoneMode && players.length === 2 && songPreview.tracksCount > 1;\n  const initialisePlayerSetup = () =>\n    players.map((player, index) => ({\n      number: player.number,\n      track: multipleTracks ? Math.min(index, songPreview.tracksCount - 1) : 0,\n    }));\n  const [playerSetup, setPlayerSetup] = useState<PlayerSetup[]>(initialisePlayerSetup());\n\n  useEventEffect([gameEvents.playerAdded, gameEvents.playerRemoved], () => setPlayerSetup(initialisePlayerSetup()));\n\n  const playerList = players.map(\n    (player, index) => playerSetup.find((setup) => setup.number === player.number) ?? initialisePlayerSetup()[index],\n  );\n\n  const playerNames = useMemo<string[]>(\n    () => JSON.parse(sessionStorage.getItem(PLAYER_NAMES_SESSION_STORAGE_KEY)!) ?? [],\n    [],\n  );\n\n  const updatePlayer = (playerNumber: number) => (newSetup: PlayerSetup) => {\n    setPlayerSetup((current) => current.map((setup) => (setup.number === playerNumber ? newSetup : setup)));\n  };\n\n  const [showModal, setShowModal] = useState(false);\n\n  useEffect(() => {\n    if (!showModal) {\n      InputManager.startMonitoring();\n    }\n  }, [showModal]);\n\n  const { register, focusElement } = useKeyboardNav({\n    enabled: keyboardControl && !showModal,\n    onBackspace: onExitKeyboardControl,\n  });\n\n  const startSong = () => {\n    onNextStep(playerList);\n  };\n\n  const areInputsConfigured = !!storedPreference && storedPreference !== 'skip';\n\n  return (\n    <>\n      {showModal && (\n        <SelectInputModal\n          closeButtonText={areInputsConfigured ? 'Continue to the song' : 'Continue to player setup'}\n          onClose={() => {\n            setShowModal(false);\n\n            if (areInputsConfigured) {\n              focusElement('play');\n            }\n          }}\n        />\n      )}\n      {playerList.map((setup, index) => (\n        <PlayerSettingContainer key={setup.number}>\n          <PlayerSettingTitle>Player {index + 1}</PlayerSettingTitle>\n          <div>\n            <SinglePlayer\n              multipleTracks={multipleTracks}\n              player={PlayersManager.getPlayer(setup.number)}\n              setup={setup}\n              onChange={updatePlayer(setup.number)}\n              playerNames={playerNames}\n              register={register}\n              songPreview={songPreview}\n            />\n          </div>\n        </PlayerSettingContainer>\n      ))}\n      {areInputsConfigured && (\n        <PlayButton {...register('play-song-button', startSong, undefined, true)}>Play</PlayButton>\n      )}\n      <PlayButton {...register('select-inputs-button', () => setShowModal(true), undefined, false)}>\n        Setup mics\n      </PlayButton>\n    </>\n  );\n}\n\nconst PlayerSettingContainer = styled.div`\n  display: flex;\n  flex-direction: row;\n`;\n\nconst PlayButton = styled(Button)<{ focused: boolean }>`\n  padding: 0.5rem 9rem;\n  font-size: 4.3rem;\n`;\n\nconst PlayerSettingTitle = styled.span`\n  ${typography};\n  padding: 1.3rem;\n  font-size: 4.5rem;\n`;\n","import styled from '@emotion/styled';\nimport events from 'GameEvents/GameEvents';\nimport GameSettings from 'Scenes/SingASong/SongSelection/SongSettings/GameSettings';\nimport MicCheck from 'Scenes/SingASong/SongSelection/SongSettings/MicCheck';\nimport PlayerSettings from 'Scenes/SingASong/SongSelection/SongSettings/PlayerSettings';\nimport { PlayerSetup, SingSetup, SongPreview } from 'interfaces';\nimport { useState } from 'react';\n\ninterface Props {\n  songPreview: SongPreview;\n  onPlay: (setup: SingSetup & { song: SongPreview }) => void;\n  keyboardControl: boolean;\n  onExitKeyboardControl: () => void;\n}\n\nexport default function SongSettings({ songPreview, onPlay, keyboardControl, onExitKeyboardControl }: Props) {\n  const [singSetup, setSingSetup] = useState<SingSetup | null>(null);\n  const [step, setStep] = useState<'song' | 'players'>('song');\n\n  const onSongStepFinish = (setup: SingSetup) => {\n    setSingSetup(setup);\n    setStep('players');\n  };\n  const startSong = (players: PlayerSetup[]) => {\n    if (!singSetup) return;\n    const finalSetup = {\n      ...singSetup,\n      players: players,\n    };\n    events.songStarted.dispatch(songPreview, finalSetup);\n    onPlay({ song: songPreview, ...finalSetup });\n  };\n  return (\n    <Container>\n      <MicCheck style={step === 'players' ? { viewTransitionName: 'player-mic-check-container' } : undefined} />\n      <GameConfiguration>\n        {step === 'song' && (\n          <GameSettings\n            songPreview={songPreview}\n            onNextStep={onSongStepFinish}\n            keyboardControl={keyboardControl}\n            onExitKeyboardControl={onExitKeyboardControl}\n          />\n        )}\n        {step === 'players' && (\n          <PlayerSettings\n            songPreview={songPreview}\n            onNextStep={startSong}\n            keyboardControl={keyboardControl}\n            onExitKeyboardControl={() => setStep('song')}\n          />\n        )}\n      </GameConfiguration>\n    </Container>\n  );\n}\n\nconst Container = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: flex-end;\n  justify-content: space-between;\n  width: 100%;\n\n  hr {\n    margin: 1rem;\n    opacity: 0.25;\n  }\n`;\n\nconst GameConfiguration = styled.div`\n  width: auto;\n  display: flex;\n  flex-direction: column;\n  align-items: flex-end;\n  gap: 1.25rem;\n`;\n","import { throttle } from 'lodash-es';\nimport { useCallback, useEffect, useState } from 'react';\n\nconst getViewportSize = () => ({\n  width: window.document.body.clientWidth,\n  height: window.visualViewport!.height,\n});\n\nexport default function useViewportSize() {\n  // Learn more here: https://joshwcomeau.com/react/the-perils-of-rehydration/\n  const [windowSize, setWindowSize] = useState(getViewportSize());\n\n  const handleResize = useCallback(\n    throttle(() => {\n      setWindowSize(getViewportSize());\n    }, 1000),\n    [],\n  );\n\n  useEffect(() => {\n    window.addEventListener('resize', handleResize);\n    handleResize();\n\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n\n  return { ...windowSize, handleResize };\n}\n","import { css } from '@emotion/react';\nimport styled from '@emotion/styled';\nimport { useTheme } from '@mui/material';\nimport VideoPlayer, { VideoPlayerRef, VideoState } from 'Elements/VideoPlayer';\nimport {\n  ExpandedData,\n  FinalSongCard,\n  SongListEntryDetailsArtist,\n  SongListEntryDetailsTitle,\n} from 'Scenes/SingASong/SongSelection/SongCard';\nimport SongSettings from 'Scenes/SingASong/SongSelection/SongSettings';\nimport useDebounce from 'hooks/useDebounce';\nimport useViewportSize from 'hooks/useViewportSize';\nimport { SingSetup, SongPreview } from 'interfaces';\nimport { ComponentProps, PropsWithChildren, useEffect, useLayoutEffect, useMemo, useRef, useState } from 'react';\n\ninterface Props {\n  songPreview: SongPreview;\n  onPlay: (setup: SingSetup & { song: SongPreview }) => void;\n  keyboardControl: boolean;\n  onExitKeyboardControl: () => void;\n  top: number;\n  left: number;\n  width: number;\n  height: number;\n  focusEffect: boolean;\n}\n\nconst PREVIEW_LENGTH = 30;\n\nexport default function SongPreviewComponent({\n  songPreview,\n  top,\n  left,\n  width,\n  height,\n  keyboardControl,\n  onExitKeyboardControl,\n  onPlay,\n  focusEffect,\n}: Props) {\n  const [showVideo, setShowVideo] = useState(false);\n  const player = useRef<VideoPlayerRef | null>(null);\n  const { width: windowWidth, height: windowHeight } = useViewportSize();\n\n  const expanded = keyboardControl;\n\n  // need to use layout effect otherwise newly selected song name is displayed briefly before the element is removed\n  useLayoutEffect(() => {\n    setShowVideo(false);\n  }, [songPreview.video]);\n\n  const start = songPreview.previewStart ?? (songPreview.videoGap ?? 0) + 60;\n  const end = songPreview.previewEnd ?? start + PREVIEW_LENGTH;\n  const undebounced = useMemo(\n    () => [songPreview.video, start, end, songPreview.volume] as const,\n    [songPreview.video, start, end, songPreview.volume],\n  );\n  const [videoId, previewStart, previewEnd, volume] = useDebounce(undebounced, 350);\n\n  useEffect(() => {\n    player.current?.loadVideoById({\n      videoId: videoId,\n      startSeconds: previewStart,\n      endSeconds: previewEnd,\n    });\n  }, [videoId, player, previewStart, previewEnd]);\n\n  const videoWidth = expanded ? windowWidth : width;\n  const videoHeight = expanded ? windowHeight : height;\n\n  const finalHeight = expanded ? Math.min((windowWidth! / 20) * 9, windowHeight! * (4 / 5)) : height;\n\n  useEffect(() => {\n    player.current?.setSize(videoWidth, videoHeight);\n  }, [videoWidth, videoHeight, keyboardControl]);\n\n  return (\n    <>\n      {expanded && <Backdrop onClick={onExitKeyboardControl} />}\n      {!expanded && showVideo && (\n        <SongBPMIndicator width={videoWidth} height={videoHeight} left={left} top={top} song={songPreview} />\n      )}\n      <SongPreviewContainer\n        background={expanded || showVideo}\n        video={\n          <Video show={showVideo} expanded={expanded} height={finalHeight} id=\"preview-video-container\">\n            <VideoPlayer\n              width={0}\n              height={0}\n              disablekb\n              ref={player}\n              video={''}\n              volume={volume}\n              onStateChange={(state) => {\n                if (state === VideoState.ENDED) {\n                  player.current?.seekTo(start);\n                  player.current?.playVideo();\n                } else if (state === VideoState.PLAYING) {\n                  setShowVideo(true);\n                }\n              }}\n            />\n          </Video>\n        }\n        focused\n        song={songPreview}\n        top={top}\n        left={left}\n        width={videoWidth}\n        height={finalHeight}\n        showVideo={showVideo}\n        expanded={expanded}\n        data-test=\"song-preview\"\n        data-song={songPreview.id}>\n        <Content expanded={expanded}>\n          {expanded && (\n            <SongSettings\n              songPreview={songPreview}\n              onPlay={onPlay}\n              keyboardControl={keyboardControl}\n              onExitKeyboardControl={onExitKeyboardControl}\n            />\n          )}\n        </Content>\n      </SongPreviewContainer>\n    </>\n  );\n}\n\nconst BaseSongPreviewContainer = styled(FinalSongCard)<{\n  width: number;\n  height: number;\n  expanded: boolean;\n  showVideo: boolean;\n}>`\n  --preview-padding: 5rem;\n  width: ${(props) => props.width}px;\n  height: ${(props) => props.height}px;\n  position: absolute;\n  z-index: ${(props) => (props.expanded ? 201 : 3)};\n  overflow: hidden;\n  visibility: ${(props) => (props.expanded || props.showVideo ? 'visible' : 'hidden')};\n\n  ${(props) =>\n    props.expanded\n      ? css`\n          border: 0;\n          border-radius: 0;\n          position: fixed;\n\n          padding: var(--preview-padding);\n        `\n      : css`\n          pointer-events: none;\n          ${props.showVideo && props.theme.graphicSetting === 'high'\n            ? 'animation: rhythmPulse 1s infinite'\n            : 'scale: 1.2'};\n        `};\n\n  @keyframes rhythmPulse {\n    0% {\n      transform: scale(1.2);\n    }\n    15% {\n      transform: scale(1.25);\n    }\n    100% {\n      transform: scale(1.2);\n    }\n  }\n  view-transition-name: song-preview;\n\n  ${SongListEntryDetailsArtist} {\n    view-transition-name: song-preview-artist;\n  }\n\n  ${SongListEntryDetailsTitle} {\n    view-transition-name: song-preview-title;\n  }\n\n  ${ExpandedData} {\n    view-transition-name: song-preview-expanded-data;\n  }\n`;\n\ninterface SongPreviewContainerProps\n  extends ComponentProps<typeof BaseSongPreviewContainer>,\n    PropsWithChildren<{\n      top: number;\n      left: number;\n      song: SongPreview;\n    }> {}\n\nconst SongPreviewContainer = (props: SongPreviewContainerProps) => {\n  const realBpm = props.song.realBpm ?? (props.song.bpm > 300 ? props.song.bpm / 4 : props.song.bpm / 2);\n\n  return (\n    <BaseSongPreviewContainer\n      style={{\n        top: props.expanded ? `calc(50vh - ${props.height}px / 2)` : props.top,\n        left: props.expanded ? 0 : props.left,\n        animationDuration: `${60 / realBpm}s`,\n      }}\n      {...props}\n    />\n  );\n};\n\nconst Backdrop = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  background: rgba(0, 0, 0, 0.8);\n  width: 100vw;\n  height: 100vh;\n  z-index: 201;\n`;\n\nconst Video = styled.div<{ show: boolean; expanded: boolean; height: number }>`\n  ${(props) =>\n    props.expanded\n      ? css`\n          position: fixed;\n          inset: 0;\n          clip-path: inset(calc((100vh - ${props.height}px) / 2) 0);\n        `\n      : css`\n          position: absolute;\n          top: 0;\n          left: 0;\n          background-image: none !important;\n          border-radius: 0.5rem;\n        `}\n\n  div {\n    opacity: ${({ show }) => (show ? 1 : 0)};\n    transition: ${({ show, expanded }) => (show || expanded ? 1000 : 0)}ms;\n  }\n`;\n\nconst Content = styled.div<{ expanded: boolean }>`\n  inset: auto var(--preview-padding);\n  position: fixed; /* makes sure Autocomplete dropdown doesn't get clipped */\n  z-index: 100;\n  ${(props) => !props.expanded && `transform: scale(0.1);`}\n\n  border-radius: 0.5rem;\n\n  view-transition-name: song-preview-content;\n`;\n\nconst BaseSongBPMIndicator = styled.div<{ width: number; height: number }>`\n  background: white;\n  width: ${(props) => props.width}px;\n  height: ${(props) => props.height}px;\n  z-index: 2;\n  top: 0;\n  left: 0;\n  position: absolute;\n  animation: bpm 1s infinite;\n  border-radius: 0.5rem;\n  pointer-events: none;\n\n  @keyframes bpm {\n    0% {\n      transform: scale(1.15);\n      opacity: 1;\n    }\n    100% {\n      transform: scale(1.45);\n      opacity: 0;\n    }\n  }\n`;\n\nconst SongBPMIndicator = (\n  props: {\n    top: number;\n    left: number;\n    song: SongPreview;\n  } & ComponentProps<typeof BaseSongBPMIndicator>,\n) => {\n  const theme = useTheme();\n\n  if (theme.graphicSetting === 'low') return null;\n\n  const realBpm = props.song.realBpm ?? (props.song.bpm > 300 ? props.song.bpm / 4 : props.song.bpm / 2);\n  return (\n    <BaseSongBPMIndicator\n      width={props.width}\n      height={props.height}\n      style={{\n        left: props.left,\n        top: props.top,\n        animationDuration: `${60 / realBpm}s`,\n      }}\n    />\n  );\n};\n","import { useEffect } from 'react';\n\nlet mounts = 0;\n\nexport default function useBlockScroll() {\n  useEffect(() => {\n    document.body.classList.add('blockOverflow');\n    document.documentElement.classList.add('blockOverflow');\n    mounts++;\n\n    return () => {\n      mounts--;\n\n      if (mounts === 0) {\n        document.body.classList.remove('blockOverflow');\n        document.documentElement.classList.remove('blockOverflow');\n      }\n    };\n  }, []);\n}\n","import { css } from '@emotion/react';\nimport styled from '@emotion/styled';\nimport { CircularProgress } from '@mui/material';\nimport { useBackground } from 'Elements/LayoutWithBackground';\nimport { focused, typography } from 'Elements/cssMixins';\nimport events from 'GameEvents/GameEvents';\nimport { useEventEffect } from 'GameEvents/hooks';\nimport styles from 'Scenes/Game/Singing/GameOverlay/Drawing/styles';\nimport { MobilePhoneModeSetting, useSettingValue } from 'Scenes/Settings/SettingsState';\nimport useSongSelection from 'Scenes/SingASong/SongSelection/Hooks/useSongSelection';\nimport Playlists from 'Scenes/SingASong/SongSelection/Playlists';\nimport QuickSearch from 'Scenes/SingASong/SongSelection/QuickSearch';\nimport SelectRandomTip from 'Scenes/SingASong/SongSelection/SelectRandomTip';\nimport { FinalSongCard } from 'Scenes/SingASong/SongSelection/SongCard';\nimport SongPreview from 'Scenes/SingASong/SongSelection/SongPreview';\nimport useBackgroundMusic from 'hooks/useBackgroundMusic';\nimport useBlockScroll from 'hooks/useBlockScroll';\nimport { REGULAR_ALPHA_CHARS } from 'hooks/useKeyboard';\nimport usePrevious from 'hooks/usePrevious';\nimport useViewportSize from 'hooks/useViewportSize';\nimport { SingSetup, SongPreview as SongPreviewEntity } from 'interfaces';\nimport { memo, useCallback, useEffect, useRef, useState } from 'react';\nimport { useHotkeys } from 'react-hotkeys-hook';\n\ninterface Props {\n  onSongSelected: (songSetup: SingSetup & { song: SongPreviewEntity }) => void;\n  preselectedSong: string | null;\n}\n\nconst focusMultiplier = 1.2;\nconst MAX_SONGS_PER_ROW = 4;\n\nexport default function SongSelection({ onSongSelected, preselectedSong }: Props) {\n  const [mobilePhoneMode] = useSettingValue(MobilePhoneModeSetting);\n  const songsPerRow = mobilePhoneMode ? MAX_SONGS_PER_ROW - 1 : MAX_SONGS_PER_ROW;\n\n  useBackgroundMusic(false);\n  useBackground(true);\n  useBlockScroll();\n\n  const [{ previewTop, previewLeft, previewWidth, previewHeight }, setPositions] = useState({\n    previewTop: 0,\n    previewLeft: 0,\n    previewWidth: 0,\n    previewHeight: 0,\n  });\n  const {\n    focusedGroup,\n    focusedSong,\n    moveToSong,\n    groupedSongList,\n    keyboardControl,\n    songPreview,\n    setKeyboardControl,\n    setFilters,\n    filters,\n    setShowFilters,\n    showFilters,\n    prefilteredList,\n    isLoading,\n  } = useSongSelection(preselectedSong, songsPerRow);\n\n  const onSearchSong = (e: KeyboardEvent) => {\n    e.stopPropagation();\n    e.preventDefault();\n\n    setFilters({\n      search: e.key,\n    });\n  };\n  useHotkeys(REGULAR_ALPHA_CHARS, onSearchSong, { enabled: !filters.search && keyboardControl });\n\n  const onRemoteSearch = useCallback(\n    (search: string) => {\n      if (keyboardControl) {\n        setFilters({ search });\n      }\n    },\n    [keyboardControl],\n  );\n  useEventEffect(events.remoteSongSearch, onRemoteSearch);\n\n  const list = useRef<HTMLDivElement | null>(null);\n  const { width, handleResize } = useViewportSize();\n  const previouslyFocusedGroup = usePrevious(focusedGroup);\n  const previouslyFocusedSong = usePrevious(focusedSong);\n\n  useEffect(() => {\n    const selector = (group: string, index: number) => `[data-group-letter=\"${group}\"] [data-index=\"${index}\"]`;\n    handleResize(); // Recalculate width/height to account possible scrollbar appearing\n\n    const previousSong = list.current?.querySelector(\n      selector(previouslyFocusedGroup, previouslyFocusedSong),\n    ) as HTMLDivElement;\n    const song = list.current?.querySelector(selector(focusedGroup, focusedSong)) as HTMLDivElement;\n    if (song) {\n      if (!previousSong || previousSong.offsetTop !== song.offsetTop) {\n        song.scrollIntoView?.({\n          behavior: 'smooth',\n          inline: 'center',\n          block: 'center',\n        });\n      }\n      setPositions({\n        previewLeft: song.offsetLeft,\n        previewTop: song.offsetTop,\n        previewWidth: song.offsetWidth,\n        previewHeight: song.offsetHeight,\n      });\n    }\n  }, [width, list, focusedSong, focusedGroup, groupedSongList]);\n\n  const expandSong = useCallback(() => setKeyboardControl(false), [setKeyboardControl]);\n\n  if (!groupedSongList || !width) return <>Loading</>;\n\n  if (isLoading) {\n    return (\n      <LoaderContainer>\n        <CircularProgress size=\"15em\" color=\"secondary\" />\n      </LoaderContainer>\n    );\n  }\n\n  return (\n    <Container songsPerRow={songsPerRow}>\n      {filters.search ? (\n        <QuickSearch showFilters={showFilters} onSongFiltered={setFilters} filters={filters} />\n      ) : (\n        <SelectRandomTip keyboardControl={keyboardControl} />\n      )}\n      <SongListContainer ref={list} active={keyboardControl} data-test=\"song-list-container\" dim={showFilters}>\n        {groupedSongList.length === 0 && <NoSongsFound>No songs found</NoSongsFound>}\n        {songPreview && (\n          <SongPreview\n            songPreview={songPreview}\n            onPlay={onSongSelected}\n            keyboardControl={!keyboardControl}\n            onExitKeyboardControl={() => setKeyboardControl(true)}\n            top={previewTop}\n            left={previewLeft}\n            width={previewWidth}\n            height={previewHeight}\n            focusEffect={!showFilters}\n          />\n        )}\n        {groupedSongList.map((group) => (\n          <SongsGroupContainer\n            {...(showFilters || !keyboardControl ? { 'data-unfocusable': true } : {})}\n            key={group.letter}\n            data-group-letter={group.letter}\n            highlight={group.letter === 'New'}>\n            <SongsGroupHeader>{group.letter}</SongsGroupHeader>\n            <SongsGroup>\n              {group.songs.map(({ song, index }) => (\n                <SongListEntry\n                  key={song.id}\n                  song={song}\n                  handleClick={focusedSong === index ? expandSong : moveToSong}\n                  focused={!showFilters && keyboardControl && index === focusedSong}\n                  index={index}\n                  data-index={index}\n                  data-focused={!showFilters && keyboardControl && index === focusedSong}\n                  data-test={`song-${song.id}${group.isNew ? '-new-group' : ''}`}\n                />\n              ))}\n            </SongsGroup>\n          </SongsGroupContainer>\n        ))}\n        <AddSongs>\n          Missing a song? Try <a href=\"/convert\">adding one</a> yourself!\n        </AddSongs>\n      </SongListContainer>\n      <Playlists\n        setFilters={setFilters}\n        active={showFilters}\n        closePlaylist={setShowFilters}\n        prefilteredList={prefilteredList}\n      />\n    </Container>\n  );\n}\n\nconst AddSongs = styled.span`\n  ${typography};\n  text-align: center;\n  font-size: 5rem;\n  margin-top: 10rem;\n`;\n\nconst Container = styled.div<{ songsPerRow: number }>`\n  display: flex;\n  flex-direction: row;\n  max-height: 100vh;\n  --song-list-gap: 3.5rem;\n  --song-item-width: ${(props) =>\n    `calc(${100 / props.songsPerRow}% - ((${props.songsPerRow - 1} / ${props.songsPerRow}) * var(--song-list-gap)))`};\n  --song-item-ratio: calc(16 / 9 * (4 / ${(props) => props.songsPerRow}));\n`;\n\nconst SongsGroupContainer = styled.div<{ highlight: boolean }>`\n  padding: 0 4.5rem 0 11rem;\n  ${(props) =>\n    props.highlight &&\n    css`\n      background: rgba(0, 0, 0, 0.5);\n      padding-bottom: 3rem;\n      border-bottom: 0.2rem solid black;\n\n      ${SongsGroupHeader} {\n        @keyframes new-song-group-header {\n          0%,\n          100% {\n            transform: scale(1);\n          }\n          50% {\n            transform: scale(1.1);\n          }\n        }\n        animation: new-song-group-header 600ms ease-in-out infinite both;\n        background: #ffffff;\n      }\n    `}\n`;\n\nconst NoSongsFound = styled.div`\n  ${typography};\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex: 1;\n\n  font-size: 10rem;\n`;\n\nconst SongsGroupHeader = styled.div`\n  ${typography};\n  display: inline-block;\n  padding: 0.5rem 1rem;\n  margin-bottom: 2rem;\n  font-size: 3.5rem;\n  position: sticky;\n  z-index: 1;\n  top: calc(-1 * var(--song-list-gap));\n  color: ${styles.colors.text.active};\n  background: rgba(0, 0, 0, 0.7);\n`;\n\nconst SongListContainer = styled.div<{ active: boolean; dim: boolean }>`\n  position: relative;\n  flex: 1 1 auto;\n  display: flex;\n  flex-direction: column;\n  gap: var(--song-list-gap);\n  padding: 4.5rem 0;\n  overflow-y: auto;\n  overflow-x: clip;\n  box-sizing: border-box;\n  min-height: 100vh;\n  max-height: 100vh;\n  ::-webkit-scrollbar {\n    display: none;\n  }\n  transition: opacity 500ms;\n  opacity: ${(props) => (props.dim ? 0.5 : 1)};\n`;\n\nconst SongsGroup = styled.div`\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n  gap: var(--song-list-gap);\n`;\n\nconst SongListEntry = memo(styled(FinalSongCard)`\n  cursor: pointer;\n  flex-basis: var(--song-item-width);\n  aspect-ratio: var(--song-item-ratio);\n\n  ${(props) =>\n    props.theme.graphicSetting === 'high' &&\n    css`\n      transition: 300ms;\n    `}\n  transform: scale(${(props) => (props.focused ? focusMultiplier : 1)});\n  ${(props) => props.focused && 'z-index: 2;'}\n  ${(props) => props.focused && focused}\n\n    content-visibility: auto;\n  contain-intrinsic-size: calc(var(--song-item-width) * (1 / var(--song-item-ratio)));\n`);\n\nconst LoaderContainer = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 100vh;\n`;\n","import ExcludeLanguagesView from 'Scenes/ExcludeLanguages/ExcludeLanguagesView';\nimport { ExcludedLanguagesSetting, useSettingValue } from 'Scenes/Settings/SettingsState';\nimport SongSelection from 'Scenes/SingASong/SongSelection/SongSelection';\nimport { ComponentProps, useState } from 'react';\n\nfunction SingASong(props: ComponentProps<typeof SongSelection>) {\n  const [excludedLanguages, setExcludedLanguages] = useSettingValue(ExcludedLanguagesSetting);\n  const [languageSelection, setLanguageSelection] = useState(excludedLanguages === null);\n  const goBack = () => {\n    setExcludedLanguages(excludedLanguages ?? []);\n    setLanguageSelection(false);\n  };\n\n  return languageSelection ? (\n    <ExcludeLanguagesView onClose={goBack} closeText=\"Continue to Song Selection\" />\n  ) : (\n    <SongSelection {...props} />\n  );\n}\n\nexport default SingASong;\n","import { useEffect } from 'react';\n\nexport default function useFullscreen() {\n  useEffect(() => {\n    try {\n      process.env.NODE_ENV !== 'development' && document.body.requestFullscreen().catch(console.info);\n    } catch (e) {}\n  }, []);\n}\n","export default \"__VITE_ASSET__0906c539__\"","const sleep = (ms: number) => new Promise<void>((resolve) => setTimeout(resolve, ms));\n\nexport default sleep;\n","import styled from '@emotion/styled';\nimport { CheckCircleOutline } from '@mui/icons-material';\nimport { CircularProgress } from '@mui/material';\nimport { typography } from 'Elements/cssMixins';\nimport events from 'GameEvents/GameEvents';\nimport { useEventEffect, useEventListenerSelector } from 'GameEvents/hooks';\nimport PlayersManager from 'Players/PlayersManager';\nimport SinglePlayer from 'Scenes/SingASong/SongSelection/SongSettings/MicCheck/SinglePlayer';\nimport { waitFinished } from 'SoundManager';\nimport backgroundMusic from 'assets/459342__papaninkasettratat__cinematic-music-short.mp3';\nimport { SyntheticEvent, useEffect, useRef, useState } from 'react';\nimport CountUp from 'react-countup';\nimport sleep from 'utils/sleep';\n\ninterface Props {\n  onFinish: () => void;\n}\n\nconst AUTOSTART_TIMEOUT_S = 15;\n\nfunction WaitForReadiness({ onFinish }: Props) {\n  const audio = useRef<HTMLAudioElement>(null);\n  const [areAllPlayersReady, setAreAllPlayersReady] = useState(false);\n\n  const [confirmedPlayers, setConfirmedPlayers] = useState<string[]>([]);\n  useEventEffect(events.readinessConfirmed, (deviceId) => {\n    setConfirmedPlayers((current) => [...current, deviceId]);\n  });\n\n  const players = useEventListenerSelector([events.inputListChanged, events.readinessConfirmed], () => {\n    return PlayersManager.getPlayers().map(\n      (player, index) => [player.input.deviceId!, player.getName(), player] as const,\n    );\n  });\n\n  useEffect(() => {\n    (async () => {\n      // can't use `areAllPlayersReady` as it would need to be specified as useEffect dependency\n      let allInputsReady = false;\n      const inputsReady = PlayersManager.requestReadiness().then(() => {\n        allInputsReady = true;\n        setAreAllPlayersReady(true);\n      });\n      const minTimeElapsed = sleep(1_500);\n      const maxTimeElapsed = sleep(AUTOSTART_TIMEOUT_S * 1_000);\n\n      // Only start the music if waiting for readiness takes some time\n      await sleep(250);\n      if (!allInputsReady) {\n        await audio?.current?.play();\n      }\n\n      await Promise.race([Promise.all([inputsReady, minTimeElapsed]), maxTimeElapsed]);\n      if (!audio?.current?.paused) waitFinished.play();\n      await sleep(500);\n      audio?.current?.pause();\n      await sleep(1000);\n      onFinish();\n    })();\n  }, []);\n\n  const playerStatuses = players.map(([deviceId, name, player]) => ({\n    confirmed: confirmedPlayers.includes(deviceId),\n    name,\n    player: player,\n  }));\n\n  return (\n    <>\n      <WaitingForReady>\n        {!areAllPlayersReady && (\n          <span>\n            Waiting for all players to click <strong>\"Ready\"</strong>\n          </span>\n        )}\n        <PlayerList>\n          {playerStatuses.map(({ confirmed, name, player }, index) => (\n            <PlayerEntry\n              className=\"ph-no-capture\"\n              key={index}\n              data-test=\"player-confirm-status\"\n              data-name={name}\n              data-confirmed={confirmed}>\n              {!areAllPlayersReady && (\n                <ConfirmStatus>\n                  {confirmed ? <CheckCircleOutline /> : <CircularProgress color=\"info\" size=\"1em\" />}\n                </ConfirmStatus>\n              )}{' '}\n              <SinglePlayer player={player} />\n            </PlayerEntry>\n          ))}\n        </PlayerList>\n        {!areAllPlayersReady && (\n          <TimeoutMessage>\n            The song will start automatically in{' '}\n            <strong>\n              <CountUp end={0} start={AUTOSTART_TIMEOUT_S} duration={AUTOSTART_TIMEOUT_S} useEasing={false} />\n            </strong>\n          </TimeoutMessage>\n        )}\n      </WaitingForReady>\n      <audio\n        src={backgroundMusic}\n        ref={audio}\n        hidden\n        autoPlay={false}\n        onPlay={(e: SyntheticEvent<HTMLAudioElement>) => {\n          e.currentTarget.volume = 0.8;\n        }}\n      />\n    </>\n  );\n}\n\nconst WaitingForReady = styled.div`\n  top: 0;\n  left: 0;\n  z-index: 1000;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-direction: column;\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  gap: 5rem;\n\n  font-size: 5rem;\n  ${typography};\n`;\n\nconst TimeoutMessage = styled.span`\n  font-size: 5rem;\n`;\n\nconst PlayerList = styled.div`\n  //margin-top: 5rem;\n  display: flex;\n  flex-direction: column;\n  gap: 5rem;\n  width: 50rem;\n  view-transition-name: player-mic-check-container;\n`;\n\nconst PlayerEntry = styled.div`\n  display: flex;\n  align-items: center;\n  //justify-content: center;\n  gap: 2rem;\n  transform: scale(1.5);\n`;\n\nconst ConfirmStatus = styled.span`\n  svg {\n    width: 5rem;\n    height: 5rem;\n    stroke: black;\n  }\n`;\n\nexport default WaitForReadiness;\n","import { NotesSection, Section, Song } from 'interfaces';\nimport { cloneDeep, range } from 'lodash-es';\nimport getSongBeatLength from 'Songs/utils/getSongBeatLength';\nimport isNotesSection from 'Songs/utils/isNotesSection';\nimport { getFirstNoteStartFromSections, getLastNoteEndFromSections } from 'Songs/utils/notesSelectors';\n\nconst MAX_SECTION_PAUSE_MS = 250;\n\nconst getSingableBeats = (sections: Section[], start: number = 0, end: number = Infinity) =>\n  sections\n    .filter(isNotesSection)\n    .filter((section) => getFirstNoteStartFromSections([section]) >= start)\n    .filter((section) => getLastNoteEndFromSections([section]) <= end)\n    .reduce((current, section) => current + section.notes.reduce((length, note) => length + note.length, 0), 0);\n\n// Join sections into segments - group of sections that have shorter than MAX_SECTION_PAUSE_MS pause between\nexport const segmentSections = (sections: Section[], beatLength: number): NotesSection[][] => {\n  const [firstSection, ...noteSections] = sections.filter(isNotesSection);\n\n  const segments: NotesSection[][] = [[firstSection]];\n\n  noteSections.forEach((section) => {\n    const lastSegment = segments.at(-1)!;\n\n    const lastSectionEnd = getLastNoteEndFromSections(lastSegment);\n    const firstSectionNoteStart = getFirstNoteStartFromSections([section]);\n    const difference = firstSectionNoteStart - lastSectionEnd;\n\n    if (difference * beatLength > MAX_SECTION_PAUSE_MS) {\n      segments.push([section]);\n    } else {\n      lastSegment.push(section);\n    }\n  });\n\n  return segments;\n};\n\nconst sum = (acc: number, elem: number) => acc + elem;\n\nconst calculateAmplitude = (groups: number[][]) => {\n  const sums = groups.map((group) => group.reduce(sum, 0));\n  return Math.max(...sums) - Math.min(...sums);\n};\n\nconst shiftSolution = (groups: number[][], at: number): number[][] => {\n  const result = cloneDeep(groups);\n  const takeFromLeft = (pos: number) => {\n    if (result[pos - 1].length < 2) return;\n    const left = result[pos - 1].pop()!;\n    result[pos].push(left);\n  };\n  const takeFromRight = (pos: number) => {\n    if (result[pos + 1]?.length < 2) return;\n    const [first, ...rest] = result[pos + 1];\n    result[pos].push(first);\n    result[pos + 1] = rest;\n  };\n\n  at % 2 === 1 ? takeFromLeft(Math.ceil(at / 2)) : takeFromRight(Math.ceil(at / 2));\n\n  return result;\n};\n\nconst arrSum = (arr: number[]) => arr.reduce(sum, 0);\n\nexport default function generatePlayerChanges(song: Song): number[][] {\n  const CHANGES_COUNT = 9;\n  const beatLength = getSongBeatLength(song);\n\n  return song.tracks.map((track) => {\n    if (track.sections.length < 3) return [];\n\n    const segments = segmentSections(track.sections, beatLength);\n\n    // array of groups of singable beats count -- each element is the total singable beats in a segment\n    // The goal is to for the groups to have as similar total count of singable beats as possible\n    let result: number[][] = [];\n\n    // todo replace this hacky algorithm with https://en.wikipedia.org/wiki/Multiway_number_partitioning\n    // STEP1:   Build initial groups by calculating \"ideal\" group length (aka amount of singable beats)\n    //          And try to have them as close to the ideal as possible (by either overflowing or \"underflowing\")\n    let currentBuffer = [getSingableBeats(segments[0])]; // A candidate for the next group\n    for (let i = 0; i < segments.length - 2; i++) {\n      // get the last segment already put in the result\n      const lastSegment = segments[result.flat().length - 1] ?? [];\n      // How many beats are left to sing\n      const singableBeats = getSingableBeats(track.sections, getLastNoteEndFromSections(lastSegment) ?? 0);\n      const idealSize = singableBeats / (1 + CHANGES_COUNT - result.length);\n\n      const segmentSingableBeatsCount = getSingableBeats(segments[i + 1]);\n\n      const bufferSum = arrSum(currentBuffer);\n\n      if (bufferSum + segmentSingableBeatsCount < idealSize) {\n        // If adding the current segment to the candidate doesn't move us past the ideal size, just add it\n        currentBuffer = [...currentBuffer, segmentSingableBeatsCount];\n      } else if (idealSize - bufferSum < bufferSum + segmentSingableBeatsCount - idealSize) {\n        // If the candidate is closer to ideal size, add it as a new group\n        result.push(currentBuffer);\n        currentBuffer = [segmentSingableBeatsCount];\n      } else {\n        // If the candidate with currently inspected segment is closer to ideal size, add it as a new group\n        result.push([...currentBuffer, segmentSingableBeatsCount]);\n        currentBuffer = [];\n      }\n    }\n\n    // STEP2:   Try to make groups more even by trying to move segments between groups and checking if it\n    //          resulted in smaller differences between longest and shortest group (aka amplitude)\n    for (let i = 0; i < 100; i++) {\n      const currentAmplitude = calculateAmplitude(result);\n      // Create alternative results (by shifting one segment between groups in either way)\n      // Note this doesn't guarantee creating best results as moving multiple segments at the same time\n      // isn't accounted for\n      const candidates = range((result.length - 2) * 2 + 2).map((at) => shiftSolution(result, at));\n      const candidatesAmplitudes = candidates.map(calculateAmplitude);\n      const minimalAmplitude = Math.min(...candidatesAmplitudes);\n      if (currentAmplitude <= minimalAmplitude) break; // If no results are better, give up\n      const minimalAmplitudeIndex = candidatesAmplitudes.indexOf(minimalAmplitude);\n      result = candidates[minimalAmplitudeIndex];\n    }\n\n    return result\n      .map((group) => group.length)\n      .reduce<number[]>((acc, length) => [...acc, (acc.at(-1) ?? 0) + length], [])\n      .map((index) => getLastNoteEndFromSections(segments[index - 1]));\n  });\n}\n","import { QrCode2 } from '@mui/icons-material';\nimport { useRef } from 'react';\nimport { randomInt } from 'utils/randomValue';\n\nconst data = [\n  <>\n    You can follow the updates and give feedback on the game through the Facebook Page:{' '}\n    <a href=\"https://www.facebook.com/allkaraoke.party\" target=\"_blank\" rel=\"noreferrer\">\n      <strong>fb.com/AllKaraoke.Party</strong>\n    </a>\n  </>,\n  <>\n    Start typing a name of a song in <strong>Song Selection</strong> to active Search feature\n  </>,\n  <>\n    Narrow down songs through <strong>playlists</strong> on the right in Song Selection\n  </>,\n  <>\n    Select <strong>Pass The Mic</strong> Game Mode to share the microphones and sing in a team\n  </>,\n  <>\n    Your scores and <strong>stats are saved</strong> in this browser - they will be available for the next party!\n  </>,\n  <>\n    You can remove irrelevant songs from the Song Selection in <strong>Edit Songs</strong> page\n  </>,\n  <>\n    If the game feels a bit jaggy with low FPS, check out <strong>Settings</strong> page\n  </>,\n  <>\n    Party is only getting started? Play <strong>Jukebox</strong> for the music and to see what songs are available\n  </>,\n  <>\n    Research shows that <strong>duet songs</strong> are that bit more fun than simple one-track ones\n  </>,\n  <>\n    Want to sing a <strong>new song</strong>? Find UltraStar version of it and import it with\n    <br />\n    <strong>Convert Ultrastar .txt</strong>\n  </>,\n  <>\n    The <strong>white pulse</strong> around selected song in Song Selection tries to match song's tempo\n  </>,\n  <>\n    Entire game (besides add/edit song) is navigable with <strong>Keyboard</strong>\n  </>,\n  <>\n    You can hide or show keyboard navigation help with <kbd>H</kbd> key\n  </>,\n  <>\n    In Song Selection, hold <kbd>↑</kbd> or <kbd>↓</kbd> to jump to the next letter\n  </>,\n  <>\n    Add <strong>vibrato</strong> to the notes you sing to get additional <strong>bonus points</strong>\n  </>,\n  <>\n    You can control the game with your phone - click on the{' '}\n    <strong>\n      <QrCode2 />\n      QR Code Icon\n    </strong>{' '}\n    on the top right and follow the instructions\n  </>,\n];\n\ninterface Props {\n  as?: any;\n}\n\nexport const GameTip = ({ as = 'h4', ...restProps }: Props) => {\n  const randomValue = useRef(randomInt(0, data.length - 1));\n  // const randomValue = useRef(randomInt(0, 0));\n\n  const Component = as;\n  return <Component {...restProps}>{data[randomValue.current]}</Component>;\n};\n","import styled from '@emotion/styled';\nimport { captureException } from '@sentry/react';\nimport CameraManager from 'Camera/CameraManager';\nimport { useEffect, useRef, useState } from 'react';\n\ninterface Props {}\n\nfunction CameraRoll({ ...props }: Props) {\n  const [videoSrc, setVideoSrc] = useState('');\n  const video = useRef<HTMLVideoElement | null>(null);\n\n  useEffect(() => {\n    // Seems it needs some time to process the video, otherwise invalid URL is returned\n    const timeout = setTimeout(() => {\n      setVideoSrc(CameraManager.getVideo());\n    }, 1000);\n\n    return () => {\n      clearTimeout(timeout);\n    };\n  }, []);\n\n  useEffect(() => {\n    try {\n      if (video.current) video.current.playbackRate = 16;\n    } catch (e) {\n      captureException(e);\n    }\n  }, [videoSrc]);\n\n  return (\n    <Container {...props}>\n      <Video src={videoSrc} ref={video} loop autoPlay className=\"ph-no-capture\" />\n    </Container>\n  );\n}\n\nconst Container = styled.div`\n  width: 80rem;\n  height: 60rem;\n`;\n\nconst Video = styled.video`\n  object-fit: cover;\n  width: 100%;\n  height: 100%;\n`;\n\nexport default CameraRoll;\n","import styled from '@emotion/styled';\nimport { typography } from 'Elements/cssMixins';\nimport { Song, SongPreview } from 'interfaces';\nimport styles from './Singing/GameOverlay/Drawing/styles';\n\ninterface Props {\n  width: number;\n  height: number;\n  songData: SongPreview | Song;\n  children: React.ReactNode;\n  background?: React.ReactNode;\n}\n\nexport default function SongPage({ songData, background, width, height, children, ...restProps }: Props) {\n  return (\n    <FocusedSongContainer video={songData.video} width={width} height={height} {...restProps}>\n      <BackgroundImage video={songData.video} blur />\n      {background && <Background>{background}</Background>}\n      <ContentLayer>\n        <FocusedSongData>\n          <SongTitle>{songData.title}</SongTitle>\n          <br />\n          <SongArtist>{songData.artist}</SongArtist>\n          <br />\n          {songData.author && (\n            <SongCreator>\n              by&nbsp;\n              {songData.authorUrl ? <a href={songData.authorUrl}>{songData.author}</a> : songData.author}\n            </SongCreator>\n          )}\n          {children}\n        </FocusedSongData>\n      </ContentLayer>\n    </FocusedSongContainer>\n  );\n}\n\nconst FocusedSongContainer = styled.div<{ video: string; width: number; height: number }>(\n  (props) => `\n    width: ${props.width}px;\n    top: 0;\n    height: ${props.height}px;\n    overflow-y: hidden;\n    background: black;\n    position: relative;\n`,\n);\n\nconst Background = styled.div`\n  z-index: 1;\n  top: 0;\n  left: 0;\n  position: absolute;\n  width: 100%;\n  height: 100%;\n`;\n\nconst BaseBackgroundImage = styled(Background)<{ blur: boolean; video: string }>`\n  background-size: cover;\n  background-position: center center;\n\n  filter: ${(props) => (props.blur ? 'blur(0.5rem)' : 'none')};\n`;\n\nconst BackgroundImage = (props: { blur: boolean; video: string }) => (\n  <BaseBackgroundImage\n    style={{ backgroundImage: `url('https://i3.ytimg.com/vi/${props.video}/hqdefault.jpg')` }}\n    {...props}\n  />\n);\n\nconst ContentLayer = styled.div`\n  z-index: 2;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  pointer-events: none;\n`;\n\nconst FocusedSongData = styled.div`\n  position: relative;\n  margin: 0 auto;\n  color: white;\n  max-width: 144rem;\n  height: 100%;\n  pointer-events: none;\n`;\n\nexport const ContentElement = styled.span`\n  background: rgba(0, 0, 0, 0.5);\n  display: inline-block;\n  backdrop-filter: blur(0.5rem);\n  ${typography};\n  padding: 0.5rem 2rem;\n  margin: 0 0 1rem 2rem;\n`;\n\nconst SongTitle = styled(ContentElement)`\n  color: ${styles.colors.text.active};\n  margin-top: 2rem;\n  font-size: 4.5rem;\n`;\n\nconst SongArtist = styled(ContentElement)`\n  font-size: 3.5rem;\n`;\n\nconst SongCreator = styled(ContentElement)`\n  font-size: 2rem;\n`;\n","import styled from '@emotion/styled';\nimport { buttonFocused } from 'Elements/Button';\nimport { formatter } from 'Scenes/Game/Singing/GameOverlay/Components/ScoreText';\nimport styles from 'Scenes/Game/Singing/GameOverlay/Drawing/styles';\nimport { MAX_POINTS, sumDetailedScore } from 'Scenes/Game/Singing/GameState/Helpers/calculateScore';\nimport { PlayerScore } from 'Scenes/Game/Singing/PostGame/PostGameView';\nimport { ContentElement } from 'Scenes/Game/SongPage';\nimport { HighScoreEntity, SingSetup } from 'interfaces';\nimport CountUp from 'react-countup';\n\ninterface Props {\n  player: PlayerScore;\n  revealHighScore: boolean;\n  setAnimDone: (playerNumber: number) => void;\n  useColors?: boolean;\n  playerNumber: number;\n  highestScore: number;\n  highScores: HighScoreEntity[];\n  singSetup: SingSetup;\n}\n\nconst MAX_POINTS_ANIM_LENGTH = 6;\nconst MIN_POINTS_ANIM_LENGTH = 3;\n\nfunction PlayerScoreView({\n  playerNumber,\n  player,\n  highestScore,\n  highScores,\n  singSetup,\n  useColors = true,\n  revealHighScore,\n  setAnimDone,\n}: Props) {\n  const playerScore = sumDetailedScore(player.detailedScore[0]);\n  const isHighScore = (playerName: string) =>\n    highScores.some((score) => score.singSetupId === singSetup.id && score.name === playerName);\n\n  return (\n    <>\n      <ScoreTextPlayer\n        color={useColors ? styles.colors.players[playerNumber].text : ``}\n        data-test={`player-${playerNumber}-name`}\n        className=\"ph-no-capture\">\n        {player.name}\n      </ScoreTextPlayer>\n      <br />\n      <ScoreTextScore\n        highscore={revealHighScore && isHighScore(player.name)}\n        color={useColors ? styles.colors.players[playerNumber].text : ``}\n        win={revealHighScore && playerScore === highestScore}\n        data-test={`player-${playerNumber}-score`}\n        data-score={playerScore}>\n        <CountUp\n          end={playerScore}\n          formattingFn={formatter.format}\n          onEnd={() => setAnimDone(playerNumber)}\n          duration={Math.max(MIN_POINTS_ANIM_LENGTH, (playerScore / MAX_POINTS) * MAX_POINTS_ANIM_LENGTH)}\n        />\n        <HighScoreBadge highscore={revealHighScore && isHighScore(player.name)}>High score!</HighScoreBadge>\n      </ScoreTextScore>\n      <br />\n      <br />\n    </>\n  );\n}\n\nconst ScoreTextPlayer = styled(ContentElement)<{ color: string }>`\n  padding-left: 10rem;\n  padding-right: 10rem;\n  font-size: 3.5rem;\n  color: rgb(${(props) => props.color});\n`;\n\nconst ScoreTextScore = styled(ScoreTextPlayer)<{ win: boolean; highscore: boolean; color: string }>`\n  font-size: ${(props) => (props.win ? '10.5rem' : '5.5rem')};\n  color: ${(props) => (props.win ? styles.colors.text.active : 'white')};\n  //color: white;\n  transition: 400ms ease-in-out;\n  position: relative;\n`;\n\nconst HighScoreBadge = styled.span<{ highscore: boolean }>`\n  position: absolute;\n  top: -1.5rem;\n  right: -10rem;\n\n  font-size: 3rem;\n  -webkit-text-stroke: 0.1rem black;\n  color: ${styles.colors.text.default};\n  padding: 0.5rem 1rem;\n  border-radius: 1.5rem;\n\n  ${(props) => props.highscore && buttonFocused};\n\n  opacity: ${(props) => (props.highscore ? '1' : '0')};\n  transition: 400ms;\n`;\n\nexport default PlayerScoreView;\n","import styled from '@emotion/styled';\nimport CameraManager from 'Camera/CameraManager';\nimport { Button } from 'Elements/Button';\nimport { sumDetailedScore } from 'Scenes/Game/Singing/GameState/Helpers/calculateScore';\nimport { PlayerScore } from 'Scenes/Game/Singing/PostGame/PostGameView';\nimport CameraRoll from 'Scenes/Game/Singing/PostGame/Views/Results/CameraRoll';\nimport PlayerScoreView from 'Scenes/Game/Singing/PostGame/Views/Results/PlayerScore';\nimport useKeyboard from 'hooks/useKeyboard';\nimport useKeyboardHelp from 'hooks/useKeyboardHelp';\nimport { GAME_MODE, HighScoreEntity, SingSetup } from 'interfaces';\nimport { useMemo, useState } from 'react';\n\ninterface Props {\n  onNextStep: () => void;\n  players: PlayerScore[];\n  highScores: HighScoreEntity[];\n  singSetup: SingSetup;\n}\n\nfunction ResultsView({ onNextStep, players, highScores, singSetup }: Props) {\n  useKeyboard({\n    accept: onNextStep,\n  });\n  const help = useMemo(\n    () => ({\n      accept: 'Next',\n    }),\n    [],\n  );\n  useKeyboardHelp(help, true);\n\n  const isCoop = singSetup.mode === GAME_MODE.CO_OP;\n  const finalPlayers = isCoop ? [{ ...players[0], name: players.map((player) => player.name).join(', ') }] : players;\n\n  const [finishedAnims, setFinishedAnims] = useState(finalPlayers.map(() => false));\n  const isAnimDone = finishedAnims.every((anim) => anim);\n\n  const playerScores = finalPlayers.map((player) => sumDetailedScore(player.detailedScore[0]));\n  const highestScore = Math.max(...playerScores);\n\n  return (\n    <>\n      <ScoresContainer>\n        {finalPlayers.map((player, number) => (\n          <PlayerScoreView\n            playerNumber={player.playerNumber}\n            useColors={!isCoop}\n            revealHighScore={isAnimDone}\n            setAnimDone={(which) =>\n              setFinishedAnims((current) => {\n                current[which] = true;\n                return [...current];\n              })\n            }\n            key={number}\n            player={player}\n            highScores={highScores}\n            highestScore={highestScore}\n            singSetup={singSetup}\n          />\n        ))}\n      </ScoresContainer>\n      <SongSelectionButton onClick={onNextStep} focused data-test=\"highscores-button\">\n        Next\n      </SongSelectionButton>\n      {CameraManager.getPermissionStatus() && <StyledPhotoRoll />}\n    </>\n  );\n}\n\nconst ScoresContainer = styled.div`\n  position: absolute;\n  top: 20rem;\n  width: 100%;\n  text-align: center;\n`;\n\nconst SongSelectionButton = styled(Button)<{ focused: boolean }>`\n  position: absolute;\n  bottom: 4rem;\n  right: 2rem;\n  width: 40rem;\n  font-size: 1.9vw;\n`;\n\nconst StyledPhotoRoll = styled(CameraRoll)`\n  position: absolute;\n  top: calc(50% - 30rem);\n  left: 95rem;\n  transform: scale(0.75);\n`;\n\nexport default ResultsView;\n","import { PLAYER_NAMES_SESSION_STORAGE_KEY } from 'hooks/players/consts';\nimport { useMemo } from 'react';\n\nexport default function useRecentPlayerNames() {\n  return useMemo<string[]>(() => JSON.parse(sessionStorage.getItem(PLAYER_NAMES_SESSION_STORAGE_KEY)!) ?? [], []);\n}\n","import { Autocomplete } from 'Elements/Autocomplete';\nimport useRecentPlayerNames from 'hooks/players/useRecentPlayerNames';\nimport useKeyboardNav from 'hooks/useKeyboardNav';\nimport { HighScoreEntity } from 'interfaces';\nimport { useRef, useState } from 'react';\n\ninterface Props {\n  index: number;\n  singSetupId: string;\n  score: HighScoreEntity;\n  register: ReturnType<typeof useKeyboardNav>['register'];\n  onSave: (singId: string, score: number, oldName: string, newName: string) => void;\n}\n\nfunction HighScoreRename({ score, register, singSetupId, onSave, index }: Props) {\n  const inputRef = useRef<HTMLInputElement | null>(null);\n  const [newName, setNewName] = useState('');\n  const playerNames = useRecentPlayerNames();\n\n  const onBlur = () => {\n    if (newName.trim().length && newName.trim() !== score.name) onSave(singSetupId, score.score, score.name, newName);\n  };\n\n  return (\n    <Autocomplete\n      className=\"ph-no-capture\"\n      options={playerNames}\n      onChange={setNewName}\n      onBlur={onBlur}\n      value={newName}\n      label=\"\"\n      ref={inputRef}\n      {...register(`highscore-rename-${index}`, () => inputRef.current?.focus())}\n      placeholder={score.name}\n      data-test={`input-edit-highscore`}\n      data-original-name={score.name}\n    />\n  );\n}\n\nexport default HighScoreRename;\n","import styled from '@emotion/styled';\nimport { Button } from 'Elements/Button';\nimport { typography } from 'Elements/cssMixins';\nimport ScoreText from 'Scenes/Game/Singing/GameOverlay/Components/ScoreText';\nimport styles from 'Scenes/Game/Singing/GameOverlay/Drawing/styles';\nimport { useEditScore } from 'Songs/stats/hooks';\nimport { format } from 'date-fns';\nimport useKeyboardNav from 'hooks/useKeyboardNav';\nimport { HighScoreEntity, SingSetup, Song } from 'interfaces';\nimport HighScoreRename from './HighScoreRename';\n\ninterface Props {\n  onNextStep: () => void;\n  singSetup: SingSetup;\n  highScores: HighScoreEntity[];\n  song: Song;\n}\n\nfunction HighScoresView({ onNextStep, highScores, singSetup, song }: Props) {\n  const { register } = useKeyboardNav();\n  const editScore = useEditScore(song);\n\n  return (\n    <>\n      <ScoresContainer data-test=\"highscores-container\">\n        {highScores.map((score, index) => (\n          <ScoreContainer isCurrentSing={score.singSetupId === singSetup.id} key={index}>\n            <ScorePosition>{index + 1}</ScorePosition>\n\n            <ScorePlayerName className=\"ph-no-capture\">\n              {score.singSetupId === singSetup.id ? (\n                <HighScoreRename\n                  index={index}\n                  score={score}\n                  register={register}\n                  singSetupId={singSetup.id}\n                  onSave={editScore}\n                />\n              ) : (\n                score.name\n              )}\n            </ScorePlayerName>\n            <ScoreScore>\n              <ScoreText score={score.score} />\n            </ScoreScore>\n            <ScoreDate>{format(new Date(score.date), 'LLL do y')}</ScoreDate>\n          </ScoreContainer>\n        ))}\n      </ScoresContainer>\n      <SongSelectionButton {...register('play-next-song-button', onNextStep, undefined, true)}>\n        Select song\n      </SongSelectionButton>\n    </>\n  );\n}\n\nconst ScoresContainer = styled.div`\n  position: absolute;\n  top: 20rem;\n  width: 100%;\n  text-align: center;\n  padding: 0 16rem;\n  box-sizing: border-box;\n`;\n\nconst ScoreContainer = styled.div<{ isCurrentSing: boolean }>`\n  position: relative;\n  ${typography};\n  font-size: 3.2rem;\n  display: flex;\n  background: ${(props) => (props.isCurrentSing ? 'rgba(0,0,0,.9)' : 'rgba(0,0,0,.5)')};\n  margin-bottom: 2rem;\n  padding: ${(props) => (props.isCurrentSing ? `0 1.5rem` : `1rem 3.2rem`)};\n  align-items: center;\n`;\nconst ScorePosition = styled.div`\n  padding: 0 1.6rem;\n  color: ${styles.colors.text.active};\n`;\nconst ScorePlayerName = styled.div`\n  text-align: left;\n  flex: 1;\n  padding: 1.6rem;\n`;\nconst ScoreScore = styled.div`\n  padding: 0 1rem;\n`;\nconst ScoreDate = styled.div`\n  position: absolute;\n  font-size: 2rem;\n  bottom: -1rem;\n  right: -1.6rem;\n  background: black;\n  padding: 0.5rem;\n`;\n\nconst SongSelectionButton = styled(Button)<{ focused: boolean }>`\n  position: absolute;\n  bottom: 4rem;\n  right: 2rem;\n  width: 40rem;\n  font-size: 1.9vw;\n`;\n\nexport default HighScoresView;\n","import styled from '@emotion/styled';\nimport { GameTip } from 'Elements/GameTip';\nimport ResultsView from 'Scenes/Game/Singing/PostGame/Views/Results';\nimport useBackgroundMusic from 'hooks/useBackgroundMusic';\nimport { DetailedScore, SingSetup, Song } from 'interfaces';\nimport { useState } from 'react';\nimport SongPage from '../../SongPage';\nimport HighScoresView from './Views/HighScores';\n\nexport interface PlayerScore {\n  detailedScore: [DetailedScore, DetailedScore];\n  playerNumber: number;\n  name: string;\n}\n\ninterface HighScoreEntity {\n  singSetupId: string;\n  name: string;\n  score: number;\n  date: string;\n}\n\ninterface Props {\n  width: number;\n  height: number;\n  song: Song;\n  onClickSongSelection: () => void;\n  players: PlayerScore[];\n  singSetup: SingSetup;\n  highScores: HighScoreEntity[];\n}\n\nfunction PostGameView({ song, width, height, onClickSongSelection, players, highScores, singSetup }: Props) {\n  useBackgroundMusic(true);\n  const [step, setStep] = useState<'results' | 'highscores'>('results');\n\n  return (\n    <SongPage songData={song} width={width} height={height}>\n      <Container>\n        {step === 'results' && (\n          <ResultsView\n            onNextStep={() => setStep('highscores')}\n            players={players}\n            singSetup={singSetup}\n            highScores={highScores}\n          />\n        )}\n        {step === 'highscores' && (\n          <HighScoresView onNextStep={onClickSongSelection} singSetup={singSetup} highScores={highScores} song={song} />\n        )}\n        <PostGameTip active />\n      </Container>\n    </SongPage>\n  );\n}\n\nconst Container = styled.div`\n  pointer-events: auto;\n`;\n\nexport default PostGameView;\n\nconst PostGameTip = styled(GameTip)<{ active: boolean }>`\n  transition: 300ms;\n  transform: scale(${({ active }) => (active ? 1 : 0)});\n  position: absolute;\n  bottom: 20rem;\n  font-size: 3.2rem;\n  line-height: 1.25;\n  color: white;\n  text-align: center;\n  background: rgba(0, 0, 0, 0.75);\n  width: 100%;\n  box-sizing: border-box;\n\n  padding: 2rem 10rem;\n\n  kbd {\n    padding: 0.12rem 0.9rem;\n    border-radius: 1rem;\n    border: 0.5rem solid rgb(204, 204, 204);\n    border-bottom-color: rgb(150, 150, 150);\n    border-right-color: rgb(150, 150, 150);\n    color: rgb(51, 51, 51);\n    line-height: 1.4;\n    display: inline-block;\n    box-shadow: 0 0.1rem 0 rgba(0, 0, 0, 0.2), inset 0 0 0 0.2rem #ffffff;\n    background-color: rgb(247, 247, 247);\n    text-shadow: 0 0.1rem 0 #fff;\n    font-weight: normal;\n  }\n`;\n","import PlayersManager from 'Players/PlayersManager';\nimport PostGameView from 'Scenes/Game/Singing/PostGame/PostGameView';\nimport { useSongStats } from 'Songs/stats/hooks';\nimport { HighScoreEntity, SingSetup, Song } from 'interfaces';\nimport { useMemo } from 'react';\nimport GameState from '../GameState/GameState';\n\ninterface Props {\n  width: number;\n  height: number;\n  song: Song;\n  onClickSongSelection: () => void;\n  singSetup: SingSetup;\n}\n\nfunction useHighScores(song: Song, singSetup: SingSetup): HighScoreEntity[] {\n  const stats = useSongStats(song);\n\n  const highScores = useMemo(\n    () =>\n      stats?.scores\n        .filter(({ setup }) => setup.mode === singSetup.mode && setup.tolerance === singSetup.tolerance)\n        .map((score) =>\n          score.scores.map((singleScore) => ({\n            ...singleScore,\n            date: score.date,\n            singSetupId: score.setup.id,\n          })),\n        )\n        .flat()\n        .sort((a, b) => b.score - a.score)\n        .slice(0, 5),\n    [stats, singSetup],\n  );\n\n  return highScores ?? [];\n}\n\nfunction PostGame({ song, width, height, onClickSongSelection, singSetup }: Props) {\n  const highScores = useHighScores(song, singSetup);\n  const playerScores = useMemo(\n    () =>\n      PlayersManager.getPlayers().map((player) => ({\n        name: player.getName(),\n        playerNumber: player.number,\n        detailedScore: GameState.getPlayerDetailedScore(player.number),\n      })),\n    [],\n  );\n\n  return (\n    <PostGameView\n      singSetup={singSetup}\n      song={song}\n      width={width}\n      height={height}\n      onClickSongSelection={onClickSongSelection}\n      players={playerScores}\n      highScores={highScores}\n    />\n  );\n}\n\nexport default PostGame;\n","import styled from '@emotion/styled';\nimport { useBackground } from 'Elements/LayoutWithBackground';\nimport { VideoState } from 'Elements/VideoPlayer';\nimport events from 'GameEvents/GameEvents';\nimport PlayersManager from 'Players/PlayersManager';\nimport GameState from 'Scenes/Game/Singing/GameState/GameState';\nimport WaitForReadiness from 'Scenes/Game/Singing/WaitForReadiness';\nimport { SongListEntryDetailsArtist, SongListEntryDetailsTitle } from 'Scenes/SingASong/SongSelection/SongCard';\nimport useSong from 'Songs/hooks/useSong';\nimport useBlockScroll from 'hooks/useBlockScroll';\nimport useFullscreen from 'hooks/useFullscreen';\nimport { GAME_MODE, SingSetup, SongPreview } from 'interfaces';\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport useViewportSize from '../../../hooks/useViewportSize';\nimport generatePlayerChanges from './Helpers/generatePlayerChanges';\nimport Player, { PlayerRef } from './Player';\nimport PostGame from './PostGame/PostGame';\n\ninterface Props {\n  singSetup: SingSetup;\n  songPreview: SongPreview;\n  returnToSongSelection: () => void;\n  restartSong: () => void;\n}\nfunction Singing({ songPreview, singSetup, returnToSongSelection, restartSong }: Props) {\n  useFullscreen();\n  useBlockScroll();\n  const player = useRef<PlayerRef | null>(null);\n  const song = useSong(songPreview.id);\n\n  const { width, height } = useViewportSize();\n  const [isEnded, setIsEnded] = useState(false);\n  const [isOverlayVisible, setIsOverlayVisible] = useState(true);\n  const [playerState, setPlayerState] = useState(VideoState.UNSTARTED);\n\n  const playerChanges = useMemo(() => {\n    if (!song.data) return [];\n    if (singSetup.mode !== GAME_MODE.PASS_THE_MIC) return song.data.tracks.map(() => []);\n\n    return generatePlayerChanges(song.data);\n  }, [song.data, singSetup]);\n\n  const [isTransitionTimeout, setIsTransitionTimeout] = useState(false);\n\n  useBackground(!isTransitionTimeout);\n\n  useEffect(() => {\n    if (isOverlayVisible && song.data && (isTransitionTimeout || playerState !== VideoState.UNSTARTED)) {\n      setIsOverlayVisible(false);\n    }\n  }, [song.data, isTransitionTimeout, playerState, isOverlayVisible]);\n\n  if (isEnded && song.data) {\n    return (\n      <PostGame\n        width={width}\n        height={height}\n        song={song.data}\n        onClickSongSelection={returnToSongSelection}\n        singSetup={singSetup}\n      />\n    );\n  } else {\n    return (\n      <Container>\n        <BackgroundContainer visible={isOverlayVisible}>\n          <Overlay video={songPreview.video} width={width} height={height} />\n          <Artist>{songPreview.artist}</Artist>\n          <Title>{songPreview.title}</Title>\n          <WaitForReadiness\n            onFinish={() => {\n              setIsTransitionTimeout(true);\n              player.current?.play();\n            }}\n          />\n        </BackgroundContainer>\n        {song.data && (\n          <Player\n            ref={player}\n            onStatusChange={setPlayerState}\n            playerChanges={playerChanges}\n            players={singSetup.players}\n            song={song.data}\n            width={width}\n            height={height}\n            autoplay={false}\n            onSongEnd={() => {\n              const scores =\n                GameState.getSingSetup()?.mode === GAME_MODE.CO_OP\n                  ? [\n                      {\n                        name: PlayersManager.getPlayers()\n                          .map((player) => player.getName())\n                          .join(', '),\n                        score: GameState.getPlayerScore(0),\n                      },\n                    ]\n                  : PlayersManager.getPlayers().map((player) => ({\n                      name: player.getName(),\n                      score: GameState.getPlayerScore(player.number),\n                    }));\n              events.songEnded.dispatch(song.data!, singSetup, scores);\n              setIsEnded(true);\n            }}\n            singSetup={singSetup}\n            restartSong={restartSong}\n          />\n        )}\n      </Container>\n    );\n  }\n}\n\nconst Container = styled.div`\n  position: relative;\n`;\n\nconst BackgroundContainer = styled.div<{ visible: boolean }>`\n  position: fixed;\n  top: 0;\n  left: 0;\n  z-index: 10;\n  pointer-events: none;\n  background-color: black;\n  view-transition-name: song-preview;\n  opacity: ${(props) => (props.visible ? 1 : 0)};\n  transition: 500ms;\n`;\n\nconst BaseOverlay = styled.div`\n  background-size: cover;\n  background-position: center center;\n  filter: blur(10px);\n`;\n\nconst Overlay = (props: { video: string; width: number; height: number }) => (\n  <BaseOverlay\n    style={{\n      backgroundImage: `url('https://i3.ytimg.com/vi/${props.video}/hqdefault.jpg')`,\n      width: `${props.width}px`,\n      height: `${props.height}px`,\n    }}\n  />\n);\n\nconst Artist = styled(SongListEntryDetailsArtist)`\n  view-transition-name: song-preview-artist;\n  position: absolute;\n  top: 10rem;\n  left: 10rem;\n  font-size: 7rem;\n`;\nconst Title = styled(SongListEntryDetailsTitle)`\n  view-transition-name: song-preview-title;\n  position: absolute;\n\n  font-size: 8rem;\n  top: 19rem;\n  left: 10rem;\n`;\n\nexport default Singing;\n","import CameraManager from 'Camera/CameraManager';\nimport SingASong from 'Scenes/SingASong/SingASong';\nimport { woosh } from 'SoundManager';\nimport useFullscreen from 'hooks/useFullscreen';\nimport { SingSetup, SongPreview } from 'interfaces';\nimport { useState } from 'react';\nimport { flushSync } from 'react-dom';\nimport startViewTransition from 'utils/startViewTransition';\nimport Singing from './Singing/Singing';\n\ninterface Props {\n  songId?: string;\n}\n\nfunction Game(props: Props) {\n  const [singSetup, setSingSetup] = useState<(SingSetup & { song: SongPreview }) | null>(null);\n  const [preselectedSong, setPreselectedSong] = useState<string | null>(props.songId ?? null);\n  const [resetKey, setResetKey] = useState(0);\n\n  const handleSelect = (setup: SingSetup & { song: SongPreview }) => {\n    // @ts-expect-error\n    document.getElementById('preview-video-container')!.style.viewTransitionName = 'song-preview-video';\n    startViewTransition(() => {\n      // @ts-expect-error\n      document.getElementById('preview-video-container')!.style.viewTransitionName = '';\n      flushSync(() => {\n        setSingSetup(setup);\n      });\n    });\n\n    woosh.play();\n  };\n\n  useFullscreen();\n\n  return (\n    <>\n      {singSetup ? (\n        <Singing\n          restartSong={() => {\n            CameraManager.restartRecord();\n            setResetKey((current) => current + 1);\n          }}\n          key={resetKey}\n          songPreview={singSetup.song}\n          singSetup={singSetup}\n          returnToSongSelection={() => {\n            setPreselectedSong(singSetup.song.id);\n            setSingSetup(null);\n          }}\n        />\n      ) : (\n        <SingASong onSongSelected={handleSelect} preselectedSong={preselectedSong} />\n      )}\n    </>\n  );\n}\nexport default Game;\n","import styled from '@emotion/styled';\nimport { Button } from 'Elements/Button';\nimport { useBackground } from 'Elements/LayoutWithBackground';\nimport VideoPlayer, { VideoState } from 'Elements/VideoPlayer';\nimport useSongIndex from 'Songs/hooks/useSongIndex';\nimport useBackgroundMusic from 'hooks/useBackgroundMusic';\nimport useKeyboardNav from 'hooks/useKeyboardNav';\nimport useSmoothNavigate from 'hooks/useSmoothNavigate';\nimport { SongPreview } from 'interfaces';\nimport { shuffle } from 'lodash-es';\nimport { useEffect, useState } from 'react';\nimport { Link } from 'wouter';\nimport useViewportSize from '../../hooks/useViewportSize';\nimport SongPage from '../Game/SongPage';\n\ninterface Props {}\n\nfunction Jukebox(props: Props) {\n  useBackground(false);\n  useBackgroundMusic(false);\n  const navigate = useSmoothNavigate();\n  const { width, height } = useViewportSize();\n  const [currentlyPlaying, setCurrentlyPlaying] = useState(0);\n  const songList = useSongIndex();\n\n  const [shuffledList, setShuffledList] = useState<SongPreview[]>([]);\n  const { register } = useKeyboardNav({ onBackspace: () => navigate('/') });\n\n  useEffect(() => songList.data && setShuffledList(shuffle(songList.data)), [songList.data]);\n\n  const playNext = () => songList.data && setCurrentlyPlaying((current) => (current + 1) % songList.data.length);\n\n  if (!shuffledList.length || !width || !height) return null;\n\n  const navigateUrl = `/game/${encodeURIComponent(shuffledList[currentlyPlaying].id)}`;\n\n  return (\n    <SongPage\n      width={width}\n      height={height}\n      songData={shuffledList[currentlyPlaying]}\n      data-test=\"jukebox-container\"\n      data-song={shuffledList[currentlyPlaying].id}\n      background={\n        <VideoPlayer\n          autoplay\n          controls\n          width={width}\n          height={height}\n          volume={shuffledList[currentlyPlaying]?.volume}\n          video={shuffledList[currentlyPlaying].video}\n          startAt={shuffledList[currentlyPlaying].videoGap}\n          onStateChange={(state) => {\n            if (state === VideoState.ENDED) playNext();\n          }}\n        />\n      }>\n      <SkipSongButton {...register('skip-button', playNext)}>Skip</SkipSongButton>\n      <Link to={navigateUrl}>\n        <PlayThisSongButton {...register('sing-button', () => navigate(navigateUrl), undefined, true)}>\n          Sing this song\n        </PlayThisSongButton>\n      </Link>\n    </SongPage>\n  );\n}\n\nconst PlayThisSongButton = styled(Button)<{ focused: boolean }>`\n  bottom: 7rem;\n  right: 2rem;\n  width: 50rem;\n  position: absolute;\n  font-size: 1.9vw;\n`;\n\nconst SkipSongButton = styled(Button)<{ focused: boolean }>`\n  bottom: 15rem;\n  right: 2rem;\n  width: 30rem;\n  position: absolute;\n  font-size: 1.9vw;\n`;\n\nexport default Jukebox;\n","import MenuWithLogo from 'Elements/MenuWithLogo';\nimport SelectInputView from 'Scenes/SelectInput/SelectInputView';\nimport useSmoothNavigate from 'hooks/useSmoothNavigate';\n\ninterface Props {\n  // file?: string;\n}\n\nfunction SelectInput(props: Props) {\n  const navigate = useSmoothNavigate();\n\n  return (\n    <MenuWithLogo>\n      <SelectInputView onFinish={() => navigate('/')} closeButtonText={'Go to main menu'} />\n    </MenuWithLogo>\n  );\n}\nexport default SelectInput;\n","import styled from '@emotion/styled';\nimport { Warning } from '@mui/icons-material';\nimport { FallbackRender } from '@sentry/react';\nimport { MenuButton } from 'Elements/Menu';\nimport MenuWithLogo from 'Elements/MenuWithLogo';\nimport localForage from 'localforage';\n\nexport const ErrorFallback: FallbackRender = ({ error, resetError }) => {\n  return (\n    <MenuWithLogo supportedBrowsers>\n      <h1>\n        <Warning fontSize=\"large\" /> An error occurred :(\n      </h1>\n      <h3>The game crashed with following error</h3>\n      <Pre>{error.message}</Pre>\n      <h3>\n        Help me fix it by reporting what exactly has happened at{' '}\n        <a href=\"https://github.com/Asvarox/allkaraoke\" target=\"_blank\" rel=\"noreferrer\">\n          GitHub\n        </a>{' '}\n        or{' '}\n        <a href=\"https://www.facebook.com/allkaraoke.party\" target=\"_blank\" rel=\"noreferrer\">\n          Facebook\n        </a>\n      </h3>\n      <MenuButton onClick={resetError}>Reset Error</MenuButton>\n      <h4>If that doesn't help</h4>\n      <MenuButton onClick={() => (window.location.href = window.location.origin)}>Reload the game</MenuButton>\n      <h4>If that doesn't help</h4>\n      <MenuButton\n        onClick={() => {\n          if (\n            window.confirm(\n              'Are you sure? It will delete all custom songs and scores. Before doing that, try opening the game in an private window or another browser to make sure it will actually help',\n            )\n          ) {\n            sessionStorage.clear();\n            localStorage.clear();\n            localForage.clear();\n            window.location.href = window.location.origin;\n          }\n        }}>\n        Clear all data\n      </MenuButton>\n    </MenuWithLogo>\n  );\n};\n\nexport const Pre = styled.span`\n  color: white;\n  font-family: monospace;\n`;\n","import { css } from '@emotion/react';\nimport { typography } from 'Elements/cssMixins';\nimport styles from 'Scenes/Game/Singing/GameOverlay/Drawing/styles';\n\nexport default css`\n  h1 {\n    ${typography};\n    margin: 0;\n    text-align: center;\n    font-size: 4rem;\n    color: ${styles.colors.text.active};\n  }\n\n  h2 {\n    ${typography};\n    margin: 0;\n    font-size: 2.9rem;\n  }\n\n  h3 {\n    ${typography};\n    margin: 0;\n    font-size: 2.7rem;\n\n    strong {\n      color: ${styles.colors.text.active};\n    }\n  }\n\n  h4 {\n    ${typography};\n    margin: 0;\n    font-size: 2.2rem;\n    line-height: 1.15;\n  }\n\n  h5 {\n    ${typography};\n    margin: 0;\n    font-size: 1.6rem;\n    line-height: 1.5;\n  }\n\n  h6 {\n    ${typography};\n    margin: 0;\n    line-height: 1.5;\n    font-size: 1.3rem;\n  }\n\n  hr {\n    margin: 0.5rem 1rem;\n    opacity: 0.25;\n  }\n\n  h1,\n  h2,\n  h3,\n  h4,\n  h5 {\n    button {\n      ${typography};\n      background: none;\n      padding: 0;\n      margin: 0;\n      border: none;\n      font-size: inherit;\n      color: ${styles.colors.text.active};\n      text-decoration: underline;\n      cursor: pointer;\n    }\n\n    svg {\n      font-size: 0.8em;\n    }\n  }\n\n  a {\n    ${typography};\n    color: ${styles.colors.text.active};\n    text-decoration: underline;\n  }\n\n  strong {\n    color: ${styles.colors.text.active};\n  }\n`;\n","import styled from '@emotion/styled';\nimport styles from 'styles';\n\nexport const GameScreens = styled.div`\n  ${styles};\n`;\n","import useSongIndex from 'Songs/hooks/useSongIndex';\nimport useBackgroundMusic from 'hooks/useBackgroundMusic';\nimport { useEffect } from 'react';\n\ninterface GetSongBpmSearchEntry {\n  song_id: string;\n  song_title: string;\n  song_uri: string;\n  tempo: string;\n  time_sig: string;\n  key_of: string;\n  open_key: null;\n  artist: {\n    id: string;\n    name: string;\n    uri: string;\n    img: string;\n    genres: string[];\n    from: string;\n    mbid: string;\n  };\n  album: {\n    title: string;\n    uri: string;\n    img: string;\n    year: string;\n  };\n}\n\nexport default function GetSongsBPMs(props: {}) {\n  useBackgroundMusic(false);\n  const songList = useSongIndex();\n\n  useEffect(() => {\n    if (songList.data) {\n      const bpms: Record<string, GetSongBpmSearchEntry | null> = {};\n      (async () => {\n        for (const song of songList.data) {\n          if (song.realBpm) continue;\n          const params = [\n            `lookup=song:${encodeURIComponent(song.title)}+artist:${encodeURIComponent(song.artist)}`,\n            'type=both',\n            `api_key=${import.meta.env.VITE_APP_GET_SONG_BPM_API_TOKEN!}`,\n          ].join('&');\n\n          const response = await fetch(`https://api.getsongbpm.com/search/?${params}`);\n          const getSongBPMData: { search: GetSongBpmSearchEntry[] } = await response.json();\n\n          bpms[song.id] = Array.isArray(getSongBPMData.search) ? getSongBPMData.search[0] || null : null;\n        }\n        console.log(bpms);\n      })();\n    }\n  }, [songList.data]);\n\n  return <>Copy resulting object to `scripts/scraped-bpm-data.json` file and run fillMetadata script</>;\n}\n","import useSmoothNavigate from 'hooks/useSmoothNavigate';\nimport ExcludeLanguagesView from './ExcludeLanguagesView';\n\ninterface Props {}\n\nfunction ExcludeLanguages(props: Props) {\n  const navigate = useSmoothNavigate();\n  const goBack = () => navigate('/');\n\n  return <ExcludeLanguagesView onClose={goBack} closeText=\"Return to Main Menu\" />;\n}\n\nexport default ExcludeLanguages;\n","import styled from '@emotion/styled';\nimport { useLayoutEffect, useState } from 'react';\nimport { usePreviousDistinct } from 'react-use';\n\nfunction Tile({ videoId, ...props }: Props) {\n  return <Image src={`https://img.youtube.com/vi/${videoId}/0.jpg`} {...props} />;\n}\n\ninterface Props {\n  videoId: string;\n}\nfunction AnimatedTile({ videoId }: Props) {\n  const previousVideoId = usePreviousDistinct(videoId) ?? videoId;\n  const [visible, setVisible] = useState(true);\n  useLayoutEffect(() => {\n    // console.log(videoId);\n    setVisible((current) => !current);\n  }, [videoId]);\n\n  return (\n    <div>\n      <Container>\n        <TileAnimated videoId={visible ? videoId : previousVideoId} visible={visible} />\n        <TileAnimated videoId={visible ? previousVideoId : videoId} visible={!visible} />\n        <BaseTile videoId={previousVideoId} />\n      </Container>\n    </div>\n  );\n}\n\nconst Container = styled.div`\n  position: relative;\n  overflow: hidden;\n  background: black;\n`;\n\nconst BaseTile = styled(Tile)`\n  visibility: hidden;\n`;\nconst TileAnimated = styled(Tile)<{ visible: boolean }>`\n  position: absolute;\n  transition: opacity 1s;\n  opacity: ${(props) => (props.visible ? 1 : 0)};\n`;\n\nconst Image = styled.img`\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n  transform: scale(1.5);\n`;\n\nexport default AnimatedTile;\n","import styled from '@emotion/styled';\nimport AnimatedTile from 'Scenes/LandingPage/AnimatedTile';\nimport isMobile from 'is-mobile';\nimport { useEffect, useMemo, useState } from 'react';\nimport { randomInt } from 'utils/randomValue';\nimport songStats from './songStats.json';\n\nconst minTime = 10000;\nconst maxTime = 20000;\n\nfunction RandomTile({ videoIds }: { videoIds: string[] }) {\n  const [videoId, setVideoId] = useState(videoIds[randomInt(0, videoIds.length - 1)]);\n  const [time, setTime] = useState(randomInt(0, maxTime - minTime));\n\n  useEffect(() => {\n    const interval = setTimeout(() => {\n      const index = randomInt(0, videoIds.length - 1);\n      setVideoId(videoIds[index]);\n      setTime(randomInt(minTime, maxTime));\n    }, time);\n\n    return () => clearInterval(interval);\n  }, [videoIds, time]);\n\n  return <AnimatedTile videoId={videoId} />;\n}\n\nfunction Background() {\n  const isMobileDevice = useMemo(() => isMobile(), []);\n\n  const cols = isMobileDevice ? 3 : 5;\n  const rows = isMobileDevice ? 9 : 4;\n\n  return (\n    <Container cols={cols} rows={rows}>\n      {new Array(cols * rows).fill(null).map(() => (\n        <RandomTile videoIds={songStats.videoIds} />\n      ))}\n    </Container>\n  );\n}\n\nconst Container = styled.div<{ cols: number; rows: number }>`\n  position: fixed;\n  inset: 0;\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n  align-items: center;\n  filter: blur(2px) grayscale(90%);\n  opacity: 0.25;\n  transform: scale(1.05);\n  z-index: -1;\n\n  div {\n    flex-basis: ${(props) => 100 / props.cols}%;\n    height: ${(props) => 100 / props.rows}vh;\n  }\n`;\n\nexport default Background;\n","import styled from '@emotion/styled';\nimport { MicIconBlue, MicIconRed } from 'Elements/MicIcon';\nimport { ComponentProps } from 'react';\n\nexport default function LogoIcon(props: ComponentProps<typeof OptionIconContainer>) {\n  return (\n    <OptionIconContainer {...props}>\n      <MicIconBlue />\n      <MicIconRed />\n    </OptionIconContainer>\n  );\n}\n\nconst OptionIconContainer = styled.div`\n  position: relative;\n  transition: 300ms;\n\n  svg {\n    transition: 300ms;\n    width: 15rem;\n    height: 15rem;\n  }\n\n  svg:first-of-type {\n    top: 1.6rem;\n    left: 3.5rem;\n    position: absolute;\n    z-index: 100;\n    transform: scaleX(-1);\n  }\n`;\n","export default \"__VITE_ASSET__b7f578a5__\"","export default \"__VITE_ASSET__9a75cc8b__\"","// import songs from '../../../public/songs/index.json';\nimport styled from '@emotion/styled';\nimport { Button } from 'Elements/Button';\nimport { useBackground } from 'Elements/LayoutWithBackground';\nimport Logo from 'Elements/Logo';\nimport { focused, typography } from 'Elements/cssMixins';\nimport Background from 'Scenes/LandingPage/Background';\nimport GithubRibbon from 'Scenes/Welcome/GithubRibbon';\nimport useSmoothNavigate from 'hooks/useSmoothNavigate';\nimport Typewriter from 'typewriter-effect';\nimport LogoIcon from './LogoIcon';\nimport screenshot1 from './screenshot1.webp';\nimport screenshot2 from './screenshot2.webp';\nimport songStats from './songStats.json';\n\nfunction LandingPage() {\n  const navigate = useSmoothNavigate();\n  useBackground(true);\n\n  return (\n    <>\n      <GithubRibbon />\n      <Background />\n      <Container>\n        <LogoContainer>\n          <LogoIcon />\n          <Logo />\n        </LogoContainer>\n        <Stats>\n          <StatSegment>\n            <StatsDescription>\n              <strong>AllKaraoke</strong> is a free online karaoke game inspired by PlayStation's{' '}\n              <strong>SingStar</strong>. Sing along to your favorite songs and compete with your friends, all through\n              the browser! Updated almost weekly with new songs and features.\n            </StatsDescription>\n            <hr />\n            <StatText>\n              ▸ <strong>{songStats.songs}</strong> songs in <strong>{songStats.languages.length}</strong> languages\n              <StatSubText>\n                Artists such as{' '}\n                <strong>\n                  <Typewriter\n                    options={{\n                      strings: songStats.artists,\n                      autoStart: true,\n                      loop: true,\n                      delay: 100,\n                    }}\n                  />\n                </strong>\n              </StatSubText>\n            </StatText>\n            <StatText>\n              ▸ Play <strong>directly</strong> in the browser\n              <StatSubText>\n                No <strong>download</strong> needed\n              </StatSubText>\n            </StatText>\n            <StatText>\n              ▸ Use <strong>phones</strong> as microphones\n              <StatSubText>No need to download an app</StatSubText>\n            </StatText>\n\n            <StatText>\n              ▸ <strong>100% Free</strong> and open source\n              <StatSubText>\n                Check the{' '}\n                <a href=\"https://github.com/Asvarox/allkaraoke\" target=\"_blank\" rel=\"noreferrer\">\n                  GitHub repository\n                </a>\n              </StatSubText>\n            </StatText>\n          </StatSegment>\n          <StatSegment>\n            <img src={screenshot1} alt=\"Song list screen\" />\n            <img src={screenshot2} alt=\"In-game screen\" />\n          </StatSegment>\n        </Stats>\n        <PlayButton onClick={() => navigate('/quick-setup')} data-test=\"enter-the-game\">\n          Enter the game\n        </PlayButton>\n      </Container>\n    </>\n  );\n}\n\nconst LogoContainer = styled.div`\n  display: flex;\n  gap: 6rem;\n`;\n\nconst Stats = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 6rem;\n  padding: 6rem;\n  box-sizing: border-box;\n  width: 110rem;\n  background: rgba(0, 0, 0, 0.8);\n  backdrop-filter: blur(10px);\n\n  hr {\n    margin: 3rem 0;\n  }\n`;\n\nconst StatsDescription = styled.span`\n  line-height: 1.5;\n  text-align: justify;\n`;\n\nconst StatSegment = styled.div`\n  ${typography};\n  font-size: 2.5rem;\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n  img {\n    margin-bottom: 4rem;\n    width: 100%;\n    object-fit: cover;\n    box-shadow: 0 0 2rem white;\n    border-radius: 1rem;\n  }\n  img:last-of-type {\n    margin-bottom: 0;\n  }\n`;\nconst StatText = styled.div`\n  height: 7rem;\n`;\nconst StatSubText = styled.div`\n  padding-top: 0.5rem;\n  font-size: 1.75rem;\n  text-align: right;\n\n  .Typewriter {\n    display: inline;\n  }\n`;\n\nconst Container = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100vh;\n  gap: 3rem;\n`;\n\nconst PlayButton = styled(Button)`\n  font-size: 9rem;\n  padding: 1rem 7rem;\n  background: black;\n  width: 110rem;\n  ${focused};\n`;\n\nexport default LandingPage;\n","import { MenuButton } from 'Elements/Menu';\nimport MenuWithLogo from 'Elements/MenuWithLogo';\nimport useKeyboardNav from 'hooks/useKeyboardNav';\nimport useSmoothNavigate from 'hooks/useSmoothNavigate';\nimport { MouseEventHandler } from 'react';\nimport { Link } from 'wouter';\n\ninterface Props {}\n\nfunction ManageSongs(props: Props) {\n  const navigate = useSmoothNavigate();\n  const goBack = () => navigate('/');\n\n  const { register } = useKeyboardNav({ onBackspace: goBack });\n\n  const handleClick: (url: string) => MouseEventHandler<HTMLAnchorElement> = (url) => (e) => {\n    e.preventDefault();\n    navigate(url);\n  };\n\n  return (\n    <MenuWithLogo>\n      <h1>Manage Songs</h1>\n      <Link href=\"/exclude-languages\" onClick={handleClick('/exclude-languages')}>\n        <MenuButton {...register('exclude-languages', () => navigate('/exclude-languages'))}>\n          Select Song Languages\n        </MenuButton>\n      </Link>\n      <Link href=\"/edit\" onClick={handleClick('/edit')}>\n        <MenuButton {...register('edit-songs', () => navigate('/edit'))}>Edit songs</MenuButton>\n      </Link>\n      <Link href=\"/convert\" onClick={handleClick('/convert')}>\n        <MenuButton {...register('convert-song', () => navigate('/convert'))}>Convert UltraStar .txt</MenuButton>\n      </Link>\n      <hr />\n      <MenuButton {...register('back-button', goBack)}>Return To Main Menu</MenuButton>\n    </MenuWithLogo>\n  );\n}\n\nexport default ManageSongs;\n","import styled from '@emotion/styled';\nimport { MenuButton, MenuContainer } from 'Elements/Menu';\nimport { MobilePhoneModeSetting, useSettingValue } from 'Scenes/Settings/SettingsState';\n\nfunction SuggestMobilePhone() {\n  const [, setMobilePhoneMode] = useSettingValue(MobilePhoneModeSetting);\n\n  const setPhoneMode = async () => {\n    try {\n      setMobilePhoneMode(true);\n      await document.body.requestFullscreen();\n      window.screen.orientation.unlock();\n      await window.screen.orientation.lock?.('landscape');\n    } catch (e) {\n      console.info(e);\n    }\n  };\n\n  return (\n    <Container>\n      <Modal>\n        <h1>Use Mobile Phone Mode?</h1>\n        <h3>\n          The regular version of the game isn't optimal for smaller screens. Enable the Mobile Phone Mode to adjust the\n          UI and gameplay elements. Use this, or connect other mobiles to sing songs.\n        </h3>\n        <h3>\n          You can always change the setting in the <strong>Settings</strong> menu.\n        </h3>\n        <MenuButton focused onClick={setPhoneMode} data-test=\"enable-mobile-mode\">\n          Enable Mobile Phone Mode\n        </MenuButton>\n        <MenuButton onClick={() => setMobilePhoneMode(false)} data-test=\"dismiss-mobile-mode\">\n          Dismiss\n        </MenuButton>\n      </Modal>\n    </Container>\n  );\n}\n\nconst Container = styled.div`\n  position: fixed;\n  inset: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n`;\n\nconst Modal = styled(MenuContainer)`\n  max-width: 150rem;\n  padding: calc(min(3vw, 4vh));\n  margin: auto;\n  h1 {\n    font-size: calc(min(4vw, 5vh));\n    margin-bottom: 0.75em;\n  }\n  h3 {\n    font-size: calc(min(3vw, 4vh));\n    line-height: 1.25;\n    margin-bottom: 1em;\n  }\n  ${MenuButton} {\n    font-size: calc(min(3vw, 4vh));\n    height: auto;\n    padding: calc(min(3vw, 4vh));\n  }\n`;\n\nexport default SuggestMobilePhone;\n","import MenuWithLogo from 'Elements/MenuWithLogo';\nimport SuggestMobileMode from 'Scenes/QuickSetup/SuggestMobileMode';\nimport SelectInputView from 'Scenes/SelectInput/SelectInputView';\nimport { MicSetupPreference, MobilePhoneModeSetting, useSettingValue } from 'Scenes/Settings/SettingsState';\nimport useSmoothNavigate from 'hooks/useSmoothNavigate';\nimport { useMemo } from 'react';\nimport isDev from 'utils/isDev';\n\ninterface Props {\n  // file?: string;\n}\n\nfunction QuickSetup(props: Props) {\n  const [mobilePhoneMode] = useSettingValue(MobilePhoneModeSetting);\n  const isMobile = useMemo(\n    () =>\n      window.matchMedia(\n        'only screen and (((max-width: 500px) and (max-aspect-ratio: 10/16)) or ((max-height: 500px) and (min-aspect-ratio: 16/10)))',\n      ).matches,\n    [],\n  );\n\n  const navigate = useSmoothNavigate();\n  const onFinish = async (pref: (typeof MicSetupPreference)[number]) => {\n    navigate('/');\n    if (!isDev() && mobilePhoneMode && document.fullscreenElement === null) {\n      try {\n        await document.body.requestFullscreen();\n        window.screen.orientation.unlock();\n        await window.screen.orientation.lock?.('landscape');\n      } catch (e) {\n        console.info(e);\n      }\n    }\n  };\n\n  return (\n    <>\n      {mobilePhoneMode === null && isMobile ? (\n        <SuggestMobileMode />\n      ) : (\n        <MenuWithLogo>\n          <SelectInputView onFinish={onFinish} closeButtonText=\"Sing a song\" smooth={false} />\n        </MenuWithLogo>\n      )}\n    </>\n  );\n}\n\nexport default QuickSetup;\n","import styled from '@emotion/styled';\nimport { MenuButton } from 'Elements/Menu';\nimport MenuWithLogo from 'Elements/MenuWithLogo';\nimport { nextValue, Switcher } from 'Elements/Switcher';\nimport events from 'GameEvents/GameEvents';\nimport { useEventListenerSelector } from 'GameEvents/hooks';\nimport useBackgroundMusic from 'hooks/useBackgroundMusic';\nimport useKeyboardNav from 'hooks/useKeyboardNav';\nimport useSmoothNavigate from 'hooks/useSmoothNavigate';\nimport { useEffect } from 'react';\nimport { useUpdate } from 'react-use';\nimport RemoteMicManager from 'RemoteMic/RemoteMicManager';\nimport { DefaultRemoteMicPermission, RemoteMicPermissions, useSettingValue } from 'Scenes/Settings/SettingsState';\nimport { useDevicePing } from 'Scenes/SingASong/SongSelection/SongSettings/MicCheck/Ping';\n\ninterface Props {}\n\nfunction RemoteMicSettings(props: Props) {\n  useBackgroundMusic(false);\n  const navigate = useSmoothNavigate();\n  const goBack = () => navigate('/settings');\n\n  const { register } = useKeyboardNav({ onBackspace: goBack });\n\n  const [defaultPermission, setDefaultPermission] = useSettingValue(DefaultRemoteMicPermission);\n  const remoteMics = useEventListenerSelector(events.inputListChanged, () => RemoteMicManager.getRemoteMics());\n\n  const forceUpdate = useUpdate();\n  useEffect(() => RemoteMicManager.addListener(forceUpdate), [forceUpdate]);\n\n  return (\n    <MenuWithLogo>\n      <h1>Remote Microphone Settings</h1>\n      <Switcher\n        {...register('default-permission', () =>\n          setDefaultPermission(nextValue(RemoteMicPermissions, defaultPermission)),\n        )}\n        label=\"Default permission\"\n        info={\n          <>\n            <strong>WRITE</strong> - player is able to navigate the menus remotely and assign themselves and other\n            players to the game.\n            <br />\n            <br />\n            <strong>READ</strong> - player will only be able to use the device as a microphone and otherwise have no\n            control over the game.\n          </>\n        }\n        value={defaultPermission.toUpperCase()}\n      />\n      <hr />\n      <h3>Connected devices permissions:</h3>\n      {remoteMics.map((mic) => {\n        const permission = RemoteMicManager.getPermission(mic.id);\n        return (\n          <RemoteMicEntry\n            key={mic.id}\n            {...register(\n              `mic-${mic.id}`,\n              () => RemoteMicManager.setPermission(mic.id, nextValue(RemoteMicPermissions, permission)),\n              'Change permissions',\n            )}\n            data-test=\"remote-mic-entry\"\n            data-id={mic.id}\n            value={permission}\n            label={\n              <EntryLabel>\n                <RemoteMicId>{mic.id.slice(-4)}</RemoteMicId>\n                <RemoteMicPing>\n                  <DevicePing deviceId={mic.id} />\n                </RemoteMicPing>\n                <RemoteMicName className=\"ph-no-capture\">{mic.name}</RemoteMicName>\n              </EntryLabel>\n            }\n          />\n        );\n      })}\n      {remoteMics.length === 0 && <h4>No remote microphones connected</h4>}\n      <hr />\n      <MenuButton {...register('back-button', goBack)}>Return To Settings</MenuButton>\n    </MenuWithLogo>\n  );\n}\n\nconst DevicePing = ({ deviceId }: { deviceId: string }) => {\n  const latency = useDevicePing(deviceId);\n\n  return latency === null ? null : <>{latency}ms</>;\n};\n\nconst EntryLabel = styled.span`\n  text-transform: uppercase;\n`;\n\nconst RemoteMicEntry = styled(Switcher)`\n  text-transform: uppercase;\n`;\n\nconst RemoteMicName = styled.span``;\nconst RemoteMicId = styled.span`\n  font-size: 1.5rem;\n  padding-right: 1rem;\n`;\nconst RemoteMicPing = styled.span`\n  font-size: 1.5rem;\n  padding-right: 2rem;\n  text-transform: none;\n`;\nexport default RemoteMicSettings;\n","import { css } from '@emotion/react';\nimport styled from '@emotion/styled';\nimport { MenuContainer } from 'Elements/Menu';\nimport { MobilePhoneModeSetting, useSettingValue } from 'Scenes/Settings/SettingsState';\nimport { useCallback, useState } from 'react';\n\nconst FBEmbedCode = (width: number, height: number) => {\n  const settings = {\n    show_posts: true,\n    width,\n    height,\n    small_header: true,\n    adapt_container_width: true,\n    hide_cover: false,\n    show_facepile: false,\n    // tabs: 'timeline',\n    appId: 530120230391395,\n  };\n\n  const qs = Object.entries(settings)\n    .map(([k, v]) => `${k}=${String(v)}`)\n    .join('&');\n  return `\n<iframe src=\"https://www.facebook.com/plugins/page.php?href=https%3A%2F%2Fwww.facebook.com%2Fallkaraoke.party&${qs}\" width=\"${width}\" height=\"${height}\" style=\"border:none;overflow:hidden\" scrolling=\"no\" frameborder=\"0\" allowfullscreen=\"true\" allow=\"autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share\"></iframe>\n`;\n};\nfunction FacebookLink() {\n  const [mobilePhoneMode] = useSettingValue(MobilePhoneModeSetting);\n\n  const [width, setWidth] = useState(200);\n  const fbRef = useCallback((node: HTMLDivElement) => {\n    setWidth(Math.round(node?.getBoundingClientRect().width) ?? 200);\n  }, []);\n\n  return (\n    <Container small={!!mobilePhoneMode}>\n      <div\n        dangerouslySetInnerHTML={{ __html: FBEmbedCode(350, 750) }}\n        style={{\n          height: 750 * (width / 350),\n          width: '100%',\n          transformOrigin: 'left top',\n          transform: `scale(${width / 350})`,\n        }}\n      />\n      <h5 ref={fbRef}>Get updates, and help by suggesting features and reporting bugs.</h5>\n    </Container>\n  );\n}\n\nconst Container = styled(MenuContainer)<{ small: boolean }>`\n  position: absolute;\n  top: 2rem;\n  right: 10rem;\n  width: 37rem;\n  margin: 0;\n  text-decoration: none;\n  text-align: justify;\n  ${(props) =>\n    props.small &&\n    css`\n      width: 25rem;\n      right: 1rem;\n\n      h2 {\n        font-size: 1.5rem;\n      }\n      h5 {\n        font-size: 1.15rem;\n      }\n    `}\n\n  view-transition-name: fb-notification;\n`;\n\nexport default FacebookLink;\n","import styled from '@emotion/styled';\nimport { useBackground } from 'Elements/LayoutWithBackground';\nimport { MenuButton } from 'Elements/Menu';\nimport MenuWithLogo from 'Elements/MenuWithLogo';\nimport { typography } from 'Elements/cssMixins';\nimport { BackgroundMusicSetting, useSettingValue } from 'Scenes/Settings/SettingsState';\nimport FacebookLink from 'Scenes/Welcome/FacebookLink';\nimport useBackgroundMusic from 'hooks/useBackgroundMusic';\nimport useKeyboardNav from 'hooks/useKeyboardNav';\nimport useSmoothNavigate from 'hooks/useSmoothNavigate';\nimport { MouseEventHandler } from 'react';\nimport { Link } from 'wouter';\n\nfunction Welcome() {\n  const [backgroundMusicSelection] = useSettingValue(BackgroundMusicSetting);\n  useBackground(true);\n\n  const navigate = useSmoothNavigate();\n\n  const handleClick: (url: string) => MouseEventHandler<HTMLAnchorElement> = (url) => (e) => {\n    e.preventDefault();\n    navigate(url);\n  };\n\n  useBackgroundMusic(/* true */ false);\n  const { register } = useKeyboardNav();\n  return (\n    <MenuWithLogo>\n      {backgroundMusicSelection !== 'Classic' && (\n        <BackgroundMusicCredit>\n          <span>\n            Bpm data and release year provided by{' '}\n            <a target=\"_blank\" href=\"https://getsongbpm.com/\" rel=\"noreferrer\">\n              GetSongBPM\n            </a>\n          </span>\n          <span>Song: Funk Cool Groove (Music Today 80)</span>\n          <span>• Composed & Produced by : Anwar Amr</span>\n          <span>\n            • Video Link:{' '}\n            <a href=\"https://youtu.be/FGzzBbYRjFY\" target=\"_blank\" rel=\"noreferrer\">\n              https://youtu.be/FGzzBbYRjFY\n            </a>\n          </span>\n        </BackgroundMusicCredit>\n      )}\n      <FacebookLink />\n      <>\n        <Link href=\"/game/\" onClick={handleClick('/game/')}>\n          <MenuButton {...register('sing-a-song', () => navigate('/game/'))}>Sing a song</MenuButton>\n        </Link>\n        <Link href=\"/select-input\" onClick={handleClick('/select-input')}>\n          <MenuButton {...register('select-input', () => navigate('/select-input'))}>Setup Microphones</MenuButton>\n        </Link>\n        <Link href=\"/settings\" onClick={handleClick('/settings')}>\n          <MenuButton {...register('settings', () => navigate('/settings'))}>Settings</MenuButton>\n        </Link>\n        <Link href=\"/jukebox\" onClick={handleClick('/jukebox')}>\n          <MenuButton {...register('jukebox', () => navigate('/jukebox'))}>Jukebox</MenuButton>\n        </Link>\n        <Link href=\"/manage-songs\" onClick={handleClick('/manage-songs')}>\n          <MenuButton {...register('manage-songs', () => navigate('/manage-songs'))}>Manage Songs</MenuButton>\n        </Link>\n      </>\n    </MenuWithLogo>\n  );\n}\n\nconst BackgroundMusicCredit = styled.div`\n  ${typography};\n  text-decoration: none;\n  flex-direction: column;\n  display: flex;\n  font-size: 1rem;\n  gap: 1.25rem;\n  opacity: 0.85;\n  position: absolute;\n  bottom: 1rem;\n  left: 1rem;\n\n  view-transition-name: background-music-credit;\n`;\n\nexport default Welcome;\n","import { Fullscreen, FullscreenExit } from '@mui/icons-material';\nimport { IconButton, Tooltip } from '@mui/material';\nimport 'RemoteMic/eventListeners';\nimport { MobilePhoneModeSetting, useSettingValue } from 'Scenes/Settings/SettingsState';\nimport 'Stats';\nimport { useEffect, useState } from 'react';\n\nfunction FullscreenButton() {\n  const [mobilePhoneMode] = useSettingValue(MobilePhoneModeSetting);\n  const [isFullScreen, setIsFullScreen] = useState(document.fullscreenElement !== null);\n\n  useEffect(() => {\n    const onChange = () => {\n      setIsFullScreen(document.fullscreenElement !== null);\n    };\n    document.addEventListener('fullscreenchange', onChange);\n\n    return () => {\n      document.removeEventListener('fullscreenchange', onChange);\n    };\n  }, []);\n\n  return (\n    <Tooltip title=\"Toggle fullscreen\">\n      <IconButton\n        size=\"small\"\n        onClick={async () => {\n          try {\n            if (document.fullscreenElement === null) {\n              await document.body.requestFullscreen();\n              if (mobilePhoneMode) {\n                window.screen.orientation.unlock();\n                await window.screen.orientation.lock?.('landscape');\n              }\n            } else {\n              await document.exitFullscreen();\n              if (mobilePhoneMode) {\n                window.screen.orientation.unlock();\n              }\n            }\n          } catch (e) {\n            console.info(e);\n          }\n        }}>\n        {isFullScreen ? <FullscreenExit /> : <Fullscreen />}\n      </IconButton>\n    </Tooltip>\n  );\n}\nexport default FullscreenButton;\n","import { Button } from 'Elements/Button';\nimport { MenuContainer } from 'Elements/Menu';\nimport Modal from 'Elements/Modal';\nimport 'RemoteMic/eventListeners';\nimport ConnectRemoteMic from 'Scenes/ConnectRemoteMic/ConnectRemoteMic';\nimport 'Stats';\nimport useKeyboardNav from 'hooks/useKeyboardNav';\n\ninterface Props {\n  closeModal: () => void;\n}\nfunction QRCodeModal({ closeModal }: Props) {\n  const { register } = useKeyboardNav({\n    onBackspace: closeModal,\n  });\n\n  return (\n    <Modal onClose={closeModal}>\n      <MenuContainer>\n        <ConnectRemoteMic />\n        <Button {...register('quick-connect-close', closeModal)}>Close</Button>\n      </MenuContainer>\n    </Modal>\n  );\n}\n\nexport default QRCodeModal;\n","import styled from '@emotion/styled';\nimport { QrCode2 } from '@mui/icons-material';\nimport { IconButton, Tooltip } from '@mui/material';\nimport 'RemoteMic/eventListeners';\nimport { MobilePhoneModeSetting, useSettingValue } from 'Scenes/Settings/SettingsState';\nimport 'Stats';\nimport FullscreenButton from 'Toolbar/Fullscreen';\nimport QRCodeModal from 'Toolbar/QRCodeModal';\nimport { useState } from 'react';\n\nfunction Toolbar() {\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [mobilePhoneMode, setMobilePhoneMode] = useSettingValue(MobilePhoneModeSetting);\n\n  const closeModal = () => setIsModalOpen(false);\n\n  return (\n    <>\n      {isModalOpen && <QRCodeModal closeModal={closeModal} />}\n      <ToolbarContainer>\n        <FullscreenButton />\n        <Tooltip title=\"Connect phone\">\n          <IconButton\n            size=\"small\"\n            onClick={() => setIsModalOpen((current) => !current)}\n            data-test=\"quick-connect-phone\">\n            <QrCode2 />\n          </IconButton>\n        </Tooltip>\n        {/*<Tooltip title=\"Toggle Mobile Phone Mode\">*/}\n        {/*    <IconButton*/}\n        {/*        size=\"small\"*/}\n        {/*        onClick={async () => {*/}\n        {/*            try {*/}\n        {/*                setMobilePhoneMode(!mobilePhoneMode);*/}\n        {/*                await document.body.requestFullscreen();*/}\n        {/*                window.screen.orientation.unlock();*/}\n        {/*                await window.screen.orientation.lock?.('landscape');*/}\n        {/*            } catch (e) {*/}\n        {/*                console.info(e);*/}\n        {/*            }*/}\n        {/*        }}>*/}\n        {/*        {mobilePhoneMode ? <Laptop /> : <PhoneIphone />}*/}\n        {/*    </IconButton>*/}\n        {/*</Tooltip>*/}\n      </ToolbarContainer>\n    </>\n  );\n}\n\nconst ToolbarContainer = styled.div`\n  view-transition-name: toolbar;\n\n  cursor: pointer;\n  background: rgba(0, 0, 0, 0.75);\n  color: white;\n  padding: 0.2rem;\n  padding-left: 1rem;\n  margin: 0;\n  position: fixed;\n  top: 0;\n  right: 0;\n  z-index: 10000;\n  color: white;\n\n  svg {\n    fill: white;\n    width: 3.5rem;\n    height: 3.5rem;\n    transition: 200ms;\n\n    &:hover {\n      transform: scale(1.2);\n    }\n  }\n\n  display: flex;\n  gap: 0.75rem;\n  border-bottom-left-radius: 1.5rem;\n`;\n\nexport default Toolbar;\n","import { ErrorBoundary } from '@sentry/react';\nimport { KeyboardHelpProvider } from 'Scenes/KeyboardHelp/Context';\nimport RemoteMic from 'Scenes/RemoteMic/RemoteMic';\nimport Settings from 'Scenes/Settings/Settings';\nimport { Redirect, Route, Router, useLocation } from 'wouter';\nimport Convert from './Scenes/Convert/Convert';\nimport Edit from './Scenes/Edit/Edit';\nimport Game from './Scenes/Game/Game';\nimport Jukebox from './Scenes/Jukebox/Jukebox';\nimport SelectInput from './Scenes/SelectInput/SelectInput';\n\nimport { Global, css } from '@emotion/react';\nimport { Theme, ThemeProvider, createTheme } from '@mui/material';\nimport { ErrorFallback } from 'Elements/ErrorFallback';\nimport { GameScreens } from 'Elements/GameScreens';\nimport LayoutWithBackgroundProvider from 'Elements/LayoutWithBackground';\nimport GetSongsBPMs from 'Scenes/Edit/GetSongsBPMs';\nimport ExcludeLanguages from 'Scenes/ExcludeLanguages/ExcludeLanguages';\nimport LandingPage from 'Scenes/LandingPage/LandingPage';\nimport ManageSongs from 'Scenes/ManageSongs/ManageSongs';\nimport QuickSetup from 'Scenes/QuickSetup/QuickSetup';\nimport RemoteMicSettings from 'Scenes/Settings/RemoteMicSettings';\nimport {\n  GraphicSetting,\n  MicSetupPreferenceSetting,\n  MobilePhoneModeSetting,\n  useSettingValue,\n} from 'Scenes/Settings/SettingsState';\nimport Welcome from 'Scenes/Welcome/Welcome';\nimport Toolbar from 'Toolbar/Toolbar';\nimport { Suspense, lazy, useEffect, useMemo } from 'react';\n\nconst LazySongList = lazy(() => import('./Scenes/Edit/SongList'));\n\nfunction App() {\n  const [mobilePhoneMode] = useSettingValue(MobilePhoneModeSetting);\n  const [graphicSetting] = useSettingValue(GraphicSetting);\n  const [setupPreference] = useSettingValue(MicSetupPreferenceSetting);\n  const [location, navigate] = useLocation();\n\n  const theme = useMemo<Theme>(\n    () =>\n      createTheme({\n        graphicSetting,\n      }),\n    [graphicSetting],\n  );\n\n  useEffect(() => {\n    if (setupPreference === null && location === '/') {\n      navigate('/landing');\n    } else if (setupPreference !== null && location === '/quick-setup') {\n      navigate('/');\n    }\n  }, []);\n\n  return (\n    <ThemeProvider theme={theme}>\n      <Global\n        styles={css`\n          :root {\n            --zoom-multipler: ${mobilePhoneMode ? 1.4 : 1};\n          }\n        `}\n      />\n      <ErrorBoundary fallback={ErrorFallback}>\n        <LayoutWithBackgroundProvider>\n          <KeyboardHelpProvider>\n            <Router>\n              <GameScreens>\n                <Toolbar />\n                <Route path=\"/game/:songId?\">\n                  {({ songId }) => <Game songId={songId ? decodeURIComponent(songId) : undefined} />}\n                </Route>\n                <Route path=\"/jukebox\" component={Jukebox} />\n                <Route path=\"/remote-mic/:roomId\">{({ roomId }) => <RemoteMic roomId={roomId!} />}</Route>\n                <Route path=\"/phone/:roomId\">{({ roomId }) => <Redirect to={`/remote-mic/${roomId}`} />}</Route>\n                <Route path=\"/quick-setup\" component={QuickSetup} />\n                <Route path=\"/select-input\" component={SelectInput} />\n                <Route path=\"/settings\" component={Settings} />\n                <Route path=\"/settings/remote-mics\" component={RemoteMicSettings} />\n                <Route path=\"/manage-songs\" component={ManageSongs} />\n                <Route path=\"/exclude-languages\" component={ExcludeLanguages} />\n                <Route path=\"/\" component={Welcome} />\n                <Route path=\"/landing\" component={LandingPage} />\n              </GameScreens>\n              <Route path=\"/convert\" component={() => <Convert />} />\n              <Route\n                path=\"/edit\"\n                component={() => (\n                  <Suspense fallback={'Loading'}>\n                    <LazySongList />\n                  </Suspense>\n                )}\n              />\n              <Route path=\"/edit/get-songs-bpms\" component={GetSongsBPMs} />\n              <Route path=\"/edit/:songId\">{({ songId }) => <Edit songId={songId!} />}</Route>\n            </Router>\n          </KeyboardHelpProvider>\n        </LayoutWithBackgroundProvider>\n      </ErrorBoundary>\n    </ThemeProvider>\n  );\n}\n\nexport default App;\n","import '@fontsource/roboto';\nimport '@fontsource/roboto/900.css';\nimport 'GameEvents/eventListeners';\nimport 'Stats';\nimport 'utils/exposeSingletons';\n\nimport { init, setUser } from '@sentry/react';\nimport posthog from 'posthog-js';\nimport { createRoot } from 'react-dom/client';\nimport { ToastContainer, toast } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\nimport isDev from 'utils/isDev';\nimport isE2E from 'utils/isE2E';\nimport { v4 } from 'uuid';\nimport App from './App';\nimport './index.css';\n\nconst isSentryEnabled = !!import.meta.env.VITE_APP_SENTRY_DSN_URL;\n\nif (isSentryEnabled) {\n  init({\n    dsn: import.meta.env.VITE_APP_SENTRY_DSN_URL,\n\n    // Set tracesSampleRate to 1.0 to capture 100%\n    // of transactions for performance monitoring.\n    // We recommend adjusting this value in production\n    tracesSampleRate: 1.0,\n    environment: isDev() ? 'development' : isE2E() ? 'e2e' : 'production',\n    tunnel: import.meta.env.VITE_APP_SENTRY_TUNNEL,\n  });\n}\n\nif (!isE2E() && import.meta.env.VITE_APP_POSTHOG_KEY) {\n  posthog.init(import.meta.env.VITE_APP_POSTHOG_KEY, {\n    // debug: true,\n    api_host: import.meta.env.VITE_APP_POSTHOG_PROXY,\n    loaded: (ph) => {\n      let storedUser = localStorage.getItem('posthog-user-id');\n      if (!storedUser) {\n        storedUser = v4();\n        localStorage.setItem('posthog-user-id', storedUser);\n      }\n      ph.identify(storedUser);\n\n      if (isSentryEnabled) {\n        setUser({ id: storedUser });\n      }\n    },\n  });\n}\n\nconst container = document.getElementById('root');\nconst root = createRoot(container!);\n\nroot.render(\n  <>\n    <App />\n    <ToastContainer position={toast.POSITION.BOTTOM_LEFT} theme={'colored'} />\n  </>,\n);\n"],"file":"assets/index-ee78d9ac.js"}