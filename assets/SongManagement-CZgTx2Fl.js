import{r as h,j as t,C as Ke,d as _e,e as qe,f as _,h as q,u as V,i as A,a as G,k as O,l as ue,m as Ye,n as Y,o as le,B as Ae,p as $,q as w,t as Ze,v as Je,w as Ne,Y as Ee,b as Ue,x as Z,T as F,y as Ce,G as Ge,z as Xe,A as pe,D as z,F as Qe,E as et,H as tt,I as at,J as ke,K as ee,L as nt,M as st,N as rt,O as ot,P as de,Q as it,R as lt,U as dt,V as ct,W as ut,X as we,Z as pt,_ as ht,$ as xt,a0 as mt,a1 as ft,a2 as Fe,a3 as gt,a4 as ze,a5 as ge,S as W,g as vt,a6 as De,a7 as ie,a8 as yt,a9 as bt,aa as St,ab as jt,ac as Ct,ad as kt,ae as wt,af as X,ag as Bt,ah as It,ai as Lt}from"./index-Bl-jK4cp.js";import{i as Tt,T as Ve,B as P,a as R,L as ve,g as Mt,l as se,S as Be,G as M,A as xe,F as Pt,I as Rt,b as $t,M as Ie,c as At,D as Nt,d as Et,e as Q,f as Le,h as Ut,j as Gt,k as Ft,m as zt,n as Dt,E as Vt,V as Ot,o as Wt,p as Ht}from"./SongsTable-Bl48bexs.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},a=new e.Error().stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="17742fcd-73a8-45ab-80e0-6a88fad7f94d",e._sentryDebugIdIdentifier="sentry-dbid-17742fcd-73a8-45ab-80e0-6a88fad7f94d")}catch{}{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:allkaraoke-party-sentry-key":!0})}function Kt(e){return h.Children.toArray(e).filter(a=>h.isValidElement(a))}const _t=(e,a)=>{const n=_e(e);return n.sheet=new a({key:n.key,nonce:n.sheet.nonce,container:n.sheet.container,speedy:n.sheet.isSpeedy,prepend:n.sheet.prepend,insertionPoint:n.sheet.insertionPoint}),n};let ye;if(typeof document=="object"){let e=document.querySelector('[name="emotion-insertion-point"]');if(!e){e=document.createElement("meta"),e.setAttribute("name","emotion-insertion-point"),e.setAttribute("content","");const n=document.querySelector("head");n&&n.prepend(e)}class a extends qe{insert(s,r){return this.key&&this.key.endsWith("global")&&(this.before=e),super.insert(s,r)}}ye=_t({key:"css",insertionPoint:e},a)}function qt(e){const{injectFirst:a,children:n}=e;return a&&ye?t.jsx(Ke,{value:ye,children:n}):n}const ae=h.createContext({}),he=h.createContext({});function Yt(e){return _("MuiStep",e)}q("MuiStep",["root","horizontal","vertical","alternativeLabel","completed"]);const Zt=e=>{const{classes:a,orientation:n,alternativeLabel:s,completed:r}=e;return O({root:["root",n,s&&"alternativeLabel",r&&"completed"]},Yt,a)},Jt=A("div",{name:"MuiStep",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[a.root,a[n.orientation],n.alternativeLabel&&a.alternativeLabel,n.completed&&a.completed]}})({variants:[{props:{orientation:"horizontal"},style:{paddingLeft:8,paddingRight:8}},{props:{alternativeLabel:!0},style:{flex:1,position:"relative"}}]}),re=h.forwardRef(function(a,n){const s=V({props:a,name:"MuiStep"}),{active:r,children:i,className:l,component:u="div",completed:x,disabled:c,expanded:g=!1,index:p,last:S,...d}=s,{activeStep:v,connector:I,alternativeLabel:B,orientation:m,nonLinear:k}=h.useContext(ae);let[j=!1,b=!1,L=!1]=[r,x,c];v===p?j=r!==void 0?r:!0:!k&&v>p?b=x!==void 0?x:!0:!k&&v<p&&(L=c!==void 0?c:!0);const f=h.useMemo(()=>({index:p,last:S,expanded:g,icon:p+1,active:j,completed:b,disabled:L}),[p,S,g,j,b,L]),o={...s,active:j,orientation:m,alternativeLabel:B,completed:b,disabled:L,expanded:g,component:u},y=Zt(o),T=t.jsxs(Jt,{as:u,className:G(y.root,l),ref:n,ownerState:o,...d,children:[I&&B&&p!==0?I:null,i]});return t.jsx(he.Provider,{value:f,children:I&&!B&&p!==0?t.jsxs(h.Fragment,{children:[I,T]}):T})}),Xt=ue(t.jsx("path",{d:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24zm-2 17l-5-5 1.4-1.4 3.6 3.6 7.6-7.6L19 8l-9 9z"}),"CheckCircle"),Qt=ue(t.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}),"Warning");function ea(e){return _("MuiStepIcon",e)}const me=q("MuiStepIcon",["root","active","completed","error","text"]);var Te;const ta=e=>{const{classes:a,active:n,completed:s,error:r}=e;return O({root:["root",n&&"active",s&&"completed",r&&"error"],text:["text"]},ea,a)},fe=A(Ye,{name:"MuiStepIcon",slot:"Root",overridesResolver:(e,a)=>a.root})(Y(({theme:e})=>({display:"block",transition:e.transitions.create("color",{duration:e.transitions.duration.shortest}),color:(e.vars||e).palette.text.disabled,[`&.${me.completed}`]:{color:(e.vars||e).palette.primary.main},[`&.${me.active}`]:{color:(e.vars||e).palette.primary.main},[`&.${me.error}`]:{color:(e.vars||e).palette.error.main}}))),aa=A("text",{name:"MuiStepIcon",slot:"Text",overridesResolver:(e,a)=>a.text})(Y(({theme:e})=>({fill:(e.vars||e).palette.primary.contrastText,fontSize:e.typography.caption.fontSize,fontFamily:e.typography.fontFamily}))),na=h.forwardRef(function(a,n){const s=V({props:a,name:"MuiStepIcon"}),{active:r=!1,className:i,completed:l=!1,error:u=!1,icon:x,...c}=s,g={...s,active:r,completed:l,error:u},p=ta(g);if(typeof x=="number"||typeof x=="string"){const S=G(i,p.root);return u?t.jsx(fe,{as:Qt,className:S,ref:n,ownerState:g,...c}):l?t.jsx(fe,{as:Xt,className:S,ref:n,ownerState:g,...c}):t.jsxs(fe,{className:S,ref:n,ownerState:g,...c,children:[Te||(Te=t.jsx("circle",{cx:"12",cy:"12",r:"12"})),t.jsx(aa,{className:p.text,x:"12",y:"12",textAnchor:"middle",dominantBaseline:"central",ownerState:g,children:x})]})}return x});function sa(e){return _("MuiStepLabel",e)}const H=q("MuiStepLabel",["root","horizontal","vertical","label","active","completed","error","disabled","iconContainer","alternativeLabel","labelContainer"]),ra=e=>{const{classes:a,orientation:n,active:s,completed:r,error:i,disabled:l,alternativeLabel:u}=e;return O({root:["root",n,i&&"error",l&&"disabled",u&&"alternativeLabel"],label:["label",s&&"active",r&&"completed",i&&"error",l&&"disabled",u&&"alternativeLabel"],iconContainer:["iconContainer",s&&"active",r&&"completed",i&&"error",l&&"disabled",u&&"alternativeLabel"],labelContainer:["labelContainer",u&&"alternativeLabel"]},sa,a)},oa=A("span",{name:"MuiStepLabel",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[a.root,a[n.orientation]]}})({display:"flex",alignItems:"center",[`&.${H.alternativeLabel}`]:{flexDirection:"column"},[`&.${H.disabled}`]:{cursor:"default"},variants:[{props:{orientation:"vertical"},style:{textAlign:"left",padding:"8px 0"}}]}),ia=A("span",{name:"MuiStepLabel",slot:"Label",overridesResolver:(e,a)=>a.label})(Y(({theme:e})=>({...e.typography.body2,display:"block",transition:e.transitions.create("color",{duration:e.transitions.duration.shortest}),[`&.${H.active}`]:{color:(e.vars||e).palette.text.primary,fontWeight:500},[`&.${H.completed}`]:{color:(e.vars||e).palette.text.primary,fontWeight:500},[`&.${H.alternativeLabel}`]:{marginTop:16},[`&.${H.error}`]:{color:(e.vars||e).palette.error.main}}))),la=A("span",{name:"MuiStepLabel",slot:"IconContainer",overridesResolver:(e,a)=>a.iconContainer})({flexShrink:0,display:"flex",paddingRight:8,[`&.${H.alternativeLabel}`]:{paddingRight:0}}),da=A("span",{name:"MuiStepLabel",slot:"LabelContainer",overridesResolver:(e,a)=>a.labelContainer})(Y(({theme:e})=>({width:"100%",color:(e.vars||e).palette.text.secondary,[`&.${H.alternativeLabel}`]:{textAlign:"center"}}))),Oe=h.forwardRef(function(a,n){const s=V({props:a,name:"MuiStepLabel"}),{children:r,className:i,componentsProps:l={},error:u=!1,icon:x,optional:c,slots:g={},slotProps:p={},StepIconComponent:S,StepIconProps:d,...v}=s,{alternativeLabel:I,orientation:B}=h.useContext(ae),{active:m,disabled:k,completed:j,icon:b}=h.useContext(he),L=x||b;let f=S;L&&!f&&(f=na);const o={...s,active:m,alternativeLabel:I,completed:j,disabled:k,error:u,orientation:B},y=ra(o),T={slots:g,slotProps:{stepIcon:d,...l,...p}},[U,N]=le("label",{elementType:ia,externalForwardedProps:T,ownerState:o}),[J,ne]=le("stepIcon",{elementType:f,externalForwardedProps:T,ownerState:o});return t.jsxs(oa,{className:G(y.root,i),ref:n,ownerState:o,...v,children:[L||J?t.jsx(la,{className:y.iconContainer,ownerState:o,children:t.jsx(J,{completed:j,active:m,error:u,icon:L,...ne})}):null,t.jsxs(da,{className:y.labelContainer,ownerState:o,children:[r?t.jsx(U,{...N,className:G(y.label,N==null?void 0:N.className),children:r}):null,c]})]})});Oe.muiName="StepLabel";function ca(e){return _("MuiStepButton",e)}const Me=q("MuiStepButton",["root","horizontal","vertical","touchRipple"]),ua=e=>{const{classes:a,orientation:n}=e;return O({root:["root",n],touchRipple:["touchRipple"]},ca,a)},pa=A(Ae,{name:"MuiStepButton",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[{[`& .${Me.touchRipple}`]:a.touchRipple},a.root,a[n.orientation]]}})({width:"100%",padding:"24px 16px",margin:"-24px -16px",boxSizing:"content-box",[`& .${Me.touchRipple}`]:{color:"rgba(0, 0, 0, 0.3)"},variants:[{props:{orientation:"vertical"},style:{justifyContent:"flex-start",padding:"8px",margin:"-8px"}}]}),oe=h.forwardRef(function(a,n){const s=V({props:a,name:"MuiStepButton"}),{children:r,className:i,icon:l,optional:u,...x}=s,{disabled:c,active:g}=h.useContext(he),{orientation:p}=h.useContext(ae),S={...s,orientation:p},d=ua(S),v={icon:l,optional:u},I=Tt(r,["StepLabel"])?h.cloneElement(r,v):t.jsx(Oe,{...v,children:r});return t.jsx(pa,{focusRipple:!0,disabled:c,TouchRippleProps:{className:d.touchRipple},className:G(d.root,i),ref:n,ownerState:S,"aria-current":g?"step":void 0,...x,children:I})});function ha(e){return _("MuiStepper",e)}q("MuiStepper",["root","horizontal","vertical","nonLinear","alternativeLabel"]);function xa(e){return _("MuiStepConnector",e)}q("MuiStepConnector",["root","horizontal","vertical","alternativeLabel","active","completed","disabled","line","lineHorizontal","lineVertical"]);const ma=e=>{const{classes:a,orientation:n,alternativeLabel:s,active:r,completed:i,disabled:l}=e,u={root:["root",n,s&&"alternativeLabel",r&&"active",i&&"completed",l&&"disabled"],line:["line",`line${$(n)}`]};return O(u,xa,a)},fa=A("div",{name:"MuiStepConnector",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[a.root,a[n.orientation],n.alternativeLabel&&a.alternativeLabel,n.completed&&a.completed]}})({flex:"1 1 auto",variants:[{props:{orientation:"vertical"},style:{marginLeft:12}},{props:{alternativeLabel:!0},style:{position:"absolute",top:12,left:"calc(-50% + 20px)",right:"calc(50% + 20px)"}}]}),ga=A("span",{name:"MuiStepConnector",slot:"Line",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[a.line,a[`line${$(n.orientation)}`]]}})(Y(({theme:e})=>{const a=e.palette.mode==="light"?e.palette.grey[400]:e.palette.grey[600];return{display:"block",borderColor:e.vars?e.vars.palette.StepConnector.border:a,variants:[{props:{orientation:"horizontal"},style:{borderTopStyle:"solid",borderTopWidth:1}},{props:{orientation:"vertical"},style:{borderLeftStyle:"solid",borderLeftWidth:1,minHeight:24}}]}})),va=h.forwardRef(function(a,n){const s=V({props:a,name:"MuiStepConnector"}),{className:r,...i}=s,{alternativeLabel:l,orientation:u="horizontal"}=h.useContext(ae),{active:x,disabled:c,completed:g}=h.useContext(he),p={...s,alternativeLabel:l,orientation:u,active:x,completed:g,disabled:c},S=ma(p);return t.jsx(fa,{className:G(S.root,r),ref:n,ownerState:p,...i,children:t.jsx(ga,{className:S.line,ownerState:p})})}),ya=e=>{const{orientation:a,nonLinear:n,alternativeLabel:s,classes:r}=e;return O({root:["root",a,n&&"nonLinear",s&&"alternativeLabel"]},ha,r)},ba=A("div",{name:"MuiStepper",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[a.root,a[n.orientation],n.alternativeLabel&&a.alternativeLabel,n.nonLinear&&a.nonLinear]}})({display:"flex",variants:[{props:{orientation:"horizontal"},style:{flexDirection:"row",alignItems:"center"}},{props:{orientation:"vertical"},style:{flexDirection:"column"}},{props:{alternativeLabel:!0},style:{alignItems:"flex-start"}}]}),Sa=t.jsx(va,{}),ja=h.forwardRef(function(a,n){const s=V({props:a,name:"MuiStepper"}),{activeStep:r=0,alternativeLabel:i=!1,children:l,className:u,component:x="div",connector:c=Sa,nonLinear:g=!1,orientation:p="horizontal",...S}=s,d={...s,nonLinear:g,alternativeLabel:i,orientation:p,component:x},v=ya(d),I=h.Children.toArray(l).filter(Boolean),B=I.map((k,j)=>h.cloneElement(k,{index:j,last:j+1===I.length,...k.props})),m=h.useMemo(()=>({activeStep:r,alternativeLabel:i,connector:c,nonLinear:g,orientation:p}),[r,i,c,g,p]);return t.jsx(ae.Provider,{value:m,children:t.jsx(ba,{as:x,ownerState:d,className:G(v.root,u),ref:n,...S,children:B})})});function Ca(e){var n;const a=new URL((n=global.location)==null?void 0:n.href);Object.entries(e).forEach(([s,r])=>{r===null?a.searchParams.delete(s):a.searchParams.set(s,r)}),global.history.replaceState(null,"",a.toString())}const ce=Je.span`font-mono`,be=(e,a,n="Lookup")=>({InputProps:{endAdornment:t.jsx(Ve,{title:a?"Open search results for the song":"Artist or title of the song is unknown",children:t.jsx("span",{children:t.jsx(w,{sx:{mr:-1},endIcon:t.jsx(Ze,{}),color:"secondary",variant:"text",onClick:e,disabled:!a,children:n})})})}});function ka(e){const a=()=>{global.open(`https://www.youtube.com/results?search_query=${encodeURIComponent((e==null?void 0:e.songArtist)+" "+(e==null?void 0:e.songTitle))}`,"_blank")},n=!!e.songTitle&&!!e.songArtist,s=Ne(e.data.video);return t.jsxs(P,{sx:{display:"flex",flexWrap:"wrap"},"data-test":"author-and-vid",children:[t.jsx(R,{"data-test":"author-name",sx:{mt:2},value:e.data.author,onChange:r=>e.onChange({...e.data,author:r.target.value}),label:"Author name (optional)",fullWidth:!0,size:"small",helperText:"Nickname of the person that created the .txt file."}),t.jsx(R,{"data-test":"author-url",sx:{mt:2},value:e.data.authorUrl,onChange:r=>e.onChange({...e.data,authorUrl:r.target.value}),label:"Author URL (optional)",helperText:"Link to authors page/profile.",fullWidth:!0,size:"small"}),t.jsx(P,{sx:{display:"flex",flexDirection:"row",mt:2,alignItems:"center",width:"100%"},children:t.jsx(R,{"data-test":"video-url",required:!0,value:e.data.video,onChange:r=>e.onChange({...e.data,video:r.target.value}),label:"YouTube Video URL",placeholder:"https://www.youtube.com/watch?v=",fullWidth:!0,size:"small",helperText:"Link to YouTube video, eg https://www.youtube.com/watch?v=xxxxxxxxx. Click the 'Lookup' button to look for it on YouTube",name:"videoUrl",...be(a,n)})}),s&&t.jsx(P,{children:t.jsx(Ee,{videoId:s})})]})}const wa={polish:{È:"é",í:"'","¥":"'","¯":"Ż","¹":"ą",π:"ą",ê:"ę",Í:"ę",Œ:"Ś",å:"Ś",œ:"ś",ú:"ś",æ:"ć",Ê:"ć","¿":"ż",ø:"ż",Ø:"Ż",ñ:"ń",Ò:"ń","³":"ł","≥":"ł","£":"Ł",Û:"ó",ü:"ź",Ÿ:"ź"},spanish:{ø:"¿",È:"é",Ì:"í",Ò:"ñ",ń:"ñ","·":"á",Û:"ó","°":"!","˙":"ú",ś:"ú"}};function Ba(e,a){const n=wa[a];if(n===void 0)return e;let s=e;for(const[r,i]of Object.entries(n))s=s.replaceAll(r,i);return s}function Ia(e){const a=e.split(`
`),n=["#TITLE","#ARTIST","#BPM"];for(const s of n)if(!a.some(r=>r.startsWith(s)))return!1;if(!a.some(s=>s.startsWith(":")))return!1;try{Ue(e)}catch(s){return console.log(s),!1}return!0}async function La(e){try{const a=new URL(e);if(a.host==="usdb.animux.de")return Ma(e,a);if(a.host==="ultrastar-es.org")return Ta(e)}catch(a){console.warn(a)}}async function Ta(e){var x,c,g,p;const n=await(await fetch(`/proxy?url=${encodeURIComponent(e)}`)).text(),s=new DOMParser().parseFromString(n,"text/html"),i=`https://ultrastar-es.org/pl/canciones/descargar/txt/${(x=s.querySelector("ul[data-id]"))==null?void 0:x.getAttribute("data-id")}`;global.location.href=i;const l=(c=s.querySelector("#listado > ul > li > dl > dd:nth-child(6) > a"))==null?void 0:c.getAttribute("href"),u=(g=s.querySelector("#listado > ul > li"))==null?void 0:g.getAttribute("data-id");return{authorUrl:l?"https://ultrastar-es.org"+l:"",author:((p=s.querySelector("#listado > ul > li > dl > dd:nth-child(6)"))==null?void 0:p.textContent)??"",video:u?"https://www.youtube.com/watch?v="+u:""}}async function Ma(e,a){var c,g,p,S,d;const s=await(await fetch(`/proxy?url=${encodeURIComponent(e)}`)).text(),r=new DOMParser().parseFromString(s,"text/html"),i=(c=r.querySelector('a[href^="?link=profil&id="]'))==null?void 0:c.textContent,l=(p=(g=r.querySelector('a[href^="?link=profil&id="]'))==null?void 0:g.getAttribute)==null?void 0:p.call(g,"href"),u=(S=r.querySelector("#tablebg > tbody > tr:nth-child(3) > td > table:nth-child(2) > tbody > tr.list_head > td:nth-child(1)"))==null?void 0:S.textContent,x=(d=r.querySelector("#tablebg > tbody > tr:nth-child(3) > td > table:nth-child(2) > tbody > tr.list_head > td:nth-child(2)"))==null?void 0:d.textContent;return global.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(u+" "+x)}`,"_blank"),global.open(`http://usdb.animux.de/index.php?link=gettxt&id=${a.searchParams.get("id")}`,"_blank"),{authorUrl:l?"http://usdb.animux.de/index.php"+l:"",author:i??"",video:""}}function Pa(e){var i,l;const a=async u=>{if(e.onChange({...e.data,sourceUrl:u.target.value}),e.shouldAutoImport){const x=await La(u.target.value);x&&e.onAutoImport(x)}},n=u=>{e.onChange({...e.data,txtInput:Ba(e.data.txtInput,u)})},r=!h.useMemo(()=>Ia(e.data.txtInput),[e.data.txtInput])&&e.data.txtInput.length>0;return t.jsxs(P,{sx:{display:"flex",flexWrap:"wrap"},"data-test":"basic-data",children:[e.isTxtRequired&&t.jsxs("div",{children:[t.jsx("h4",{children:"Where to find songs?"}),t.jsxs("p",{children:["Any UltraStar compatible .txt file will do. You can find many already made songs on"," ",t.jsx("a",{href:"https://usdb.animux.de/",target:"_blank",rel:"noreferrer",children:"usdb.animux.de"})," or ",t.jsx("a",{href:"https://ultrastar-es.org/en",target:"_blank",rel:"noreferrer",children:"ultrastar-es.org"}),".",t.jsx("br",{}),t.jsx("br",{})]}),t.jsx("p",{children:"You don't need audio/video files, you'll be able to search for appropriate YouTube video and synchronise the lyrics to it in subsequent steps."})]}),t.jsx(R,{sx:{mt:2},value:e.data.sourceUrl,onChange:a,label:"Source URL (optional)",fullWidth:!0,size:"small","data-test":"source-url",helperText:"The link to the page from which the .TXT file was downloaded."}),e.isTxtRequired?t.jsxs(t.Fragment,{children:[t.jsx(R,{error:r,helperText:r?"This doesn't look like a valid UltraStar .TXT format":"",required:!0,sx:{mt:2},fullWidth:!0,size:"small",multiline:!0,label:"Song's UltraStar .TXT file contents",onChange:u=>e.onChange({...e.data,txtInput:u.target.value}),value:e.data.txtInput,maxRows:15,minRows:15,InputProps:{inputProps:{"data-test":"input-txt",sx:{fontFamily:"monospace"}}}}),t.jsxs(P,{sx:{display:"flex",gap:1,mt:1},children:[t.jsx(w,{onClick:()=>n("polish"),children:"Fix 🇵🇱 Polish accents"}),t.jsx(w,{onClick:()=>n("spanish"),children:"Fix 🇪🇸 Spanish accents"})]})]}):t.jsx(P,{sx:{display:"flex",width:"100%",height:500,overflow:"auto"},children:(l=(i=e.finalSong)==null?void 0:i.tracks)==null?void 0:l.map((u,x)=>t.jsxs(P,{sx:{flex:1},children:[t.jsx("h4",{className:"py-3",children:u.name??`Track #${x+1}`}),u.sections.filter(Z).map(c=>t.jsx("p",{children:c.notes.map(g=>g.lyrics).join("")},c.start))]},x))})]})}const Ra=e=>{const{classes:a,inset:n,primary:s,secondary:r,dense:i}=e;return O({root:["root",n&&"inset",i&&"dense",s&&r&&"multiline"],primary:["primary"],secondary:["secondary"]},Mt,a)},$a=A("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[{[`& .${se.primary}`]:a.primary},{[`& .${se.secondary}`]:a.secondary},a.root,n.inset&&a.inset,n.primary&&n.secondary&&a.multiline,n.dense&&a.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${Ce.root}:where(& .${se.primary})`]:{display:"block"},[`.${Ce.root}:where(& .${se.secondary})`]:{display:"block"},variants:[{props:({ownerState:e})=>e.primary&&e.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:e})=>e.inset,style:{paddingLeft:56}}]}),Aa=h.forwardRef(function(a,n){const s=V({props:a,name:"MuiListItemText"}),{children:r,className:i,disableTypography:l=!1,inset:u=!1,primary:x,primaryTypographyProps:c,secondary:g,secondaryTypographyProps:p,slots:S={},slotProps:d={},...v}=s,{dense:I}=h.useContext(ve);let B=x??r,m=g;const k={...s,disableTypography:l,inset:u,primary:!!B,secondary:!!m,dense:I},j=Ra(k),b={slots:S,slotProps:{primary:c,secondary:p,...d}},[L,f]=le("primary",{className:j.primary,elementType:F,externalForwardedProps:b,ownerState:k}),[o,y]=le("secondary",{className:j.secondary,elementType:F,externalForwardedProps:b,ownerState:k});return B!=null&&B.type!==F&&!l&&(B=t.jsx(L,{variant:I?"body2":"body1",component:f!=null&&f.variant?void 0:"span",...f,children:B})),m!=null&&m.type!==F&&!l&&(m=t.jsx(o,{variant:"body2",color:"textSecondary",...y,children:m})),t.jsxs($a,{className:G(j.root,i),ownerState:k,ref:n,...v,children:[B,m]})}),Na={AF:"Afghanistan",AX:"Åland Islands",AL:"Albania",DZ:"Algeria",AS:"American Samoa",AD:"Andorra",AO:"Angola",AI:"Anguilla",AQ:"Antarctica",AG:"Antigua and Barbuda",AR:"Argentina",AM:"Armenia",AW:"Aruba",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BS:"Bahamas",BH:"Bahrain",BD:"Bangladesh",BE:"Belgium",BZ:"Belize",BJ:"Benin",BM:"Bermuda",BT:"Bhutan",BO:"Bolivia",BA:"Bosnia and Herzegovina",BW:"Botswana",BV:"Bouvet Island",BR:"Brazil",IO:"British Indian Ocean Territory",BN:"Brunei Darussalam",BG:"Bulgaria",BF:"Burkina Faso",BI:"Burundi",KH:"Cambodia",CM:"Cameroon",CA:"Canada",CV:"Cape Verde",KY:"Cayman Islands",CF:"Central African Republic",TD:"Chad",CL:"Chile",CN:"China",CX:"Christmas Island",CC:"Cocos (Keeling) Islands",CO:"Colombia",KM:"Comoros",CG:"Congo",CD:"Congo",CK:"Cook Islands",CR:"Costa Rica",CI:"Cote D Ivoire",HR:"Croatia",CU:"Cuba",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",DJ:"Djibouti",DM:"Dominica",DO:"Dominican Republic",EC:"Ecuador",EG:"Egypt",SV:"El Salvador",GQ:"Equatorial Guinea",ER:"Eritrea",EE:"Estonia",ET:"Ethiopia",FK:"Falkland Islands (Malvinas)",FO:"Faroe Islands",FJ:"Fiji",FI:"Finland",FR:"France",GF:"French Guiana",PF:"French Polynesia",TF:"French Southern Territories",GA:"Gabon",GM:"Gambia",GE:"Georgia",DE:"Germany",GH:"Ghana",GI:"Gibraltar",GR:"Greece",GL:"Greenland",GD:"Grenada",GP:"Guadeloupe",GU:"Guam",GT:"Guatemala",GG:"Guernsey",GN:"Guinea",GW:"Guinea-Bissau",GY:"Guyana",HT:"Haiti",HM:"Heard Island and Mcdonald Islands",VA:"Holy See (Vatican City State)",HN:"Honduras",HK:"Hong Kong",HU:"Hungary",IS:"Iceland",IN:"India",ID:"Indonesia",IR:"Iran",IQ:"Iraq",IE:"Ireland",IM:"Isle of Man",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JE:"Jersey",JO:"Jordan",KZ:"Kazakhstan",KE:"Kenya",KI:"Kiribati",KP:"South Korea",KR:"North Korea",KW:"Kuwait",KG:"Kyrgyzstan",LA:"Lao People Democratic Republic",LV:"Latvia",LB:"Lebanon",LS:"Lesotho",LR:"Liberia",LY:"Libyan Arab Jamahiriya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MK:"Macedonia",MG:"Madagascar",MW:"Malawi",MY:"Malaysia",MV:"Maldives",ML:"Mali",MT:"Malta",MH:"Marshall Islands",MQ:"Martinique",MR:"Mauritania",MU:"Mauritius",YT:"Mayotte",MX:"Mexico",FM:"Micronesia",MD:"Moldova",MC:"Monaco",MN:"Mongolia",MS:"Montserrat",MA:"Morocco",MZ:"Mozambique",MM:"Myanmar",NA:"Namibia",NR:"Nauru",NP:"Nepal",NL:"Netherlands",AN:"Netherlands Antilles",NC:"New Caledonia",NZ:"New Zealand",NI:"Nicaragua",NE:"Niger",NG:"Nigeria",NU:"Niue",NF:"Norfolk Island",MP:"Northern Mariana Islands",NO:"Norway",OM:"Oman",PK:"Pakistan",PW:"Palau",PS:"Palestinian Territory",PA:"Panama",PG:"Papua New Guinea",PY:"Paraguay",PE:"Peru",PH:"Philippines",PN:"Pitcairn",PL:"Poland",PT:"Portugal",PR:"Puerto Rico",QA:"Qatar",RE:"Reunion",RO:"Romania",RU:"Russian Federation",RW:"Rwanda",SH:"Saint Helena",KN:"Saint Kitts and Nevis",LC:"Saint Lucia",PM:"Saint Pierre and Miquelon",VC:"Saint Vincent and the Grenadines",WS:"Samoa",SM:"San Marino",ST:"Sao Tome and Principe",SA:"Saudi Arabia",SN:"Senegal",CS:"Serbia and Montenegro",SC:"Seychelles",SL:"Sierra Leone",SG:"Singapore",SK:"Slovakia",SI:"Slovenia",SB:"Solomon Islands",SO:"Somalia",ZA:"South Africa",GS:"South Georgia and the South Sandwich Islands",ES:"Spain",LK:"Sri Lanka",SD:"Sudan",SR:"Suriname",SJ:"Svalbard and Jan Mayen",SZ:"Swaziland",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan",TJ:"Tajikistan",TZ:"Tanzania",TH:"Thailand",TL:"Timor-Leste",TG:"Togo",TK:"Tokelau",TO:"Tonga",TT:"Trinidad and Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",TC:"Turks and Caicos Islands",TV:"Tuvalu",UG:"Uganda",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",US:"United States",UY:"Uruguay",UZ:"Uzbekistan",VU:"Vanuatu",VE:"Venezuela",VN:"Vietnam",VI:"Virgin Islands",WF:"Wallis and Futuna",EH:"Western Sahara",YE:"Yemen",ZM:"Zambia",ZW:"Zimbabwe"},We=e=>{const a=Math.floor(e/1e3/60),n=Math.floor(e/1e3)-a*60,s=Math.floor(e%1e3);return t.jsxs(ce,{children:[String(a).padStart(2,"0"),":",String(n).padStart(2,"0"),".",String(s).padStart(3,"0")]})},Ea=e=>"playVideo"in e?{play:()=>e.playVideo(),pause:()=>e.pauseVideo(),seekTo:a=>e.seekTo(a,!0),setPlaybackSpeed:a=>e.setPlaybackRate(a)}:e,te=(e,a)=>t.jsx(Ve,{title:"Click to play the moment just before this time",placement:"top",arrow:!0,children:t.jsx(w,{sx:{py:.15,mb:.5},variant:"contained",size:"small",disabled:!a,onClick:a?()=>{Ge.resetPlayerNotes(),Ea(a).seekTo((e??0)/1e3-.7)}:void 0,children:We(e??0)})}),Pe=10;function Ua({data:e,onChange:a,videoId:n,videoGap:s=0}){var k;const r=h.useRef(null),i=h.useRef(null),[l,u]=h.useState(!1);h.useEffect(()=>{const j=setInterval(async()=>{var b,L,f,o,y,T;if(!l)e.volume===0?(a({...e,volume:.5}),await((L=(b=r.current)==null?void 0:b.getInternalPlayer())==null?void 0:L.setVolume(50))):await((o=(f=r.current)==null?void 0:f.getInternalPlayer())==null?void 0:o.setVolume(e.volume*100)),u(!0);else{const U=await((T=(y=r.current)==null?void 0:y.getInternalPlayer())==null?void 0:T.getVolume());U!==void 0&&U!==e.volume*100&&a({...e,volume:U/100})}},500);return()=>{clearInterval(j)}},[l,e,a]);const[x,c]=h.useState(!1),[g,p]=h.useState(!1),S=async(j,b)=>{var L,f;await((f=(L=r.current)==null?void 0:L.getInternalPlayer())==null?void 0:f.setVolume(+b*100)),a({...e,volume:+b})},d=e.previewStart??s+60,v=e.previewEnd??d+30,[I,B]=h.useState(null);h.useEffect(()=>{var j,b;i.current&&(i.current.currentTime=35),(b=(j=r.current)==null?void 0:j.getInternalPlayer())==null||b.getDuration().then(B)},[]);const m=(k=r.current)==null?void 0:k.getInternalPlayer();return t.jsxs(P,{sx:{display:"flex",flexDirection:"column",width:"100%"},gap:1,children:[t.jsxs("h4",{children:["Set song preview (start: ",te(d*1e3,m),", end:"," ",te(v*1e3,m),")"]}),t.jsx(P,{sx:{display:"flex",gap:5},children:t.jsx(Be,{"data-test":"song-preview",disabled:I===null,step:1,value:[d,v],max:(I??500)-Pe,onChange:(j,b)=>{const[L,f]=b;f-L>Pe&&a({...e,previewStart:L,previewEnd:f})}})}),t.jsx("h4",{children:"Adjust volume"}),t.jsxs(P,{sx:{display:"flex",gap:5},children:[t.jsxs(P,{sx:{display:"flex",flexDirection:"column",gap:1},children:[t.jsx("h5",{children:"Song"}),t.jsx(Ee,{videoId:n,ref:r,onPlay:()=>{var j;c(!0),g&&((j=i.current)==null||j.pause(),setTimeout(()=>p(!0),200))},onPause:()=>{p(!1)}})]}),t.jsxs(P,{sx:{display:"flex",flexDirection:"column",gap:1},children:[t.jsx("h5",{children:"Reference sound"}),t.jsx("p",{children:"Use the slider below to make the video volume roughly the same as this music."}),t.jsx("br",{}),t.jsx("audio",{ref:i,controls:!0,src:Xe,loop:!0,onLoad:j=>j.currentTarget.currentTime=35,onPlay:j=>{var b,L;j.currentTarget.volume=.5,p(!0),x&&((L=(b=r.current)==null?void 0:b.getInternalPlayer())==null||L.pauseVideo(),setTimeout(()=>c(!0),200))},onPause:()=>{var j,b;p(!1),x&&((b=(j=r.current)==null?void 0:j.getInternalPlayer())==null||b.playVideo())}})]})]}),t.jsxs("h5",{children:["Final Song Volume (",e.volume*100,")"]}),t.jsx(P,{children:t.jsx(Be,{"data-test":"volume",min:.1,max:1,step:.01,"aria-label":"Volume",value:e.volume,onChange:S})})]})}const Ga=e=>{const a=pe(!0);return h.useMemo(()=>{var s,r;const n=a.data.filter(i=>i.artist===e).map(i=>i.artistOrigin).filter(Boolean).reduce((i,l)=>(i[l]?i[l]++:i[l]=1,i),{});return((r=(s=Object.entries(n).sort((i,l)=>l[1]-i[1]))==null?void 0:s[0])==null?void 0:r[0])??""},[e,a.data])};function Fa(e){var S;const a=pe(!0),n=Ga(e.songArtist??"");h.useEffect(()=>{e.data.artistOrigin===void 0&&(console.log("props.data.artistOrigin",n),e.onChange({...e.data,artistOrigin:n}))},[n,e.data]);const s=h.useMemo(()=>[...new Set(a.data.map(({language:d})=>Array.isArray(d)?d:[d]).flat().filter(Boolean))],[a.data]),r=Na,i=h.useMemo(()=>[...new Set(a.data.map(d=>d.genre).filter(Boolean).map(d=>d.toLowerCase().replace(/\b\w/g,v=>v.toUpperCase().trim())))],[a.data]),l=h.useMemo(()=>[...new Set(a.data.map(d=>d.edition).filter(Boolean).map(d=>d.toLowerCase().replace(/\b\w/g,v=>v.toUpperCase().trim())))].sort(),[a.data]),u=d=>{global.open(`https://www.google.com/search?q=${encodeURIComponent(`${e.songArtist} ${e.songTitle} ${d}`)}`,"_blank")},x=!!e.songTitle&&!!e.songArtist,c=+(((S=e.data)==null?void 0:S.realBpm)??0)>200,[g,p]=h.useState(!1);return t.jsxs(M,{container:!0,spacing:2,"data-test":"song-metadata",children:[t.jsx(M,{item:!0,xs:6,children:t.jsx(R,{value:e.data.artist,onChange:d=>e.onChange({...e.data,artist:d.target.value}),label:"Song artist",size:"small","data-test":"song-artist",required:!0,fullWidth:!0})}),t.jsx(M,{item:!0,xs:6,children:t.jsx(R,{value:e.data.title,onChange:d=>e.onChange({...e.data,title:d.target.value}),label:"Song title",fullWidth:!0,size:"small",required:!0,"data-test":"song-title"})}),t.jsx(M,{item:!0,xs:3,children:t.jsx(xe,{onKeyDown:d=>{d.key==="Enter"&&d.preventDefault()},freeSolo:!0,disableClearable:!0,options:i,value:e.data.genre??"",onChange:(d,v)=>e.onChange({...e.data,genre:v}),renderInput:d=>t.jsx(R,{...d,onBlur:v=>e.onChange({...e.data,genre:v.target.value}),label:"Song genre (optional)",size:"small","data-test":"song-genre",fullWidth:!0})})}),t.jsx(M,{item:!0,xs:3,children:t.jsx(xe,{onKeyDown:d=>{d.key==="Enter"&&d.preventDefault()},freeSolo:!0,disableClearable:!0,options:l,value:e.data.edition??"",onChange:(d,v)=>e.onChange({...e.data,edition:v}),renderInput:d=>t.jsx(R,{...d,onBlur:v=>e.onChange({...e.data,edition:v.target.value}),label:"Song edition (optional)",size:"small","data-test":"song-edition",helperText:"Songs with the same theme, e.g. 'Christmas'",fullWidth:!0})})}),t.jsx(M,{item:!0,xs:3,children:t.jsx(xe,{onKeyDown:d=>{d.key==="Enter"&&d.preventDefault()},multiple:!0,freeSolo:!0,disableClearable:!0,options:s,value:typeof e.data.language=="string"?[e.data.language]:e.data.language,onChange:(d,v)=>{e.onChange({...e.data,language:v?v.filter(Boolean):e.data.language})},renderInput:d=>{var v;return t.jsx(R,{...d,label:"Song language",fullWidth:!0,size:"small",required:!((v=e.data.language)!=null&&v.length),"data-test":"song-language"})}})}),t.jsx(M,{item:!0,xs:3,children:t.jsxs(Pt,{fullWidth:!0,children:[t.jsx(Rt,{id:"song-origin-select-label",size:"small",children:"Song/artist origin (optional)"}),t.jsxs($t,{"data-test":"artist-origin",size:"small",labelId:"song-origin-select-label",id:"song-origin-select",value:e.data.artistOrigin??"",label:"Song/artist origin (optional)",onChange:d=>e.onChange({...e.data,artistOrigin:d.target.value}),children:[t.jsx(Ie,{value:"",children:"None"},"none"),Object.entries(r).map(([d,v])=>t.jsxs(Ie,{value:d,children:[t.jsx(za,{isocode:d})," ",v]},d))]}),t.jsx(At,{children:"Used to show the flag on the list"})]})}),t.jsx(M,{item:!0,xs:6,children:t.jsx(R,{"data-test":"release-year",value:e.data.year,onChange:d=>e.onChange({...e.data,year:d.target.value}),label:"Release year",helperText:"The year the song was released. Click the 'Lookup' button to look for it on Google",fullWidth:!0,size:"small",required:!0,...be(()=>u("release year"),x)})}),t.jsx(M,{item:!0,xs:6,children:t.jsx(R,{"data-test":"song-bpm",value:e.data.realBpm,onChange:d=>e.onChange({...e.data,realBpm:d.target.value}),label:"Song (real) BPM",focused:c?!0:void 0,helperText:c?t.jsxs(t.Fragment,{children:["Usually songs don't have higher BPM than ",t.jsx("b",{children:"200"}),". Make sure the value is correct (you can still save the song)"]}):`The actual tempo of the song. Click the 'Lookup' button to look for it on Google. ${g?"If you can't find it, you can still save the song":""}`,color:c?"warning":void 0,fullWidth:!0,type:"number",size:"small",required:!g,...be(()=>{p(!0),u("tempo")},x)})}),t.jsx(M,{item:!0,xs:12}),t.jsx(M,{item:!0,xs:12,children:t.jsx(Ua,{...e})})]})}const za=z(Qe,{target:"e70j9sv0"})({name:"3kqygp",styles:"width:1em;margin-right:0.5em;display:inline-block"});var Da=1,Va=4;function Oa(e){return et(e,Da|Va)}function Wa(e){return _("MuiButtonGroup",e)}const C=q("MuiButtonGroup",["root","contained","outlined","text","disableElevation","disabled","firstButton","fullWidth","horizontal","vertical","colorPrimary","colorSecondary","grouped","groupedHorizontal","groupedVertical","groupedText","groupedTextHorizontal","groupedTextVertical","groupedTextPrimary","groupedTextSecondary","groupedOutlined","groupedOutlinedHorizontal","groupedOutlinedVertical","groupedOutlinedPrimary","groupedOutlinedSecondary","groupedContained","groupedContainedHorizontal","groupedContainedVertical","groupedContainedPrimary","groupedContainedSecondary","lastButton","middleButton"]),Ha=(e,a)=>{const{ownerState:n}=e;return[{[`& .${C.grouped}`]:a.grouped},{[`& .${C.grouped}`]:a[`grouped${$(n.orientation)}`]},{[`& .${C.grouped}`]:a[`grouped${$(n.variant)}`]},{[`& .${C.grouped}`]:a[`grouped${$(n.variant)}${$(n.orientation)}`]},{[`& .${C.grouped}`]:a[`grouped${$(n.variant)}${$(n.color)}`]},{[`& .${C.firstButton}`]:a.firstButton},{[`& .${C.lastButton}`]:a.lastButton},{[`& .${C.middleButton}`]:a.middleButton},a.root,a[n.variant],n.disableElevation===!0&&a.disableElevation,n.fullWidth&&a.fullWidth,n.orientation==="vertical"&&a.vertical]},Ka=e=>{const{classes:a,color:n,disabled:s,disableElevation:r,fullWidth:i,orientation:l,variant:u}=e,x={root:["root",u,l,i&&"fullWidth",r&&"disableElevation",`color${$(n)}`],grouped:["grouped",`grouped${$(l)}`,`grouped${$(u)}`,`grouped${$(u)}${$(l)}`,`grouped${$(u)}${$(n)}`,s&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return O(x,Wa,a)},_a=A("div",{name:"MuiButtonGroup",slot:"Root",overridesResolver:Ha})(Y(({theme:e})=>({display:"inline-flex",borderRadius:(e.vars||e).shape.borderRadius,variants:[{props:{variant:"contained"},style:{boxShadow:(e.vars||e).shadows[2]}},{props:{disableElevation:!0},style:{boxShadow:"none"}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{orientation:"vertical"},style:{flexDirection:"column",[`& .${C.lastButton},& .${C.middleButton}`]:{borderTopRightRadius:0,borderTopLeftRadius:0},[`& .${C.firstButton},& .${C.middleButton}`]:{borderBottomRightRadius:0,borderBottomLeftRadius:0}}},{props:{orientation:"horizontal"},style:{[`& .${C.firstButton},& .${C.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${C.lastButton},& .${C.middleButton}`]:{borderTopLeftRadius:0,borderBottomLeftRadius:0}}},{props:{variant:"text",orientation:"horizontal"},style:{[`& .${C.firstButton},& .${C.middleButton}`]:{borderRight:e.vars?`1px solid rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${e.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${C.disabled}`]:{borderRight:`1px solid ${(e.vars||e).palette.action.disabled}`}}}},{props:{variant:"text",orientation:"vertical"},style:{[`& .${C.firstButton},& .${C.middleButton}`]:{borderBottom:e.vars?`1px solid rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${e.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${C.disabled}`]:{borderBottom:`1px solid ${(e.vars||e).palette.action.disabled}`}}}},...Object.entries(e.palette).filter(ke()).flatMap(([a])=>[{props:{variant:"text",color:a},style:{[`& .${C.firstButton},& .${C.middleButton}`]:{borderColor:e.vars?`rgba(${e.vars.palette[a].mainChannel} / 0.5)`:ee(e.palette[a].main,.5)}}}]),{props:{variant:"outlined",orientation:"horizontal"},style:{[`& .${C.firstButton},& .${C.middleButton}`]:{borderRightColor:"transparent","&:hover":{borderRightColor:"currentColor"}},[`& .${C.lastButton},& .${C.middleButton}`]:{marginLeft:-1}}},{props:{variant:"outlined",orientation:"vertical"},style:{[`& .${C.firstButton},& .${C.middleButton}`]:{borderBottomColor:"transparent","&:hover":{borderBottomColor:"currentColor"}},[`& .${C.lastButton},& .${C.middleButton}`]:{marginTop:-1}}},{props:{variant:"contained",orientation:"horizontal"},style:{[`& .${C.firstButton},& .${C.middleButton}`]:{borderRight:`1px solid ${(e.vars||e).palette.grey[400]}`,[`&.${C.disabled}`]:{borderRight:`1px solid ${(e.vars||e).palette.action.disabled}`}}}},{props:{variant:"contained",orientation:"vertical"},style:{[`& .${C.firstButton},& .${C.middleButton}`]:{borderBottom:`1px solid ${(e.vars||e).palette.grey[400]}`,[`&.${C.disabled}`]:{borderBottom:`1px solid ${(e.vars||e).palette.action.disabled}`}}}},...Object.entries(e.palette).filter(ke(["dark"])).map(([a])=>({props:{variant:"contained",color:a},style:{[`& .${C.firstButton},& .${C.middleButton}`]:{borderColor:(e.vars||e).palette[a].dark}}}))],[`& .${C.grouped}`]:{minWidth:40,boxShadow:"none",props:{variant:"contained"},style:{"&:hover":{boxShadow:"none"}}}}))),K=h.forwardRef(function(a,n){const s=V({props:a,name:"MuiButtonGroup"}),{children:r,className:i,color:l="primary",component:u="div",disabled:x=!1,disableElevation:c=!1,disableFocusRipple:g=!1,disableRipple:p=!1,fullWidth:S=!1,orientation:d="horizontal",size:v="medium",variant:I="outlined",...B}=s,m={...s,color:l,component:u,disabled:x,disableElevation:c,disableFocusRipple:g,disableRipple:p,fullWidth:S,orientation:d,size:v,variant:I},k=Ka(m),j=h.useMemo(()=>({className:k.grouped,color:l,disabled:x,disableElevation:c,disableFocusRipple:g,disableRipple:p,fullWidth:S,size:v,variant:I}),[l,x,c,g,p,S,v,I,k.grouped]),b=Kt(r),L=b.length,f=o=>{const y=o===0,T=o===L-1;return y&&T?"":y?k.firstButton:T?k.lastButton:k.middleButton};return t.jsx(_a,{as:u,role:"group",className:G(k.root,i),ref:n,ownerState:m,...B,children:t.jsx(tt.Provider,{value:j,children:b.map((o,y)=>t.jsx(at.Provider,{value:f(y),children:o},y))})})});function qa({player:e,currentTime:a,playbackSpeed:n,setPlaybackSpeed:s}){const r=i=>e.seekTo((a+i)/1e3);return t.jsxs(t.Fragment,{children:[t.jsxs(P,{children:[t.jsxs(F,{"data-test":"current-time",children:["Current time: ",We(a)," (",t.jsx(ce,{children:Math.round(a)})," ms)"]}),t.jsxs(P,{sx:{display:"flex",gap:1},children:[t.jsxs(K,{variant:"contained",sx:{display:"flex",mt:1,flex:1},children:[t.jsx(w,{size:"small",sx:{flex:1,px:1},onClick:()=>r(-1e4),"data-test":"seek-10s",children:"-10"}),t.jsx(w,{size:"small",sx:{flex:1,px:1},onClick:()=>r(-5e3),"data-test":"seek-5s",children:"-5"}),t.jsx(w,{size:"small",sx:{flex:1,px:1},onClick:()=>r(-1e3),"data-test":"seek-1s",children:"-1"}),t.jsx(w,{size:"small",sx:{flex:1,px:1},onClick:()=>r(-500),"data-test":"seek-0.5s",children:"-0.5"})]}),t.jsx(Nt,{}),t.jsxs(K,{variant:"contained",sx:{display:"flex",mt:1,flex:1},children:[t.jsx(w,{size:"small",sx:{flex:1,px:1},onClick:()=>r(500),"data-test":"seek+0.5s",children:"+0.5"}),t.jsx(w,{size:"small",sx:{flex:1,px:1},onClick:()=>r(1e3),"data-test":"seek+1s",children:"+1"}),t.jsx(w,{size:"small",sx:{flex:1,px:1},onClick:()=>r(5e3),"data-test":"seek+5s",children:"+5"}),t.jsx(w,{size:"small",sx:{flex:1,px:1},onClick:()=>r(1e4),"data-test":"seek+10s",children:"+10"})]})]})]}),t.jsxs(P,{children:[t.jsxs(F,{children:["Playback speed: ",t.jsxs(ce,{"data-test":"current-speed",children:[n*100,"%"]})]}),t.jsx(K,{variant:"contained",sx:{display:"flex",mt:1},children:[.25,.5,.75,1,1.25,1.5,2].map(i=>t.jsxs(w,{size:"small","data-test":`speed-${i}`,sx:{flex:1},onClick:()=>{s(i),e.setPlaybackSpeed(i)},disabled:n===i,children:[i*100,"%"]},i))})]})]})}const Ya=(e,a)=>{const{ownerState:n}=e;return[a.root,n.dense&&a.dense,n.alignItems==="flex-start"&&a.alignItemsFlexStart,n.divider&&a.divider,!n.disableGutters&&a.gutters]},Za=e=>{const{alignItems:a,classes:n,dense:s,disabled:r,disableGutters:i,divider:l,selected:u}=e,c=O({root:["root",s&&"dense",!i&&"gutters",l&&"divider",r&&"disabled",a==="flex-start"&&"alignItemsFlexStart",u&&"selected"]},Et,n);return{...n,...c}},Ja=A(Ae,{shouldForwardProp:e=>rt(e)||e==="classes",name:"MuiListItemButton",slot:"Root",overridesResolver:Ya})(Y(({theme:e})=>({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${Q.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:ee(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${Q.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:ee(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}},[`&.${Q.selected}:hover`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:ee(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:ee(e.palette.primary.main,e.palette.action.selectedOpacity)}},[`&.${Q.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${Q.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},variants:[{props:({ownerState:a})=>a.divider,style:{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:"padding-box"}},{props:{alignItems:"flex-start"},style:{alignItems:"flex-start"}},{props:({ownerState:a})=>!a.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:a})=>a.dense,style:{paddingTop:4,paddingBottom:4}}]}))),Xa=h.forwardRef(function(a,n){const s=V({props:a,name:"MuiListItemButton"}),{alignItems:r="center",autoFocus:i=!1,component:l="div",children:u,dense:x=!1,disableGutters:c=!1,divider:g=!1,focusVisibleClassName:p,selected:S=!1,className:d,...v}=s,I=h.useContext(ve),B=h.useMemo(()=>({dense:x||I.dense||!1,alignItems:r,disableGutters:c}),[r,I.dense,x,c]),m=h.useRef(null);nt(()=>{i&&m.current&&m.current.focus()},[i]);const k={...s,alignItems:r,dense:B.dense,disableGutters:c,divider:g,selected:S},j=Za(k),b=st(m,n);return t.jsx(ve.Provider,{value:B,children:t.jsx(Ja,{ref:b,href:v.href||v.to,component:(v.href||v.to)&&l==="div"?"button":l,focusVisibleClassName:G(j.focusVisible,p),ownerState:k,className:G(j.root,d),...v,classes:j,children:u})})});function Qa(e,a){const n=Math.floor(a);return h.useMemo(()=>e.findIndex((s,r)=>n<0?!0:n<s.start?!1:r===e.length-1||e[r+1].start>n),[n,e])}function en({song:e,currentTime:a,beatLength:n,player:s,onRecordChange:r,onLyricChange:i,playbackSpeed:l,onTrackNameChange:u,lyricChanges:x}){var L;const[c,g]=h.useState(0),[p,S]=h.useState(-1),[d,v]=h.useState([]),I=ot(a,n,e.gap),B=e.tracks[c].sections.filter(Z),m=Qa(B,I),k=f=>{S(f),Ge.resetPlayerNotes();const o=it(B[f])*n+e.gap;s.seekTo(o/1e3-.8*l)},j=()=>{v(f=>[...f,{type:"delete",section:p,track:c}]),p===B.length-1&&S(f=>f-1)},b=f=>{v(o=>{const y=o.at(-1);if(y&&y.type==="shift"&&y.track===c&&y.section===p){const T=[...o];return T.at(-1).shift=f,T}return[...o,{type:"shift",section:p,track:c,shift:f}]})};return h.useEffect(()=>{r(d)},[r,d]),t.jsxs(nn,{children:[t.jsxs(Le,{direction:"row",children:[t.jsxs(F,{variant:"h6",mb:0,sx:{flex:1,display:"flex",alignItems:"center"},children:["Edit verses",e.tracks.length>1&&t.jsx(K,{variant:"contained",sx:{ml:2},size:"small",children:e.tracks.map((f,o)=>t.jsxs(w,{onClick:()=>g(o),disabled:c===o,"data-test":`track-${o+1}`,children:["Track ",o+1]},o))})]}),t.jsx(R,{label:"Track name",placeholder:"Set track name",sx:{flex:1},size:"small",value:((L=e.tracks[c])==null?void 0:L.name)??"",onChange:f=>u(c,f.target.value),"data-test":"track-name"})]}),t.jsxs(Le,{direction:"row",spacing:2,sx:{height:"400px",mt:3},children:[t.jsx(Ut,{sx:{overflowY:"auto"},children:B.map((f,o)=>t.jsx(Gt,{disablePadding:!0,"data-test":`section-${o}`,sx:{maxWidth:250,overflowX:"hidden",textWrap:"ellipsis",whiteSpace:"nowrap"},children:t.jsx(Xa,{onClick:()=>k(o),selected:p===o,children:t.jsx(Aa,{primaryTypographyProps:{fontWeight:o===m?"bold":"normal"},primary:Z(f)?f.notes.map(y=>y.lyrics.replaceAll(" ","·")).join(""):"[pause]"})})},f.start))}),t.jsx(sn,{children:p>-1&&t.jsxs(t.Fragment,{children:[p===0&&t.jsx("h3",{"data-test":"use-gap-info",children:"Use gap shift to change when this section starts"}),p>0&&t.jsx(t.Fragment,{children:t.jsx(R,{"data-test":"change-start-beat",size:"small",type:"number",onChange:f=>b(+f.target.value),value:de([B[p]]),label:"Change start beat",InputProps:{inputProps:{step:1}},fullWidth:!0,sx:{mb:2},helperText:t.jsxs(t.Fragment,{children:["Timestamp:"," ",te(de([B[p]])*n+e.gap,s)]})})}),t.jsx(rn,{children:B[p].notes.map((f,o)=>{var T,U;const y=((U=(T=x[c])==null?void 0:T[p])==null?void 0:U[o])??f.lyrics;return t.jsx(on,{style:{width:`${y.length}ch`},value:y,"data-test":`lyric-input-${o}`,onChange:N=>{i({section:p,track:c,noteIndex:o,newLyric:N.target.value})},onKeyDown:N=>{var ne,je;const J=N.target.selectionStart;if(N.key==="ArrowLeft"&&J===0){const D=(ne=N.target)==null?void 0:ne.previousElementSibling;D&&(D.focus(),setTimeout(()=>D.setSelectionRange(D.value.length,D.value.length),10))}else if(N.key==="ArrowRight"&&J===N.target.value.length){const D=(je=N.target)==null?void 0:je.nextElementSibling;D&&(D.focus(),setTimeout(()=>D.setSelectionRange(0,0),10))}}},o)})}),t.jsx(w,{variant:"contained",color:"error",onClick:j,fullWidth:!0,"data-test":"delete-section",children:"Delete section"})]})}),t.jsxs(tn,{children:[t.jsx(P,{sx:{overflowY:"auto",maxHeight:"34rem"},"data-test":"change-list",children:d.map((f,o)=>{let y="",T=Re;return f.type==="delete"?(T=Re,y="Deleted"):f.type==="shift"&&(T=an,y=`Start -> ${f.shift}`),t.jsx(T,{children:t.jsxs("strong",{children:["Track: ",f.track+1,", Section: ",f.section+1,", ",y]})},o)})}),d.length>0&&t.jsx(w,{"data-test":"undo-change",variant:"contained",color:"warning",onClick:()=>v(f=>f.filter((o,y)=>y!==f.length-1)),fullWidth:!0,children:"Undo last change"})]})]})]})}const tn=z("div",{target:"e18sxv6t7"})({name:"82a6rk",styles:"flex:1"}),He=z("div",{target:"e18sxv6t6"})({name:"m1a2da",styles:"padding:0.5rem"}),Re=z(He,{target:"e18sxv6t5"})({name:"hwfcu5",styles:"color:red"}),an=z(He,{target:"e18sxv6t4"})({name:"zzs6wi",styles:"color:#0059ff"}),nn=z("div",{target:"e18sxv6t3"})(""),sn=z("div",{target:"e18sxv6t2"})({name:"82a6rk",styles:"flex:1"}),rn=z("div",{target:"e18sxv6t1"})({name:"1qhi3cl",styles:"display:flex;gap:0.25rem;column-gap:0;margin-bottom:1rem;align-items:center;flex-wrap:wrap"}),on=z("input",{target:"e18sxv6t0"})({name:"1bv0k4z",styles:"font-family:monospace;background:#f6f6f6;width:3rem;padding:0.5rem 0.1rem;border:0;border-right:1px solid #ececec;text-decoration:underline;box-sizing:content-box;&:focus{background:#ececec;outline:none!important;}"});function ln(e,a){var l;const s=(l=a.tracks[0].sections.filter(Z).at(-1))==null?void 0:l.notes.at(-1),r=e-a.gap,i=s.start+s.length;return Number((6e4/(r/i*a.bar)).toFixed(2))}function dn({current:e,onChange:a,song:n}){const s=Math.max(...n.tracks.map(u=>lt(u.sections))),r=dt(s,n)+n.gap,[i,l]=h.useState(Math.round(r));return t.jsxs(P,{sx:{display:"flex",gap:2,mb:2},children:[t.jsx(R,{"data-test":"desired-end",size:"small",type:"number",value:i,onChange:u=>l(+u.target.value),label:"Desired last note end time (in milliseconds)",sx:{flex:1},helperText:i?t.jsxs(t.Fragment,{children:["Estimated proper Tempo (BPM) of the lyrics:"," ",t.jsx(ce,{"data-test":"desired-bpm",children:ln(i,n)})]}):" "}),t.jsx(R,{"data-test":"change-bpm",size:"small",type:"number",value:e,onChange:u=>a(+u.target.value),label:"Tempo (BPM) of the lyrics",sx:{flex:.5},helperText:" ",InputProps:{inputProps:{step:"0.1"}}})]})}function cn({current:e,onChange:a,player:n,finalGap:s}){return t.jsxs(P,{flex:"1",children:[t.jsxs(F,{children:["Lyrics Gap shift (final: ",te(s,n),")"]}),t.jsxs(P,{sx:{display:"flex",gap:1,mt:1},children:[t.jsxs(K,{sx:{flex:1},children:[t.jsx(w,{sx:{flex:1,px:1},onClick:()=>a(e-1e3),"data-test":"shift-gap-1s",children:"-1000"}),t.jsx(w,{sx:{flex:1,px:1},onClick:()=>a(e-500),"data-test":"shift-gap-0.5s",children:"-500"}),t.jsx(w,{sx:{flex:1,px:1},onClick:()=>a(e-50),"data-test":"shift-gap-0.05s",children:"-50"})]}),t.jsx(R,{sx:{py:0,flex:1},size:"small",type:"text",value:e,onChange:r=>a(+r.target.value),label:"Miliseconds","data-test":"shift-gap"}),t.jsxs(K,{sx:{flex:1},children:[t.jsx(w,{sx:{flex:1,px:1},onClick:()=>a(e+50),"data-test":"shift-gap+0.05s",children:"+50"}),t.jsx(w,{sx:{flex:1,px:1},onClick:()=>a(e+500),"data-test":"shift-gap+0.5s",children:"+500"}),t.jsx(w,{sx:{flex:1,px:1},onClick:()=>a(e+1e3),"data-test":"shift-gap+1s",children:"+1000"})]})]})]})}function un({current:e,onChange:a,player:n,finalGap:s}){return t.jsxs(P,{flex:"1",children:[t.jsxs(F,{children:["Video Gap shift (final: ",te((s??0)*1e3,n),")"]}),t.jsxs(P,{sx:{display:"flex",gap:1,mt:1},children:[t.jsxs(K,{sx:{flex:1},children:[t.jsx(w,{sx:{flex:1,px:1.25},onClick:()=>a(e-10),"data-test":"shift-video-gap-10s",children:"-10"}),t.jsx(w,{sx:{flex:1,px:1.25},onClick:()=>a(e-5),"data-test":"shift-video-gap-5s",children:"-5"}),t.jsx(w,{sx:{flex:1,px:1.25},onClick:()=>a(e-1),"data-test":"shift-video-gap-1s",children:"-1"})]}),t.jsx(R,{"data-test":"shift-video-gap",sx:{py:0,flex:1},size:"small",type:"text",value:e,onChange:r=>a(+r.target.value),label:"Seconds"}),t.jsxs(K,{sx:{flex:1},children:[t.jsx(w,{sx:{flex:1,px:1.25},onClick:()=>a(e+1),"data-test":"shift-video-gap+1s",children:"+1"}),t.jsx(w,{sx:{flex:1,px:1.25},onClick:()=>a(e+5),"data-test":"shift-video-gap+5s",children:"+5"}),t.jsx(w,{sx:{flex:1,px:1.25},onClick:()=>a(e+10),"data-test":"shift-video-gap+10s",children:"+10"})]})]})]})}const pn=(e,a)=>({...e,gap:e.gap+a}),hn=(e,a)=>({...e,videoGap:(e.videoGap??0)+a}),xn=(e,a)=>({...e,bpm:a}),mn=(e,a)=>({...e,tracks:e.tracks.map((n,s)=>{const r=a.filter(l=>l.track===s);let i=[...n.sections].filter(Z);return r.forEach(l=>{if(l.type==="delete")i=i.filter((u,x)=>x!==l.section);else if(l.type==="shift"){const u=l.shift-de([i[l.section]]);i=i.map((x,c)=>c<l.section?x:{...x,notes:x.notes.map(g=>({...g,start:g.start+u}))})}}),{...n,sections:i}})}),fn=(e,a)=>({...e,tracks:e.tracks.map((n,s)=>({...n,name:a[s]??n.name}))}),gn=(e,a)=>({...e,tracks:e.tracks.map((n,s)=>{const r=a[s]??{};return{...n,sections:n.sections.map((i,l)=>{const u=r[l]??{};return Z(i)?{...i,notes:i.notes.map((x,c)=>({...x,lyrics:u[c]??x.lyrics}))}:i})}})}),Se=824,$e=Se/16*9;function vn({song:e,onUpdate:a,visible:n}){const s=h.useRef(null),[r,i]=h.useState(0),[l,u]=h.useState(1),[x,c]=h.useState(0),[g,p]=h.useState(0),[S,d]=h.useState(e.bpm),[v,I]=h.useState([]),[B,m]=h.useState(e.tracks.map(o=>o.name??void 0)),[k,j]=h.useState({}),b=h.useMemo(()=>{let o=Oa(e);return o=ct(o),o=ut(o),o=we(o),o=pn(o,x),o=hn(o,g),o=xn(o,S),o=mn(o,v),o=fn(o,B),o=gn(o,k),o=we(o),o=pt(o),o},[x,g,e,S,v,B,k]);h.useEffect(()=>{a==null||a(b)},[a,b]);const L=h.useMemo(()=>({id:"test",mode:ht.DUEL,players:[{number:0,track:0},{number:1,track:e.tracks.length-1}],tolerance:6}),[e]),f=xt(b);return h.useEffect(()=>{var o;n||(o=s.current)==null||o.pause()},[n]),t.jsxs(M,{container:!0,spacing:2,sx:{display:n?void 0:"none"},children:[t.jsx(M,{item:!0,xs:8,"data-test":"player-container",children:t.jsx(P,{sx:{width:Se,height:$e},children:t.jsx(mt,{song:b,showControls:!0,autoplay:!1,width:Se,height:$e,ref:s,onCurrentTimeUpdate:i,effectsEnabled:!1,singSetup:L,onSongEnd:()=>{}},0)})}),t.jsxs(M,{item:!0,xs:4,sx:{display:"flex",flexDirection:"column",gap:2},children:[s.current&&t.jsxs(t.Fragment,{children:[t.jsx(qa,{player:s.current,currentTime:r,playbackSpeed:l,setPlaybackSpeed:u}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx(w,{onClick:()=>{var y;const o=de(b.tracks[0].sections)*f+b.gap;(y=s.current)==null||y.seekTo(o/1e3-.8*l)},children:"First section"}),t.jsx(w,{onClick:()=>{var y,T;const o=(((y=ft(b.tracks[0].sections))==null?void 0:y.notes[0].start)??0)*f+b.gap;(T=s.current)==null||T.seekTo(o/1e3-.8*l)},children:"Last section"})]})]}),!s.current&&t.jsx("h2",{children:"Start the song to see the manipulation form"})]}),s.current&&t.jsxs(t.Fragment,{children:[t.jsx(M,{item:!0,xs:8,children:t.jsxs(P,{sx:{display:"flex",gap:5,flex:1},children:[t.jsx(un,{player:s.current,onChange:o=>{const y=o-g;p(o),c(T=>T+y*1e3)},current:g,finalGap:b.videoGap}),t.jsx(cn,{player:s.current,onChange:c,current:x,finalGap:b.gap})]})}),t.jsxs(M,{item:!0,xs:4,children:[t.jsxs("div",{className:"mb-2 text-xs",children:["Use ",t.jsx("strong",{children:"Video shift gap"})," to crop the beginning of the video if it starts with an intro."]}),t.jsxs("div",{className:"mb-2 text-xs",children:["Use ",t.jsx("strong",{children:"Lyrics shift gap"})," to sync the start of the lyrics to the video. You can lower the"," ",t.jsx("strong",{children:"Playback speed"})," above to make sure you got it just right."," "]})]}),t.jsxs(M,{item:!0,xs:8,children:[t.jsx(F,{variant:"h5",mb:2,children:"Advanced"}),t.jsx(dn,{onChange:d,current:S,song:b},b.gap)]}),t.jsxs(M,{item:!0,xs:4,children:[t.jsx("div",{className:"mb-2 text-xs",children:"If the lyrics desynchronise over time, probably the tempo (BPM) of the lyrics is wrong."}),t.jsxs("div",{className:"mb-2 text-xs",children:["You can either use ",t.jsx("strong",{children:"Last note end time"})," - enter the millisecond when the last note should end (seek through the video for the moment as ",t.jsx("strong",{children:"Current time"})," panel show the exact millisecond) and a suggested BPM value will appear below."]}),t.jsxs("div",{className:"mb-2 text-xs",children:[t.jsx("strong",{children:"Tempo (BPM)"})," field allows to fine-tune the tempo."]})]}),t.jsx(M,{item:!0,xs:8,children:t.jsx(en,{playbackSpeed:l,song:b,currentTime:r,beatLength:f,player:s.current,onRecordChange:I,onTrackNameChange:(o,y)=>m(T=>{const U=[...T];return U[o]=y===""?void 0:y,U}),lyricChanges:k,onLyricChange:o=>j(y=>{var T;return{...y,[o.track]:{...y[o.track],[o.section]:{...(T=y[o.track])==null?void 0:T[o.section],[o.noteIndex]:o.newLyric}}}})})}),t.jsxs(M,{item:!0,xs:4,children:[t.jsxs("div",{className:"mb-2 text-xs",children:["If the lyrics there are more lyrics than in the video or there are longer/shorter interludes between verses, you can ",t.jsx("strong",{children:"Edit verses"}),"."]}),t.jsx("div",{className:"mb-2 text-xs",children:"Select a verse by clicking on it."}),t.jsxs("div",{className:"mb-2 text-xs",children:["You can either ",t.jsx("strong",{children:"Change its start beat"}),' (which will "move in time" the verse and all subsequent ones) or ',t.jsx("strong",{children:"Delete it"})," (it won't affect the timing of other verses). You can also edit the lyrics of each note."]}),t.jsxs("div",{className:"mb-2 text-xs",children:[t.jsx("strong",{children:"List of changes"})," on the right allows you to see and undo the actions one by one."]})]})]})]})}function yn(e){var a,n,s;return t.jsx(P,{"data-test":"sync-lyrics",children:e.data&&e.data.video.length<15&&!!((s=(n=(a=e.data.tracks)==null?void 0:a[0])==null?void 0:n.sections)!=null&&s.length)&&t.jsx(vn,{song:e.data,onUpdate:e.onChange,visible:e.visible})})}function bn(e){return Array.isArray(e)?e.length===0:!e}const E=["basic-data","author-and-video","sync","metadata"];function Bn({song:e}){const a=!!e,{data:n}=pe(!0);Fe(!1);const s=gt();ze(!1);const r=ge("step"),[i,l]=h.useState(Math.max(0,E.indexOf(r))),[u,x]=h.useState(!1);h.useEffect(()=>{E[i]&&Ca({step:E[i]})},[i]);const[c,g]=h.useState({sourceUrl:(e==null?void 0:e.sourceUrl)??"",txtInput:""}),[p,S]=h.useState({author:(e==null?void 0:e.author)??"",authorUrl:(e==null?void 0:e.authorUrl)??"",video:e!=null&&e.video?`https://www.youtube.com/watch?v=${e.video}`:""}),[d,v]=h.useState({artist:(e==null?void 0:e.artist)??"",title:(e==null?void 0:e.title)??"",realBpm:e!=null&&e.realBpm?String(e.realBpm):"",year:(e==null?void 0:e.year)??"",language:(e==null?void 0:e.language)??[],volume:(e==null?void 0:e.volume)??0,previewStart:(e==null?void 0:e.previewStart)??void 0,previewEnd:(e==null?void 0:e.previewEnd)??void 0,genre:e==null?void 0:e.genre,edition:e==null?void 0:e.edition,artistOrigin:e==null?void 0:e.artistOrigin}),[I,B]=h.useState(e),m=h.useMemo(()=>{try{return a?{...e,video:Ne(p.video)||e.video,author:p.author,authorUrl:p.authorUrl,sourceUrl:c.sourceUrl}:c.txtInput?Ue(c.txtInput,p.video,p.author,p.authorUrl,c.sourceUrl):void 0}catch(o){console.error(o)}},[c.txtInput,p.video,p.author,p.authorUrl,c.sourceUrl,e,a]),k=h.useMemo(()=>!a&&m&&(n==null?void 0:n.find(o=>W.generateSongFile(o)===W.generateSongFile(m))),[n,m,a]);h.useEffect(()=>{m&&(m.video&&!p.video&&S(o=>({...o,video:`https://www.youtube.com/watch?v=${m.video}`})),m.author&&!p.author&&S(o=>({...o,author:o.author||(m==null?void 0:m.author)||"",authorUrl:o.authorUrl||(m==null?void 0:m.authorUrl)||""})),m.sourceUrl&&!c.sourceUrl&&g(o=>({...o,sourceUrl:m.sourceUrl})),["year","language","realBpm","genre","artist","title","volume","previewStart","previewEnd","artistOrigin"].forEach(o=>{m[o]&&bn(d[o])&&v(y=>({...y,[o]:m[o]}))}))},[m,d.year,d.language,d.realBpm,d.genre,d.artist,d.volume,d.title,d.previewStart,d.previewEnd,c.sourceUrl,p.video]);const j=!!c.txtInput||a,b=!!p.video,L=E[i]==="author-and-video"?b:!0,f={...I,...d,author:p.author,authorUrl:p.authorUrl,realBpm:+d.realBpm,sourceUrl:c.sourceUrl,id:vt(d)};return t.jsxs(qt,{injectFirst:!0,children:[t.jsx(De,{}),t.jsxs(M,{container:!0,gap:2,p:1,pb:10,children:[t.jsx(M,{item:!0,xs:12,children:!a&&t.jsx("div",{style:{marginBottom:"1rem"},children:t.jsx(ie,{to:"menu/",children:t.jsx("a",{children:"Return to the main menu"})})})}),t.jsx(M,{item:!0,xs:12,children:t.jsxs(ja,{activeStep:i,sx:{mb:2},nonLinear:a,children:[t.jsx(re,{completed:j,children:t.jsx(oe,{color:"inherit",onClick:()=>l(0),children:"Basic Info"})},0),t.jsx(re,{completed:b,children:t.jsx(oe,{color:"inherit",onClick:()=>l(1),children:"Author and video data"})},1),t.jsx(re,{children:t.jsx(oe,{color:"inherit",onClick:()=>l(2),children:"Sync lyrics to video"})},2),t.jsx(re,{children:t.jsx(oe,{color:"inherit",onClick:()=>l(3),children:"Fill song metadata"})},3)]})}),t.jsx(M,{item:!0,xs:12,children:t.jsxs("form",{onSubmit:async o=>{o.preventDefault(),i<E.length-1?l(y=>y+1):E.at(i)==="metadata"&&(x(!0),await W.store(f),await bt(f.id),x(!1),s("edit/list/",{id:f.id,created:a?null:"true",song:null}))},children:[E.at(i)==="basic-data"&&t.jsx(Pa,{shouldAutoImport:!b,isTxtRequired:!e,onAutoImport:S,onChange:g,data:c,finalSong:f}),E.at(i)==="author-and-video"&&t.jsx(ka,{songArtist:m==null?void 0:m.artist,songTitle:m==null?void 0:m.title,onChange:S,data:p}),m&&t.jsx(yn,{onChange:B,data:m,visible:E.at(i)==="sync"}),E.at(i)==="metadata"&&t.jsx(Fa,{videoGap:I==null?void 0:I.videoGap,onChange:v,data:d,songArtist:m==null?void 0:m.artist,songTitle:m==null?void 0:m.title,videoId:(m==null?void 0:m.video)??""}),k&&t.jsxs(Ft,{severity:"warning","data-test":"possible-duplicate",children:[t.jsx(zt,{children:"Possible duplicate"}),"There is already a song with similar artist and/or name:"," ",t.jsxs("b",{children:[k.artist," - ",k.title]})]}),t.jsxs(yt,{sx:{position:"fixed",bottom:0,left:"50%",width:"1260px",padding:1,transform:"translateX(-50%)",display:"flex",gap:2,justifyContent:"flex-end"},elevation:3,children:[t.jsx(w,{"data-test":"previous-button",sx:{align:"right"},onClick:()=>l(o=>o-1),disabled:i===0,children:"Previous"}),E.at(i)==="metadata"?t.jsx(w,{"data-test":"save-button",sx:{align:"right"},type:"submit",variant:"contained",disabled:u,children:u?"Saving...":"Save"}):t.jsx(w,{"data-test":"next-button",sx:{align:"right"},variant:"contained",type:"submit",disabled:!L||i===E.length-1,children:"Next"})]})]})})]})]})}const Sn=ue(t.jsx("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download"),jn=ue(t.jsx("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility");function In(){Fe(!1),ze(!1);const{data:e,reload:a}=pe(!0),[n,s]=St(null),r=ge("created"),i=ge("id");return e?t.jsxs(t.Fragment,{children:[t.jsx(jt,{children:t.jsx("title",{children:"Song List | AllKaraoke.Party - Free Online Karaoke Party Game"})}),t.jsx(Ct,{children:t.jsxs(Cn,{children:[r&&t.jsx(kt,{id:i}),t.jsx(De,{}),t.jsxs(M,{container:!0,rowGap:2,children:[t.jsx(M,{item:!0,xs:3,display:"flex",alignItems:"center",justifyContent:"flex-start",children:t.jsx(ie,{to:"menu/",children:t.jsx(w,{"data-test":"main-menu-link",children:"Return to main menu"})})}),t.jsx(M,{item:!0,xs:6,display:"flex",alignItems:"center",justifyContent:"center",children:t.jsxs("h4",{children:[e.length," songs"]})}),t.jsx(M,{item:!0,xs:3,display:"flex",alignItems:"center",justifyContent:"flex-end",children:t.jsx(ie,{to:"convert/",children:t.jsx(w,{"data-test":"convert-song",variant:"contained",children:"Import UltraStar .TXT"})})}),t.jsx(M,{item:!0,xs:12,children:t.jsx(Dt,{globalFilter:i,data:e,renderRowActions:({row:l})=>t.jsxs(t.Fragment,{children:[t.jsx(ie,{to:wt("edit/song/",{song:l.original.id,id:null}),children:t.jsx(X,{title:"Edit the song","data-test":"edit-song","data-song":l.original.id,children:t.jsx(Vt,{})})}),t.jsx(X,{title:"Download .txt file",onClick:async()=>{const u=await W.get(l.original.id),x=Bt(u),c=document.createElement("a");c.href=`data:plain/text;charset=utf-8,${encodeURIComponent(x)}`,c.download=`${W.generateSongFile(u)}.txt`,document.body.appendChild(c),c.click(),document.body.removeChild(c)},"data-test":"download-song","data-song":l.original.id,children:t.jsx(Sn,{})}),!l.original.isDeleted&&t.jsx(X,{title:"Hide the song",onClick:async()=>{await W.softDeleteSong(l.original.id),a()},"data-test":"hide-song","data-song":l.original.id,children:t.jsx(jn,{})}),l.original.isDeleted&&t.jsx(X,{title:"Restore the song",onClick:async()=>{await W.restoreSong(l.original.id),a()},"data-test":"restore-song","data-song":l.original.id,children:t.jsx(Ot,{})}),t.jsx(X,{className:l.original.local?"":"cursor-default! opacity-50",title:"Delete the song",onClick:async()=>{global.confirm("Are you sure you want to delete this song?")&&(await W.deleteSong(l.original.id),n&&e.some(x=>x.id===l.original.id)&&Lt.capture("unshare-song",{songId:l.original.id}),a())},"data-test":"delete-song","data-song":l.original.id,children:t.jsx(It,{})})]})})}),n!==null&&t.jsx(M,{item:!0,xs:12,children:t.jsx(Wt,{control:t.jsx(Ht,{defaultChecked:!0,checked:n,onChange:l=>s(l.target.checked),"data-test":"share-songs-switch"}),label:"Share added songs (so they can be played by others)"})})]})]})})]}):t.jsx(t.Fragment,{children:"Loading"})}const Cn=z("div",{target:"e4idn2b0"})({name:"19rvb6v",styles:"margin:0 auto;height:100%;width:1260px;background:white;padding:60px 20px 0 20px"});export{Bn as Convert,In as SongList};
//# sourceMappingURL=SongManagement-CZgTx2Fl.js.map
