import{r as c,j as t,C as We,d as He,e as Ke,f as H,h as K,u as z,i as N,a as U,k as D,l as ie,m as _e,n as _,o as se,B as Re,p as $,q as B,t as qe,v as Ye,w as Pe,Y as $e,b as Ae,x as q,T as G,y as be,G as Ne,z as Ze,A as le,D as F,F as Je,E as Xe,H as Qe,I as et,J as Se,K as J,L as tt,M as at,N as nt,O as st,P as oe,Q as ot,R as rt,U as it,V as lt,W as dt,X as je,Z as ct,_ as ut,$ as pt,a0 as ht,a1 as xt,a2 as Ee,a3 as gt,a4 as Ue,a5 as he,S as V,g as mt,a6 as Ge,a7 as ne,a8 as ft,a9 as vt,aa as yt,ab as bt,ac as St,ad as jt,ae as Ct,af as Y,ag as kt,ah as wt,ai as Bt}from"./index-BKy_CZeZ.js";import{i as It,T as Fe,B as M,a as R,L as xe,g as Lt,l as ee,S as Ce,G as T,A as ce,F as Tt,I as Mt,b as Rt,M as ke,c as Pt,D as $t,d as At,e as Z,f as we,h as Nt,j as Et,k as Ut,m as Gt,n as Ft,E as zt,V as Dt,o as Vt,p as Ot}from"./SongsTable-D5mNbwO4.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},a=new e.Error().stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="17742fcd-73a8-45ab-80e0-6a88fad7f94d",e._sentryDebugIdIdentifier="sentry-dbid-17742fcd-73a8-45ab-80e0-6a88fad7f94d")}catch{}{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:allkaraoke-party-sentry-key":!0})}function Wt(e){return c.Children.toArray(e).filter(a=>c.isValidElement(a))}const Ht=(e,a)=>{const n=He(e);return n.sheet=new a({key:n.key,nonce:n.sheet.nonce,container:n.sheet.container,speedy:n.sheet.isSpeedy,prepend:n.sheet.prepend,insertionPoint:n.sheet.insertionPoint}),n};let ge;if(typeof document=="object"){let e=document.querySelector('[name="emotion-insertion-point"]');if(!e){e=document.createElement("meta"),e.setAttribute("name","emotion-insertion-point"),e.setAttribute("content","");const n=document.querySelector("head");n&&n.prepend(e)}class a extends Ke{insert(s,o){return this.key&&this.key.endsWith("global")&&(this.before=e),super.insert(s,o)}}ge=Ht({key:"css",insertionPoint:e},a)}function Kt(e){const{injectFirst:a,children:n}=e;return a&&ge?t.jsx(We,{value:ge,children:n}):n}const Q=c.createContext({}),de=c.createContext({});function _t(e){return H("MuiStep",e)}K("MuiStep",["root","horizontal","vertical","alternativeLabel","completed"]);const qt=e=>{const{classes:a,orientation:n,alternativeLabel:s,completed:o}=e;return D({root:["root",n,s&&"alternativeLabel",o&&"completed"]},_t,a)},Yt=N("div",{name:"MuiStep",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[a.root,a[n.orientation],n.alternativeLabel&&a.alternativeLabel,n.completed&&a.completed]}})({variants:[{props:{orientation:"horizontal"},style:{paddingLeft:8,paddingRight:8}},{props:{alternativeLabel:!0},style:{flex:1,position:"relative"}}]}),te=c.forwardRef(function(a,n){const s=z({props:a,name:"MuiStep"}),{active:o,children:r,className:i,component:p="div",completed:x,disabled:h,expanded:v=!1,index:u,last:d,...g}=s,{activeStep:k,connector:L,alternativeLabel:I,orientation:m,nonLinear:j}=c.useContext(Q);let[w=!1,C=!1,f=!1]=[o,x,h];k===u?w=o!==void 0?o:!0:!j&&k>u?C=x!==void 0?x:!0:!j&&k<u&&(f=h!==void 0?h:!0);const y=c.useMemo(()=>({index:u,last:d,expanded:v,icon:u+1,active:w,completed:C,disabled:f}),[u,d,v,w,C,f]),l={...s,active:w,orientation:m,alternativeLabel:I,completed:C,disabled:f,expanded:v,component:p},b=qt(l),P=t.jsxs(Yt,{as:p,className:U(b.root,i),ref:n,ownerState:l,...g,children:[L&&I&&u!==0?L:null,r]});return t.jsx(de.Provider,{value:y,children:L&&!I&&u!==0?t.jsxs(c.Fragment,{children:[L,P]}):P})}),Zt=ie(t.jsx("path",{d:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24zm-2 17l-5-5 1.4-1.4 3.6 3.6 7.6-7.6L19 8l-9 9z"}),"CheckCircle"),Jt=ie(t.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}),"Warning");function Xt(e){return H("MuiStepIcon",e)}const ue=K("MuiStepIcon",["root","active","completed","error","text"]);var Be;const Qt=e=>{const{classes:a,active:n,completed:s,error:o}=e;return D({root:["root",n&&"active",s&&"completed",o&&"error"],text:["text"]},Xt,a)},pe=N(_e,{name:"MuiStepIcon",slot:"Root",overridesResolver:(e,a)=>a.root})(_(({theme:e})=>({display:"block",transition:e.transitions.create("color",{duration:e.transitions.duration.shortest}),color:(e.vars||e).palette.text.disabled,[`&.${ue.completed}`]:{color:(e.vars||e).palette.primary.main},[`&.${ue.active}`]:{color:(e.vars||e).palette.primary.main},[`&.${ue.error}`]:{color:(e.vars||e).palette.error.main}}))),ea=N("text",{name:"MuiStepIcon",slot:"Text",overridesResolver:(e,a)=>a.text})(_(({theme:e})=>({fill:(e.vars||e).palette.primary.contrastText,fontSize:e.typography.caption.fontSize,fontFamily:e.typography.fontFamily}))),ta=c.forwardRef(function(a,n){const s=z({props:a,name:"MuiStepIcon"}),{active:o=!1,className:r,completed:i=!1,error:p=!1,icon:x,...h}=s,v={...s,active:o,completed:i,error:p},u=Qt(v);if(typeof x=="number"||typeof x=="string"){const d=U(r,u.root);return p?t.jsx(pe,{as:Jt,className:d,ref:n,ownerState:v,...h}):i?t.jsx(pe,{as:Zt,className:d,ref:n,ownerState:v,...h}):t.jsxs(pe,{className:d,ref:n,ownerState:v,...h,children:[Be||(Be=t.jsx("circle",{cx:"12",cy:"12",r:"12"})),t.jsx(ea,{className:u.text,x:"12",y:"12",textAnchor:"middle",dominantBaseline:"central",ownerState:v,children:x})]})}return x});function aa(e){return H("MuiStepLabel",e)}const O=K("MuiStepLabel",["root","horizontal","vertical","label","active","completed","error","disabled","iconContainer","alternativeLabel","labelContainer"]),na=e=>{const{classes:a,orientation:n,active:s,completed:o,error:r,disabled:i,alternativeLabel:p}=e;return D({root:["root",n,r&&"error",i&&"disabled",p&&"alternativeLabel"],label:["label",s&&"active",o&&"completed",r&&"error",i&&"disabled",p&&"alternativeLabel"],iconContainer:["iconContainer",s&&"active",o&&"completed",r&&"error",i&&"disabled",p&&"alternativeLabel"],labelContainer:["labelContainer",p&&"alternativeLabel"]},aa,a)},sa=N("span",{name:"MuiStepLabel",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[a.root,a[n.orientation]]}})({display:"flex",alignItems:"center",[`&.${O.alternativeLabel}`]:{flexDirection:"column"},[`&.${O.disabled}`]:{cursor:"default"},variants:[{props:{orientation:"vertical"},style:{textAlign:"left",padding:"8px 0"}}]}),oa=N("span",{name:"MuiStepLabel",slot:"Label",overridesResolver:(e,a)=>a.label})(_(({theme:e})=>({...e.typography.body2,display:"block",transition:e.transitions.create("color",{duration:e.transitions.duration.shortest}),[`&.${O.active}`]:{color:(e.vars||e).palette.text.primary,fontWeight:500},[`&.${O.completed}`]:{color:(e.vars||e).palette.text.primary,fontWeight:500},[`&.${O.alternativeLabel}`]:{marginTop:16},[`&.${O.error}`]:{color:(e.vars||e).palette.error.main}}))),ra=N("span",{name:"MuiStepLabel",slot:"IconContainer",overridesResolver:(e,a)=>a.iconContainer})({flexShrink:0,display:"flex",paddingRight:8,[`&.${O.alternativeLabel}`]:{paddingRight:0}}),ia=N("span",{name:"MuiStepLabel",slot:"LabelContainer",overridesResolver:(e,a)=>a.labelContainer})(_(({theme:e})=>({width:"100%",color:(e.vars||e).palette.text.secondary,[`&.${O.alternativeLabel}`]:{textAlign:"center"}}))),ze=c.forwardRef(function(a,n){const s=z({props:a,name:"MuiStepLabel"}),{children:o,className:r,componentsProps:i={},error:p=!1,icon:x,optional:h,slots:v={},slotProps:u={},StepIconComponent:d,StepIconProps:g,...k}=s,{alternativeLabel:L,orientation:I}=c.useContext(Q),{active:m,disabled:j,completed:w,icon:C}=c.useContext(de),f=x||C;let y=d;f&&!y&&(y=ta);const l={...s,active:m,alternativeLabel:L,completed:w,disabled:j,error:p,orientation:I},b=na(l),P={slots:v,slotProps:{stepIcon:g,...i,...u}},[A,ve]=se("label",{elementType:oa,externalForwardedProps:P,ownerState:l}),[ye,Oe]=se("stepIcon",{elementType:y,externalForwardedProps:P,ownerState:l});return t.jsxs(sa,{className:U(b.root,r),ref:n,ownerState:l,...k,children:[f||ye?t.jsx(ra,{className:b.iconContainer,ownerState:l,children:t.jsx(ye,{completed:w,active:m,error:p,icon:f,...Oe})}):null,t.jsxs(ia,{className:b.labelContainer,ownerState:l,children:[o?t.jsx(A,{...ve,className:U(b.label,ve?.className),children:o}):null,h]})]})});ze.muiName="StepLabel";function la(e){return H("MuiStepButton",e)}const Ie=K("MuiStepButton",["root","horizontal","vertical","touchRipple"]),da=e=>{const{classes:a,orientation:n}=e;return D({root:["root",n],touchRipple:["touchRipple"]},la,a)},ca=N(Re,{name:"MuiStepButton",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[{[`& .${Ie.touchRipple}`]:a.touchRipple},a.root,a[n.orientation]]}})({width:"100%",padding:"24px 16px",margin:"-24px -16px",boxSizing:"content-box",[`& .${Ie.touchRipple}`]:{color:"rgba(0, 0, 0, 0.3)"},variants:[{props:{orientation:"vertical"},style:{justifyContent:"flex-start",padding:"8px",margin:"-8px"}}]}),ae=c.forwardRef(function(a,n){const s=z({props:a,name:"MuiStepButton"}),{children:o,className:r,icon:i,optional:p,...x}=s,{disabled:h,active:v}=c.useContext(de),{orientation:u}=c.useContext(Q),d={...s,orientation:u},g=da(d),k={icon:i,optional:p},L=It(o,["StepLabel"])?c.cloneElement(o,k):t.jsx(ze,{...k,children:o});return t.jsx(ca,{focusRipple:!0,disabled:h,TouchRippleProps:{className:g.touchRipple},className:U(g.root,r),ref:n,ownerState:d,"aria-current":v?"step":void 0,...x,children:L})});function ua(e){return H("MuiStepper",e)}K("MuiStepper",["root","horizontal","vertical","nonLinear","alternativeLabel"]);function pa(e){return H("MuiStepConnector",e)}K("MuiStepConnector",["root","horizontal","vertical","alternativeLabel","active","completed","disabled","line","lineHorizontal","lineVertical"]);const ha=e=>{const{classes:a,orientation:n,alternativeLabel:s,active:o,completed:r,disabled:i}=e,p={root:["root",n,s&&"alternativeLabel",o&&"active",r&&"completed",i&&"disabled"],line:["line",`line${$(n)}`]};return D(p,pa,a)},xa=N("div",{name:"MuiStepConnector",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[a.root,a[n.orientation],n.alternativeLabel&&a.alternativeLabel,n.completed&&a.completed]}})({flex:"1 1 auto",variants:[{props:{orientation:"vertical"},style:{marginLeft:12}},{props:{alternativeLabel:!0},style:{position:"absolute",top:12,left:"calc(-50% + 20px)",right:"calc(50% + 20px)"}}]}),ga=N("span",{name:"MuiStepConnector",slot:"Line",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[a.line,a[`line${$(n.orientation)}`]]}})(_(({theme:e})=>{const a=e.palette.mode==="light"?e.palette.grey[400]:e.palette.grey[600];return{display:"block",borderColor:e.vars?e.vars.palette.StepConnector.border:a,variants:[{props:{orientation:"horizontal"},style:{borderTopStyle:"solid",borderTopWidth:1}},{props:{orientation:"vertical"},style:{borderLeftStyle:"solid",borderLeftWidth:1,minHeight:24}}]}})),ma=c.forwardRef(function(a,n){const s=z({props:a,name:"MuiStepConnector"}),{className:o,...r}=s,{alternativeLabel:i,orientation:p="horizontal"}=c.useContext(Q),{active:x,disabled:h,completed:v}=c.useContext(de),u={...s,alternativeLabel:i,orientation:p,active:x,completed:v,disabled:h},d=ha(u);return t.jsx(xa,{className:U(d.root,o),ref:n,ownerState:u,...r,children:t.jsx(ga,{className:d.line,ownerState:u})})}),fa=e=>{const{orientation:a,nonLinear:n,alternativeLabel:s,classes:o}=e;return D({root:["root",a,n&&"nonLinear",s&&"alternativeLabel"]},ua,o)},va=N("div",{name:"MuiStepper",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[a.root,a[n.orientation],n.alternativeLabel&&a.alternativeLabel,n.nonLinear&&a.nonLinear]}})({display:"flex",variants:[{props:{orientation:"horizontal"},style:{flexDirection:"row",alignItems:"center"}},{props:{orientation:"vertical"},style:{flexDirection:"column"}},{props:{alternativeLabel:!0},style:{alignItems:"flex-start"}}]}),ya=t.jsx(ma,{}),ba=c.forwardRef(function(a,n){const s=z({props:a,name:"MuiStepper"}),{activeStep:o=0,alternativeLabel:r=!1,children:i,className:p,component:x="div",connector:h=ya,nonLinear:v=!1,orientation:u="horizontal",...d}=s,g={...s,nonLinear:v,alternativeLabel:r,orientation:u,component:x},k=fa(g),L=c.Children.toArray(i).filter(Boolean),I=L.map((j,w)=>c.cloneElement(j,{index:w,last:w+1===L.length,...j.props})),m=c.useMemo(()=>({activeStep:o,alternativeLabel:r,connector:h,nonLinear:v,orientation:u}),[o,r,h,v,u]);return t.jsx(Q.Provider,{value:m,children:t.jsx(va,{as:x,ownerState:g,className:U(k.root,p),ref:n,...d,children:I})})});function Sa(e){const a=new URL(global.location?.href);Object.entries(e).forEach(([n,s])=>{s===null?a.searchParams.delete(n):a.searchParams.set(n,s)}),global.history.replaceState(null,"",a.toString())}const re=Ye.span`font-mono`,me=(e,a,n="Lookup")=>({InputProps:{endAdornment:t.jsx(Fe,{title:a?"Open search results for the song":"Artist or title of the song is unknown",children:t.jsx("span",{children:t.jsx(B,{sx:{mr:-1},endIcon:t.jsx(qe,{}),color:"secondary",variant:"text",onClick:e,disabled:!a,children:n})})})}});function ja(e){const a=()=>{global.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(e?.songArtist+" "+e?.songTitle)}`,"_blank")},n=!!e.songTitle&&!!e.songArtist,s=Pe(e.data.video);return t.jsxs(M,{sx:{display:"flex",flexWrap:"wrap"},"data-test":"author-and-vid",children:[t.jsx(R,{"data-test":"author-name",sx:{mt:2},value:e.data.author,onChange:o=>e.onChange({...e.data,author:o.target.value}),label:"Author name (optional)",fullWidth:!0,size:"small",helperText:"Nickname of the person that created the .txt file."}),t.jsx(R,{"data-test":"author-url",sx:{mt:2},value:e.data.authorUrl,onChange:o=>e.onChange({...e.data,authorUrl:o.target.value}),label:"Author URL (optional)",helperText:"Link to authors page/profile.",fullWidth:!0,size:"small"}),t.jsx(M,{sx:{display:"flex",flexDirection:"row",mt:2,alignItems:"center",width:"100%"},children:t.jsx(R,{"data-test":"video-url",required:!0,value:e.data.video,onChange:o=>e.onChange({...e.data,video:o.target.value}),label:"YouTube Video URL",placeholder:"https://www.youtube.com/watch?v=",fullWidth:!0,size:"small",helperText:"Link to YouTube video, eg https://www.youtube.com/watch?v=xxxxxxxxx. Click the 'Lookup' button to look for it on YouTube",name:"videoUrl",...me(a,n)})}),s&&t.jsx(M,{children:t.jsx($e,{videoId:s})})]})}const Ca={polish:{Ãˆ:"Ã©",Ã­:"'","Â¥":"'","Â¯":"Å»","Â¹":"Ä…",Ï€:"Ä…",Ãª:"Ä™",Ã:"Ä™",Å’:"Åš",Ã¥:"Åš",Å“:"Å›",Ãº:"Å›",Ã¦:"Ä‡",ÃŠ:"Ä‡","Â¿":"Å¼",Ã¸:"Å¼",Ã˜:"Å»",Ã±:"Å„",Ã’:"Å„","Â³":"Å‚","â‰¥":"Å‚","Â£":"Å",Ã›:"Ã³",Ã¼:"Åº",Å¸:"Åº"},spanish:{Ã¸:"Â¿",Ãˆ:"Ã©",ÃŒ:"Ã­",Ã’:"Ã±",Å„:"Ã±","Â·":"Ã¡",Ã›:"Ã³","Â°":"!","Ë™":"Ãº",Å›:"Ãº"}};function ka(e,a){const n=Ca[a];if(n===void 0)return e;let s=e;for(const[o,r]of Object.entries(n))s=s.replaceAll(o,r);return s}function wa(e){const a=e.split(`
`),n=["#TITLE","#ARTIST","#BPM"];for(const s of n)if(!a.some(o=>o.startsWith(s)))return!1;if(!a.some(s=>s.startsWith(":")))return!1;try{Ae(e)}catch(s){return console.log(s),!1}return!0}async function Ba(e){try{const a=new URL(e);if(a.host==="usdb.animux.de")return La(e,a);if(a.host==="ultrastar-es.org")return Ia(e)}catch(a){console.warn(a)}}async function Ia(e){const n=await(await fetch(`/proxy?url=${encodeURIComponent(e)}`)).text(),s=new DOMParser().parseFromString(n,"text/html"),r=`https://ultrastar-es.org/pl/canciones/descargar/txt/${s.querySelector("ul[data-id]")?.getAttribute("data-id")}`;global.location.href=r;const i=s.querySelector("#listado > ul > li > dl > dd:nth-child(6) > a")?.getAttribute("href"),p=s.querySelector("#listado > ul > li")?.getAttribute("data-id");return{authorUrl:i?"https://ultrastar-es.org"+i:"",author:s.querySelector("#listado > ul > li > dl > dd:nth-child(6)")?.textContent??"",video:p?"https://www.youtube.com/watch?v="+p:""}}async function La(e,a){const s=await(await fetch(`/proxy?url=${encodeURIComponent(e)}`)).text(),o=new DOMParser().parseFromString(s,"text/html"),r=o.querySelector('a[href^="?link=profil&id="]')?.textContent,i=o.querySelector('a[href^="?link=profil&id="]')?.getAttribute?.("href"),p=o.querySelector("#tablebg > tbody > tr:nth-child(3) > td > table:nth-child(2) > tbody > tr.list_head > td:nth-child(1)")?.textContent,x=o.querySelector("#tablebg > tbody > tr:nth-child(3) > td > table:nth-child(2) > tbody > tr.list_head > td:nth-child(2)")?.textContent;return global.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(p+" "+x)}`,"_blank"),global.open(`http://usdb.animux.de/index.php?link=gettxt&id=${a.searchParams.get("id")}`,"_blank"),{authorUrl:i?"http://usdb.animux.de/index.php"+i:"",author:r??"",video:""}}function Ta(e){const a=async r=>{if(e.onChange({...e.data,sourceUrl:r.target.value}),e.shouldAutoImport){const i=await Ba(r.target.value);i&&e.onAutoImport(i)}},n=r=>{e.onChange({...e.data,txtInput:ka(e.data.txtInput,r)})},o=!c.useMemo(()=>wa(e.data.txtInput),[e.data.txtInput])&&e.data.txtInput.length>0;return t.jsxs(M,{sx:{display:"flex",flexWrap:"wrap"},"data-test":"basic-data",children:[e.isTxtRequired&&t.jsxs("div",{children:[t.jsx("h4",{children:"Where to find songs?"}),t.jsxs("p",{children:["Any UltraStar compatible .txt file will do. You can find many already made songs on"," ",t.jsx("a",{href:"https://usdb.animux.de/",target:"_blank",rel:"noreferrer",children:"usdb.animux.de"})," or ",t.jsx("a",{href:"https://ultrastar-es.org/en",target:"_blank",rel:"noreferrer",children:"ultrastar-es.org"}),".",t.jsx("br",{}),t.jsx("br",{})]}),t.jsx("p",{children:"You don't need audio/video files, you'll be able to search for appropriate YouTube video and synchronise the lyrics to it in subsequent steps."})]}),t.jsx(R,{sx:{mt:2},value:e.data.sourceUrl,onChange:a,label:"Source URL (optional)",fullWidth:!0,size:"small","data-test":"source-url",helperText:"The link to the page from which the .TXT file was downloaded."}),e.isTxtRequired?t.jsxs(t.Fragment,{children:[t.jsx(R,{error:o,helperText:o?"This doesn't look like a valid UltraStar .TXT format":"",required:!0,sx:{mt:2},fullWidth:!0,size:"small",multiline:!0,label:"Song's UltraStar .TXT file contents",onChange:r=>e.onChange({...e.data,txtInput:r.target.value}),value:e.data.txtInput,maxRows:15,minRows:15,InputProps:{inputProps:{"data-test":"input-txt",sx:{fontFamily:"monospace"}}}}),t.jsxs(M,{sx:{display:"flex",gap:1,mt:1},children:[t.jsx(B,{onClick:()=>n("polish"),children:"Fix ðŸ‡µðŸ‡± Polish accents"}),t.jsx(B,{onClick:()=>n("spanish"),children:"Fix ðŸ‡ªðŸ‡¸ Spanish accents"})]})]}):t.jsx(M,{sx:{display:"flex",width:"100%",height:500,overflow:"auto"},children:e.finalSong?.tracks?.map((r,i)=>t.jsxs(M,{sx:{flex:1},children:[t.jsx("h4",{className:"py-3",children:r.name??`Track #${i+1}`}),r.sections.filter(q).map(p=>t.jsx("p",{children:p.notes.map(x=>x.lyrics).join("")},p.start))]},i))})]})}const Ma=e=>{const{classes:a,inset:n,primary:s,secondary:o,dense:r}=e;return D({root:["root",n&&"inset",r&&"dense",s&&o&&"multiline"],primary:["primary"],secondary:["secondary"]},Lt,a)},Ra=N("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[{[`& .${ee.primary}`]:a.primary},{[`& .${ee.secondary}`]:a.secondary},a.root,n.inset&&a.inset,n.primary&&n.secondary&&a.multiline,n.dense&&a.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${be.root}:where(& .${ee.primary})`]:{display:"block"},[`.${be.root}:where(& .${ee.secondary})`]:{display:"block"},variants:[{props:({ownerState:e})=>e.primary&&e.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:e})=>e.inset,style:{paddingLeft:56}}]}),Pa=c.forwardRef(function(a,n){const s=z({props:a,name:"MuiListItemText"}),{children:o,className:r,disableTypography:i=!1,inset:p=!1,primary:x,primaryTypographyProps:h,secondary:v,secondaryTypographyProps:u,slots:d={},slotProps:g={},...k}=s,{dense:L}=c.useContext(xe);let I=x??o,m=v;const j={...s,disableTypography:i,inset:p,primary:!!I,secondary:!!m,dense:L},w=Ma(j),C={slots:d,slotProps:{primary:h,secondary:u,...g}},[f,y]=se("primary",{className:w.primary,elementType:G,externalForwardedProps:C,ownerState:j}),[l,b]=se("secondary",{className:w.secondary,elementType:G,externalForwardedProps:C,ownerState:j});return I!=null&&I.type!==G&&!i&&(I=t.jsx(f,{variant:L?"body2":"body1",component:y?.variant?void 0:"span",...y,children:I})),m!=null&&m.type!==G&&!i&&(m=t.jsx(l,{variant:"body2",color:"textSecondary",...b,children:m})),t.jsxs(Ra,{className:U(w.root,r),ownerState:j,ref:n,...k,children:[I,m]})}),$a={AF:"Afghanistan",AX:"Ã…land Islands",AL:"Albania",DZ:"Algeria",AS:"American Samoa",AD:"Andorra",AO:"Angola",AI:"Anguilla",AQ:"Antarctica",AG:"Antigua and Barbuda",AR:"Argentina",AM:"Armenia",AW:"Aruba",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BS:"Bahamas",BH:"Bahrain",BD:"Bangladesh",BE:"Belgium",BZ:"Belize",BJ:"Benin",BM:"Bermuda",BT:"Bhutan",BO:"Bolivia",BA:"Bosnia and Herzegovina",BW:"Botswana",BV:"Bouvet Island",BR:"Brazil",IO:"British Indian Ocean Territory",BN:"Brunei Darussalam",BG:"Bulgaria",BF:"Burkina Faso",BI:"Burundi",KH:"Cambodia",CM:"Cameroon",CA:"Canada",CV:"Cape Verde",KY:"Cayman Islands",CF:"Central African Republic",TD:"Chad",CL:"Chile",CN:"China",CX:"Christmas Island",CC:"Cocos (Keeling) Islands",CO:"Colombia",KM:"Comoros",CG:"Congo",CD:"Congo",CK:"Cook Islands",CR:"Costa Rica",CI:"Cote D Ivoire",HR:"Croatia",CU:"Cuba",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",DJ:"Djibouti",DM:"Dominica",DO:"Dominican Republic",EC:"Ecuador",EG:"Egypt",SV:"El Salvador",GQ:"Equatorial Guinea",ER:"Eritrea",EE:"Estonia",ET:"Ethiopia",FK:"Falkland Islands (Malvinas)",FO:"Faroe Islands",FJ:"Fiji",FI:"Finland",FR:"France",GF:"French Guiana",PF:"French Polynesia",TF:"French Southern Territories",GA:"Gabon",GM:"Gambia",GE:"Georgia",DE:"Germany",GH:"Ghana",GI:"Gibraltar",GR:"Greece",GL:"Greenland",GD:"Grenada",GP:"Guadeloupe",GU:"Guam",GT:"Guatemala",GG:"Guernsey",GN:"Guinea",GW:"Guinea-Bissau",GY:"Guyana",HT:"Haiti",HM:"Heard Island and Mcdonald Islands",VA:"Holy See (Vatican City State)",HN:"Honduras",HK:"Hong Kong",HU:"Hungary",IS:"Iceland",IN:"India",ID:"Indonesia",IR:"Iran",IQ:"Iraq",IE:"Ireland",IM:"Isle of Man",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JE:"Jersey",JO:"Jordan",KZ:"Kazakhstan",KE:"Kenya",KI:"Kiribati",KP:"South Korea",KR:"North Korea",KW:"Kuwait",KG:"Kyrgyzstan",LA:"Lao People Democratic Republic",LV:"Latvia",LB:"Lebanon",LS:"Lesotho",LR:"Liberia",LY:"Libyan Arab Jamahiriya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MK:"Macedonia",MG:"Madagascar",MW:"Malawi",MY:"Malaysia",MV:"Maldives",ML:"Mali",MT:"Malta",MH:"Marshall Islands",MQ:"Martinique",MR:"Mauritania",MU:"Mauritius",YT:"Mayotte",MX:"Mexico",FM:"Micronesia",MD:"Moldova",MC:"Monaco",MN:"Mongolia",MS:"Montserrat",MA:"Morocco",MZ:"Mozambique",MM:"Myanmar",NA:"Namibia",NR:"Nauru",NP:"Nepal",NL:"Netherlands",AN:"Netherlands Antilles",NC:"New Caledonia",NZ:"New Zealand",NI:"Nicaragua",NE:"Niger",NG:"Nigeria",NU:"Niue",NF:"Norfolk Island",MP:"Northern Mariana Islands",NO:"Norway",OM:"Oman",PK:"Pakistan",PW:"Palau",PS:"Palestinian Territory",PA:"Panama",PG:"Papua New Guinea",PY:"Paraguay",PE:"Peru",PH:"Philippines",PN:"Pitcairn",PL:"Poland",PT:"Portugal",PR:"Puerto Rico",QA:"Qatar",RE:"Reunion",RO:"Romania",RU:"Russian Federation",RW:"Rwanda",SH:"Saint Helena",KN:"Saint Kitts and Nevis",LC:"Saint Lucia",PM:"Saint Pierre and Miquelon",VC:"Saint Vincent and the Grenadines",WS:"Samoa",SM:"San Marino",ST:"Sao Tome and Principe",SA:"Saudi Arabia",SN:"Senegal",CS:"Serbia and Montenegro",SC:"Seychelles",SL:"Sierra Leone",SG:"Singapore",SK:"Slovakia",SI:"Slovenia",SB:"Solomon Islands",SO:"Somalia",ZA:"South Africa",GS:"South Georgia and the South Sandwich Islands",ES:"Spain",LK:"Sri Lanka",SD:"Sudan",SR:"Suriname",SJ:"Svalbard and Jan Mayen",SZ:"Swaziland",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan",TJ:"Tajikistan",TZ:"Tanzania",TH:"Thailand",TL:"Timor-Leste",TG:"Togo",TK:"Tokelau",TO:"Tonga",TT:"Trinidad and Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",TC:"Turks and Caicos Islands",TV:"Tuvalu",UG:"Uganda",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",US:"United States",UY:"Uruguay",UZ:"Uzbekistan",VU:"Vanuatu",VE:"Venezuela",VN:"Vietnam",VI:"Virgin Islands",WF:"Wallis and Futuna",EH:"Western Sahara",YE:"Yemen",ZM:"Zambia",ZW:"Zimbabwe"},De=e=>{const a=Math.floor(e/1e3/60),n=Math.floor(e/1e3)-a*60,s=Math.floor(e%1e3);return t.jsxs(re,{children:[String(a).padStart(2,"0"),":",String(n).padStart(2,"0"),".",String(s).padStart(3,"0")]})},Aa=e=>"playVideo"in e?{play:()=>e.playVideo(),pause:()=>e.pauseVideo(),seekTo:a=>e.seekTo(a,!0),setPlaybackSpeed:a=>e.setPlaybackRate(a)}:e,X=(e,a)=>t.jsx(Fe,{title:"Click to play the moment just before this time",placement:"top",arrow:!0,children:t.jsx(B,{sx:{py:.15,mb:.5},variant:"contained",size:"small",disabled:!a,onClick:a?()=>{Ne.resetPlayerNotes(),Aa(a).seekTo((e??0)/1e3-.7)}:void 0,children:De(e??0)})}),Le=10;function Na({data:e,onChange:a,videoId:n,videoGap:s=0}){const o=c.useRef(null),r=c.useRef(null),[i,p]=c.useState(!1);c.useEffect(()=>{const j=setInterval(async()=>{if(!i)e.volume===0?(a({...e,volume:.5}),await o.current?.getInternalPlayer()?.setVolume(50)):await o.current?.getInternalPlayer()?.setVolume(e.volume*100),p(!0);else{const w=await o.current?.getInternalPlayer()?.getVolume();w!==void 0&&w!==e.volume*100&&a({...e,volume:w/100})}},500);return()=>{clearInterval(j)}},[i,e,a]);const[x,h]=c.useState(!1),[v,u]=c.useState(!1),d=async(j,w)=>{await o.current?.getInternalPlayer()?.setVolume(+w*100),a({...e,volume:+w})},g=e.previewStart??s+60,k=e.previewEnd??g+30,[L,I]=c.useState(null);c.useEffect(()=>{r.current&&(r.current.currentTime=35),o.current?.getInternalPlayer()?.getDuration().then(I)},[]);const m=o.current?.getInternalPlayer();return t.jsxs(M,{sx:{display:"flex",flexDirection:"column",width:"100%"},gap:1,children:[t.jsxs("h4",{children:["Set song preview (start: ",X(g*1e3,m),", end:"," ",X(k*1e3,m),")"]}),t.jsx(M,{sx:{display:"flex",gap:5},children:t.jsx(Ce,{"data-test":"song-preview",disabled:L===null,step:1,value:[g,k],max:(L??500)-Le,onChange:(j,w)=>{const[C,f]=w;f-C>Le&&a({...e,previewStart:C,previewEnd:f})}})}),t.jsx("h4",{children:"Adjust volume"}),t.jsxs(M,{sx:{display:"flex",gap:5},children:[t.jsxs(M,{sx:{display:"flex",flexDirection:"column",gap:1},children:[t.jsx("h5",{children:"Song"}),t.jsx($e,{videoId:n,ref:o,onPlay:()=>{h(!0),v&&(r.current?.pause(),setTimeout(()=>u(!0),200))},onPause:()=>{u(!1)}})]}),t.jsxs(M,{sx:{display:"flex",flexDirection:"column",gap:1},children:[t.jsx("h5",{children:"Reference sound"}),t.jsx("p",{children:"Use the slider below to make the video volume roughly the same as this music."}),t.jsx("br",{}),t.jsx("audio",{ref:r,controls:!0,src:Ze,loop:!0,onLoad:j=>j.currentTarget.currentTime=35,onPlay:j=>{j.currentTarget.volume=.5,u(!0),x&&(o.current?.getInternalPlayer()?.pauseVideo(),setTimeout(()=>h(!0),200))},onPause:()=>{u(!1),x&&o.current?.getInternalPlayer()?.playVideo()}})]})]}),t.jsxs("h5",{children:["Final Song Volume (",e.volume*100,")"]}),t.jsx(M,{children:t.jsx(Ce,{"data-test":"volume",min:.1,max:1,step:.01,"aria-label":"Volume",value:e.volume,onChange:d})})]})}const Ea=e=>{const a=le(!0);return c.useMemo(()=>{const n=a.data.filter(s=>s.artist===e).map(s=>s.artistOrigin).filter(Boolean).reduce((s,o)=>(s[o]?s[o]++:s[o]=1,s),{});return Object.entries(n).sort((s,o)=>o[1]-s[1])?.[0]?.[0]??""},[e,a.data])};function Ua(e){const a=le(!0),n=Ea(e.songArtist??"");c.useEffect(()=>{e.data.artistOrigin===void 0&&(console.log("props.data.artistOrigin",n),e.onChange({...e.data,artistOrigin:n}))},[n,e.data]);const s=c.useMemo(()=>[...new Set(a.data.map(({language:d})=>Array.isArray(d)?d:[d]).flat().filter(Boolean))],[a.data]),o=$a,r=c.useMemo(()=>[...new Set(a.data.map(d=>d.genre).filter(Boolean).map(d=>d.toLowerCase().replace(/\b\w/g,g=>g.toUpperCase().trim())))],[a.data]),i=c.useMemo(()=>[...new Set(a.data.map(d=>d.edition).filter(Boolean).map(d=>d.toLowerCase().replace(/\b\w/g,g=>g.toUpperCase().trim())))].sort(),[a.data]),p=d=>{global.open(`https://www.google.com/search?q=${encodeURIComponent(`${e.songArtist} ${e.songTitle} ${d}`)}`,"_blank")},x=!!e.songTitle&&!!e.songArtist,h=+(e.data?.realBpm??0)>200,[v,u]=c.useState(!1);return t.jsxs(T,{container:!0,spacing:2,"data-test":"song-metadata",children:[t.jsx(T,{item:!0,xs:6,children:t.jsx(R,{value:e.data.artist,onChange:d=>e.onChange({...e.data,artist:d.target.value}),label:"Song artist",size:"small","data-test":"song-artist",required:!0,fullWidth:!0})}),t.jsx(T,{item:!0,xs:6,children:t.jsx(R,{value:e.data.title,onChange:d=>e.onChange({...e.data,title:d.target.value}),label:"Song title",fullWidth:!0,size:"small",required:!0,"data-test":"song-title"})}),t.jsx(T,{item:!0,xs:3,children:t.jsx(ce,{onKeyDown:d=>{d.key==="Enter"&&d.preventDefault()},freeSolo:!0,disableClearable:!0,options:r,value:e.data.genre??"",onChange:(d,g)=>e.onChange({...e.data,genre:g}),renderInput:d=>t.jsx(R,{...d,onBlur:g=>e.onChange({...e.data,genre:g.target.value}),label:"Song genre (optional)",size:"small","data-test":"song-genre",fullWidth:!0})})}),t.jsx(T,{item:!0,xs:3,children:t.jsx(ce,{onKeyDown:d=>{d.key==="Enter"&&d.preventDefault()},freeSolo:!0,disableClearable:!0,options:i,value:e.data.edition??"",onChange:(d,g)=>e.onChange({...e.data,edition:g}),renderInput:d=>t.jsx(R,{...d,onBlur:g=>e.onChange({...e.data,edition:g.target.value}),label:"Song edition (optional)",size:"small","data-test":"song-edition",helperText:"Songs with the same theme, e.g. 'Christmas'",fullWidth:!0})})}),t.jsx(T,{item:!0,xs:3,children:t.jsx(ce,{onKeyDown:d=>{d.key==="Enter"&&d.preventDefault()},multiple:!0,freeSolo:!0,disableClearable:!0,options:s,value:typeof e.data.language=="string"?[e.data.language]:e.data.language,onChange:(d,g)=>{e.onChange({...e.data,language:g?g.filter(Boolean):e.data.language})},renderInput:d=>t.jsx(R,{...d,label:"Song language",fullWidth:!0,size:"small",required:!e.data.language?.length,"data-test":"song-language"})})}),t.jsx(T,{item:!0,xs:3,children:t.jsxs(Tt,{fullWidth:!0,children:[t.jsx(Mt,{id:"song-origin-select-label",size:"small",children:"Song/artist origin (optional)"}),t.jsxs(Rt,{"data-test":"artist-origin",size:"small",labelId:"song-origin-select-label",id:"song-origin-select",value:e.data.artistOrigin??"",label:"Song/artist origin (optional)",onChange:d=>e.onChange({...e.data,artistOrigin:d.target.value}),children:[t.jsx(ke,{value:"",children:"None"},"none"),Object.entries(o).map(([d,g])=>t.jsxs(ke,{value:d,children:[t.jsx(Ga,{isocode:d})," ",g]},d))]}),t.jsx(Pt,{children:"Used to show the flag on the list"})]})}),t.jsx(T,{item:!0,xs:6,children:t.jsx(R,{"data-test":"release-year",value:e.data.year,onChange:d=>e.onChange({...e.data,year:d.target.value}),label:"Release year",helperText:"The year the song was released. Click the 'Lookup' button to look for it on Google",fullWidth:!0,size:"small",required:!0,...me(()=>p("release year"),x)})}),t.jsx(T,{item:!0,xs:6,children:t.jsx(R,{"data-test":"song-bpm",value:e.data.realBpm,onChange:d=>e.onChange({...e.data,realBpm:d.target.value}),label:"Song (real) BPM",focused:h?!0:void 0,helperText:h?t.jsxs(t.Fragment,{children:["Usually songs don't have higher BPM than ",t.jsx("b",{children:"200"}),". Make sure the value is correct (you can still save the song)"]}):`The actual tempo of the song. Click the 'Lookup' button to look for it on Google. ${v?"If you can't find it, you can still save the song":""}`,color:h?"warning":void 0,fullWidth:!0,type:"number",size:"small",required:!v,...me(()=>{u(!0),p("tempo")},x)})}),t.jsx(T,{item:!0,xs:12}),t.jsx(T,{item:!0,xs:12,children:t.jsx(Na,{...e})})]})}const Ga=F(Je,{target:"e70j9sv0"})({name:"3kqygp",styles:"width:1em;margin-right:0.5em;display:inline-block"});var Fa=1,za=4;function Da(e){return Xe(e,Fa|za)}function Va(e){return H("MuiButtonGroup",e)}const S=K("MuiButtonGroup",["root","contained","outlined","text","disableElevation","disabled","firstButton","fullWidth","horizontal","vertical","colorPrimary","colorSecondary","grouped","groupedHorizontal","groupedVertical","groupedText","groupedTextHorizontal","groupedTextVertical","groupedTextPrimary","groupedTextSecondary","groupedOutlined","groupedOutlinedHorizontal","groupedOutlinedVertical","groupedOutlinedPrimary","groupedOutlinedSecondary","groupedContained","groupedContainedHorizontal","groupedContainedVertical","groupedContainedPrimary","groupedContainedSecondary","lastButton","middleButton"]),Oa=(e,a)=>{const{ownerState:n}=e;return[{[`& .${S.grouped}`]:a.grouped},{[`& .${S.grouped}`]:a[`grouped${$(n.orientation)}`]},{[`& .${S.grouped}`]:a[`grouped${$(n.variant)}`]},{[`& .${S.grouped}`]:a[`grouped${$(n.variant)}${$(n.orientation)}`]},{[`& .${S.grouped}`]:a[`grouped${$(n.variant)}${$(n.color)}`]},{[`& .${S.firstButton}`]:a.firstButton},{[`& .${S.lastButton}`]:a.lastButton},{[`& .${S.middleButton}`]:a.middleButton},a.root,a[n.variant],n.disableElevation===!0&&a.disableElevation,n.fullWidth&&a.fullWidth,n.orientation==="vertical"&&a.vertical]},Wa=e=>{const{classes:a,color:n,disabled:s,disableElevation:o,fullWidth:r,orientation:i,variant:p}=e,x={root:["root",p,i,r&&"fullWidth",o&&"disableElevation",`color${$(n)}`],grouped:["grouped",`grouped${$(i)}`,`grouped${$(p)}`,`grouped${$(p)}${$(i)}`,`grouped${$(p)}${$(n)}`,s&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return D(x,Va,a)},Ha=N("div",{name:"MuiButtonGroup",slot:"Root",overridesResolver:Oa})(_(({theme:e})=>({display:"inline-flex",borderRadius:(e.vars||e).shape.borderRadius,variants:[{props:{variant:"contained"},style:{boxShadow:(e.vars||e).shadows[2]}},{props:{disableElevation:!0},style:{boxShadow:"none"}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{orientation:"vertical"},style:{flexDirection:"column",[`& .${S.lastButton},& .${S.middleButton}`]:{borderTopRightRadius:0,borderTopLeftRadius:0},[`& .${S.firstButton},& .${S.middleButton}`]:{borderBottomRightRadius:0,borderBottomLeftRadius:0}}},{props:{orientation:"horizontal"},style:{[`& .${S.firstButton},& .${S.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${S.lastButton},& .${S.middleButton}`]:{borderTopLeftRadius:0,borderBottomLeftRadius:0}}},{props:{variant:"text",orientation:"horizontal"},style:{[`& .${S.firstButton},& .${S.middleButton}`]:{borderRight:e.vars?`1px solid rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${e.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${S.disabled}`]:{borderRight:`1px solid ${(e.vars||e).palette.action.disabled}`}}}},{props:{variant:"text",orientation:"vertical"},style:{[`& .${S.firstButton},& .${S.middleButton}`]:{borderBottom:e.vars?`1px solid rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${e.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${S.disabled}`]:{borderBottom:`1px solid ${(e.vars||e).palette.action.disabled}`}}}},...Object.entries(e.palette).filter(Se()).flatMap(([a])=>[{props:{variant:"text",color:a},style:{[`& .${S.firstButton},& .${S.middleButton}`]:{borderColor:e.vars?`rgba(${e.vars.palette[a].mainChannel} / 0.5)`:J(e.palette[a].main,.5)}}}]),{props:{variant:"outlined",orientation:"horizontal"},style:{[`& .${S.firstButton},& .${S.middleButton}`]:{borderRightColor:"transparent","&:hover":{borderRightColor:"currentColor"}},[`& .${S.lastButton},& .${S.middleButton}`]:{marginLeft:-1}}},{props:{variant:"outlined",orientation:"vertical"},style:{[`& .${S.firstButton},& .${S.middleButton}`]:{borderBottomColor:"transparent","&:hover":{borderBottomColor:"currentColor"}},[`& .${S.lastButton},& .${S.middleButton}`]:{marginTop:-1}}},{props:{variant:"contained",orientation:"horizontal"},style:{[`& .${S.firstButton},& .${S.middleButton}`]:{borderRight:`1px solid ${(e.vars||e).palette.grey[400]}`,[`&.${S.disabled}`]:{borderRight:`1px solid ${(e.vars||e).palette.action.disabled}`}}}},{props:{variant:"contained",orientation:"vertical"},style:{[`& .${S.firstButton},& .${S.middleButton}`]:{borderBottom:`1px solid ${(e.vars||e).palette.grey[400]}`,[`&.${S.disabled}`]:{borderBottom:`1px solid ${(e.vars||e).palette.action.disabled}`}}}},...Object.entries(e.palette).filter(Se(["dark"])).map(([a])=>({props:{variant:"contained",color:a},style:{[`& .${S.firstButton},& .${S.middleButton}`]:{borderColor:(e.vars||e).palette[a].dark}}}))],[`& .${S.grouped}`]:{minWidth:40,boxShadow:"none",props:{variant:"contained"},style:{"&:hover":{boxShadow:"none"}}}}))),W=c.forwardRef(function(a,n){const s=z({props:a,name:"MuiButtonGroup"}),{children:o,className:r,color:i="primary",component:p="div",disabled:x=!1,disableElevation:h=!1,disableFocusRipple:v=!1,disableRipple:u=!1,fullWidth:d=!1,orientation:g="horizontal",size:k="medium",variant:L="outlined",...I}=s,m={...s,color:i,component:p,disabled:x,disableElevation:h,disableFocusRipple:v,disableRipple:u,fullWidth:d,orientation:g,size:k,variant:L},j=Wa(m),w=c.useMemo(()=>({className:j.grouped,color:i,disabled:x,disableElevation:h,disableFocusRipple:v,disableRipple:u,fullWidth:d,size:k,variant:L}),[i,x,h,v,u,d,k,L,j.grouped]),C=Wt(o),f=C.length,y=l=>{const b=l===0,P=l===f-1;return b&&P?"":b?j.firstButton:P?j.lastButton:j.middleButton};return t.jsx(Ha,{as:p,role:"group",className:U(j.root,r),ref:n,ownerState:m,...I,children:t.jsx(Qe.Provider,{value:w,children:C.map((l,b)=>t.jsx(et.Provider,{value:y(b),children:l},b))})})});function Ka({player:e,currentTime:a,playbackSpeed:n,setPlaybackSpeed:s}){const o=r=>e.seekTo((a+r)/1e3);return t.jsxs(t.Fragment,{children:[t.jsxs(M,{children:[t.jsxs(G,{"data-test":"current-time",children:["Current time: ",De(a)," (",t.jsx(re,{children:Math.round(a)})," ms)"]}),t.jsxs(M,{sx:{display:"flex",gap:1},children:[t.jsxs(W,{variant:"contained",sx:{display:"flex",mt:1,flex:1},children:[t.jsx(B,{size:"small",sx:{flex:1,px:1},onClick:()=>o(-1e4),"data-test":"seek-10s",children:"-10"}),t.jsx(B,{size:"small",sx:{flex:1,px:1},onClick:()=>o(-5e3),"data-test":"seek-5s",children:"-5"}),t.jsx(B,{size:"small",sx:{flex:1,px:1},onClick:()=>o(-1e3),"data-test":"seek-1s",children:"-1"}),t.jsx(B,{size:"small",sx:{flex:1,px:1},onClick:()=>o(-500),"data-test":"seek-0.5s",children:"-0.5"})]}),t.jsx($t,{}),t.jsxs(W,{variant:"contained",sx:{display:"flex",mt:1,flex:1},children:[t.jsx(B,{size:"small",sx:{flex:1,px:1},onClick:()=>o(500),"data-test":"seek+0.5s",children:"+0.5"}),t.jsx(B,{size:"small",sx:{flex:1,px:1},onClick:()=>o(1e3),"data-test":"seek+1s",children:"+1"}),t.jsx(B,{size:"small",sx:{flex:1,px:1},onClick:()=>o(5e3),"data-test":"seek+5s",children:"+5"}),t.jsx(B,{size:"small",sx:{flex:1,px:1},onClick:()=>o(1e4),"data-test":"seek+10s",children:"+10"})]})]})]}),t.jsxs(M,{children:[t.jsxs(G,{children:["Playback speed: ",t.jsxs(re,{"data-test":"current-speed",children:[n*100,"%"]})]}),t.jsx(W,{variant:"contained",sx:{display:"flex",mt:1},children:[.25,.5,.75,1,1.25,1.5,2].map(r=>t.jsxs(B,{size:"small","data-test":`speed-${r}`,sx:{flex:1},onClick:()=>{s(r),e.setPlaybackSpeed(r)},disabled:n===r,children:[r*100,"%"]},r))})]})]})}const _a=(e,a)=>{const{ownerState:n}=e;return[a.root,n.dense&&a.dense,n.alignItems==="flex-start"&&a.alignItemsFlexStart,n.divider&&a.divider,!n.disableGutters&&a.gutters]},qa=e=>{const{alignItems:a,classes:n,dense:s,disabled:o,disableGutters:r,divider:i,selected:p}=e,h=D({root:["root",s&&"dense",!r&&"gutters",i&&"divider",o&&"disabled",a==="flex-start"&&"alignItemsFlexStart",p&&"selected"]},At,n);return{...n,...h}},Ya=N(Re,{shouldForwardProp:e=>nt(e)||e==="classes",name:"MuiListItemButton",slot:"Root",overridesResolver:_a})(_(({theme:e})=>({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${Z.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:J(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${Z.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:J(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}},[`&.${Z.selected}:hover`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:J(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:J(e.palette.primary.main,e.palette.action.selectedOpacity)}},[`&.${Z.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${Z.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},variants:[{props:({ownerState:a})=>a.divider,style:{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:"padding-box"}},{props:{alignItems:"flex-start"},style:{alignItems:"flex-start"}},{props:({ownerState:a})=>!a.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:a})=>a.dense,style:{paddingTop:4,paddingBottom:4}}]}))),Za=c.forwardRef(function(a,n){const s=z({props:a,name:"MuiListItemButton"}),{alignItems:o="center",autoFocus:r=!1,component:i="div",children:p,dense:x=!1,disableGutters:h=!1,divider:v=!1,focusVisibleClassName:u,selected:d=!1,className:g,...k}=s,L=c.useContext(xe),I=c.useMemo(()=>({dense:x||L.dense||!1,alignItems:o,disableGutters:h}),[o,L.dense,x,h]),m=c.useRef(null);tt(()=>{r&&m.current&&m.current.focus()},[r]);const j={...s,alignItems:o,dense:I.dense,disableGutters:h,divider:v,selected:d},w=qa(j),C=at(m,n);return t.jsx(xe.Provider,{value:I,children:t.jsx(Ya,{ref:C,href:k.href||k.to,component:(k.href||k.to)&&i==="div"?"button":i,focusVisibleClassName:U(w.focusVisible,u),ownerState:j,className:U(w.root,g),...k,classes:w,children:p})})});function Ja(e,a){const n=Math.floor(a);return c.useMemo(()=>e.findIndex((s,o)=>n<0?!0:n<s.start?!1:o===e.length-1||e[o+1].start>n),[n,e])}function Xa({song:e,currentTime:a,beatLength:n,player:s,onRecordChange:o,onLyricChange:r,playbackSpeed:i,onTrackNameChange:p,lyricChanges:x}){const[h,v]=c.useState(0),[u,d]=c.useState(-1),[g,k]=c.useState([]),L=st(a,n,e.gap),I=e.tracks[h].sections.filter(q),m=Ja(I,L),j=f=>{d(f),Ne.resetPlayerNotes();const y=ot(I[f])*n+e.gap;s.seekTo(y/1e3-.8*i)},w=()=>{k(f=>[...f,{type:"delete",section:u,track:h}]),u===I.length-1&&d(f=>f-1)},C=f=>{k(y=>{const l=y.at(-1);if(l&&l.type==="shift"&&l.track===h&&l.section===u){const b=[...y];return b.at(-1).shift=f,b}return[...y,{type:"shift",section:u,track:h,shift:f}]})};return c.useEffect(()=>{o(g)},[o,g]),t.jsxs(tn,{children:[t.jsxs(we,{direction:"row",children:[t.jsxs(G,{variant:"h6",mb:0,sx:{flex:1,display:"flex",alignItems:"center"},children:["Edit verses",e.tracks.length>1&&t.jsx(W,{variant:"contained",sx:{ml:2},size:"small",children:e.tracks.map((f,y)=>t.jsxs(B,{onClick:()=>v(y),disabled:h===y,"data-test":`track-${y+1}`,children:["Track ",y+1]},y))})]}),t.jsx(R,{label:"Track name",placeholder:"Set track name",sx:{flex:1},size:"small",value:e.tracks[h]?.name??"",onChange:f=>p(h,f.target.value),"data-test":"track-name"})]}),t.jsxs(we,{direction:"row",spacing:2,sx:{height:"400px",mt:3},children:[t.jsx(Nt,{sx:{overflowY:"auto"},children:I.map((f,y)=>t.jsx(Et,{disablePadding:!0,"data-test":`section-${y}`,sx:{maxWidth:250,overflowX:"hidden",textWrap:"ellipsis",whiteSpace:"nowrap"},children:t.jsx(Za,{onClick:()=>j(y),selected:u===y,children:t.jsx(Pa,{primaryTypographyProps:{fontWeight:y===m?"bold":"normal"},primary:q(f)?f.notes.map(l=>l.lyrics.replaceAll(" ","Â·")).join(""):"[pause]"})})},f.start))}),t.jsx(an,{children:u>-1&&t.jsxs(t.Fragment,{children:[u===0&&t.jsx("h3",{"data-test":"use-gap-info",children:"Use gap shift to change when this section starts"}),u>0&&t.jsx(t.Fragment,{children:t.jsx(R,{"data-test":"change-start-beat",size:"small",type:"number",onChange:f=>C(+f.target.value),value:oe([I[u]]),label:"Change start beat",InputProps:{inputProps:{step:1}},fullWidth:!0,sx:{mb:2},helperText:t.jsxs(t.Fragment,{children:["Timestamp:"," ",X(oe([I[u]])*n+e.gap,s)]})})}),t.jsx(nn,{children:I[u].notes.map((f,y)=>{const l=x[h]?.[u]?.[y]??f.lyrics;return t.jsx(sn,{style:{width:`${l.length}ch`},value:l,"data-test":`lyric-input-${y}`,onChange:b=>{r({section:u,track:h,noteIndex:y,newLyric:b.target.value})},onKeyDown:b=>{const P=b.target.selectionStart;if(b.key==="ArrowLeft"&&P===0){const A=b.target?.previousElementSibling;A&&(A.focus(),setTimeout(()=>A.setSelectionRange(A.value.length,A.value.length),10))}else if(b.key==="ArrowRight"&&P===b.target.value.length){const A=b.target?.nextElementSibling;A&&(A.focus(),setTimeout(()=>A.setSelectionRange(0,0),10))}}},y)})}),t.jsx(B,{variant:"contained",color:"error",onClick:w,fullWidth:!0,"data-test":"delete-section",children:"Delete section"})]})}),t.jsxs(Qa,{children:[t.jsx(M,{sx:{overflowY:"auto",maxHeight:"34rem"},"data-test":"change-list",children:g.map((f,y)=>{let l="",b=Te;return f.type==="delete"?(b=Te,l="Deleted"):f.type==="shift"&&(b=en,l=`Start -> ${f.shift}`),t.jsx(b,{children:t.jsxs("strong",{children:["Track: ",f.track+1,", Section: ",f.section+1,", ",l]})},y)})}),g.length>0&&t.jsx(B,{"data-test":"undo-change",variant:"contained",color:"warning",onClick:()=>k(f=>f.filter((y,l)=>l!==f.length-1)),fullWidth:!0,children:"Undo last change"})]})]})]})}const Qa=F("div",{target:"e18sxv6t7"})({name:"82a6rk",styles:"flex:1"}),Ve=F("div",{target:"e18sxv6t6"})({name:"m1a2da",styles:"padding:0.5rem"}),Te=F(Ve,{target:"e18sxv6t5"})({name:"hwfcu5",styles:"color:red"}),en=F(Ve,{target:"e18sxv6t4"})({name:"zzs6wi",styles:"color:#0059ff"}),tn=F("div",{target:"e18sxv6t3"})(""),an=F("div",{target:"e18sxv6t2"})({name:"82a6rk",styles:"flex:1"}),nn=F("div",{target:"e18sxv6t1"})({name:"1qhi3cl",styles:"display:flex;gap:0.25rem;column-gap:0;margin-bottom:1rem;align-items:center;flex-wrap:wrap"}),sn=F("input",{target:"e18sxv6t0"})({name:"1bv0k4z",styles:"font-family:monospace;background:#f6f6f6;width:3rem;padding:0.5rem 0.1rem;border:0;border-right:1px solid #ececec;text-decoration:underline;box-sizing:content-box;&:focus{background:#ececec;outline:none!important;}"});function on(e,a){const s=a.tracks[0].sections.filter(q).at(-1)?.notes.at(-1),o=e-a.gap,r=s.start+s.length;return Number((6e4/(o/r*a.bar)).toFixed(2))}function rn({current:e,onChange:a,song:n}){const s=Math.max(...n.tracks.map(p=>rt(p.sections))),o=it(s,n)+n.gap,[r,i]=c.useState(Math.round(o));return t.jsxs(M,{sx:{display:"flex",gap:2,mb:2},children:[t.jsx(R,{"data-test":"desired-end",size:"small",type:"number",value:r,onChange:p=>i(+p.target.value),label:"Desired last note end time (in milliseconds)",sx:{flex:1},helperText:r?t.jsxs(t.Fragment,{children:["Estimated proper Tempo (BPM) of the lyrics:"," ",t.jsx(re,{"data-test":"desired-bpm",children:on(r,n)})]}):" "}),t.jsx(R,{"data-test":"change-bpm",size:"small",type:"number",value:e,onChange:p=>a(+p.target.value),label:"Tempo (BPM) of the lyrics",sx:{flex:.5},helperText:" ",InputProps:{inputProps:{step:"0.1"}}})]})}function ln({current:e,onChange:a,player:n,finalGap:s}){return t.jsxs(M,{flex:"1",children:[t.jsxs(G,{children:["Lyrics Gap shift (final: ",X(s,n),")"]}),t.jsxs(M,{sx:{display:"flex",gap:1,mt:1},children:[t.jsxs(W,{sx:{flex:1},children:[t.jsx(B,{sx:{flex:1,px:1},onClick:()=>a(e-1e3),"data-test":"shift-gap-1s",children:"-1000"}),t.jsx(B,{sx:{flex:1,px:1},onClick:()=>a(e-500),"data-test":"shift-gap-0.5s",children:"-500"}),t.jsx(B,{sx:{flex:1,px:1},onClick:()=>a(e-50),"data-test":"shift-gap-0.05s",children:"-50"})]}),t.jsx(R,{sx:{py:0,flex:1},size:"small",type:"text",value:e,onChange:o=>a(+o.target.value),label:"Miliseconds","data-test":"shift-gap"}),t.jsxs(W,{sx:{flex:1},children:[t.jsx(B,{sx:{flex:1,px:1},onClick:()=>a(e+50),"data-test":"shift-gap+0.05s",children:"+50"}),t.jsx(B,{sx:{flex:1,px:1},onClick:()=>a(e+500),"data-test":"shift-gap+0.5s",children:"+500"}),t.jsx(B,{sx:{flex:1,px:1},onClick:()=>a(e+1e3),"data-test":"shift-gap+1s",children:"+1000"})]})]})]})}function dn({current:e,onChange:a,player:n,finalGap:s}){return t.jsxs(M,{flex:"1",children:[t.jsxs(G,{children:["Video Gap shift (final: ",X((s??0)*1e3,n),")"]}),t.jsxs(M,{sx:{display:"flex",gap:1,mt:1},children:[t.jsxs(W,{sx:{flex:1},children:[t.jsx(B,{sx:{flex:1,px:1.25},onClick:()=>a(e-10),"data-test":"shift-video-gap-10s",children:"-10"}),t.jsx(B,{sx:{flex:1,px:1.25},onClick:()=>a(e-5),"data-test":"shift-video-gap-5s",children:"-5"}),t.jsx(B,{sx:{flex:1,px:1.25},onClick:()=>a(e-1),"data-test":"shift-video-gap-1s",children:"-1"})]}),t.jsx(R,{"data-test":"shift-video-gap",sx:{py:0,flex:1},size:"small",type:"text",value:e,onChange:o=>a(+o.target.value),label:"Seconds"}),t.jsxs(W,{sx:{flex:1},children:[t.jsx(B,{sx:{flex:1,px:1.25},onClick:()=>a(e+1),"data-test":"shift-video-gap+1s",children:"+1"}),t.jsx(B,{sx:{flex:1,px:1.25},onClick:()=>a(e+5),"data-test":"shift-video-gap+5s",children:"+5"}),t.jsx(B,{sx:{flex:1,px:1.25},onClick:()=>a(e+10),"data-test":"shift-video-gap+10s",children:"+10"})]})]})]})}const cn=(e,a)=>({...e,gap:e.gap+a}),un=(e,a)=>({...e,videoGap:(e.videoGap??0)+a}),pn=(e,a)=>({...e,bpm:a}),hn=(e,a)=>({...e,tracks:e.tracks.map((n,s)=>{const o=a.filter(i=>i.track===s);let r=[...n.sections].filter(q);return o.forEach(i=>{if(i.type==="delete")r=r.filter((p,x)=>x!==i.section);else if(i.type==="shift"){const p=i.shift-oe([r[i.section]]);r=r.map((x,h)=>h<i.section?x:{...x,notes:x.notes.map(v=>({...v,start:v.start+p}))})}}),{...n,sections:r}})}),xn=(e,a)=>({...e,tracks:e.tracks.map((n,s)=>({...n,name:a[s]??n.name}))}),gn=(e,a)=>({...e,tracks:e.tracks.map((n,s)=>{const o=a[s]??{};return{...n,sections:n.sections.map((r,i)=>{const p=o[i]??{};return q(r)?{...r,notes:r.notes.map((x,h)=>({...x,lyrics:p[h]??x.lyrics}))}:r})}})}),fe=824,Me=fe/16*9;function mn({song:e,onUpdate:a,visible:n}){const s=c.useRef(null),[o,r]=c.useState(0),[i,p]=c.useState(1),[x,h]=c.useState(0),[v,u]=c.useState(0),[d,g]=c.useState(e.bpm),[k,L]=c.useState([]),[I,m]=c.useState(e.tracks.map(l=>l.name??void 0)),[j,w]=c.useState({}),C=c.useMemo(()=>{let l=Da(e);return l=lt(l),l=dt(l),l=je(l),l=cn(l,x),l=un(l,v),l=pn(l,d),l=hn(l,k),l=xn(l,I),l=gn(l,j),l=je(l),l=ct(l),l},[x,v,e,d,k,I,j]);c.useEffect(()=>{a?.(C)},[a,C]);const f=c.useMemo(()=>({id:"test",mode:ut.DUEL,players:[{number:0,track:0},{number:1,track:e.tracks.length-1}],tolerance:6}),[e]),y=pt(C);return c.useEffect(()=>{n||s.current?.pause()},[n]),t.jsxs(T,{container:!0,spacing:2,sx:{display:n?void 0:"none"},children:[t.jsx(T,{item:!0,xs:8,"data-test":"player-container",children:t.jsx(M,{sx:{width:fe,height:Me},children:t.jsx(ht,{song:C,showControls:!0,autoplay:!1,width:fe,height:Me,ref:s,onCurrentTimeUpdate:r,effectsEnabled:!1,singSetup:f,onSongEnd:()=>{}},0)})}),t.jsxs(T,{item:!0,xs:4,sx:{display:"flex",flexDirection:"column",gap:2},children:[s.current&&t.jsxs(t.Fragment,{children:[t.jsx(Ka,{player:s.current,currentTime:o,playbackSpeed:i,setPlaybackSpeed:p}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx(B,{onClick:()=>{const l=oe(C.tracks[0].sections)*y+C.gap;s.current?.seekTo(l/1e3-.8*i)},children:"First section"}),t.jsx(B,{onClick:()=>{const l=(xt(C.tracks[0].sections)?.notes[0].start??0)*y+C.gap;s.current?.seekTo(l/1e3-.8*i)},children:"Last section"})]})]}),!s.current&&t.jsx("h2",{children:"Start the song to see the manipulation form"})]}),s.current&&t.jsxs(t.Fragment,{children:[t.jsx(T,{item:!0,xs:8,children:t.jsxs(M,{sx:{display:"flex",gap:5,flex:1},children:[t.jsx(dn,{player:s.current,onChange:l=>{const b=l-v;u(l),h(P=>P+b*1e3)},current:v,finalGap:C.videoGap}),t.jsx(ln,{player:s.current,onChange:h,current:x,finalGap:C.gap})]})}),t.jsxs(T,{item:!0,xs:4,children:[t.jsxs("div",{className:"mb-2 text-xs",children:["Use ",t.jsx("strong",{children:"Video shift gap"})," to crop the beginning of the video if it starts with an intro."]}),t.jsxs("div",{className:"mb-2 text-xs",children:["Use ",t.jsx("strong",{children:"Lyrics shift gap"})," to sync the start of the lyrics to the video. You can lower the"," ",t.jsx("strong",{children:"Playback speed"})," above to make sure you got it just right."," "]})]}),t.jsxs(T,{item:!0,xs:8,children:[t.jsx(G,{variant:"h5",mb:2,children:"Advanced"}),t.jsx(rn,{onChange:g,current:d,song:C},C.gap)]}),t.jsxs(T,{item:!0,xs:4,children:[t.jsx("div",{className:"mb-2 text-xs",children:"If the lyrics desynchronise over time, probably the tempo (BPM) of the lyrics is wrong."}),t.jsxs("div",{className:"mb-2 text-xs",children:["You can either use ",t.jsx("strong",{children:"Last note end time"})," - enter the millisecond when the last note should end (seek through the video for the moment as ",t.jsx("strong",{children:"Current time"})," panel show the exact millisecond) and a suggested BPM value will appear below."]}),t.jsxs("div",{className:"mb-2 text-xs",children:[t.jsx("strong",{children:"Tempo (BPM)"})," field allows to fine-tune the tempo."]})]}),t.jsx(T,{item:!0,xs:8,children:t.jsx(Xa,{playbackSpeed:i,song:C,currentTime:o,beatLength:y,player:s.current,onRecordChange:L,onTrackNameChange:(l,b)=>m(P=>{const A=[...P];return A[l]=b===""?void 0:b,A}),lyricChanges:j,onLyricChange:l=>w(b=>({...b,[l.track]:{...b[l.track],[l.section]:{...b[l.track]?.[l.section],[l.noteIndex]:l.newLyric}}}))})}),t.jsxs(T,{item:!0,xs:4,children:[t.jsxs("div",{className:"mb-2 text-xs",children:["If the lyrics there are more lyrics than in the video or there are longer/shorter interludes between verses, you can ",t.jsx("strong",{children:"Edit verses"}),"."]}),t.jsx("div",{className:"mb-2 text-xs",children:"Select a verse by clicking on it."}),t.jsxs("div",{className:"mb-2 text-xs",children:["You can either ",t.jsx("strong",{children:"Change its start beat"}),' (which will "move in time" the verse and all subsequent ones) or ',t.jsx("strong",{children:"Delete it"})," (it won't affect the timing of other verses). You can also edit the lyrics of each note."]}),t.jsxs("div",{className:"mb-2 text-xs",children:[t.jsx("strong",{children:"List of changes"})," on the right allows you to see and undo the actions one by one."]})]})]})]})}function fn(e){return t.jsx(M,{"data-test":"sync-lyrics",children:e.data&&e.data.video.length<15&&!!e.data.tracks?.[0]?.sections?.length&&t.jsx(mn,{song:e.data,onUpdate:e.onChange,visible:e.visible})})}function vn(e){return Array.isArray(e)?e.length===0:!e}const E=["basic-data","author-and-video","sync","metadata"];function kn({song:e}){const a=!!e,{data:n}=le(!0);Ee(!1);const s=gt();Ue(!1);const o=he("step"),[r,i]=c.useState(Math.max(0,E.indexOf(o))),[p,x]=c.useState(!1);c.useEffect(()=>{E[r]&&Sa({step:E[r]})},[r]);const[h,v]=c.useState({sourceUrl:e?.sourceUrl??"",txtInput:""}),[u,d]=c.useState({author:e?.author??"",authorUrl:e?.authorUrl??"",video:e?.video?`https://www.youtube.com/watch?v=${e.video}`:""}),[g,k]=c.useState({artist:e?.artist??"",title:e?.title??"",realBpm:e?.realBpm?String(e.realBpm):"",year:e?.year??"",language:e?.language??[],volume:e?.volume??0,previewStart:e?.previewStart??void 0,previewEnd:e?.previewEnd??void 0,genre:e?.genre,edition:e?.edition,artistOrigin:e?.artistOrigin}),[L,I]=c.useState(e),m=c.useMemo(()=>{try{return a?{...e,video:Pe(u.video)||e.video,author:u.author,authorUrl:u.authorUrl,sourceUrl:h.sourceUrl}:h.txtInput?Ae(h.txtInput,u.video,u.author,u.authorUrl,h.sourceUrl):void 0}catch(l){console.error(l)}},[h.txtInput,u.video,u.author,u.authorUrl,h.sourceUrl,e,a]),j=c.useMemo(()=>!a&&m&&n?.find(l=>V.generateSongFile(l)===V.generateSongFile(m)),[n,m,a]);c.useEffect(()=>{m&&(m.video&&!u.video&&d(l=>({...l,video:`https://www.youtube.com/watch?v=${m.video}`})),m.author&&!u.author&&d(l=>({...l,author:l.author||m?.author||"",authorUrl:l.authorUrl||m?.authorUrl||""})),m.sourceUrl&&!h.sourceUrl&&v(l=>({...l,sourceUrl:m.sourceUrl})),["year","language","realBpm","genre","artist","title","volume","previewStart","previewEnd","artistOrigin"].forEach(l=>{m[l]&&vn(g[l])&&k(b=>({...b,[l]:m[l]}))}))},[m,g.year,g.language,g.realBpm,g.genre,g.artist,g.volume,g.title,g.previewStart,g.previewEnd,h.sourceUrl,u.video]);const w=!!h.txtInput||a,C=!!u.video,f=E[r]==="author-and-video"?C:!0,y={...L,...g,author:u.author,authorUrl:u.authorUrl,realBpm:+g.realBpm,sourceUrl:h.sourceUrl,id:mt(g)};return t.jsxs(Kt,{injectFirst:!0,children:[t.jsx(Ge,{}),t.jsxs(T,{container:!0,gap:2,p:1,pb:10,children:[t.jsx(T,{item:!0,xs:12,children:!a&&t.jsx("div",{style:{marginBottom:"1rem"},children:t.jsx(ne,{to:"menu/",children:t.jsx("a",{children:"Return to the main menu"})})})}),t.jsx(T,{item:!0,xs:12,children:t.jsxs(ba,{activeStep:r,sx:{mb:2},nonLinear:a,children:[t.jsx(te,{completed:w,children:t.jsx(ae,{color:"inherit",onClick:()=>i(0),children:"Basic Info"})},0),t.jsx(te,{completed:C,children:t.jsx(ae,{color:"inherit",onClick:()=>i(1),children:"Author and video data"})},1),t.jsx(te,{children:t.jsx(ae,{color:"inherit",onClick:()=>i(2),children:"Sync lyrics to video"})},2),t.jsx(te,{children:t.jsx(ae,{color:"inherit",onClick:()=>i(3),children:"Fill song metadata"})},3)]})}),t.jsx(T,{item:!0,xs:12,children:t.jsxs("form",{onSubmit:async l=>{l.preventDefault(),r<E.length-1?i(b=>b+1):E.at(r)==="metadata"&&(x(!0),await V.store(y),await vt(y.id),x(!1),s("edit/list/",{id:y.id,created:a?null:"true",song:null}))},children:[E.at(r)==="basic-data"&&t.jsx(Ta,{shouldAutoImport:!C,isTxtRequired:!e,onAutoImport:d,onChange:v,data:h,finalSong:y}),E.at(r)==="author-and-video"&&t.jsx(ja,{songArtist:m?.artist,songTitle:m?.title,onChange:d,data:u}),m&&t.jsx(fn,{onChange:I,data:m,visible:E.at(r)==="sync"}),E.at(r)==="metadata"&&t.jsx(Ua,{videoGap:L?.videoGap,onChange:k,data:g,songArtist:m?.artist,songTitle:m?.title,videoId:m?.video??""}),j&&t.jsxs(Ut,{severity:"warning","data-test":"possible-duplicate",children:[t.jsx(Gt,{children:"Possible duplicate"}),"There is already a song with similar artist and/or name:"," ",t.jsxs("b",{children:[j.artist," - ",j.title]})]}),t.jsxs(ft,{sx:{position:"fixed",bottom:0,left:"50%",width:"1260px",padding:1,transform:"translateX(-50%)",display:"flex",gap:2,justifyContent:"flex-end"},elevation:3,children:[t.jsx(B,{"data-test":"previous-button",sx:{align:"right"},onClick:()=>i(l=>l-1),disabled:r===0,children:"Previous"}),E.at(r)==="metadata"?t.jsx(B,{"data-test":"save-button",sx:{align:"right"},type:"submit",variant:"contained",disabled:p,children:p?"Saving...":"Save"}):t.jsx(B,{"data-test":"next-button",sx:{align:"right"},variant:"contained",type:"submit",disabled:!f||r===E.length-1,children:"Next"})]})]})})]})]})}const yn=ie(t.jsx("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download"),bn=ie(t.jsx("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility");function wn(){Ee(!1),Ue(!1);const{data:e,reload:a}=le(!0),[n,s]=yt(null),o=he("created"),r=he("id");return e?t.jsxs(t.Fragment,{children:[t.jsx(bt,{children:t.jsx("title",{children:"Song List | AllKaraoke.Party - Free Online Karaoke Party Game"})}),t.jsx(St,{children:t.jsxs(Sn,{children:[o&&t.jsx(jt,{id:r}),t.jsx(Ge,{}),t.jsxs(T,{container:!0,rowGap:2,children:[t.jsx(T,{item:!0,xs:3,display:"flex",alignItems:"center",justifyContent:"flex-start",children:t.jsx(ne,{to:"menu/",children:t.jsx(B,{"data-test":"main-menu-link",children:"Return to main menu"})})}),t.jsx(T,{item:!0,xs:6,display:"flex",alignItems:"center",justifyContent:"center",children:t.jsxs("h4",{children:[e.length," songs"]})}),t.jsx(T,{item:!0,xs:3,display:"flex",alignItems:"center",justifyContent:"flex-end",children:t.jsx(ne,{to:"convert/",children:t.jsx(B,{"data-test":"convert-song",variant:"contained",children:"Import UltraStar .TXT"})})}),t.jsx(T,{item:!0,xs:12,children:t.jsx(Ft,{globalFilter:r,data:e,renderRowActions:({row:i})=>t.jsxs(t.Fragment,{children:[t.jsx(ne,{to:Ct("edit/song/",{song:i.original.id,id:null}),children:t.jsx(Y,{title:"Edit the song","data-test":"edit-song","data-song":i.original.id,children:t.jsx(zt,{})})}),t.jsx(Y,{title:"Download .txt file",onClick:async()=>{const p=await V.get(i.original.id),x=kt(p),h=document.createElement("a");h.href=`data:plain/text;charset=utf-8,${encodeURIComponent(x)}`,h.download=`${V.generateSongFile(p)}.txt`,document.body.appendChild(h),h.click(),document.body.removeChild(h)},"data-test":"download-song","data-song":i.original.id,children:t.jsx(yn,{})}),!i.original.isDeleted&&t.jsx(Y,{title:"Hide the song",onClick:async()=>{await V.softDeleteSong(i.original.id),a()},"data-test":"hide-song","data-song":i.original.id,children:t.jsx(bn,{})}),i.original.isDeleted&&t.jsx(Y,{title:"Restore the song",onClick:async()=>{await V.restoreSong(i.original.id),a()},"data-test":"restore-song","data-song":i.original.id,children:t.jsx(Dt,{})}),t.jsx(Y,{className:i.original.local?"":"cursor-default! opacity-50",title:"Delete the song",onClick:async()=>{global.confirm("Are you sure you want to delete this song?")&&(await V.deleteSong(i.original.id),n&&e.some(x=>x.id===i.original.id)&&Bt.capture("unshare-song",{songId:i.original.id}),a())},"data-test":"delete-song","data-song":i.original.id,children:t.jsx(wt,{})})]})})}),n!==null&&t.jsx(T,{item:!0,xs:12,children:t.jsx(Vt,{control:t.jsx(Ot,{defaultChecked:!0,checked:n,onChange:i=>s(i.target.checked),"data-test":"share-songs-switch"}),label:"Share added songs (so they can be played by others)"})})]})]})})]}):t.jsx(t.Fragment,{children:"Loading"})}const Sn=F("div",{target:"e4idn2b0"})({name:"19rvb6v",styles:"margin:0 auto;height:100%;width:1260px;background:white;padding:60px 20px 0 20px"});export{kn as Convert,wn as SongList};
//# sourceMappingURL=SongManagement-Cyi_i7BE.js.map
