(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`789183d9c87a0e307e853bd8bb3dd299f4f787d8`}}catch{}})(),function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];if(n!=null)for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e}({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:allkaraoke-party-sentry-key":!0})}catch{}}();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`4b4839a5-c066-4e31-9c4e-02d7f2c8b053`,e._sentryDebugIdIdentifier=`sentry-dbid-4b4839a5-c066-4e31-9c4e-02d7f2c8b053`)})()}catch{}import{An as e,Dn as t,On as n,Wn as r}from"./index-DZ8HZI8e.js";var i=`https://eu.posthog.com`,a=`281`,o=new Date(Date.now()-1e3*3600*24*28).toISOString(),s=[`(tv)`,`(album version)`,`(movie version)`,`[duet]`],c=t=>(s.forEach(e=>{t.title.toLowerCase().endsWith(e)&&(t.title=t.title.slice(0,-e.length))}),t.title=t.title.trim(),t.language=t.language.map(e=>e.toLowerCase().startsWith(`espa`)?`Spanish`:e.toLowerCase().endsWith(`(romanized)`)?e.slice(0,-11).trim():e.toLowerCase().endsWith(`(brazil)`)?`Portuguese`:e),t.artistOrigin=t.artistOrigin?.toLowerCase()===`kp`?`KR`:t.artistOrigin,t.lastUpdate=new Date().toISOString(),t.id=void 0,t.id=e(t),t);const l=async(e,t,r,s,l,u)=>{let d=await e(`${i}/api/projects/${a}/query`,{method:`post`,headers:{"Content-Type":`application/json`},body:JSON.stringify({query:{kind:`HogQLQuery`,query:`
            select events.properties.song, events.properties.songId, events.created_at
            from events
            where events.created_at > toDateTime('${u??o}')
              and event IN ('share-song', 'unshare-song') and events.properties.$user_id !='3ab0feed-e1d2-4ff0-8780-5db00698eb60'
            ORDER BY events.created_at ASC
            LIMIT 300
        `}})}),f=[];for(let[e,i,a]of d.results)try{!e&&i&&f.includes(i)&&(await l(i),console.log(`Deleting song ${i}`));let o=n(e.replaceAll(`\\n`,`
`).replaceAll(`\\"`,`"`));if(!o.id){console.log(`Song has no ID`,o);return}c(o),r.includes(o.id)?console.log(`Song ${o.id} already fetched`):(o.tracks[0]?.sections.length??0)<5?console.log(`Song ${o.id} seems to be broken, ${o.tracks[0]?.sections.length} sections found`):t.find(e=>e.id===o.id)?console.log(`Song ${o.id} already exists (by song id)`):t.find(e=>e.video===o.video)?console.log(`Song ${o.id} already exists (by video id)`):(o.lastUpdate=new Date().toISOString(),f.push(o.id),await s(o,a),console.log(`Added song ${o.id}`))}catch(t){console.warn(`Couldn't convert song ${e}`,t)}};var u=async()=>{let e=r.session.getItem(`posthog_key`)||prompt(`Enter PostHog PAT`);if(!e)return;r.session.setItem(`posthog_key`,e);let n=new Date;n.setDate(n.getDate()-10);let i=prompt(`Enter from`,r.local.getItem(`posthog_from`)||n.toISOString());if(i===null)return;i=new Date(i).toISOString();let a=async(t,n)=>{let r=await fetch(t,{...n,headers:{...n.headers,Authorization:`Bearer ${e}`}});if(!r.ok)throw Error(`Request failed with status ${r.status}`);return r.json()},o=r.local.getItem(`posthog_from`)?new Date(r.local.getItem(`posthog_from`)).getTime():0;await l(a,(await t.getIndex(!0)).filter(e=>!e.local),[],async(e,n)=>{await t.store(e,!1);let r=new Date(n).getTime();r>o&&(o=r)},async e=>t.deleteSong(e),i),r.local.setItem(`posthog_from`,new Date(o).toISOString())};export{u as default};
//# sourceMappingURL=importSongsFromPostHog-CtomHypk.js.map