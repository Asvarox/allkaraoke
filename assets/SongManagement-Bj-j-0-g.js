import{r as c,j as t,C as _e,d as qe,e as Ye,f as Y,h as Z,u as W,i as G,a as F,k as K,l as me,m as Ze,n as J,o as ue,B as Ee,p as E,q as k,t as Je,v as Qe,w as Ue,Y as Ge,G as ze,b as Fe,x as Q,y as De,T as D,z as Ie,A as Xe,D as ge,E as V,F as et,H as tt,I as at,J as nt,K as Le,L as ne,M as st,N as ot,O as rt,P as it,Q as pe,R as lt,U as ct,V as dt,W as ut,X as pt,Z as Me,_ as ht,$ as xt,a0 as mt,a1 as q,a2 as gt,a3 as ft,a4 as Ve,a5 as vt,a6 as Oe,a7 as he,S as O,g as bt,a8 as yt,a9 as We,aa as se,ab as St,ac as jt,ad as Ct,ae as wt,af as kt,ag as Bt,ah as te,ai as It,aj as Lt,ak as Mt}from"./index-Bfs-tJn_.js";import{i as Tt,T as we,B as P,a as $,L as Se,g as Rt,l as ie,S as Te,G as M,A as ve,F as Pt,I as Nt,b as $t,M as Re,c as At,D as Et,d as Ut,e as ae,f as Pe,h as Gt,j as zt,u as Ft,k as Dt,m as Vt,n as Ot,E as Wt,V as Kt,o as Ht,p as _t}from"./SongsTable-DljWQZ2c.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},a=new e.Error().stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="e55e984f-9e37-45b7-89c2-8617f54c8f16",e._sentryDebugIdIdentifier="sentry-dbid-e55e984f-9e37-45b7-89c2-8617f54c8f16")}catch{}{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:allkaraoke-party-sentry-key":!0})}function qt(e){return c.Children.toArray(e).filter(a=>c.isValidElement(a))}const Yt=(e,a)=>{const n=qe(e);return n.sheet=new a({key:n.key,nonce:n.sheet.nonce,container:n.sheet.container,speedy:n.sheet.isSpeedy,prepend:n.sheet.prepend,insertionPoint:n.sheet.insertionPoint}),n};let je;if(typeof document=="object"){let e=document.querySelector('[name="emotion-insertion-point"]');if(!e){e=document.createElement("meta"),e.setAttribute("name","emotion-insertion-point"),e.setAttribute("content","");const n=document.querySelector("head");n&&n.prepend(e)}class a extends Ye{insert(s,o){return this.key&&this.key.endsWith("global")&&(this.before=e),super.insert(s,o)}}je=Yt({key:"css",insertionPoint:e},a)}function Zt(e){const{injectFirst:a,children:n}=e;return a&&je?t.jsx(_e,{value:je,children:n}):n}const re=c.createContext({}),fe=c.createContext({});function Jt(e){return Y("MuiStep",e)}Z("MuiStep",["root","horizontal","vertical","alternativeLabel","completed"]);const Qt=e=>{const{classes:a,orientation:n,alternativeLabel:s,completed:o}=e;return K({root:["root",n,s&&"alternativeLabel",o&&"completed"]},Jt,a)},Xt=G("div",{name:"MuiStep",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[a.root,a[n.orientation],n.alternativeLabel&&a.alternativeLabel,n.completed&&a.completed]}})({variants:[{props:{orientation:"horizontal"},style:{paddingLeft:8,paddingRight:8}},{props:{alternativeLabel:!0},style:{flex:1,position:"relative"}}]}),le=c.forwardRef(function(a,n){const s=W({props:a,name:"MuiStep"}),{active:o,children:r,className:i,component:d="div",completed:p,disabled:u,expanded:v=!1,index:h,last:l,...b}=s,{activeStep:y,connector:w,alternativeLabel:B,orientation:L,nonLinear:x}=c.useContext(re);let[S=!1,R=!1,g=!1]=[o,p,u];y===h?S=o!==void 0?o:!0:!x&&y>h?R=p!==void 0?p:!0:!x&&y<h&&(g=u!==void 0?u:!0);const C=c.useMemo(()=>({index:h,last:l,expanded:v,icon:h+1,active:S,completed:R,disabled:g}),[h,l,v,S,R,g]),f={...s,active:S,orientation:L,alternativeLabel:B,completed:R,disabled:g,expanded:v,component:d},I=Qt(f),N=t.jsxs(Xt,{as:d,className:F(I.root,i),ref:n,ownerState:f,...b,children:[w&&B&&h!==0?w:null,r]});return t.jsx(fe.Provider,{value:C,children:w&&!B&&h!==0?t.jsxs(c.Fragment,{children:[w,N]}):N})}),ea=me(t.jsx("path",{d:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24zm-2 17l-5-5 1.4-1.4 3.6 3.6 7.6-7.6L19 8l-9 9z"}),"CheckCircle"),ta=me(t.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}),"Warning");function aa(e){return Y("MuiStepIcon",e)}const be=Z("MuiStepIcon",["root","active","completed","error","text"]);var Ne;const na=e=>{const{classes:a,active:n,completed:s,error:o}=e;return K({root:["root",n&&"active",s&&"completed",o&&"error"],text:["text"]},aa,a)},ye=G(Ze,{name:"MuiStepIcon",slot:"Root",overridesResolver:(e,a)=>a.root})(J(({theme:e})=>({display:"block",transition:e.transitions.create("color",{duration:e.transitions.duration.shortest}),color:(e.vars||e).palette.text.disabled,[`&.${be.completed}`]:{color:(e.vars||e).palette.primary.main},[`&.${be.active}`]:{color:(e.vars||e).palette.primary.main},[`&.${be.error}`]:{color:(e.vars||e).palette.error.main}}))),sa=G("text",{name:"MuiStepIcon",slot:"Text",overridesResolver:(e,a)=>a.text})(J(({theme:e})=>({fill:(e.vars||e).palette.primary.contrastText,fontSize:e.typography.caption.fontSize,fontFamily:e.typography.fontFamily}))),oa=c.forwardRef(function(a,n){const s=W({props:a,name:"MuiStepIcon"}),{active:o=!1,className:r,completed:i=!1,error:d=!1,icon:p,...u}=s,v={...s,active:o,completed:i,error:d},h=na(v);if(typeof p=="number"||typeof p=="string"){const l=F(r,h.root);return d?t.jsx(ye,{as:ta,className:l,ref:n,ownerState:v,...u}):i?t.jsx(ye,{as:ea,className:l,ref:n,ownerState:v,...u}):t.jsxs(ye,{className:l,ref:n,ownerState:v,...u,children:[Ne||(Ne=t.jsx("circle",{cx:"12",cy:"12",r:"12"})),t.jsx(sa,{className:h.text,x:"12",y:"12",textAnchor:"middle",dominantBaseline:"central",ownerState:v,children:p})]})}return p});function ra(e){return Y("MuiStepLabel",e)}const H=Z("MuiStepLabel",["root","horizontal","vertical","label","active","completed","error","disabled","iconContainer","alternativeLabel","labelContainer"]),ia=e=>{const{classes:a,orientation:n,active:s,completed:o,error:r,disabled:i,alternativeLabel:d}=e;return K({root:["root",n,r&&"error",i&&"disabled",d&&"alternativeLabel"],label:["label",s&&"active",o&&"completed",r&&"error",i&&"disabled",d&&"alternativeLabel"],iconContainer:["iconContainer",s&&"active",o&&"completed",r&&"error",i&&"disabled",d&&"alternativeLabel"],labelContainer:["labelContainer",d&&"alternativeLabel"]},ra,a)},la=G("span",{name:"MuiStepLabel",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[a.root,a[n.orientation]]}})({display:"flex",alignItems:"center",[`&.${H.alternativeLabel}`]:{flexDirection:"column"},[`&.${H.disabled}`]:{cursor:"default"},variants:[{props:{orientation:"vertical"},style:{textAlign:"left",padding:"8px 0"}}]}),ca=G("span",{name:"MuiStepLabel",slot:"Label",overridesResolver:(e,a)=>a.label})(J(({theme:e})=>({...e.typography.body2,display:"block",transition:e.transitions.create("color",{duration:e.transitions.duration.shortest}),[`&.${H.active}`]:{color:(e.vars||e).palette.text.primary,fontWeight:500},[`&.${H.completed}`]:{color:(e.vars||e).palette.text.primary,fontWeight:500},[`&.${H.alternativeLabel}`]:{marginTop:16},[`&.${H.error}`]:{color:(e.vars||e).palette.error.main}}))),da=G("span",{name:"MuiStepLabel",slot:"IconContainer",overridesResolver:(e,a)=>a.iconContainer})({flexShrink:0,display:"flex",paddingRight:8,[`&.${H.alternativeLabel}`]:{paddingRight:0}}),ua=G("span",{name:"MuiStepLabel",slot:"LabelContainer",overridesResolver:(e,a)=>a.labelContainer})(J(({theme:e})=>({width:"100%",color:(e.vars||e).palette.text.secondary,[`&.${H.alternativeLabel}`]:{textAlign:"center"}}))),Ke=c.forwardRef(function(a,n){const s=W({props:a,name:"MuiStepLabel"}),{children:o,className:r,componentsProps:i={},error:d=!1,icon:p,optional:u,slots:v={},slotProps:h={},StepIconComponent:l,StepIconProps:b,...y}=s,{alternativeLabel:w,orientation:B}=c.useContext(re),{active:L,disabled:x,completed:S,icon:R}=c.useContext(fe),g=p||R;let C=l;g&&!C&&(C=oa);const f={...s,active:L,alternativeLabel:w,completed:S,disabled:x,error:d,orientation:B},I=ia(f),N={slots:v,slotProps:{stepIcon:b,...i,...h}},[A,T]=ue("label",{elementType:ca,externalForwardedProps:N,ownerState:f}),[m,U]=ue("stepIcon",{elementType:C,externalForwardedProps:N,ownerState:f});return t.jsxs(la,{className:F(I.root,r),ref:n,ownerState:f,...y,children:[g||m?t.jsx(da,{className:I.iconContainer,ownerState:f,children:t.jsx(m,{completed:S,active:L,error:d,icon:g,...U})}):null,t.jsxs(ua,{className:I.labelContainer,ownerState:f,children:[o?t.jsx(A,{...T,className:F(I.label,T?.className),children:o}):null,u]})]})});Ke.muiName="StepLabel";function pa(e){return Y("MuiStepButton",e)}const $e=Z("MuiStepButton",["root","horizontal","vertical","touchRipple"]),ha=e=>{const{classes:a,orientation:n}=e;return K({root:["root",n],touchRipple:["touchRipple"]},pa,a)},xa=G(Ee,{name:"MuiStepButton",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[{[`& .${$e.touchRipple}`]:a.touchRipple},a.root,a[n.orientation]]}})({width:"100%",padding:"24px 16px",margin:"-24px -16px",boxSizing:"content-box",[`& .${$e.touchRipple}`]:{color:"rgba(0, 0, 0, 0.3)"},variants:[{props:{orientation:"vertical"},style:{justifyContent:"flex-start",padding:"8px",margin:"-8px"}}]}),ce=c.forwardRef(function(a,n){const s=W({props:a,name:"MuiStepButton"}),{children:o,className:r,icon:i,optional:d,...p}=s,{disabled:u,active:v}=c.useContext(fe),{orientation:h}=c.useContext(re),l={...s,orientation:h},b=ha(l),y={icon:i,optional:d},w=Tt(o,["StepLabel"])?c.cloneElement(o,y):t.jsx(Ke,{...y,children:o});return t.jsx(xa,{focusRipple:!0,disabled:u,TouchRippleProps:{className:b.touchRipple},className:F(b.root,r),ref:n,ownerState:l,"aria-current":v?"step":void 0,...p,children:w})});function ma(e){return Y("MuiStepper",e)}Z("MuiStepper",["root","horizontal","vertical","nonLinear","alternativeLabel"]);function ga(e){return Y("MuiStepConnector",e)}Z("MuiStepConnector",["root","horizontal","vertical","alternativeLabel","active","completed","disabled","line","lineHorizontal","lineVertical"]);const fa=e=>{const{classes:a,orientation:n,alternativeLabel:s,active:o,completed:r,disabled:i}=e,d={root:["root",n,s&&"alternativeLabel",o&&"active",r&&"completed",i&&"disabled"],line:["line",`line${E(n)}`]};return K(d,ga,a)},va=G("div",{name:"MuiStepConnector",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[a.root,a[n.orientation],n.alternativeLabel&&a.alternativeLabel,n.completed&&a.completed]}})({flex:"1 1 auto",variants:[{props:{orientation:"vertical"},style:{marginLeft:12}},{props:{alternativeLabel:!0},style:{position:"absolute",top:12,left:"calc(-50% + 20px)",right:"calc(50% + 20px)"}}]}),ba=G("span",{name:"MuiStepConnector",slot:"Line",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[a.line,a[`line${E(n.orientation)}`]]}})(J(({theme:e})=>{const a=e.palette.mode==="light"?e.palette.grey[400]:e.palette.grey[600];return{display:"block",borderColor:e.vars?e.vars.palette.StepConnector.border:a,variants:[{props:{orientation:"horizontal"},style:{borderTopStyle:"solid",borderTopWidth:1}},{props:{orientation:"vertical"},style:{borderLeftStyle:"solid",borderLeftWidth:1,minHeight:24}}]}})),ya=c.forwardRef(function(a,n){const s=W({props:a,name:"MuiStepConnector"}),{className:o,...r}=s,{alternativeLabel:i,orientation:d="horizontal"}=c.useContext(re),{active:p,disabled:u,completed:v}=c.useContext(fe),h={...s,alternativeLabel:i,orientation:d,active:p,completed:v,disabled:u},l=fa(h);return t.jsx(va,{className:F(l.root,o),ref:n,ownerState:h,...r,children:t.jsx(ba,{className:l.line,ownerState:h})})}),Sa=e=>{const{orientation:a,nonLinear:n,alternativeLabel:s,classes:o}=e;return K({root:["root",a,n&&"nonLinear",s&&"alternativeLabel"]},ma,o)},ja=G("div",{name:"MuiStepper",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[a.root,a[n.orientation],n.alternativeLabel&&a.alternativeLabel,n.nonLinear&&a.nonLinear]}})({display:"flex",variants:[{props:{orientation:"horizontal"},style:{flexDirection:"row",alignItems:"center"}},{props:{orientation:"vertical"},style:{flexDirection:"column"}},{props:{alternativeLabel:!0},style:{alignItems:"flex-start"}}]}),Ca=t.jsx(ya,{}),wa=c.forwardRef(function(a,n){const s=W({props:a,name:"MuiStepper"}),{activeStep:o=0,alternativeLabel:r=!1,children:i,className:d,component:p="div",connector:u=Ca,nonLinear:v=!1,orientation:h="horizontal",...l}=s,b={...s,nonLinear:v,alternativeLabel:r,orientation:h,component:p},y=Sa(b),w=c.Children.toArray(i).filter(Boolean),B=w.map((x,S)=>c.cloneElement(x,{index:S,last:S+1===w.length,...x.props})),L=c.useMemo(()=>({activeStep:o,alternativeLabel:r,connector:u,nonLinear:v,orientation:h}),[o,r,u,v,h]);return t.jsx(re.Provider,{value:L,children:t.jsx(ja,{as:p,ownerState:b,className:F(y.root,d),ref:n,...l,children:B})})});function ka(e){const a=new URL(global.location?.href);Object.entries(e).forEach(([n,s])=>{s===null?a.searchParams.delete(n):a.searchParams.set(n,s)}),global.history.replaceState(null,"",a.toString())}const xe=Qe.span`font-mono`,Ce=(e,a,n="Lookup")=>({InputProps:{endAdornment:t.jsx(we,{title:a?"Open search results for the song":"Artist or title of the song is unknown",children:t.jsx("span",{children:t.jsx(k,{sx:{mr:-1},endIcon:t.jsx(Je,{}),color:"secondary",variant:"text",onClick:e,disabled:!a,children:n})})})}});function Ba(e){const a=()=>{global.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(e?.songArtist+" "+e?.songTitle)}`,"_blank")},n=!!e.songTitle&&!!e.songArtist,s=Ue(e.data.video);return t.jsxs(P,{sx:{display:"flex",flexWrap:"wrap"},"data-test":"author-and-vid",children:[t.jsx($,{"data-test":"author-name",sx:{mt:2},value:e.data.author,onChange:o=>e.onChange({...e.data,author:o.target.value}),label:"Author name (optional)",fullWidth:!0,size:"small",helperText:"Nickname of the person that created the .txt file."}),t.jsx($,{"data-test":"author-url",sx:{mt:2},value:e.data.authorUrl,onChange:o=>e.onChange({...e.data,authorUrl:o.target.value}),label:"Author URL (optional)",helperText:"Link to authors page/profile.",fullWidth:!0,size:"small"}),t.jsx(P,{sx:{display:"flex",flexDirection:"row",mt:2,alignItems:"center",width:"100%"},children:t.jsx($,{"data-test":"video-url",required:!0,value:e.data.video,onChange:o=>e.onChange({...e.data,video:o.target.value}),label:"YouTube Video URL",placeholder:"https://www.youtube.com/watch?v=",fullWidth:!0,size:"small",helperText:"Link to YouTube video, eg https://www.youtube.com/watch?v=xxxxxxxxx. Click the 'Lookup' button to look for it on YouTube",name:"videoUrl",...Ce(a,n)})}),s&&t.jsx(P,{children:t.jsx(Ge,{videoId:s})})]})}async function Ia(e){try{const a=new URL(e);if(a.host==="usdb.animux.de")return Ma(e,a);if(a.host==="ultrastar-es.org")return La(e)}catch(a){console.warn(a)}}async function La(e){const n=await(await fetch(`/proxy?url=${encodeURIComponent(e)}`)).text(),s=new DOMParser().parseFromString(n,"text/html"),r=`https://ultrastar-es.org/pl/canciones/descargar/txt/${s.querySelector("ul[data-id]")?.getAttribute("data-id")}`;global.location.href=r;const i=s.querySelector("#listado > ul > li > dl > dd:nth-child(6) > a")?.getAttribute("href"),d=s.querySelector("#listado > ul > li")?.getAttribute("data-id");return{authorUrl:i?"https://ultrastar-es.org"+i:"",author:s.querySelector("#listado > ul > li > dl > dd:nth-child(6)")?.textContent??"",video:d?"https://www.youtube.com/watch?v="+d:""}}async function Ma(e,a){const s=await(await fetch(`/proxy?url=${encodeURIComponent(e)}`)).text(),o=new DOMParser().parseFromString(s,"text/html"),r=o.querySelector('a[href^="?link=profil&id="]')?.textContent,i=o.querySelector('a[href^="?link=profil&id="]')?.getAttribute?.("href"),d=o.querySelector("#tablebg > tbody > tr:nth-child(3) > td > table:nth-child(2) > tbody > tr.list_head > td:nth-child(1)")?.textContent,p=o.querySelector("#tablebg > tbody > tr:nth-child(3) > td > table:nth-child(2) > tbody > tr.list_head > td:nth-child(2)")?.textContent;return global.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(d+" "+p)}`,"_blank"),global.open(`http://usdb.animux.de/index.php?link=gettxt&id=${a.searchParams.get("id")}`,"_blank"),{authorUrl:i?"http://usdb.animux.de/index.php"+i:"",author:r??"",video:""}}const ke=e=>{const a=Math.floor(e/1e3/60),n=Math.floor(e/1e3)-a*60,s=Math.floor(e%1e3);return t.jsxs(xe,{children:[String(a).padStart(2,"0"),":",String(n).padStart(2,"0"),".",String(s).padStart(3,"0")]})},Ta=e=>"playVideo"in e?{play:()=>e.playVideo(),pause:()=>e.pauseVideo(),seekTo:a=>e.seekTo(a,!0),setPlaybackSpeed:a=>e.setPlaybackRate(a)}:e,oe=(e,a)=>t.jsx(we,{title:"Click to play the moment just before this time",placement:"top",arrow:!0,children:t.jsx(k,{sx:{py:.15,mb:.5},variant:"contained",size:"small",disabled:!a,onClick:a?()=>{ze.resetPlayerNotes(),Ta(a).seekTo((e??0)/1e3-.7)}:void 0,children:ke(e??0)})}),Ra={polish:{Ãˆ:"Ã©",Ã­:"'","Â¥":"'","Â¯":"Å»","Â¹":"Ä…",Ï€:"Ä…",Ãª:"Ä™",Ã:"Ä™",Å’:"Åš",Ã¥:"Åš",Å“:"Å›",Ãº:"Å›",Ã¦:"Ä‡",ÃŠ:"Ä‡","Â¿":"Å¼",Ã¸:"Å¼",Ã˜:"Å»",Ã±:"Å„",Ã’:"Å„","Â³":"Å‚","â‰¥":"Å‚","Â£":"Å",Ã›:"Ã³",Ã¼:"Åº",Å¸:"Åº"},spanish:{Ã¸:"Â¿",Ãˆ:"Ã©",ÃŒ:"Ã­",Ã’:"Ã±",Å„:"Ã±","Â·":"Ã¡",Ã›:"Ã³","Â°":"!","Ë™":"Ãº",Å›:"Ãº"}};function Pa(e,a){const n=Ra[a];if(n===void 0)return e;let s=e;for(const[o,r]of Object.entries(n))s=s.replaceAll(o,r);return s}function Na(e){const a=e.split(`
`),n=["#TITLE","#ARTIST","#BPM"];for(const s of n)if(!a.some(o=>o.startsWith(s)))return!1;if(!a.some(s=>s.startsWith(":")))return!1;try{Fe(e)}catch(s){return console.log(s),!1}return!0}function $a(e){const a=async r=>{if(e.onChange({...e.data,sourceUrl:r.target.value}),e.shouldAutoImport){const i=await Ia(r.target.value);i&&e.onAutoImport(i)}},n=r=>{e.onChange({...e.data,txtInput:Pa(e.data.txtInput,r)})},o=!c.useMemo(()=>Na(e.data.txtInput),[e.data.txtInput])&&e.data.txtInput.length>0;return t.jsxs(P,{sx:{display:"flex",flexWrap:"wrap"},"data-test":"basic-data",children:[e.isTxtRequired&&t.jsxs("div",{children:[t.jsx("h4",{children:"Where to find songs?"}),t.jsxs("p",{children:["Any UltraStar compatible .txt file will do. You can find many already made songs on"," ",t.jsx("a",{href:"https://usdb.animux.de/",target:"_blank",rel:"noreferrer",children:"usdb.animux.de"})," or ",t.jsx("a",{href:"https://ultrastar-es.org/en",target:"_blank",rel:"noreferrer",children:"ultrastar-es.org"}),".",t.jsx("br",{}),t.jsx("br",{})]}),t.jsx("p",{children:"You don't need audio/video files, you'll be able to search for appropriate YouTube video and synchronise the lyrics to it in subsequent steps."})]}),t.jsx($,{sx:{mt:2},value:e.data.sourceUrl,onChange:a,label:"Source URL (optional)",fullWidth:!0,size:"small","data-test":"source-url",helperText:"The link to the page from which the .TXT file was downloaded."}),e.isTxtRequired?t.jsxs(t.Fragment,{children:[t.jsx($,{error:o,helperText:o?"This doesn't look like a valid UltraStar .TXT format":"",required:!0,sx:{mt:2},fullWidth:!0,size:"small",multiline:!0,label:"Song's UltraStar .TXT file contents",onChange:r=>e.onChange({...e.data,txtInput:r.target.value}),value:e.data.txtInput,maxRows:15,minRows:15,InputProps:{inputProps:{"data-test":"input-txt",sx:{fontFamily:"monospace"}}}}),t.jsxs(P,{sx:{display:"flex",gap:1,mt:1},children:[t.jsx(k,{onClick:()=>n("polish"),children:"Fix ðŸ‡µðŸ‡± Polish accents"}),t.jsx(k,{onClick:()=>n("spanish"),children:"Fix ðŸ‡ªðŸ‡¸ Spanish accents"})]})]}):t.jsx("div",{className:"flex h-150 w-full gap-1 overflow-auto",children:e.finalSong?.tracks?.map((r,i)=>t.jsxs("div",{className:"flex flex-1 flex-col gap-1",children:[t.jsx("h4",{className:"py-3",children:r.name??`Track #${i+1}`}),r.sections.filter(Q).map(d=>t.jsxs("p",{children:[t.jsxs("span",{className:"text-[0.75rem]",children:[" [",ke(De(d,e.finalSong)),"]"]})," ",d.notes.map(p=>p.lyrics).join("")]},d.start))]},i))})]})}const Aa=e=>{const{classes:a,inset:n,primary:s,secondary:o,dense:r}=e;return K({root:["root",n&&"inset",r&&"dense",s&&o&&"multiline"],primary:["primary"],secondary:["secondary"]},Rt,a)},Ea=G("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[{[`& .${ie.primary}`]:a.primary},{[`& .${ie.secondary}`]:a.secondary},a.root,n.inset&&a.inset,n.primary&&n.secondary&&a.multiline,n.dense&&a.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${Ie.root}:where(& .${ie.primary})`]:{display:"block"},[`.${Ie.root}:where(& .${ie.secondary})`]:{display:"block"},variants:[{props:({ownerState:e})=>e.primary&&e.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:e})=>e.inset,style:{paddingLeft:56}}]}),Ua=c.forwardRef(function(a,n){const s=W({props:a,name:"MuiListItemText"}),{children:o,className:r,disableTypography:i=!1,inset:d=!1,primary:p,primaryTypographyProps:u,secondary:v,secondaryTypographyProps:h,slots:l={},slotProps:b={},...y}=s,{dense:w}=c.useContext(Se);let B=p??o,L=v;const x={...s,disableTypography:i,inset:d,primary:!!B,secondary:!!L,dense:w},S=Aa(x),R={slots:l,slotProps:{primary:u,secondary:h,...b}},[g,C]=ue("primary",{className:S.primary,elementType:D,externalForwardedProps:R,ownerState:x}),[f,I]=ue("secondary",{className:S.secondary,elementType:D,externalForwardedProps:R,ownerState:x});return B!=null&&B.type!==D&&!i&&(B=t.jsx(g,{variant:w?"body2":"body1",component:C?.variant?void 0:"span",...C,children:B})),L!=null&&L.type!==D&&!i&&(L=t.jsx(f,{variant:"body2",color:"textSecondary",...I,children:L})),t.jsxs(Ea,{className:F(S.root,r),ownerState:x,ref:n,...y,children:[B,L]})}),Ga={AF:"Afghanistan",AX:"Ã…land Islands",AL:"Albania",DZ:"Algeria",AS:"American Samoa",AD:"Andorra",AO:"Angola",AI:"Anguilla",AQ:"Antarctica",AG:"Antigua and Barbuda",AR:"Argentina",AM:"Armenia",AW:"Aruba",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BS:"Bahamas",BH:"Bahrain",BD:"Bangladesh",BE:"Belgium",BZ:"Belize",BJ:"Benin",BM:"Bermuda",BT:"Bhutan",BO:"Bolivia",BA:"Bosnia and Herzegovina",BW:"Botswana",BV:"Bouvet Island",BR:"Brazil",IO:"British Indian Ocean Territory",BN:"Brunei Darussalam",BG:"Bulgaria",BF:"Burkina Faso",BI:"Burundi",KH:"Cambodia",CM:"Cameroon",CA:"Canada",CV:"Cape Verde",KY:"Cayman Islands",CF:"Central African Republic",TD:"Chad",CL:"Chile",CN:"China",CX:"Christmas Island",CC:"Cocos (Keeling) Islands",CO:"Colombia",KM:"Comoros",CG:"Congo",CD:"Congo",CK:"Cook Islands",CR:"Costa Rica",CI:"Cote D Ivoire",HR:"Croatia",CU:"Cuba",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",DJ:"Djibouti",DM:"Dominica",DO:"Dominican Republic",EC:"Ecuador",EG:"Egypt",SV:"El Salvador",GQ:"Equatorial Guinea",ER:"Eritrea",EE:"Estonia",ET:"Ethiopia",FK:"Falkland Islands (Malvinas)",FO:"Faroe Islands",FJ:"Fiji",FI:"Finland",FR:"France",GF:"French Guiana",PF:"French Polynesia",TF:"French Southern Territories",GA:"Gabon",GM:"Gambia",GE:"Georgia",DE:"Germany",GH:"Ghana",GI:"Gibraltar",GR:"Greece",GL:"Greenland",GD:"Grenada",GP:"Guadeloupe",GU:"Guam",GT:"Guatemala",GG:"Guernsey",GN:"Guinea",GW:"Guinea-Bissau",GY:"Guyana",HT:"Haiti",HM:"Heard Island and Mcdonald Islands",VA:"Holy See (Vatican City State)",HN:"Honduras",HK:"Hong Kong",HU:"Hungary",IS:"Iceland",IN:"India",ID:"Indonesia",IR:"Iran",IQ:"Iraq",IE:"Ireland",IM:"Isle of Man",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JE:"Jersey",JO:"Jordan",KZ:"Kazakhstan",KE:"Kenya",KI:"Kiribati",KP:"South Korea",KR:"North Korea",KW:"Kuwait",KG:"Kyrgyzstan",LA:"Lao People Democratic Republic",LV:"Latvia",LB:"Lebanon",LS:"Lesotho",LR:"Liberia",LY:"Libyan Arab Jamahiriya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MK:"Macedonia",MG:"Madagascar",MW:"Malawi",MY:"Malaysia",MV:"Maldives",ML:"Mali",MT:"Malta",MH:"Marshall Islands",MQ:"Martinique",MR:"Mauritania",MU:"Mauritius",YT:"Mayotte",MX:"Mexico",FM:"Micronesia",MD:"Moldova",MC:"Monaco",MN:"Mongolia",MS:"Montserrat",MA:"Morocco",MZ:"Mozambique",MM:"Myanmar",NA:"Namibia",NR:"Nauru",NP:"Nepal",NL:"Netherlands",AN:"Netherlands Antilles",NC:"New Caledonia",NZ:"New Zealand",NI:"Nicaragua",NE:"Niger",NG:"Nigeria",NU:"Niue",NF:"Norfolk Island",MP:"Northern Mariana Islands",NO:"Norway",OM:"Oman",PK:"Pakistan",PW:"Palau",PS:"Palestinian Territory",PA:"Panama",PG:"Papua New Guinea",PY:"Paraguay",PE:"Peru",PH:"Philippines",PN:"Pitcairn",PL:"Poland",PT:"Portugal",PR:"Puerto Rico",QA:"Qatar",RE:"Reunion",RO:"Romania",RU:"Russian Federation",RW:"Rwanda",SH:"Saint Helena",KN:"Saint Kitts and Nevis",LC:"Saint Lucia",PM:"Saint Pierre and Miquelon",VC:"Saint Vincent and the Grenadines",WS:"Samoa",SM:"San Marino",ST:"Sao Tome and Principe",SA:"Saudi Arabia",SN:"Senegal",CS:"Serbia and Montenegro",SC:"Seychelles",SL:"Sierra Leone",SG:"Singapore",SK:"Slovakia",SI:"Slovenia",SB:"Solomon Islands",SO:"Somalia",ZA:"South Africa",GS:"South Georgia and the South Sandwich Islands",ES:"Spain",LK:"Sri Lanka",SD:"Sudan",SR:"Suriname",SJ:"Svalbard and Jan Mayen",SZ:"Swaziland",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan",TJ:"Tajikistan",TZ:"Tanzania",TH:"Thailand",TL:"Timor-Leste",TG:"Togo",TK:"Tokelau",TO:"Tonga",TT:"Trinidad and Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",TC:"Turks and Caicos Islands",TV:"Tuvalu",UG:"Uganda",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",US:"United States",UY:"Uruguay",UZ:"Uzbekistan",VU:"Vanuatu",VE:"Venezuela",VN:"Vietnam",VI:"Virgin Islands",WF:"Wallis and Futuna",EH:"Western Sahara",YE:"Yemen",ZM:"Zambia",ZW:"Zimbabwe"},de=10;function za({data:e,onChange:a,videoId:n,videoGap:s=0}){const o=c.useRef(null),r=c.useRef(null),[i,d]=c.useState(!1);c.useEffect(()=>{const x=setInterval(async()=>{if(!i)e.volume===0?(a({...e,volume:.7}),await o.current?.getInternalPlayer()?.setVolume(70)):await o.current?.getInternalPlayer()?.setVolume(e.volume*100),d(!0);else{const S=await o.current?.getInternalPlayer()?.getVolume();S!==void 0&&S!==e.volume*100&&a({...e,volume:S/100})}},500);return()=>{clearInterval(x)}},[i,e,a]);const[p,u]=c.useState(!1),[v,h]=c.useState(!1),l=async(x,S)=>{await o.current?.getInternalPlayer()?.setVolume(+S*100),a({...e,volume:+S})},b=e.previewStart??s+60,y=e.previewEnd??b+30,[w,B]=c.useState(null);c.useEffect(()=>{r.current&&(r.current.currentTime=35),o.current?.getInternalPlayer()?.getDuration().then(B)},[]),c.useEffect(()=>{if(w!==null&&w<y){const x=Math.max(w-s-de,0)/2,S=Math.max(s+x,0),R=Math.max(S+de,w);a({...e,previewStart:S,previewEnd:R})}},[w,e,y,a,s]);const L=o.current?.getInternalPlayer();return t.jsxs(P,{sx:{display:"flex",flexDirection:"column",width:"100%"},gap:1,children:[t.jsxs("h4",{children:["Set song preview (start: ",oe(b*1e3,L),", end:"," ",oe(y*1e3,L),")"]}),t.jsx(P,{sx:{display:"flex",gap:5},children:t.jsx(Te,{"data-test":"song-preview",disabled:w===null,step:1,value:[b,y],max:(w??500)-de,onChange:(x,S)=>{const[R,g]=S;g-R>de&&a({...e,previewStart:R,previewEnd:g})}})}),t.jsx("h4",{children:"Adjust volume"}),t.jsxs(P,{sx:{display:"flex",gap:5},children:[t.jsxs(P,{sx:{display:"flex",flexDirection:"column",gap:1},children:[t.jsx("h5",{children:"Song"}),t.jsx(Ge,{videoId:n,ref:o,onPlay:()=>{u(!0),v&&(r.current?.pause(),setTimeout(()=>h(!0),200))},onPause:()=>{h(!1)}})]}),t.jsxs(P,{sx:{display:"flex",flexDirection:"column",gap:1},children:[t.jsx("h5",{children:"Reference sound"}),t.jsx("p",{children:"Use the slider below to make the video volume roughly the same as this music."}),t.jsx("br",{}),t.jsx("audio",{ref:r,controls:!0,src:Xe,loop:!0,onLoad:x=>x.currentTarget.currentTime=35,onPlay:x=>{x.currentTarget.volume=.5,h(!0),p&&(o.current?.getInternalPlayer()?.pauseVideo(),setTimeout(()=>u(!0),200))},onPause:()=>{h(!1),p&&o.current?.getInternalPlayer()?.playVideo()}})]})]}),t.jsxs("h5",{children:["Final Song Volume (",e.volume*100,")"]}),t.jsx(P,{children:t.jsx(Te,{"data-test":"volume",min:.1,max:1,step:.01,"aria-label":"Volume",value:e.volume,onChange:l})})]})}const Fa=e=>{const a=ge(!0);return c.useMemo(()=>{const n=a.data.filter(s=>s.artist===e).map(s=>s.artistOrigin).filter(Boolean).reduce((s,o)=>(s[o]?s[o]++:s[o]=1,s),{});return Object.entries(n).sort((s,o)=>o[1]-s[1])?.[0]?.[0]??""},[e,a.data])};function Da(e){const a=ge(!0),n=Fa(e.songArtist??"");c.useEffect(()=>{e.data.artistOrigin===void 0&&(console.log("props.data.artistOrigin",n),e.onChange({...e.data,artistOrigin:n}))},[n,e.data]);const s=c.useMemo(()=>[...new Set(a.data.map(({language:l})=>Array.isArray(l)?l:[l]).flat().filter(Boolean))],[a.data]),o=Ga,r=c.useMemo(()=>[...new Set(a.data.map(l=>l.genre).filter(Boolean).map(l=>l.toLowerCase().replace(/\b\w/g,b=>b.toUpperCase().trim())))],[a.data]),i=c.useMemo(()=>[...new Set(a.data.map(l=>l.edition).filter(Boolean).map(l=>l.toLowerCase().replace(/\b\w/g,b=>b.toUpperCase().trim())))].sort(),[a.data]),d=l=>{global.open(`https://www.google.com/search?q=${encodeURIComponent(`${e.data.artist} ${e.data.title} ${l}`)}`,"_blank")},p=!!e.data.title&&!!e.data.artist,u=+(e.data?.realBpm??0)>200,[v,h]=c.useState(!1);return t.jsxs(M,{container:!0,spacing:2,"data-test":"song-metadata",children:[t.jsx(M,{item:!0,xs:6,children:t.jsx($,{value:e.data.artist,onChange:l=>e.onChange({...e.data,artist:l.target.value}),label:"Song artist",size:"small","data-test":"song-artist",required:!0,fullWidth:!0})}),t.jsx(M,{item:!0,xs:6,children:t.jsx($,{value:e.data.title,onChange:l=>e.onChange({...e.data,title:l.target.value}),label:"Song title",fullWidth:!0,size:"small",required:!0,"data-test":"song-title"})}),t.jsx(M,{item:!0,xs:3,children:t.jsx(ve,{onKeyDown:l=>{l.key==="Enter"&&l.preventDefault()},freeSolo:!0,disableClearable:!0,options:r,value:e.data.genre??"",onChange:(l,b)=>e.onChange({...e.data,genre:b}),renderInput:l=>t.jsx($,{...l,onBlur:b=>e.onChange({...e.data,genre:b.target.value}),label:"Song genre (optional)",size:"small","data-test":"song-genre",fullWidth:!0})})}),t.jsx(M,{item:!0,xs:3,children:t.jsx(ve,{onKeyDown:l=>{l.key==="Enter"&&l.preventDefault()},freeSolo:!0,disableClearable:!0,options:i,value:e.data.edition??"",onChange:(l,b)=>e.onChange({...e.data,edition:b}),renderInput:l=>t.jsx($,{...l,onBlur:b=>e.onChange({...e.data,edition:b.target.value}),label:"Song edition (optional)",size:"small","data-test":"song-edition",helperText:"Songs with the same theme, e.g. 'Christmas'",fullWidth:!0})})}),t.jsx(M,{item:!0,xs:3,children:t.jsx(ve,{onKeyDown:l=>{l.key==="Enter"&&l.preventDefault()},multiple:!0,freeSolo:!0,disableClearable:!0,options:s,value:typeof e.data.language=="string"?[e.data.language]:e.data.language,onChange:(l,b)=>{e.onChange({...e.data,language:b?b.filter(Boolean):e.data.language})},renderInput:l=>t.jsx($,{...l,label:"Song language",fullWidth:!0,size:"small",required:!e.data.language?.length,"data-test":"song-language"})})}),t.jsx(M,{item:!0,xs:3,children:t.jsxs(Pt,{fullWidth:!0,children:[t.jsx(Nt,{id:"song-origin-select-label",size:"small",children:"Song/artist origin (optional)"}),t.jsxs($t,{"data-test":"artist-origin",size:"small",labelId:"song-origin-select-label",id:"song-origin-select",value:e.data.artistOrigin??"",label:"Song/artist origin (optional)",onChange:l=>e.onChange({...e.data,artistOrigin:l.target.value}),children:[t.jsx(Re,{value:"",children:"None"},"none"),Object.entries(o).map(([l,b])=>t.jsxs(Re,{value:l,children:[t.jsx(Va,{isocode:l})," ",b]},l))]}),t.jsx(At,{children:"Used to show the flag on the list"})]})}),t.jsx(M,{item:!0,xs:6,children:t.jsx($,{"data-test":"release-year",value:e.data.year,onChange:l=>e.onChange({...e.data,year:l.target.value}),label:"Release year",helperText:"The year the song was released. Click the 'Lookup' button to look for it on Google",fullWidth:!0,size:"small",required:!0,...Ce(()=>d("release year"),p)})}),t.jsx(M,{item:!0,xs:6,children:t.jsx($,{"data-test":"song-bpm",value:e.data.realBpm,onChange:l=>e.onChange({...e.data,realBpm:l.target.value}),label:"Song (real) BPM",focused:u?!0:void 0,helperText:u?t.jsxs(t.Fragment,{children:["Usually songs don't have higher BPM than ",t.jsx("b",{children:"200"}),". Make sure the value is correct (you can still save the song)"]}):`The actual tempo of the song. Click the 'Lookup' button to look for it on Google. ${v?"If you can't find it, you can still save the song":""}`,color:u?"warning":void 0,fullWidth:!0,type:"number",size:"small",required:!v,...Ce(()=>{h(!0),d("tempo")},p)})}),t.jsx(M,{item:!0,xs:12}),t.jsx(M,{item:!0,xs:12,children:t.jsx(za,{...e})})]})}const Va=V(et,{target:"e70j9sv0"})({name:"3kqygp",styles:"width:1em;margin-right:0.5em;display:inline-block"});var Oa=1,Wa=4;function Ka(e){return tt(e,Oa|Wa)}function Ha(e){return Y("MuiButtonGroup",e)}const j=Z("MuiButtonGroup",["root","contained","outlined","text","disableElevation","disabled","firstButton","fullWidth","horizontal","vertical","colorPrimary","colorSecondary","grouped","groupedHorizontal","groupedVertical","groupedText","groupedTextHorizontal","groupedTextVertical","groupedTextPrimary","groupedTextSecondary","groupedOutlined","groupedOutlinedHorizontal","groupedOutlinedVertical","groupedOutlinedPrimary","groupedOutlinedSecondary","groupedContained","groupedContainedHorizontal","groupedContainedVertical","groupedContainedPrimary","groupedContainedSecondary","lastButton","middleButton"]),_a=(e,a)=>{const{ownerState:n}=e;return[{[`& .${j.grouped}`]:a.grouped},{[`& .${j.grouped}`]:a[`grouped${E(n.orientation)}`]},{[`& .${j.grouped}`]:a[`grouped${E(n.variant)}`]},{[`& .${j.grouped}`]:a[`grouped${E(n.variant)}${E(n.orientation)}`]},{[`& .${j.grouped}`]:a[`grouped${E(n.variant)}${E(n.color)}`]},{[`& .${j.firstButton}`]:a.firstButton},{[`& .${j.lastButton}`]:a.lastButton},{[`& .${j.middleButton}`]:a.middleButton},a.root,a[n.variant],n.disableElevation===!0&&a.disableElevation,n.fullWidth&&a.fullWidth,n.orientation==="vertical"&&a.vertical]},qa=e=>{const{classes:a,color:n,disabled:s,disableElevation:o,fullWidth:r,orientation:i,variant:d}=e,p={root:["root",d,i,r&&"fullWidth",o&&"disableElevation",`color${E(n)}`],grouped:["grouped",`grouped${E(i)}`,`grouped${E(d)}`,`grouped${E(d)}${E(i)}`,`grouped${E(d)}${E(n)}`,s&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return K(p,Ha,a)},Ya=G("div",{name:"MuiButtonGroup",slot:"Root",overridesResolver:_a})(J(({theme:e})=>({display:"inline-flex",borderRadius:(e.vars||e).shape.borderRadius,variants:[{props:{variant:"contained"},style:{boxShadow:(e.vars||e).shadows[2]}},{props:{disableElevation:!0},style:{boxShadow:"none"}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{orientation:"vertical"},style:{flexDirection:"column",[`& .${j.lastButton},& .${j.middleButton}`]:{borderTopRightRadius:0,borderTopLeftRadius:0},[`& .${j.firstButton},& .${j.middleButton}`]:{borderBottomRightRadius:0,borderBottomLeftRadius:0}}},{props:{orientation:"horizontal"},style:{[`& .${j.firstButton},& .${j.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${j.lastButton},& .${j.middleButton}`]:{borderTopLeftRadius:0,borderBottomLeftRadius:0}}},{props:{variant:"text",orientation:"horizontal"},style:{[`& .${j.firstButton},& .${j.middleButton}`]:{borderRight:e.vars?`1px solid rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${e.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${j.disabled}`]:{borderRight:`1px solid ${(e.vars||e).palette.action.disabled}`}}}},{props:{variant:"text",orientation:"vertical"},style:{[`& .${j.firstButton},& .${j.middleButton}`]:{borderBottom:e.vars?`1px solid rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${e.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${j.disabled}`]:{borderBottom:`1px solid ${(e.vars||e).palette.action.disabled}`}}}},...Object.entries(e.palette).filter(Le()).flatMap(([a])=>[{props:{variant:"text",color:a},style:{[`& .${j.firstButton},& .${j.middleButton}`]:{borderColor:e.vars?`rgba(${e.vars.palette[a].mainChannel} / 0.5)`:ne(e.palette[a].main,.5)}}}]),{props:{variant:"outlined",orientation:"horizontal"},style:{[`& .${j.firstButton},& .${j.middleButton}`]:{borderRightColor:"transparent","&:hover":{borderRightColor:"currentColor"}},[`& .${j.lastButton},& .${j.middleButton}`]:{marginLeft:-1}}},{props:{variant:"outlined",orientation:"vertical"},style:{[`& .${j.firstButton},& .${j.middleButton}`]:{borderBottomColor:"transparent","&:hover":{borderBottomColor:"currentColor"}},[`& .${j.lastButton},& .${j.middleButton}`]:{marginTop:-1}}},{props:{variant:"contained",orientation:"horizontal"},style:{[`& .${j.firstButton},& .${j.middleButton}`]:{borderRight:`1px solid ${(e.vars||e).palette.grey[400]}`,[`&.${j.disabled}`]:{borderRight:`1px solid ${(e.vars||e).palette.action.disabled}`}}}},{props:{variant:"contained",orientation:"vertical"},style:{[`& .${j.firstButton},& .${j.middleButton}`]:{borderBottom:`1px solid ${(e.vars||e).palette.grey[400]}`,[`&.${j.disabled}`]:{borderBottom:`1px solid ${(e.vars||e).palette.action.disabled}`}}}},...Object.entries(e.palette).filter(Le(["dark"])).map(([a])=>({props:{variant:"contained",color:a},style:{[`& .${j.firstButton},& .${j.middleButton}`]:{borderColor:(e.vars||e).palette[a].dark}}}))],[`& .${j.grouped}`]:{minWidth:40,boxShadow:"none",props:{variant:"contained"},style:{"&:hover":{boxShadow:"none"}}}}))),_=c.forwardRef(function(a,n){const s=W({props:a,name:"MuiButtonGroup"}),{children:o,className:r,color:i="primary",component:d="div",disabled:p=!1,disableElevation:u=!1,disableFocusRipple:v=!1,disableRipple:h=!1,fullWidth:l=!1,orientation:b="horizontal",size:y="medium",variant:w="outlined",...B}=s,L={...s,color:i,component:d,disabled:p,disableElevation:u,disableFocusRipple:v,disableRipple:h,fullWidth:l,orientation:b,size:y,variant:w},x=qa(L),S=c.useMemo(()=>({className:x.grouped,color:i,disabled:p,disableElevation:u,disableFocusRipple:v,disableRipple:h,fullWidth:l,size:y,variant:w}),[i,p,u,v,h,l,y,w,x.grouped]),R=qt(o),g=R.length,C=f=>{const I=f===0,N=f===g-1;return I&&N?"":I?x.firstButton:N?x.lastButton:x.middleButton};return t.jsx(Ya,{as:d,role:"group",className:F(x.root,r),ref:n,ownerState:L,...B,children:t.jsx(at.Provider,{value:S,children:R.map((f,I)=>t.jsx(nt.Provider,{value:C(I),children:f},I))})})});function Za({player:e,currentTime:a,playbackSpeed:n,setPlaybackSpeed:s}){const o=r=>e.seekTo((a+r)/1e3);return t.jsxs(t.Fragment,{children:[t.jsxs(P,{children:[t.jsxs(D,{"data-test":"current-time",children:["Current time: ",ke(a)," (",t.jsx(xe,{children:Math.round(a)})," ms)"]}),t.jsxs(P,{sx:{display:"flex",gap:1},children:[t.jsxs(_,{variant:"contained",sx:{display:"flex",mt:1,flex:1},children:[t.jsx(k,{size:"small",sx:{flex:1,px:1},onClick:()=>o(-1e4),"data-test":"seek-10s",children:"-10"}),t.jsx(k,{size:"small",sx:{flex:1,px:1},onClick:()=>o(-5e3),"data-test":"seek-5s",children:"-5"}),t.jsx(k,{size:"small",sx:{flex:1,px:1},onClick:()=>o(-1e3),"data-test":"seek-1s",children:"-1"}),t.jsx(k,{size:"small",sx:{flex:1,px:1},onClick:()=>o(-500),"data-test":"seek-0.5s",children:"-0.5"})]}),t.jsx(Et,{}),t.jsxs(_,{variant:"contained",sx:{display:"flex",mt:1,flex:1},children:[t.jsx(k,{size:"small",sx:{flex:1,px:1},onClick:()=>o(500),"data-test":"seek+0.5s",children:"+0.5"}),t.jsx(k,{size:"small",sx:{flex:1,px:1},onClick:()=>o(1e3),"data-test":"seek+1s",children:"+1"}),t.jsx(k,{size:"small",sx:{flex:1,px:1},onClick:()=>o(5e3),"data-test":"seek+5s",children:"+5"}),t.jsx(k,{size:"small",sx:{flex:1,px:1},onClick:()=>o(1e4),"data-test":"seek+10s",children:"+10"})]})]})]}),t.jsxs(P,{children:[t.jsxs(D,{children:["Playback speed: ",t.jsxs(xe,{"data-test":"current-speed",children:[n*100,"%"]})]}),t.jsx(_,{variant:"contained",sx:{display:"flex",mt:1},children:[.25,.5,.75,1,1.25,1.5,2].map(r=>t.jsxs(k,{size:"small","data-test":`speed-${r}`,sx:{flex:1},onClick:()=>{s(r)},disabled:n===r,children:[r*100,"%"]},r))})]})]})}const Ja=(e,a)=>{const{ownerState:n}=e;return[a.root,n.dense&&a.dense,n.alignItems==="flex-start"&&a.alignItemsFlexStart,n.divider&&a.divider,!n.disableGutters&&a.gutters]},Qa=e=>{const{alignItems:a,classes:n,dense:s,disabled:o,disableGutters:r,divider:i,selected:d}=e,u=K({root:["root",s&&"dense",!r&&"gutters",i&&"divider",o&&"disabled",a==="flex-start"&&"alignItemsFlexStart",d&&"selected"]},Ut,n);return{...n,...u}},Xa=G(Ee,{shouldForwardProp:e=>rt(e)||e==="classes",name:"MuiListItemButton",slot:"Root",overridesResolver:Ja})(J(({theme:e})=>({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${ae.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:ne(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${ae.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:ne(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}},[`&.${ae.selected}:hover`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:ne(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:ne(e.palette.primary.main,e.palette.action.selectedOpacity)}},[`&.${ae.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${ae.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},variants:[{props:({ownerState:a})=>a.divider,style:{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:"padding-box"}},{props:{alignItems:"flex-start"},style:{alignItems:"flex-start"}},{props:({ownerState:a})=>!a.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:a})=>a.dense,style:{paddingTop:4,paddingBottom:4}}]}))),en=c.forwardRef(function(a,n){const s=W({props:a,name:"MuiListItemButton"}),{alignItems:o="center",autoFocus:r=!1,component:i="div",children:d,dense:p=!1,disableGutters:u=!1,divider:v=!1,focusVisibleClassName:h,selected:l=!1,className:b,...y}=s,w=c.useContext(Se),B=c.useMemo(()=>({dense:p||w.dense||!1,alignItems:o,disableGutters:u}),[o,w.dense,p,u]),L=c.useRef(null);st(()=>{r&&L.current&&L.current.focus()},[r]);const x={...s,alignItems:o,dense:B.dense,disableGutters:u,divider:v,selected:l},S=Qa(x),R=ot(L,n);return t.jsx(Se.Provider,{value:B,children:t.jsx(Xa,{ref:R,href:y.href||y.to,component:(y.href||y.to)&&i==="div"?"button":i,focusVisibleClassName:F(S.focusVisible,h),ownerState:x,className:F(S.root,b),...y,classes:S,children:d})})});function tn(e,a){const n=Math.floor(a);return c.useMemo(()=>e.findIndex((s,o)=>n<0?!0:n<s.start?!1:o===e.length-1||e[o+1].start>n),[n,e])}function an({song:e,currentTime:a,beatLength:n,player:s,onRecordChange:o,onLyricChange:r,playbackSpeed:i,onTrackNameChange:d,lyricChanges:p}){const[u,v]=c.useState(0),[h,l]=c.useState(-1),[b,y]=c.useState([]),w=it(a,n,e.gap),B=e.tracks[u].sections.filter(Q),L=tn(B,w),x=g=>{l(g),ze.resetPlayerNotes();const C=De(B[g],e);s.seekTo(C/1e3-.8*i)},S=()=>{y(g=>[...g,{type:"delete",section:h,track:u}]),h===B.length-1&&l(g=>g-1)},R=g=>{y(C=>{const f=C.at(-1);if(f&&f.type==="shift"&&f.track===u&&f.section===h){const I=[...C];return I.at(-1).shift=g,I}return[...C,{type:"shift",section:h,track:u,shift:g}]})};return c.useEffect(()=>{o(b)},[o,b]),t.jsxs(on,{children:[t.jsxs(Pe,{direction:"row",children:[t.jsxs(D,{variant:"h6",mb:0,sx:{flex:1,display:"flex",alignItems:"center"},children:["Edit verses",e.tracks.length>1&&t.jsx(_,{variant:"contained",sx:{ml:2},size:"small",children:e.tracks.map((g,C)=>t.jsxs(k,{onClick:()=>v(C),disabled:u===C,"data-test":`track-${C+1}`,children:["Track ",C+1]},C))})]}),t.jsx($,{label:"Track name",placeholder:"Set track name",sx:{flex:1},size:"small",value:e.tracks[u]?.name??"",onChange:g=>d(u,g.target.value),"data-test":"track-name"})]}),t.jsxs(Pe,{direction:"row",spacing:2,sx:{height:"400px",mt:3},children:[t.jsx(Gt,{sx:{overflowY:"auto"},children:B.map((g,C)=>t.jsx(zt,{disablePadding:!0,"data-test":`section-${C}`,sx:{maxWidth:250,overflowX:"hidden",textWrap:"ellipsis",whiteSpace:"nowrap"},children:t.jsx(en,{onClick:()=>x(C),selected:h===C,children:t.jsx(Ua,{primaryTypographyProps:{fontWeight:C===L?"bold":"normal"},primary:Q(g)?g.notes.map(f=>f.lyrics.replaceAll(" ","Â·")).join(""):"[pause]"})})},g.start))}),t.jsx(rn,{children:h>-1&&t.jsxs(t.Fragment,{children:[h===0&&t.jsx("h3",{"data-test":"use-gap-info",children:"Use gap shift to change when this section starts"}),h>0&&t.jsx(t.Fragment,{children:t.jsx($,{"data-test":"change-start-beat",size:"small",type:"number",onChange:g=>R(+g.target.value),value:pe([B[h]]),label:"Change start beat",InputProps:{inputProps:{step:1}},fullWidth:!0,sx:{mb:2},helperText:t.jsxs(t.Fragment,{children:["Timestamp:"," ",oe(pe([B[h]])*n+e.gap,s)]})})}),t.jsx(ln,{children:B[h].notes.map((g,C)=>{const f=p[u]?.[h]?.[C]??g.lyrics;return t.jsx(cn,{style:{width:`${f.length}ch`},value:f,"data-test":`lyric-input-${C}`,onChange:I=>{r({section:h,track:u,noteIndex:C,newLyric:I.target.value})},onKeyDown:I=>{const N=I.target.selectionStart;if(I.key==="ArrowLeft"&&N===0){const A=I.target?.previousElementSibling;A&&(A.focus(),setTimeout(()=>A.setSelectionRange(A.value.length,A.value.length),10))}else if(I.key==="ArrowRight"&&N===I.target.value.length){const A=I.target?.nextElementSibling;A&&(A.focus(),setTimeout(()=>A.setSelectionRange(0,0),10))}}},C)})}),t.jsx(k,{variant:"contained",color:"error",onClick:S,fullWidth:!0,"data-test":"delete-section",children:"Delete section"})]})}),t.jsxs(nn,{children:[t.jsx(P,{sx:{overflowY:"auto",maxHeight:"34rem"},"data-test":"change-list",children:b.map((g,C)=>{let f="",I=Ae;return g.type==="delete"?(I=Ae,f="Deleted"):g.type==="shift"&&(I=sn,f=`Start -> ${g.shift}`),t.jsx(I,{children:t.jsxs("strong",{children:["Track: ",g.track+1,", Section: ",g.section+1,", ",f]})},C)})}),b.length>0&&t.jsx(k,{"data-test":"undo-change",variant:"contained",color:"warning",onClick:()=>y(g=>g.filter((C,f)=>f!==g.length-1)),fullWidth:!0,children:"Undo last change"})]})]})]})}const nn=V("div",{target:"e18sxv6t7"})({name:"82a6rk",styles:"flex:1"}),He=V("div",{target:"e18sxv6t6"})({name:"m1a2da",styles:"padding:0.5rem"}),Ae=V(He,{target:"e18sxv6t5"})({name:"hwfcu5",styles:"color:red"}),sn=V(He,{target:"e18sxv6t4"})({name:"zzs6wi",styles:"color:#0059ff"}),on=V("div",{target:"e18sxv6t3"})(""),rn=V("div",{target:"e18sxv6t2"})({name:"82a6rk",styles:"flex:1"}),ln=V("div",{target:"e18sxv6t1"})({name:"1qhi3cl",styles:"display:flex;gap:0.25rem;column-gap:0;margin-bottom:1rem;align-items:center;flex-wrap:wrap"}),cn=V("input",{target:"e18sxv6t0"})({name:"1bv0k4z",styles:"font-family:monospace;background:#f6f6f6;width:3rem;padding:0.5rem 0.1rem;border:0;border-right:1px solid #ececec;text-decoration:underline;box-sizing:content-box;&:focus{background:#ececec;outline:none!important;}"});function dn(e,a){const s=a.tracks[0].sections.filter(Q).at(-1)?.notes.at(-1),o=e-a.gap,r=s.start+s.length;return Number((6e4/(o/r*a.bar)).toFixed(2))}function X({shortcutKey:e,children:a}){return Ft(s=>s.breakpoints.down("sm"))?a:t.jsx(we,{title:`${e}`,placement:"bottom-end",open:!0,slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[5,-20]}}]}},children:a})}function un({current:e,onChange:a,song:n}){const s=Math.max(...n.tracks.map(d=>lt(d.sections))),o=ct(s,n)+n.gap,[r,i]=c.useState(Math.round(o));return t.jsxs("div",{className:"mb-2 flex items-start gap-2",children:[t.jsx($,{"data-test":"desired-end",size:"small",type:"number",value:r,onChange:d=>i(+d.target.value),label:"Target last note end time (ms)",sx:{flex:1},helperText:r?t.jsxs(t.Fragment,{children:["Estimated proper Tempo (BPM) of the lyrics:"," ",t.jsx(xe,{"data-test":"desired-bpm",children:dn(r,n)})]}):" "}),t.jsxs("div",{className:"flex flex-1",children:[t.jsx(X,{shortcutKey:"z",children:t.jsx(k,{sx:{minWidth:"40px",width:"40px"},variant:"contained",size:"small",onClick:()=>a(e-.1),children:"-"})}),t.jsx($,{"data-test":"change-bpm",size:"small",type:"number",value:e,onChange:d=>!isNaN(+d.target.value)&&a(+d.target.value),label:"Tempo (BPM) of the lyrics",sx:{flex:1},InputProps:{inputProps:{step:"0.1"}}}),t.jsx(X,{shortcutKey:"w",children:t.jsx(k,{variant:"contained",size:"small",sx:{minWidth:"40px",width:"40px"},onClick:()=>a(e+.1),children:"+"})})]})]})}function pn({current:e,onChange:a,player:n,finalGap:s}){const o=r=>{const i=String(Number(e)+r);a(i)};return t.jsxs(P,{flex:"1",children:[t.jsxs(D,{children:["Lyrics Gap shift (final: ",oe(s,n),")"]}),t.jsxs("div",{className:"mt-1 flex gap-1",children:[t.jsxs(_,{sx:{flex:1},children:[t.jsx(k,{sx:{flex:1,px:1},onClick:()=>o(-1e3),"data-test":"shift-gap-1s",children:"-1000"}),t.jsx(k,{sx:{flex:1,px:1},onClick:()=>o(-500),"data-test":"shift-gap-0.5s",children:"-500"}),t.jsx(X,{shortcutKey:"a",children:t.jsx(k,{sx:{flex:1,px:1},onClick:()=>o(-50),"data-test":"shift-gap-0.05s",children:"-50"})})]}),t.jsx($,{sx:{py:0,flex:1},size:"small",type:"text",value:e,onChange:r=>a(r.target.value),label:"Miliseconds","data-test":"shift-gap"}),t.jsxs(_,{sx:{flex:1},children:[t.jsx(X,{shortcutKey:"s",children:t.jsx(k,{sx:{flex:1,px:1},onClick:()=>o(50),"data-test":"shift-gap+0.05s",children:"+50"})}),t.jsx(k,{sx:{flex:1,px:1},onClick:()=>o(500),"data-test":"shift-gap+0.5s",children:"+500"}),t.jsx(k,{sx:{flex:1,px:1},onClick:()=>o(1e3),"data-test":"shift-gap+1s",children:"+1000"})]})]})]})}function hn({current:e,onChange:a,player:n,finalGap:s}){return t.jsxs(P,{flex:"1",children:[t.jsxs(D,{children:["Video Gap shift (final: ",oe((s??0)*1e3,n),")"]}),t.jsxs(P,{sx:{display:"flex",gap:1,mt:1},children:[t.jsxs(_,{sx:{flex:1},children:[t.jsx(k,{sx:{flex:1,px:1.25},onClick:()=>a(e-10),"data-test":"shift-video-gap-10s",children:"-10"}),t.jsx(k,{sx:{flex:1,px:1.25},onClick:()=>a(e-5),"data-test":"shift-video-gap-5s",children:"-5"}),t.jsx(k,{sx:{flex:1,px:1.25},onClick:()=>a(e-1),"data-test":"shift-video-gap-1s",children:"-1"})]}),t.jsx($,{"data-test":"shift-video-gap",sx:{py:0,flex:1},size:"small",type:"text",value:e,onChange:o=>a(+o.target.value),label:"Seconds"}),t.jsxs(_,{sx:{flex:1},children:[t.jsx(k,{sx:{flex:1,px:1.25},onClick:()=>a(e+1),"data-test":"shift-video-gap+1s",children:"+1"}),t.jsx(k,{sx:{flex:1,px:1.25},onClick:()=>a(e+5),"data-test":"shift-video-gap+5s",children:"+5"}),t.jsx(k,{sx:{flex:1,px:1.25},onClick:()=>a(e+10),"data-test":"shift-video-gap+10s",children:"+10"})]})]})]})}const xn=(e,a)=>({...e,gap:e.gap+a}),mn=(e,a)=>({...e,videoGap:(e.videoGap??0)+a}),gn=(e,a)=>({...e,bpm:a}),fn=(e,a)=>({...e,tracks:e.tracks.map((n,s)=>{const o=a.filter(i=>i.track===s);let r=[...n.sections].filter(Q);return o.forEach(i=>{if(i.type==="delete")r=r.filter((d,p)=>p!==i.section);else if(i.type==="shift"){const d=i.shift-pe([r[i.section]]);r=r.map((p,u)=>u<i.section?p:{...p,notes:p.notes.map(v=>({...v,start:v.start+d}))})}}),{...n,sections:r}})}),vn=(e,a)=>({...e,tracks:e.tracks.map((n,s)=>({...n,name:a[s]??n.name}))}),bn=(e,a)=>({...e,tracks:e.tracks.map((n,s)=>{const o=a[s]??{};return{...n,sections:n.sections.map((r,i)=>{const d=o[i]??{};return Q(r)?{...r,notes:r.notes.map((p,u)=>({...p,lyrics:d[u]??p.lyrics}))}:r})}})});function yn({song:e,onUpdate:a,visible:n}){const s=c.useRef(null),[o,r]=c.useState(0),[i,d]=c.useState(1),{width:p}=dt(),u=Math.min(p-16,824),v=u/16*9,[h,l]=c.useState("0"),[b,y]=c.useState(0),[w,B]=c.useState(e.bpm),[L,x]=c.useState([]),[S,R]=c.useState(e.tracks.map(m=>m.name??void 0)),[g,C]=c.useState({}),f=c.useMemo(()=>{let m=Ka(e);return m=ut(m),m=pt(m),m=Me(m),isNaN(Number(h))||(m=xn(m,Number(h))),m=mn(m,b),m=gn(m,w),m=fn(m,L),m=vn(m,S),m=bn(m,g),m=Me(m),m=ht(m),m},[h,b,e,w,L,S,g]);c.useEffect(()=>{a?.(f)},[a,f]);const I=c.useMemo(()=>({id:"test",mode:xt.DUEL,players:[{number:0,track:0},{number:1,track:e.tracks.length-1}],tolerance:6}),[e]),N=mt(f);c.useEffect(()=>{n||s.current?.pause()},[n]),c.useEffect(()=>{s.current&&s.current.setPlaybackSpeed(i)},[i]);const A=(m=.5*i)=>{const U=pe(f.tracks[0].sections)*N+f.gap;s.current?.seekTo(U/1e3-m)},T=(m=.5*i)=>{const U=(ft(f.tracks[0].sections)?.notes[0].start??0)*N+f.gap;s.current?.seekTo(U/1e3-m)};return q("q",()=>{d(.5),A(.25)}),q("w",()=>{d(.5),T(.25)}),q("a",()=>{l(m=>String(Number(m)-50))}),q("s",()=>{l(m=>String(Number(m)+50))}),q("z",()=>{B(m=>m-.1)}),q("x",()=>{B(m=>m+.1)}),t.jsxs(M,{container:!0,spacing:2,sx:{display:n?void 0:"none"},children:[t.jsx(M,{item:!0,xs:12,sm:8,"data-test":"player-container",children:t.jsx(P,{sx:{width:u,height:v},children:t.jsx(gt,{song:f,showControls:!0,autoplay:!1,width:u,height:v,ref:s,onCurrentTimeUpdate:r,effectsEnabled:!1,singSetup:I,onSongEnd:()=>{}},0)})}),t.jsxs(M,{item:!0,xs:12,sm:4,sx:{display:"flex",flexDirection:"column",gap:2},children:[s.current&&t.jsxs(t.Fragment,{children:[t.jsx(Za,{player:s.current,currentTime:o,playbackSpeed:i,setPlaybackSpeed:d}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx(X,{shortcutKey:"q",children:t.jsx(k,{variant:"outlined",size:"small",onClick:()=>A(),children:"First section"})}),t.jsx(X,{shortcutKey:"w",children:t.jsx(k,{variant:"outlined",size:"small",onClick:()=>T(),children:"Last section"})})]})]}),!s.current&&t.jsx("h2",{children:"Start the song to see the manipulation form"})]}),s.current&&t.jsxs(t.Fragment,{children:[t.jsx(M,{item:!0,xs:12,sm:8,children:t.jsxs("div",{className:"flex flex-1 flex-col gap-5 sm:flex-row",children:[t.jsx(hn,{player:s.current,onChange:m=>{const U=m-b;y(m),l(ee=>isNaN(Number(ee))?ee:String(Number(ee)+U*1e3))},current:b,finalGap:f.videoGap}),t.jsx(pn,{player:s.current,onChange:l,current:h,finalGap:f.gap})]})}),t.jsxs(M,{item:!0,xs:0,sm:4,className:"hidden sm:block",children:[t.jsxs("div",{className:"mb-2 text-xs",children:["Use ",t.jsx("strong",{children:"Video shift gap"})," to crop the beginning of the video if it starts with an intro."]}),t.jsxs("div",{className:"mb-2 text-xs",children:["Use ",t.jsx("strong",{children:"Lyrics shift gap"})," to sync the start of the lyrics to the video. You can lower the"," ",t.jsx("strong",{children:"Playback speed"})," above to make sure you got it just right."," "]})]}),t.jsxs(M,{item:!0,xs:12,sm:8,children:[t.jsx(D,{variant:"h5",mb:2,children:"Advanced"}),t.jsx(un,{onChange:B,current:w,song:f},f.gap)]}),t.jsxs(M,{item:!0,xs:0,sm:4,className:"hidden sm:block",children:[t.jsx("div",{className:"mb-2 text-xs",children:"If the lyrics desynchronise over time, probably the tempo (BPM) of the lyrics is wrong."}),t.jsxs("div",{className:"mb-2 text-xs",children:["You can either use ",t.jsx("strong",{children:"Last note end time"})," - enter the millisecond when the last note should end (seek through the video for the moment as ",t.jsx("strong",{children:"Current time"})," panel show the exact millisecond) and a suggested BPM value will appear below."]}),t.jsxs("div",{className:"mb-2 text-xs",children:[t.jsx("strong",{children:"Tempo (BPM)"})," field allows to fine-tune the tempo."]})]}),t.jsx(M,{item:!0,xs:12,sm:8,children:t.jsx(an,{playbackSpeed:i,song:f,currentTime:o,beatLength:N,player:s.current,onRecordChange:x,onTrackNameChange:(m,U)=>R(ee=>{const Be=[...ee];return Be[m]=U===""?void 0:U,Be}),lyricChanges:g,onLyricChange:m=>C(U=>({...U,[m.track]:{...U[m.track],[m.section]:{...U[m.track]?.[m.section],[m.noteIndex]:m.newLyric}}}))})}),t.jsxs(M,{item:!0,xs:0,sm:4,className:"hidden sm:block",children:[t.jsxs("div",{className:"mb-2 text-xs",children:["If the lyrics there are more lyrics than in the video or there are longer/shorter interludes between verses, you can ",t.jsx("strong",{children:"Edit verses"}),"."]}),t.jsx("div",{className:"mb-2 text-xs",children:"Select a verse by clicking on it."}),t.jsxs("div",{className:"mb-2 text-xs",children:["You can either ",t.jsx("strong",{children:"Change its start beat"}),' (which will "move in time" the verse and all subsequent ones) or ',t.jsx("strong",{children:"Delete it"})," (it won't affect the timing of other verses). You can also edit the lyrics of each note."]}),t.jsxs("div",{className:"mb-2 text-xs",children:[t.jsx("strong",{children:"List of changes"})," on the right allows you to see and undo the actions one by one."]})]})]})]})}function Sn(e){return t.jsx(P,{"data-test":"sync-lyrics",children:e.data&&e.data.video.length<15&&!!e.data.tracks?.[0]?.sections?.length&&t.jsx(yn,{song:e.data,onUpdate:e.onChange,visible:e.visible})})}function jn(e){return Array.isArray(e)?e.length===0:!e}const z=["basic-data","author-and-video","sync","metadata"];function Ln({song:e}){const a=!!e,{data:n}=ge(!0);Ve(!1);const s=vt();Oe(!1);const o=he("step"),[r,i]=c.useState(Math.max(0,z.indexOf(o))),[d,p]=c.useState(!1),u=he("redirect");c.useEffect(()=>{z[r]&&ka({step:z[r]})},[r]);const[v,h]=c.useState({sourceUrl:e?.sourceUrl??"",txtInput:""}),[l,b]=c.useState({author:e?.author??"",authorUrl:e?.authorUrl??"",video:e?.video?`https://www.youtube.com/watch?v=${e.video}`:""}),[y,w]=c.useState({artist:e?.artist??"",title:e?.title??"",realBpm:e?.realBpm?String(e.realBpm):"",year:e?.year??"",language:e?.language??[],volume:e?.volume??70,previewStart:e?.previewStart??void 0,previewEnd:e?.previewEnd??void 0,genre:e?.genre,edition:e?.edition,artistOrigin:e?.artistOrigin}),[B,L]=c.useState(e),x=c.useMemo(()=>{try{return a?{...e,video:Ue(l.video)||e.video,author:l.author,authorUrl:l.authorUrl,sourceUrl:v.sourceUrl}:v.txtInput?Fe(v.txtInput,l.video,l.author,l.authorUrl,v.sourceUrl):void 0}catch(T){console.error(T)}},[v.txtInput,l.video,l.author,l.authorUrl,v.sourceUrl,e,a]),S=c.useMemo(()=>!a&&x&&n?.find(T=>O.generateSongFile(T)===O.generateSongFile(x)),[n,x,a]);c.useEffect(()=>{x&&(x.video&&!l.video&&b(T=>({...T,video:`https://www.youtube.com/watch?v=${x.video}`})),x.author&&!l.author&&b(T=>({...T,author:T.author||x?.author||"",authorUrl:T.authorUrl||x?.authorUrl||""})),x.sourceUrl&&!v.sourceUrl&&h(T=>({...T,sourceUrl:x.sourceUrl})),["year","language","realBpm","genre","artist","title","volume","previewStart","previewEnd","artistOrigin"].forEach(T=>{x[T]&&jn(y[T])&&w(m=>({...m,[T]:x[T]}))}))},[x,y.year,y.language,y.realBpm,y.genre,y.artist,y.volume,y.title,y.previewStart,y.previewEnd,v.sourceUrl,l.video]);const R=!!v.txtInput||a,g=!!l.video,C=z[r]==="author-and-video"?g:!0,f={...B,...y,author:l.author,authorUrl:l.authorUrl,realBpm:+y.realBpm,sourceUrl:v.sourceUrl,id:bt(y)},I=c.useCallback(async()=>{p(!0),await O.store(f),await yt(f.id),p(!1),u?s(u):s("edit/list/",{id:f.id,created:a?null:"true",song:null})},[f,a,s]),N=c.useCallback(()=>{r<z.length-1?i(T=>T+1):z[r]==="metadata"&&I()},[r,I]);q("shift+enter",()=>{N()},[N]);const A=z.at(r)==="metadata";return t.jsxs(Zt,{injectFirst:!0,children:[t.jsx(We,{}),t.jsxs(M,{container:!0,gap:2,p:1,pb:10,children:[t.jsx(M,{item:!0,xs:12,children:!a&&t.jsx("div",{style:{marginBottom:"1rem"},children:t.jsx(se,{to:"menu/",children:t.jsx("a",{children:"Return to the main menu"})})})}),t.jsx(M,{item:!0,xs:12,children:t.jsxs(wa,{activeStep:r,sx:{mb:2},nonLinear:a,children:[t.jsx(le,{completed:R,children:t.jsx(ce,{color:"inherit",onClick:()=>i(0),children:"Basic Info"})},0),t.jsx(le,{completed:g,children:t.jsx(ce,{color:"inherit",onClick:()=>i(1),children:"Author and video data"})},1),t.jsx(le,{children:t.jsx(ce,{color:"inherit",onClick:()=>i(2),children:"Sync lyrics to video"})},2),t.jsx(le,{children:t.jsx(ce,{color:"inherit",onClick:()=>i(3),children:"Fill song metadata"})},3)]})}),t.jsx(M,{item:!0,xs:12,children:t.jsxs("form",{onSubmit:async T=>{T.preventDefault(),N()},children:[z.at(r)==="basic-data"&&t.jsx($a,{shouldAutoImport:!g,isTxtRequired:!e,onAutoImport:b,onChange:h,data:v,finalSong:f}),z.at(r)==="author-and-video"&&t.jsx(Ba,{songArtist:x?.artist,songTitle:x?.title,onChange:b,data:l}),x&&t.jsx(Sn,{onChange:L,data:x,visible:z.at(r)==="sync"}),z.at(r)==="metadata"&&t.jsx(Da,{videoGap:B?.videoGap,onChange:w,data:y,songArtist:x?.artist,videoId:x?.video??""}),S&&t.jsxs(Dt,{severity:"warning","data-test":"possible-duplicate",children:[t.jsx(Vt,{children:"Possible duplicate"}),"There is already a song with similar artist and/or name:"," ",t.jsxs("b",{children:[S.artist," - ",S.title]})]}),t.jsxs(St,{sx:{position:"fixed",bottom:0,left:"50%",maxWidth:"1260px",width:"100%",padding:1,transform:"translateX(-50%)",display:"flex",gap:2,justifyContent:"space-between"},elevation:3,children:[u&&t.jsx(k,{disabled:d,sx:{align:"right"},onClick:async()=>{p(!0),await O.store(f),p(!1),s(u)},children:"Skip"}),t.jsxs("div",{className:"flex items-end",children:[t.jsx(k,{"data-test":"previous-button",sx:{align:"right"},onClick:()=>i(T=>T-1),disabled:r===0,children:"Previous"}),A?t.jsx(k,{"data-test":"save-button",sx:{align:"right"},type:"submit",variant:"contained",disabled:d,children:d?"Saving...":"Save"}):t.jsx(k,{"data-test":"next-button",sx:{align:"right"},variant:"contained",type:"submit",disabled:d||!C||r===z.length-1,children:"Next"})]})]})]})})]})]})}const Cn=me(t.jsx("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download"),wn=me(t.jsx("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility");function Mn(){Ve(!1),Oe(!1);const{data:e,reload:a}=ge(!0),[n,s]=jt(null),o=he("created"),r=he("id");return e?t.jsxs(t.Fragment,{children:[t.jsx(Ct,{children:t.jsx("title",{children:"Song List | AllKaraoke.Party - Free Online Karaoke Party Game"})}),t.jsx(wt,{children:t.jsxs(kn,{children:[o&&t.jsx(kt,{id:r}),t.jsx(We,{}),t.jsxs(M,{container:!0,rowGap:2,children:[t.jsx(M,{item:!0,xs:3,display:"flex",alignItems:"center",justifyContent:"flex-start",children:t.jsx(se,{to:"menu/",children:t.jsx(k,{"data-test":"main-menu-link",children:"Return to main menu"})})}),t.jsx(M,{item:!0,xs:6,display:"flex",alignItems:"center",justifyContent:"center",children:t.jsxs("h4",{children:[t.jsx("span",{onClick:()=>{window.__exposeSingletons(),window.__singletons.importSongs()},children:e.length})," ",t.jsx(se,{to:"edit/redirect-to-first-local-song",children:t.jsx("span",{children:"songs"})})]})}),t.jsx(M,{item:!0,xs:3,display:"flex",alignItems:"center",justifyContent:"flex-end",children:t.jsx(se,{to:"convert/",children:t.jsx(k,{"data-test":"convert-song",variant:"contained",children:"Import UltraStar .TXT"})})}),t.jsx(M,{item:!0,xs:12,children:t.jsx(Ot,{globalFilter:r,data:e,renderRowActions:({row:i})=>t.jsxs(t.Fragment,{children:[t.jsx(se,{to:Bt("edit/song/",{song:i.original.id,id:null}),children:t.jsx(te,{title:"Edit the song","data-test":"edit-song","data-song":i.original.id,children:t.jsx(Wt,{})})}),t.jsx(te,{title:"Download .txt file",onClick:async()=>{const d=await O.get(i.original.id),p=It(d),u=document.createElement("a");u.href=`data:plain/text;charset=utf-8,${encodeURIComponent(p)}`,u.download=`${O.generateSongFile(d)}.txt`,document.body.appendChild(u),u.click(),document.body.removeChild(u)},"data-test":"download-song","data-song":i.original.id,children:t.jsx(Cn,{})}),!i.original.isDeleted&&t.jsx(te,{title:"Hide the song",onClick:async()=>{await O.softDeleteSong(i.original.id),a()},"data-test":"hide-song","data-song":i.original.id,children:t.jsx(wn,{})}),i.original.isDeleted&&t.jsx(te,{title:"Restore the song",onClick:async()=>{await O.restoreSong(i.original.id),a()},"data-test":"restore-song","data-song":i.original.id,children:t.jsx(Kt,{})}),t.jsx(te,{className:i.original.local?"":"cursor-default! opacity-50",title:"Delete the song",onClick:async()=>{global.confirm("Are you sure you want to delete this song?")&&(await O.deleteSong(i.original.id),n&&e.some(p=>p.id===i.original.id)&&Mt.capture("unshare-song",{songId:i.original.id}),a())},"data-test":"delete-song","data-song":i.original.id,children:t.jsx(Lt,{})})]})})}),n!==null&&t.jsx(M,{item:!0,xs:12,children:t.jsx(Ht,{control:t.jsx(_t,{defaultChecked:!0,checked:n,onChange:i=>s(i.target.checked),"data-test":"share-songs-switch"}),label:"Share added songs (so they can be played by others)"})})]})]})})]}):t.jsx(t.Fragment,{children:"Loading"})}const kn=V("div",{target:"e4idn2b0"})({name:"19rvb6v",styles:"margin:0 auto;height:100%;width:1260px;background:white;padding:60px 20px 0 20px"});export{Ln as Convert,Mn as SongList};
//# sourceMappingURL=SongManagement-Bj-j-0-g.js.map
